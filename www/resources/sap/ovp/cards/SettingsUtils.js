sap.ui.define(["jquery.sap.global","sap/m/Dialog","sap/m/Button","sap/ovp/cards/PayLoadUtils","sap/ovp/cards/OVPCardAsAPIUtils","sap/ovp/cards/rta/SettingsDialogConstants","sap/ui/Device","sap/m/MessagePopover","sap/m/MessagePopoverItem","sap/m/Link","sap/m/MessageBox","sap/ovp/cards/AnnotationHelper","sap/ui/core/mvc/ViewType","sap/ui/model/json/JSONModel","sap/ui/model/resource/ResourceModel","sap/ovp/app/resources"],function(Q,D,B,P,O,S,a,M,b,L,c,A,V,J,R,d){"use strict";var r=d;function e(i,q,a1){var b1=i.getComponentInstance(),c1=b1.getComponentData(),d1=c1.appComponent,e1=c1.mainComponent,f1=(a1)?"":c1.cardId,g1=f1+"Dialog",h1=(a1)?"":c1.modelName,i1=(!h1)?undefined:d1.getModel(h1),j1=q.getModel().getData(),k1={cards:{}};k1.cards[g1]={template:j1.template,settings:j1};if(_.bNewKPICardFlag){var l1=j1.selectedKPI;i1=new sap.ui.model.odata.v2.ODataModel(l1.ODataURI,{'annotationURI':l1.ModelURI,'defaultCountMode':sap.ui.model.odata.CountMode.None});h1="customer.kpi_card_model_"+g(l1.ODataURI);}if(i1&&!!h1){k1.cards[g1].model=h1;q.setModel(i1,h1);}k1.cards[g1]=e1._getTemplateForChart(k1.cards[g1]);q.getController()._oManifest=k1;if(_.bNewKPICardFlag){i1.getMetaModel().loaded().then(function(){var m1=O.createCardComponent(q,k1,"dialogCard");m1.then(function(){q.setBusy(false);}).catch(function(){s(k1.cards[g1].settings,"OVP_KEYUSER_ANNOTATION_FAILURE");f(q,k1,g1);});},function(m1){Q.sap.log.error(m1);});i1.attachMetadataFailed(function(){s(k1.cards[g1].settings,"OVP_KEYUSER_METADATA_FAILURE");f(q,k1,g1);});}else{O.createCardComponent(q,k1,"dialogCard");}}function g(i){var q=i.split("/");return q[q.length-1]?q[q.length-1]:q[q.length-2];}function f(i,q,a1){q.cards[a1].template="sap.ovp.cards.error";q.cards[a1].model=undefined;var b1=O.createCardComponent(i,q,"dialogCard");var c1=i.getController();b1.then(function(){i.setBusy(false);c1.setBusy(false);}).catch(function(){i.setBusy(false);c1.setBusy(false);});}function s(i,q){if(i){i.errorStatusText=d.getText(q);}}function h(i){if(i.indexOf('#')!==-1){return i.split('#')[1];}else{return"Default";}}function j(i,q){if(i){var a1,b1,c1;if(i.indexOf("{")===0&&i.indexOf("}")===i.length-1){i=i.slice(1,-1);if(i.indexOf(">")!=-1){a1=i.split(">");c1=a1[0];b1=a1[1];}else if(i.indexOf("&gt;")!=-1){a1=i.split("&gt;");c1=a1[0];b1=a1[1];}if(!!b1&&c1==="@i18n"&&_.oi18nModel){return _.oi18nModel.getProperty(b1);}else{return i;}}else{return i;}}else{return q;}}function k(i,q,a1,b1){if(q[i]&&q[i][a1]){return j(q[i][a1].String,b1);}else{return b1;}}function l(i,q){var a1=h(q),b1=d.getText("OVP_KEYUSER_LABEL_DEFAULT_LABEL_WITH_QUALIFIER",[a1]);b1=(b1)?b1:a1;if(q.indexOf(",")!==-1){q=q.split(",")[0];}if(q.indexOf(".Identification")!==-1){if(i[q]){var c1=A.sortCollectionByImportance(i[q]);for(var d1=0;d1<c1.length;d1++){var e1=c1[d1];if(e1.RecordType==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"){if(e1&&e1["Label"]){return j(e1["Label"].String,b1);}else{return e1["SemanticObject"].String+"-"+e1["Action"].String;}}if(e1.RecordType==="com.sap.vocabularies.UI.v1.DataFieldWithUrl"){if(e1&&e1["Label"]){return j(e1["Label"].String,b1);}else{return e1["Url"].String;}}}}return d.getText("OVP_KEYUSER_LABEL_NO_NAVIGATION");}else if(q.indexOf(".HeaderInfo")!==-1){if(i[q]&&i[q]["Description"]&&i[q]["Description"].Label){return j(i[q]["Description"].Label.String,b1);}else{return b1;}}else if(q.indexOf(".PresentationVariant")!==-1||q.indexOf(".SelectionVariant")!==-1||q.indexOf(".SelectionPresentationVariant")!==-1){return k(q,i,"Text",b1);}else if(q.indexOf(".DataPoint")!==-1){return k(q,i,"Title",b1);}else if(q.indexOf(".Chart")!==-1){return k(q,i,"Description",b1);}else if(q.indexOf(".FieldGroup")!==-1){return k(q,i,"Label",b1);}else{var f1="";if(a1!=="Default"){f1="#"+a1;}var g1="com.sap.vocabularies.Common.v1.Label"+f1;if(i[q]&&i[q][g1]){return j(i[q][g1].String,b1);}else{return b1;}}}function m(i,q){switch(q){case"cardPreview":return(O.getSupportedCardTypes().indexOf(i)!==-1);case"noOfRows":case"noOfColumns":case"stopResizing":var a1=["sap.ovp.cards.stack"];return(a1.indexOf(i)===-1);case"listType":case"listFlavor":var b1=["sap.ovp.cards.list"];return(b1.indexOf(i)!==-1);case"listFlavorForLinkList":var c1=["sap.ovp.cards.linklist"];return(c1.indexOf(i)!==-1);case"isViewSwitchSupportedCard":case"kpiHeader":var d1=["sap.ovp.cards.list","sap.ovp.cards.table","sap.ovp.cards.charts.analytical","sap.ovp.cards.charts.smart.chart","sap.ovp.cards.charts.bubble","sap.ovp.cards.charts.donut","sap.ovp.cards.charts.line"];return(d1.indexOf(i)!==-1);case"chartSPVorKPI":case"chart":var e1=["sap.ovp.cards.charts.analytical","sap.ovp.cards.charts.smart.chart","sap.ovp.cards.charts.bubble","sap.ovp.cards.charts.donut","sap.ovp.cards.charts.line"];return(e1.indexOf(i)!==-1);case"sortOrder":case"sortBy":case"lineItem":var f1=["sap.ovp.cards.list","sap.ovp.cards.table"];return(f1.indexOf(i)!==-1);case"identification":var g1=["sap.ovp.cards.stack"];return(g1.indexOf(i)!==-1);default:break;}}function n(i){return!!i.kpiAnnotationPath;}function o(i){return!!i.selectionPresentationAnnotationPath;}function p(i){return o(i)||n(i);}function t(i){return i.substring(i.lastIndexOf("_")+1,i.length).indexOf("C")!==-1;}function u(i){if(i.NewKPICard){return i.NewKPICard;}else if(i.selectedKPICardID){return i.selectedKPICardID.indexOf("newKPICard")!==-1;}else{return false;}}function v(i,q,a1,b1){var c1=true;var d1=true;if(a1){if(i.mainViewSelected){d1=false;}else{c1=false;}}switch(q){case"cardPreview":return m(i.template,"cardPreview");case"noOfRows":case"noOfColumns":case"stopResizing":return c1&&m(i.template,q);case"title":return c1;case"dynamicSwitchSubTitle":return c1&&!!i.dynamicSubTitle;case"dynamicSwitchStateSubTitle":return!!i.dynamicSubtitleAnnotationPath;case"subTitle":if(!i.subTitle){i.subTitle=" ";return true;}else{return c1&&!i.dynamicSubtitleAnnotationPath;}break;case"dynamicSubTitle":return d1&&!!i.dynamicSubtitleAnnotationPath;case"valueSelectionInfo":if(!i.valueSelectionInfo){i.valueSelectionInfo=" ";}return c1&&(m(i.template,"kpiHeader")&&!!i.dataPointAnnotationPath)&&!u(i);case"dataPoint":return d1&&!n(i)&&(m(i.template,"kpiHeader")&&!!i.dataPointAnnotationPath);case"listType":case"listFlavor":case"listFlavorForLinkList":return c1&&m(i.template,q);case"identification":return d1&&(!i.staticContent)&&!m(i.template,q);case"selectionPresentationVariant":return d1&&o(i)&&!n(i)&&m(i.template,"kpiHeader");case"KPI":return d1&&n(i)&&!o(i)&&m(i.template,"chart")&&!u(i);case"presentationVariant":case"selectionVariant":return d1&&!p(i)&&(!i.staticContent)&&m(i.template,"kpiHeader");case"kpiHeader":return c1&&!n(i)&&m(i.template,q);case"lineItem":case"chart":return d1&&!p(i)&&m(i.template,q);case"chartSPVorKPI":return d1&&p(i)&&!u(i)&&m(i.template,q);case"presentationVariantSPVorKPI":case"selectionVariantSPVorKPI":return d1&&p(i)&&!u(i)&&(!i.staticContent)&&m(i.template,"kpiHeader");case"showViewName":return a1&&d1;case"showDefaultView":if(a1&&d1){if(i.defaultViewSelected!=i.selectedKey){return true;}}return false;case"showEntitySet":if(a1&&d1){if(i.selectedKey>0&&i.tabs[i.selectedKey-1].entitySet){return true;}}return false;case"showMore":case"removeVisual":case"lineItemSubTitle":case"lineItemTitle":case"staticLink":case"links":var e1=(i.template==="sap.ovp.cards.linklist"&&!!i.staticContent);if(q==="staticLink"){return(e1&&!!i.staticContent[b1].targetUri);}else if(q==="links"){return(e1&&!!i.staticContent[b1].semanticObject);}else if(q==="removeVisual"){return(e1&&(!!i.staticContent[b1].targetUri||!!i.staticContent[b1].semanticObject));}else{return e1;}break;default:break;}}function w(i){var q=false;this.oVisibility.viewSwitchEnabled=false;this.oVisibility.showViewSwitch=false;if(m(i.template,"isViewSwitchSupportedCard")&&!u(i)){if(i.tabs&&i.tabs.length){q=true;this.oVisibility.showViewSwitch=true;}this.oVisibility.viewSwitchEnabled=true;}this.oVisibility.cardPreview=v(i,"cardPreview");this.oVisibility.stopResizing=v(i,"stopResizing",q);this.oVisibility.noOfRows=v(i,"noOfRows",q);this.oVisibility.noOfColumns=v(i,"noOfColumns",q);this.oVisibility.title=v(i,"title",q);this.oVisibility.subTitle=v(i,"subTitle",q);this.oVisibility.valueSelectionInfo=v(i,"valueSelectionInfo",q);this.oVisibility.listType=v(i,"listType",q);this.oVisibility.listFlavor=v(i,"listFlavor",q);this.oVisibility.listFlavorForLinkList=v(i,"listFlavorForLinkList",q);if(i.template==="sap.ovp.cards.linklist"&&!!i.staticContent){var a1=i.staticContent,b1={},c1={},d1={},e1={};for(var f1=0;f1<a1.length;f1++){var g1=a1[f1].index;b1[g1]=v(i,"staticLink",null,f1);c1[g1]=v(i,"links",null,f1);d1[g1]=v(i,"removeVisual",null,f1);e1[g1]=v(i,"showMore",null,f1);}this.oVisibility.staticLink=b1;this.oVisibility.links=c1;this.oVisibility.removeVisual=d1;this.oVisibility.showMore=e1;}this.oVisibility.lineItemTitle=v(i,"lineItemTitle");this.oVisibility.lineItemSubTitle=v(i,"lineItemSubTitle");this.oVisibility.showViewName=v(i,"showViewName",q);this.oVisibility.showDefaultView=v(i,"showDefaultView",q);this.oVisibility.showEntitySet=v(i,"showEntitySet",q);this.aVariantNames.forEach(function(h1){this.oVisibility[h1.sPath]=v(i,h1.sPath,q)&&!!i[h1.sPath]&&!!i[h1.sPath].length;}.bind(this));this.oVisibility.kpiHeader=v(i,"kpiHeader",q)&&!!i["dataPoint"]&&!!i["dataPoint"].length;this.oVisibility.dynamicSwitchSubTitle=v(i,"dynamicSwitchSubTitle",q);this.oVisibility.dynamicSwitchStateSubTitle=v(i,"dynamicSwitchStateSubTitle",q);this.oVisibility.moveToTheTop=false;this.oVisibility.moveUp=false;this.oVisibility.moveDown=false;this.oVisibility.moveToTheBottom=false;this.oVisibility.delete=false;}function x(i){var q=i.getProperty("/staticContent");for(var a1=0;a1<q.length;a1++){q[a1].index="Index--"+(a1+1);}i.setProperty("/staticContent",q);}function y(q){var a1=0;for(var i=q.length-1;i>=0;i--){if(/^\d+$/.test(q[i])){a1=parseInt(q[i],10);break;}}return a1;}function z(i){if(i.lineItem){i.lineItem.forEach(function(a1){if(a1.value===i.annotationPath){i.lineItemQualifier=a1.name;}});}if(i.tabs&&i.tabs.length&&i.selectedKey){i.viewName=i.tabs[i.selectedKey-1].value;i.isDefaultView=false;if(i.selectedKey===i.defaultViewSelected){i.isDefaultView=true;}}var q=i.sortOrder;i.sortOrder="descending";if(q&&q.toLowerCase()!=="descending"){i.sortOrder="ascending";}i.isExtendedList=false;if(i.listType==="extended"){i.isExtendedList=true;}i.isBarList=false;if(i.listFlavor==="bar"){i.isBarList=true;}i.hasKPIHeader=false;if(i.dataPointAnnotationPath){i.hasKPIHeader=true;}return i;}function C(i){var q=i.kpiAnnotationPath;var a1=i.template;var b1=i.entityType;var c1="";if(q&&b1&&a1==="sap.ovp.cards.charts.analytical"){var d1=b1[q];var e1=d1&&d1.Detail;if(e1&&e1.RecordType==="com.sap.vocabularies.UI.v1.KPIDetailType"&&e1.SemanticObject&&e1.Action){c1="#"+e1.SemanticObject.String+"-"+e1.Action.String;}}i["KPINav"]=c1;}function E(i){var q=[],a1=i.metaModel,b1=(!!a1)?a1.getODataEntityContainer().entitySet:[];b1.forEach(function(c1){var d1=d.getText("OVP_KEYUSER_LABEL_DEFAULT_LABEL_WITH_QUALIFIER",[c1.name]),e1=a1.getODataEntityType(c1.entityType)["sap:label"];q.push({name:j(e1,d1),value:c1.name});});if(q.length>0){i["allEntitySet"]=q;}}function F(i){var q=i.entityType;if(!i["allEntitySet"]){E(i);}C(i);this.aVariantNames.forEach(function(d1){var e1=[],f1=1;for(var g1 in q){if(q.hasOwnProperty(g1)&&g1.indexOf(d1.sVariant)!==-1){if(d1.sVariant===".LineItem"){var h1={name:r.getText("OVP_KEYUSER_LABEL_LINEITEM_OPTIONS",[f1]),value:g1,fields:A.sortCollectionByImportance(q[g1])};e1.push(h1);f1++;}else{e1.push({name:l(q,g1),value:g1});}}}if(e1.length!==0){i[d1.sPath]=e1;}});if(i.entityType&&i.entityType.property){i["modelProperties"]=i.entityType.property.map(function(d1){return{name:d1.name,value:d1.name};});}if(!!i.tabs&&i.tabs.length){var a1=false,b1=i.tabs[i.tabs.length-1].value,c1=b1.split(' ');i.newViewCounter=y(c1);i.defaultViewSelected=i.selectedKey;i.isViewResetEnabled=false;i.aViews=[{text:r&&r.getText("OVP_KEYUSER_LABEL_MAIN_VIEW"),key:0,isLaterAddedView:false,isViewResetEnabled:false}];a1=i.tabs.some(function(d1){return d1.dataPointAnnotationPath;});i.tabs.forEach(function(d1,e1){var f1=d1.value;if(a1&&!d1.dataPointAnnotationPath&&d1.dataPoint&&d1.dataPoint.length){d1.dataPointAnnotationPath=d1.dataPoint[0].value;}if(e1+1===i.selectedKey){f1=d1.value;if(r){f1+=" ("+r.getText("OVP_KEYUSER_LABEL_DEFAULT_VIEW")+")";}else{f1+=" (Default view)";}}i.aViews.push({text:f1,key:e1+1,initialSelectedKey:e1+1,isLaterAddedView:false,isViewResetEnabled:false});});}else if(m(i.template,"isViewSwitchSupportedCard")){i.newViewCounter=0;i.aViews=[{text:r.getText("OVP_KEYUSER_SHOWS_DIFFERENT_VIEWS"),key:0,initialSelectedKey:0,isLaterAddedView:false,isViewResetEnabled:false}];}return i;}function G(q){var a1=q.getData();if(sap.ushell&&sap.ushell.Container){sap.ushell.Container.getService("CrossApplicationNavigation").getLinks().done(function(b1){var c1=[],d1={};for(var i=0;i<b1.length;i++){c1.push(b1[i].intent);d1[b1[i].intent]=b1[i].text;}sap.ushell.Container.getService("CrossApplicationNavigation").isIntentSupported(c1).done(function(e1){var b1=[];for(var f1 in e1){if(e1.hasOwnProperty(f1)&&e1[f1].supported===true&&d1&&d1[f1]){b1.push({name:d1[f1],value:f1});}}var g1=a1;if(b1.length!==0||b1.length!==0){g1["links"]=b1;}q.refresh();}).fail(function(e1){Q.sap.log.error(e1);});}).fail(function(i){Q.sap.log.error(i);});}}function H(i){this.oResetButton.setEnabled(i);}function I(i){this.oSaveButton.setEnabled(i);var q=this.oMessagePopOver.getModel(),a1=q.getProperty("/Counter/Error");this.bError=(a1>0);}function K(i){var q=new RegExp("((http|https)(:\/\/))?([a-zA-Z0-9]+[.]{1}){2}[a-zA-z0-9]+(\/{1}[a-zA-Z0-9]+)*\/?","i");return q.test(i);}function N(i,q){if(q==="targetUri"){return!K(i)&&(!!i||i==="");}else{return!(i.trim().length);}}function T(q){var a1=q.getParameter("path"),b1="",c1,i,d1,e1,f1,g1;if(a1==="/title"||a1==="title"||a1==="/viewName"||a1==="targetUri"||a1==="value"){var h1=q.getParameter("value"),i1=N(h1,a1),j1,k1=q.getParameter("context");if(a1==="/viewName"){j1=q.getSource().getProperty("/selectedKey");b1=d.getText("OVP_KEYUSER_INPUT_ERROR_VIEW_NAME");a1="/tabs/"+(j1-1)+"/value";}if(a1==="value"){b1=d.getText("OVP_KEYUSER_INPUT_ERROR_VIEW_NAME");a1=k1.getPath()+"/"+a1;}if(a1.indexOf("/title")!==-1){b1=d.getText("OVP_KEYUSER_INPUT_ERROR");}if(k1&&k1.getPath().indexOf("staticContent")!==-1){c1=k1.getPath().split("/");if(a1==="title"){b1=d.getText("OVP_KEYUSER_INPUT_ERROR_RECORD_TITLE")+(parseInt(c1[c1.length-1],10)+1);}else if(a1==="targetUri"){b1=d.getText("OVP_KEYUSER_INPUT_ERROR_RECORD_URL")+" "+(parseInt(c1[c1.length-1],10)+1);}a1=k1.getPath()+"/"+a1;}d1=this.oMessagePopOver.getModel();e1=d1.getProperty("/Messages");f1=d1.getProperty("/Counter/All");g1=d1.getProperty("/Counter/Error");if(i1){I.bind(this)(true);for(i=0;i<e1.length;i++){if(e1[i].fieldName===a1){e1.splice(i,1);f1--;g1--;i--;}}e1.push({"type":"Error","title":b1,"fieldName":a1,"counter":g1+1});f1++;g1++;}else{I.bind(this)(true);for(i=0;i<e1.length;i++){if(e1[i].fieldName===a1){e1.splice(i,1);f1--;g1--;i--;}}}d1.setProperty("/Messages",e1);d1.setProperty("/Counter/All",f1);d1.setProperty("/Counter/Error",g1);d1.refresh(true);}else if(a1==="/staticContent,title"||a1==="/staticContent,targetUri"||a1==="/tabs,value"){c1=a1.split(",");d1=this.oMessagePopOver.getModel();e1=d1.getProperty("/Messages");f1=d1.getProperty("/Counter/All");g1=d1.getProperty("/Counter/Error");I.bind(this)(true);for(i=0;i<e1.length;i++){if(e1[i].fieldName.indexOf(c1[0])!==-1&&e1[i].fieldName.indexOf(c1[1])!==-1){e1.splice(i,1);f1--;g1--;i--;}}d1.setProperty("/Messages",e1);d1.setProperty("/Counter/All",f1);d1.setProperty("/Counter/Error",g1);d1.refresh(true);}}function U(){var i=this.oMessagePopOver.getModel();i.setProperty("/Messages",[]);i.setProperty("/Counter/All",0);i.setProperty("/Counter/Error",0);i.setProperty("/Counter/Success",0);i.setProperty("/Counter/Warning",0);i.setProperty("/Counter/Information",0);i.refresh(true);}function W(){var i=new L({text:"Show more information",href:"",target:"_blank"});var q=new b({type:"{type}",title:"{title}",description:"{description}",subtitle:"{subtitle}",counter:"{counter}",fieldName:"{fieldName}",link:i});this.oMessagePopOver=new M({items:{path:"/Messages",template:q}});var a1={"Counter":{"All":0,"Error":0,"Success":0,"Warning":0,"Information":0},"Messages":[]};var b1=new J(a1);this.oMessagePopOver.setModel(b1);this.oMessagePopOverButton.setModel(b1);}function X(i,q){var a1=i.byId("sapOvpSettingsForm");if(a1){var b1=a1.getDomRef();if(b1){b1.style.width=q;}}}function Y(i){var q=this.dialogBox.getContent()[0],a1=q.getModel(),b1=q.getModel("deviceMediaProperties");switch(i.name){case"S":case"M":b1.setProperty("/deviceMedia","Column");X(q,"100%");break;case"L":case"XL":default:b1.setProperty("/deviceMedia","Row");X(q,"calc(100% - "+(a1.getProperty("/dialogBoxWidth")+1)+"rem)");break;}b1.refresh(true);}function Z(){a.media.detachHandler(Y.bind(this),null,"SettingsViewRangeSet");a.media.removeRangeSet("SettingsViewRangeSet");}function $(){a.media.initRangeSet("SettingsViewRangeSet",[520,760,960],"px",["S","M","L","XL"]);a.media.attachHandler(Y.bind(this),null,"SettingsViewRangeSet");Y.bind(this)(a.media.getCurrentRange("SettingsViewRangeSet"));}var _={dialogBox:undefined,oSaveButton:undefined,oResetButton:undefined,oMessagePopOverButton:undefined,oMessagePopOver:undefined,oAppDescriptor:undefined,oOriginalAppDescriptor:undefined,oMainComponent:undefined,oAppComponent:undefined,sApplicationId:"",oi18nModel:undefined,iContentHeightForDialog:38,iContentHeightForDialogWithViewSwitch:33,aVariantNames:S.aVariantNames,attachWindowResizeHandler:$,detachWindowResizeHandler:Z,settingFormWidth:X,addKPINavApplicationName:C,addManifestSettings:z,setVisibilityForFormElements:w,getVisibilityOfElement:v,enableResetButton:H,enableSaveButton:I,checkClonedCard:t,resetErrorHandling:U,createErrorCard:f,setErrorMessage:s,getQualifier:h,getTrimmedDataURIName:g,addSupportingObjects:F,oVisibility:S.oVisibility,bError:false,bNewStaticLinkListCardFlag:false,bNewKPICardFlag:false,getDialogBox:function(i){return new Promise(function(a1,b1){if(!this.dialogBox){this.oSaveButton=new B("settingsSaveBtn",{text:d.getText("save"),type:"Emphasized"});var c1=new B("settingsCancelBtn",{text:d.getText("cancelBtn")});this.oResetButton=new B("settingsResetBtn",{text:d.getText("resetCardBtn")});this.oMessagePopOverButton=new B("settingsMessagePopOverBtn",{text:"{/Counter/All}",type:"Emphasized",icon:"sap-icon://message-popup",visible:"{= ${/Counter/All} === 0 ? false : true}"}).addStyleClass("sapOvpSettingsMessagePopOverBtn");this.dialogBox=new D("settingsDialog",{title:d.getText("settingsDialogTitle"),buttons:[this.oMessagePopOverButton,this.oSaveButton,c1,this.oResetButton],afterClose:function(I1){var G1=this.dialogBox.getContent()[0],J1=G1.byId("sapOvpSettingsLineItemTitle"),K1=G1.byId("sapOvpSettingsLineItemSubTitle");if(J1){J1.destroy();}if(K1){K1.destroy();}this.bNewStaticLinkListCardFlag=false;this.bNewKPICardFlag=false;this.dialogBox.destroyContent();this.detachWindowResizeHandler();}.bind(this)});this.dialogBox.setBusyIndicatorDelay(0);c1.attachPress(function(I1){this.dialogBox.close();}.bind(this));}this.oResetButton.setVisible(!this.bNewKPICardFlag);W.bind(this)();var d1=this.bNewStaticLinkListCardFlag||this.bNewKPICardFlag;var e1=i.getComponentInstance(),f1=e1.getRootControl().getModel("ovpCardProperties"),g1;this.oi18nModel=e1.getComponentData().i18n;if(this.bNewStaticLinkListCardFlag){g1={"title":"New Title","subTitle":"New Subtitle","staticContent":[],"listFlavor":"standard","template":"sap.ovp.cards.linklist","layoutDetail":f1.getProperty("/layoutDetail")};}else if(this.bNewKPICardFlag){var h1=e1.getComponentData().mainComponent.getView().getModel("JSONModelForSSB").getProperty("/d/results"),i1=h1[0];g1={"entitySet":i1.ODataEntityset,"kpiAnnotationPath":"com.sap.vocabularies.UI.v1.KPI#"+i1.KPIQualifier,"title":i1.GroupTitle,"subTitle":i1.KPITitle,"template":"sap.ovp.cards.charts.analytical","layoutDetail":f1.getProperty("/layoutDetail"),"selectedKPI":i1,"errorStatusText":undefined,"KPIData":h1};}else{g1=f1.getData();}var j1=Q.extend(true,{},g1);j1=F.call(this,j1);j1=this.addManifestSettings(j1);var k1=new J(j1),l1=i.getDomRef().offsetHeight,m1=new J(a.system),n1=new J({"deviceMedia":"Row"}),o1=e1.getComponentData(),p1=o1.mainComponent,q1=o1.appComponent,r1=(d1)?"":o1.cardId;this.oAppComponent=q1;this.oAppDescriptor=p1._getCardFromManifest(r1);this.sApplicationId=p1._getApplicationId();this.oMainComponent=p1;this.oOriginalAppDescriptor=q1._getOvpCardOriginalConfig(r1);m1.setDefaultBindingMode("OneWay");j1.dialogBoxHeight=l1;j1.dialogBoxWidth=20;if(j1.template==="sap.ovp.cards.linklist"){k1.setProperty("/listFlavorName",d.getText("OVP_KEYUSER_CAROUSEL"));}else{k1.setProperty("/listFlavorName",d.getText("OVP_KEYUSER_BARLIST"));}if(j1.layoutDetail==="resizable"){if(!j1.defaultSpan){j1.defaultSpan={};k1.setProperty("/defaultSpan/cols",k1.getProperty("/cardLayout/colSpan"));k1.setProperty("/defaultSpan/rows",j1.template==="sap.ovp.cards.list"||j1.template==="sap.ovp.cards.table"?k1.getProperty("/cardLayout/noOfItems"):k1.getProperty("/cardLayout/rowSpan"));}else{if(!j1.defaultSpan.rows){k1.setProperty("/defaultSpan/rows",j1.template==="sap.ovp.cards.list"||j1.template==="sap.ovp.cards.table"?k1.getProperty("/cardLayout/noOfItems"):k1.getProperty("/cardLayout/rowSpan"));}if(!j1.defaultSpan.cols){k1.setProperty("/defaultSpan/cols",k1.getProperty("/cardLayout/colSpan"));}}j1.NoOfColumns=[];var s1=1,t1=6;for(var q=s1;q<=t1;q++){j1.NoOfColumns.push({value:q});}if(m(j1.template,'chart')||j1.template==='sap.ovp.cards.linklist'){var u1=i.getComponentInstance().getComponentData().mainComponent,v1=u1.getLayout(),w1=v1.getDashboardLayoutUtil(),x1=p1._getCardId(i.getId()),y1=w1.calculateCardProperties(x1),z1=w1._getCardController(x1).getView().byId('bubbleText')?43:0,A1=y1.headerHeight+y1.dropDownHeight+z1+50,B1=Math.ceil(y1.minCardHeight/w1.getRowHeightPx())+1;j1.NoOfRows=[];j1.NoOfRows.push({name:"None",value:0});j1.NoOfRows.push({name:"Small",value:B1});j1.NoOfRows.push({name:"Standard",value:Math.ceil((A1+480)/w1.getRowHeightPx())+1});if(this.bNewStaticLinkListCardFlag||this.bNewKPICardFlag){k1.setProperty("/defaultSpan/cols",1);k1.setProperty("/defaultSpan/rows",B1);}}}var C1={};var D1=new J(C1);G(D1);if(j1.template==="sap.ovp.cards.linklist"&&j1.staticContent){x(k1);k1.setProperty("/lineItemId","linkListItem--1");k1.setProperty("/lineItemIdCounter",j1.staticContent.length);}if(j1.template==="sap.ovp.cards.charts.analytical"){var E1=p1._getCardId(i.getId());k1.setProperty("/NewKPICard",this.bNewKPICardFlag);k1.setProperty("/selectedKPICardID",E1);}this.setVisibilityForFormElements(j1);var F1=new J(this.oVisibility);k1.attachPropertyChange(T.bind(this));var G1=new sap.ui.view("settingsView",{viewName:"sap.ovp.cards.rta.SettingsDialog",type:V.XML,preprocessors:{xml:{bindingContexts:{ovpCardProperties:k1.createBindingContext("/")},models:{ovpCardProperties:k1,deviceSystemProperties:m1}}}});G1.setModel(D1,"staticCardProperties");var H1=d.oResourceModel;G1.setModel(k1);G1.setModel(H1,"ovpResourceModel");G1.setModel(n1,"deviceMediaProperties");G1.setModel(F1,"visibility");if(this.oi18nModel){G1.setModel(this.oi18nModel,"@i18n");}this.dialogBox.addContent(G1);this.attachWindowResizeHandler();G1.loaded().then(function(I1){var J1=I1.byId("dialogCard");if(!J1.getVisible()){J1=I1.byId("dialogCardNoPreview");var K1=G1.getModel().getProperty("/template").split("."),L1=K1[K1.length-1],M1=d.getText("OVP_KEYUSER_NO_CARD_PREVIEW_MSG",[L1]);J1.setText(M1);}else{J1.setWidth(j1.dialogBoxWidth+"rem");}e(i,I1,d1);this.dialogBox.open();I1.getController().settingsResolve=a1;}.bind(this));}.bind(this));}};_.fnEditCardHandler=function(i,q){var a1=i.getComponentInstance().getComponentData().mainComponent,b1=a1.getLayout(),c1=a1.getUIModel();return _.getDialogBox(i).then(function(d1){var e1=[{appComponent:i.getComponentInstance().getComponentData().appComponent,changeSpecificData:{appDescriptorChangeType:"appdescr_ovp_changeCard",content:d1.appDescriptorChange}},{selectorControl:i.getComponentInstance().getComponentData().appComponent.getRootControl().getController().getLayout(),changeSpecificData:{runtimeOnly:true,changeType:"editCardSettings",content:d1.flexibilityChange}}];if(d1.viewSwitchChange){e1.push({selectorControl:i.getComponentInstance().getComponentData().appComponent.getRootControl().getController().getLayout(),changeSpecificData:{changeType:"viewSwitch",content:d1.viewSwitchChange}});}if(c1.getProperty('/containerLayout')==='resizable'){var f1=b1.getDashboardLayoutModel(),g1=b1.getDashboardLayoutUtil(),h1=a1._getCardId(i.getId()),i1=f1.getCardById(h1),j1=g1.calculateCardProperties(h1),k1=f1.getColCount(),l1='C'+k1,m1=d1.flexibilityChange.newAppDescriptor.settings.defaultSpan,n1,o1=[];if(m1&&m1.cols){e1.forEach(function(p1){if(p1.changeSpecificData.changeType==='editCardSettings'){var q1=p1.changeSpecificData.content.oldAppDescriptor;q1.settings.defaultSpan={rowSpan:i1.dashboardLayout.rowSpan,colSpan:i1.dashboardLayout.colSpan,showOnlyHeader:i1.dashboardLayout.showOnlyHeader};}});if(m1.rows===0){i1.dashboardLayout.autoSpan=false;n1=Math.ceil((j1.headerHeight+2*g1.CARD_BORDER_PX)/g1.getRowHeightPx());}else{i1.dashboardLayout.autoSpan=true;if(i1.template==='sap.ovp.cards.list'||i1.template==='sap.ovp.cards.table'){i1.dashboardLayout.noOfItems=m1.rows;}else{n1=m1.rows;}}f1._arrangeCards(i1,{row:n1,column:m1.cols},'resize',o1);f1._removeSpaceBeforeCard(o1);o1.forEach(function(p1){var q1={};q1.dashboardLayout={};q1.cardId=p1.content.cardId;q1.dashboardLayout[l1]=p1.content.dashboardLayout;e1.push({selectorControl:i.getComponentInstance().getComponentData().appComponent.getRootControl().getController().getLayout(),changeSpecificData:{changeType:"dragOrResize",content:q1}});});}}return e1;});};_.fnCloneCardHandler=function(i,q){return P.getPayLoadForCloneCard(i).then(function(a1){return[{appComponent:i.getComponentInstance().getComponentData().appComponent,changeSpecificData:{appDescriptorChangeType:"appdescr_ovp_addNewCard",content:a1.appDescriptorChange}},{selectorControl:i.getComponentInstance().getComponentData().appComponent.getRootControl().getController().getLayout(),changeSpecificData:{runtimeOnly:true,changeType:"newCardSettings",content:a1.flexibilityChange}}];});};_.fnAddStaticLinkListCardHandler=function(i,q){_.bNewStaticLinkListCardFlag=true;return _.getDialogBox(i).then(function(a1){return[{appComponent:i.getComponentInstance().getComponentData().appComponent,changeSpecificData:{appDescriptorChangeType:"appdescr_ovp_addNewCard",content:a1.appDescriptorChange}},{selectorControl:i.getComponentInstance().getComponentData().appComponent.getRootControl().getController().getLayout(),changeSpecificData:{runtimeOnly:true,changeType:"newCardSettings",content:a1.flexibilityChange}}];});};_.fnAddKPICardHandler=function(i,q){_.bNewKPICardFlag=true;return _.getDialogBox(i).then(function(a1){var b1=[{appComponent:i.getComponentInstance().getComponentData().appComponent,changeSpecificData:{appDescriptorChangeType:"appdescr_ovp_addNewCard",content:a1.appDescriptorChange}},{selectorControl:i.getComponentInstance().getComponentData().appComponent.getRootControl().getController().getLayout(),changeSpecificData:{runtimeOnly:true,changeType:"newCardSettings",content:a1.flexibilityChange}}];if(a1.addODataAnnotation){b1.push({appComponent:i.getComponentInstance().getComponentData().appComponent,changeSpecificData:{appDescriptorChangeType:"appdescr_app_addAnnotationsToOData",content:a1.addODataAnnotation}});}return b1;});};_.fnRemoveCardHandler=function(i,q){return new Promise(function(a1,b1){c.confirm(d.getText("OVP_KEYUSER_MESSAGE_BOX_WARNING_MESSAGE_DELETE"),{actions:[c.Action.DELETE,c.Action.CANCEL],icon:c.Icon.WARNING,title:d.getText("OVP_KEYUSER_MESSAGE_BOX_TITLE_DELETE"),initialFocus:c.Action.CANCEL,onClose:function(c1){if(c1==="DELETE"){a1(P.getPayLoadForRemoveCard(i));}else{b1(null);}}});}).then(function(a1){var b1=[{appComponent:i.getComponentInstance().getComponentData().appComponent,changeSpecificData:{appDescriptorChangeType:"appdescr_ovp_removeCard",content:a1.appDescriptorChange}},{selectorControl:i.getComponentInstance().getComponentData().appComponent.getRootControl().getController().getLayout(),changeSpecificData:{runtimeOnly:true,changeType:"removeCardContainer",content:a1.flexibilityChange}}];if(a1.removeDataSourceChange){a1.removeDataSourceChange.forEach(function(c1){b1.push({appComponent:i.getComponentInstance().getComponentData().appComponent,changeSpecificData:{appDescriptorChangeType:"appdescr_app_removeDataSource",content:c1}});});}return b1;},function(a1){return[];});};return _;},true);
