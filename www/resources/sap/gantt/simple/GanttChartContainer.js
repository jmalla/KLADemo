/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/core/Control","sap/ui/base/ManagedObjectObserver","sap/ui/layout/Splitter","sap/ui/layout/SplitterLayoutData","sap/ui/core/Orientation","../control/AssociateContainer","../config/TimeHorizon"],function(C,M,S,a,O,A,T){"use strict";var G=C.extend("sap.gantt.simple.GanttChartContainer",{metadata:{library:"sap.gantt",properties:{height:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:'100%'},width:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:'100%'},layoutOrientation:{type:"sap.ui.core.Orientation",group:"Behavior",defaultValue:sap.ui.core.Orientation.Vertical},enableTimeScrollSync:{type:"boolean",defaultValue:true},enableCursorLine:{type:"boolean",defaultValue:true},enableNowLine:{type:"boolean",defaultValue:true},enableVerticalLine:{type:"boolean",defaultValue:true},enableAdhocLine:{type:"boolean",defaultValue:true}},defaultAggregation:"ganttCharts",aggregations:{toolbar:{type:"sap.gantt.simple.ContainerToolbar",multiple:false},ganttCharts:{type:"sap.gantt.simple.GanttChartWithTable",multiple:true},svgDefs:{type:"sap.gantt.def.SvgDefs",multiple:false}},events:{customSettingChange:{parameters:{name:{type:"string"},value:{type:"boolean"}}}}}});var b=["enableCursorLine","enableNowLine","enableVerticalLine","enableAdhocLine"];var c=["enableTimeScrollSync"].concat(b);b.forEach(function(p){G.prototype["set"+jQuery.sap.charToUpperCase(p,0)]=function(v){this.setProperty(p,v);this.getGanttCharts().forEach(function(g){g.setProperty(p,v);});return this;};});G.prototype.setSharedPropertiesValueToGantts=function(){b.forEach(function(p){var P=this.getProperty(p);this.getGanttCharts().forEach(function(g){g.setProperty(p,P,true);});}.bind(this));};G.prototype.init=function(){this._bInitHorizonApplied=false;this._oSplitter=new S({orientation:this.getLayoutOrientation()});this.oObserver=new M(this.observePropertiesChanges.bind(this));this.oObserver.observe(this,{properties:c});};G.prototype.exit=function(){this.oObserver.disconnect();};G.prototype.setToolbar=function(t){this.setAggregation("toolbar",t,true);t.attachZoomStopChange(this._onToolbarZoomStopChange,this);t.attachBirdEyeButtonPress(this._onToolbarBirdEyeButtonPress,this);t.attachEvent("_settingsChange",this._onToolbarSettingsChange.bind(this));t.attachEvent("_zoomControlTypeChange",this._onToolbarZoomControlTypeChange.bind(this));return this;};G.prototype.setLayoutOrientation=function(o){this.setProperty("layoutOrientation",o);this._oSplitter.setOrientation(o);return this;};G.prototype.addGanttChart=function(g){this.addAggregation("ganttCharts",g);this._insertGanttChart(g);};G.prototype.insertGanttChart=function(g,i){this.insertAggregation("ganttCharts",g,i);this._insertGanttChart(g,i);};G.prototype.removeGanttChart=function(g){this._removeGanttChartFromSplitter(g);var r=this.removeAggregation("ganttCharts",g);this._adjustSplitterLayoutData();return r;};G.prototype.removeAllGanttCharts=function(){var g=this.getGanttCharts();for(var i=0;i<g.length;i++){this._removeGanttChartFromSplitter(g[i]);}return this.removeAllAggregation("ganttCharts");};G.prototype._insertGanttChart=function(g,i){if(!g){return;}g.setProperty("selectionPanelSize",this._getOtherGanttSelectionPanelSize(g),"true");var o=new A({content:g,layoutData:g.getLayoutData()?g.getLayoutData().clone():new a()});if(i!==0&&!i){this._oSplitter.addContentArea(o);}else{this._oSplitter.insertContentArea(o,i);}this._sanitizeGanttChartEvents(g);this.setSharedPropertiesValueToGantts();};G.prototype._adjustSplitterLayoutData=function(){var g=this.getGanttCharts();var d=this._oSplitter.getContentAreas();if(g.length===1){d[0].getLayoutData().setSize("auto");}};G.prototype._getOtherGanttSelectionPanelSize=function(n){var o=this.getGanttCharts().filter(function(g){return g.getId()!==n.getId();});return o&&o.length>0?o[0].getSelectionPanelSize():null;};G.prototype._sanitizeGanttChartEvents=function(g){var e={"_visibleHorizonUpdate":this._onGanttChartVisibleHorizonUpdate,"_timePeriodZoomOperation":this._onGanttChartTimePeriodZoomOperation,"_zoomInfoUpdated":this._onZoomInfoUpdated,"_selectionPanelResize":this._onSelectionPanelWidthChange,"_layoutDataChange":this._onGanttChartLayoutDataChange};Object.keys(e).forEach(function(E){g.detachEvent(E,e[E],this);}.bind(this));Object.keys(e).forEach(function(E){g.attachEvent(E,e[E],this);}.bind(this));};G.prototype._onGanttChartLayoutDataChange=function(e){var g=e.getSource(),n=g.getLayoutData();this._oSplitter.getContentAreas().forEach(function(o){if(o.getContent()===g.getId()){o.getLayoutData().setSize(n.getSize()).setMinSize(n.getMinSize());}});};G.prototype._removeGanttChartFromSplitter=function(g){var o=g;if((typeof g)==="number"){o=this.getGanttCharts()[g];}if(o){this._oSplitter.removeContentArea(o);}return o;};G.prototype._onGanttChartVisibleHorizonUpdate=function(e){var p=e.getParameters();var g=this.getGanttCharts();if(p.reasonCode==="initialRender"&&!this.getEnableTimeScrollSync()){return;}if(!this.getEnableTimeScrollSync()){if(p.reasonCode==="visibleHorizonUpdated"){for(var i=0;i<g.length;i++){if(e.getSource().getId()===g[i].getId()){continue;}g[i].syncVisibleHorizon(p.visibleHorizon,p.visibleWidth,true);}}else{var s;if(p.reasonCode==="mouseWheelZoom"){s="syncMouseWheelZoom";}if(s){for(var m=0;m<g.length;m++){var o=g[m];var d=o;if(e.getSource().getId()===d.getId()){continue;}d[s](p);}}}}else{for(var j=0;j<g.length;j++){if(e.getSource().getId()===g[j].getId()){continue;}g[j].syncVisibleHorizon(p.visibleHorizon,p.visibleWidth);}}};G.prototype._onGanttChartTimePeriodZoomOperation=function(e){var t=this.getEnableTimeScrollSync();var g=this.getGanttCharts();for(var i=0;i<g.length;i++){if(e.getSource().getId()===g[i].getId()){continue;}var o=this._oSplitter.getOrientation();g[i].syncTimePeriodZoomOperation(e,t,o);}};G.prototype._onSelectionPanelWidthChange=function(e){if(this.getLayoutOrientation()===O.Horizontal){return;}var n=e.getParameter("newWidth");this.getGanttCharts().forEach(function(g){g.setSelectionPanelSize(n+"px");g._draw(true);});};G.prototype._removeGanttChartFromSplitter=function(g){var o=g;if((typeof g)==="number"){o=this.getGanttCharts()[g];}if(o){this._oSplitter.removeContentArea(o._oAC);}};G.prototype.onBeforeRendering=function(){this.observePropertiesChanges();this.handleZoomControlTypeToAxistimeStrategy();};G.prototype.handleZoomControlTypeToAxistimeStrategy=function(){if(this.getToolbar()){var g=this.getGanttCharts();var z=this.getToolbar().getZoomControlType();g.forEach(function(o){o.getAxisTimeStrategy()._updateZoomControlType(z);});}};G.prototype._onZoomInfoUpdated=function(e){if(this.getToolbar()){var z=e.getParameter("zoomLevel");if(!isNaN(z)){this.getToolbar().updateZoomLevel(z);}}};G.prototype._onToolbarBirdEyeButtonPress=function(e){var g=this.getGanttCharts();var s;var E;g.forEach(function(o){var h=o._getZoomExtension().calculateBirdEyeRange();if(h.startTime&&h.endTime){if(!s||h.startTime.getTime()<s.getTime()){s=h.startTime;}if(!E||E.getTime()<h.endTime.getTime()){E=h.endTime;}}});if(s&&E){var B=new T({startTime:s,endTime:E});g.forEach(function(o){o.syncVisibleHorizon(B);});}};G.prototype._onToolbarZoomStopChange=function(e){var g=this.getGanttCharts();g.forEach(function(o){o.getAxisTimeStrategy().updateStopInfo({index:e.getParameter("index"),selectedItem:e.getParameter("selectedItem")});});};G.prototype._onToolbarZoomControlTypeChange=function(e){this._handleZoomControlType(e.getParameter("zoomControlType"));};G.prototype._handleZoomControlType=function(z){var g=this.getGanttCharts();g.forEach(function(o){o.getAxisTimeStrategy()._updateZoomControlType(z);});};G.prototype._onToolbarSettingsChange=function(e){var p=e.getParameters();var d=[];p.forEach(function(P){var s=P.name.substr(4);if(c.indexOf(s)>=0){this["set"+jQuery.sap.charToUpperCase(s,0)](P.value);}else{d.push(P);}}.bind(this));if(d.length>0){this.fireCustomSettingChange(d);}};G.prototype.observePropertiesChanges=function(o){var s;if(!o){s=c.reduce(function(m,p){m[p]=this.getProperty(p);return m;}.bind(this),{});}else{s={};s[o.name]=o.current;}var t=this.getToolbar();if(t){t.updateSettingsConfig(s);}};return G;},true);
