sap.ui.predefine('sap/ui/vk/threejs/BBoxSubdivider',["jquery.sap.global"],function(q){"use strict";var U=function(){this.unpack=function(p){if(!p||(p.bytelength<1)){return false;}try{this.nLevel=p[0];if(this.nLevel>5){return false;}this.numDivision=Math.pow(2,this.nLevel);this.octree=new Uint8Array(Math.pow(this.numDivision,3));this.streamOffset=1;this._decodeRecursive(p,0,0,0,0);}catch(e){return false;}return true;};this.GetUnpacked=function(){return this.octree;};this._setValue=function(g,a,b,v){this.octree[b*this.numDivision*this.numDivision+a*this.numDivision+g]=v?1:0;};this._decodeRecursive=function(p,g,a,b,l){if(l===this.nLevel){this._setValue(g,a,b,true);return true;}if(this.streamOffset>=p.length){return false;}var c=p[this.streamOffset];this.streamOffset++;g*=2;a*=2;b*=2;if(l>=this.nLevel){return true;}for(var z=0;z<2;z++){for(var y=0;y<2;y++){for(var x=0;x<2;x++){if((c&(1<<(z*4+y*2+x)))!==0){if(!this._decodeRecursive(p,g+x,a+y,b+z,l+1)){return false;}}else{this._clearBitsRecursive(g+x,a+y,b+z,l+1);}}}}return true;};this._clearBitsRecursive=function(g,a,b,l){if(l===this.nLevel){this._setValue(g,a,b,false);return;}g*=2;a*=2;b*=2;if(l>=this.nLevel){return;}for(var z=0;z<2;z++){for(var y=0;y<2;y++){for(var x=0;x<2;x++){this._clearBitsRecursive(g+x,a+y,b+z,l+1);}}}};};var C=function(n){this.numDivision=n;this.xyzToIndexMap=new Map();this.points=[];this.getOrCreatePointAt=function(x,y,z,f,d){var k=x+":"+y+":"+z+":"+f+":"+d;var i=this.xyzToIndexMap.get(k);if(i){return i;}this.points.push(x/this.numDivision-0.5,y/this.numDivision-0.5,z/this.numDivision-0.5);i=this.points.length/3-1;this.xyzToIndexMap.set(k,i);return i;};};var S=function(l,n,u){this.level=l;this.numDivision=n;this.unpacked=u;this.getValue=function(g,a,b){if(g<0||a<0||b<0||g>=this.numDivision||a>=this.numDivision||b>=this.numDivision){return 0;}return this.unpacked[b*this.numDivision*this.numDivision+a*this.numDivision+g];};};var B=function(){};
B.unpackSubDividedBoundingBox=function(p){var u=new U();if(u.unpack(p)){return new S(u.nLevel,u.numDivision,u.unpacked);}return null;};
B.makeSubDividedBoundingBoxGeometry=function(s){if(!s){return null;}var i=[];var n=s.level;var e=Math.pow(2,n);var m=new C(e);var x,y,z,f,a,b,c,d;for(x=0;x<=e;x++){for(y=0;y<e;y++){for(z=0;z<e;z++){f=s.getValue(x,y,z)-s.getValue(x-1,y,z);if(f!==0){a=m.getOrCreatePointAt(x,y,z,0,f);b=m.getOrCreatePointAt(x,y+1,z,0,f);c=m.getOrCreatePointAt(x,y+1,z+1,0,f);d=m.getOrCreatePointAt(x,y,z+1,0,f);if(f<0){i.push(a,b,c);i.push(a,c,d);}else{i.push(c,b,a);i.push(d,c,a);}}}}}for(y=0;y<=e;y++){for(x=0;x<e;x++){for(z=0;z<e;z++){f=s.getValue(x,y,z)-s.getValue(x,y-1,z);if(f!==0){a=m.getOrCreatePointAt(x,y,z,1,f);b=m.getOrCreatePointAt(x+1,y,z,1,f);c=m.getOrCreatePointAt(x+1,y,z+1,1,f);d=m.getOrCreatePointAt(x,y,z+1,1,f);if(f>0){i.push(a,b,c);i.push(a,c,d);}else{i.push(c,b,a);i.push(d,c,a);}}}}}for(z=0;z<=e;z++){for(x=0;x<e;x++){for(y=0;y<e;y++){f=s.getValue(x,y,z)-s.getValue(x,y,z-1);if(f!==0){a=m.getOrCreatePointAt(x,y,z,2,f);b=m.getOrCreatePointAt(x+1,y,z,2,f);c=m.getOrCreatePointAt(x+1,y+1,z,2,f);d=m.getOrCreatePointAt(x,y+1,z,2,f);if(f<0){i.push(a,b,c);i.push(a,c,d);}else{i.push(c,b,a);i.push(d,c,a);}}}}}var g=new THREE.BufferGeometry();var h=new THREE.BufferAttribute(new Uint16Array(i),1);var p=new THREE.BufferAttribute(new Float32Array(m.points),3);g.setIndex(h);g.addAttribute("position",p);g.computeFaceNormals();g.computeVertexNormals();g.computeBoundingSphere();return g;};
return B;});
sap.ui.predefine('sap/ui/vk/threejs/UsageCounter',["jquery.sap.global","./thirdparty/three"],function(q,t){"use strict";var U=function(){};
U.increaseMaterialUsed=function(m){if(m&&m.userData&&m.userData.materialUsed!==undefined){m.userData.materialUsed++;return true;}return false;};
U.decreaseMaterialUsed=function(m){if(m&&m.userData&&m.userData.materialUsed!==undefined){m.userData.materialUsed--;return true;}return false;};
U.increaseGeometryUsed=function(g){if(g&&g.userData&&g.userData.geometryUsed!==undefined){g.userData.geometryUsed++;return true;}return false;};
U.decreaseGeometryUsed=function(g){if(g&&g.userData&&g.userData.geometryUsed!==undefined){g.userData.geometryUsed--;return true;}return false;};
return U;});
sap.ui.predefine('sap/ui/vk/tools/MoveToolHandler',["jquery.sap.global","sap/ui/base/EventProvider"],function(q,E){"use strict";
var M=E.extend("sap.ui.vk.tools.MoveToolHandler",{
metadata:{},
constructor:function(t){this._tool=t;this._gizmo=t.getGizmo();this._rect=null;this._rayCaster=new THREE.Raycaster();this._handleIndex=-1;this._gizmoIndex=-1;this._handleAxis=new THREE.Vector3();this._gizmoOrigin=new THREE.Vector3();this._mouse=new THREE.Vector2();}
});
M.prototype.destroy=function(){this._tool=null;this._gizmo=null;this._rect=null;this._rayCaster=null;this._handleAxis=null;this._gizmoOrigin=null;this._mouse=null;};
M.prototype._updateMouse=function(e){var s=this.getViewport().getRenderer().getSize();this._mouse.x=((e.x-this._rect.x)/s.width)*2-1;this._mouse.y=((e.y-this._rect.y)/s.height)*-2+1;this._rayCaster.setFromCamera(this._mouse,this.getViewport().getCamera().getCameraRef());};
M.prototype._updateHandles=function(e,h){var p=this._handleIndex;this._handleIndex=-1;for(var i=0,l=this._gizmo.getGizmoCount();i<l;i++){var t=this._gizmo.getTouchObject(i);var a=this._rayCaster.intersectObject(t,true);if(a.length>0){this._handleIndex=t.children.indexOf(a[0].object);if(this._handleIndex>=0){this._gizmoIndex=i;this._gizmoOrigin.setFromMatrixPosition(t.matrixWorld);if(this._handleIndex<3){this._handleAxis.setFromMatrixColumn(t.matrixWorld,this._handleIndex).normalize();}else if(this._handleIndex<6){this._handleAxis.setFromMatrixColumn(t.matrixWorld,this._handleIndex-3).normalize();}}}}this._gizmo.highlightHandle(this._handleIndex,h||this._handleIndex===-1);if(p!==this._handleIndex){this.getViewport().setShouldRenderFrame();}};
M.prototype.hover=function(e){if(this._inside(e)&&!this._gesture){this._updateMouse(e);this._updateHandles(e,true);e.handled|=this._handleIndex>0;}};
M.prototype._getAxisOffset=function(){var r=this._rayCaster.ray;var d=this._handleAxis.clone().cross(r.direction).cross(r.direction).normalize();var a=r.origin.clone().sub(this._gizmoOrigin);return d.dot(a)/d.dot(this._handleAxis);};
M.prototype._getPlaneOffset=function(){var r=this._rayCaster.ray;var d=this._gizmoOrigin.clone().sub(r.origin);var a=this._handleAxis.dot(d)/this._handleAxis.dot(r.direction);return r.direction.clone().multiplyScalar(a).sub(d);};
M.prototype.beginGesture=function(e){if(this._inside(e)&&!this._gesture){this._updateMouse(e);this._updateHandles(e,false);if(this._handleIndex>=0&&e.n===1){this._gesture=true;e.handled=true;this._gizmo.beginGesture();if(this._handleIndex<3){this._dragOrigin=this._getAxisOffset();}else if(this._handleIndex<6){this._dragOrigin=this._getPlaneOffset();}}}};
M.prototype.move=function(e){if(this._gesture){e.handled=true;this._updateMouse(e);if(this._handleIndex<3){if(!isNaN(this._dragOrigin)){this._gizmo._setOffset(this._handleAxis.clone().multiplyScalar(this._getAxisOffset()-this._dragOrigin),this._gizmoIndex);}}else if(this._handleIndex<6){if(!isNaN(this._dragOrigin.x)&&!isNaN(this._dragOrigin.y)&&!isNaN(this._dragOrigin.z)){this._gizmo._setOffset(this._getPlaneOffset().sub(this._dragOrigin),this._gizmoIndex);}}}};
M.prototype.endGesture=function(e){if(this._gesture){this._gesture=false;e.handled=true;this._updateMouse(e);this._gizmo.endGesture();this._dragOrigin=undefined;this._updateHandles(e,true);this.getViewport().setShouldRenderFrame();}};
M.prototype.click=function(e){};
M.prototype.doubleClick=function(e){};
M.prototype.contextMenu=function(e){};
M.prototype.getViewport=function(){return this._tool._viewport;};
M.prototype._getOffset=function(o){var r=o.getBoundingClientRect();var p={x:r.left+window.pageXOffset,y:r.top+window.pageYOffset};return p;};
M.prototype._inside=function(e){if(this._rect===null||true){var i=this._tool._viewport.getIdForLabel();var d=document.getElementById(i);if(d===null){return false;}var o=this._getOffset(d);this._rect={x:o.x,y:o.y,w:d.offsetWidth,h:d.offsetHeight};}return(e.x>=this._rect.x&&e.x<=this._rect.x+this._rect.w&&e.y>=this._rect.y&&e.y<=this._rect.y+this._rect.h);};
return M;},true);
sap.ui.predefine('sap/ui/vk/tools/RectSelectToolHandler',["jquery.sap.global","sap/ui/base/EventProvider"],function(q,E){"use strict";
var R=E.extend("sap.ui.vk.tools.RectSelectToolHandler",{
metadata:{publicMethods:["beginGesture","endGesture","move","click","doubleClick","contextMenu"]},
constructor:function(T){this._tool=T;this._rect=null;this._gesture=false;this._nomenu=false;this._selectionRect=null;}
});
R.prototype.destroy=function(){this._tool=null;this._rect=null;this._gesture=false;};
R.prototype.activate=function(v){this._deactivate=false;if(v._loco){this._viewport=v;v._loco.addHandler(this);}};
R.prototype.deactivate=function(){if(this._gesture){this._deactivate=true;}else if(this._viewport){this._deactivate=false;this._viewport._loco.removeHandler(this);this._viewport=null;}};
R.prototype._getOffset=function(o){var r=o.getBoundingClientRect();var p={x:r.left+window.pageXOffset,y:r.top+window.pageYOffset};return p;};
R.prototype._inside=function(e){var i=this._tool._viewport.getIdForLabel();var d=document.getElementById(i);if(d==null){return false;}var o=this._getOffset(d);this._rect={x:o.x,y:o.y,w:d.offsetWidth,h:d.offsetHeight};return(e.x>=this._rect.x&&e.x<=this._rect.x+this._rect.w&&e.y>=this._rect.y&&e.y<=this._rect.y+this._rect.h);};
R.prototype.beginGesture=function(e){if(this._inside(e)&&!this._gesture){this._gesture=true;e.handled=true;var x=e.x-this._rect.x,y=e.y-this._rect.y;this._selectionRect={x1:x,y1:y,x2:x,y2:y};return;}};
R.prototype.move=function(e){if(this._gesture){e.handled=true;this._nomenu=true;if(this._selectionRect){this._selectionRect.x2=e.x-this._rect.x;this._selectionRect.y2=e.y-this._rect.y;if(this._viewport){this._viewport.setSelectionRect(this._selectionRect);}}}};
R.prototype.click=function(e){e.handled=false;};
R.prototype.doubleClick=function(e){e.handled=false;};
R.prototype.contextMenu=function(e){e.handled=false;};
R.prototype.endGesture=function(e){if(this._gesture){this._gesture=false;e.handled=true;if(this._selectionRect){if(this._viewport){var x=e.x-this._rect.x,y=e.y-this._rect.y;if(this._tool.isViewportType("sap.ui.vk.dvl.Viewport")){this._tool.select(this._selectionRect.x1,this._selectionRect.y1,x,y,null,null);}else if(this._tool.isViewportType("sap.ui.vk.threejs.Viewport")){this._tool.select(this._selectionRect.x1,this._selectionRect.y1,x,y,this._viewport.getScene(),this._viewport.getCamera());}}this._viewport.setSelectionRect(null);this._selectionRect=null;}if(this._deactivate){this.deactivate();}}};
R.prototype.getViewport=function(){return this._viewport;};
return R;},true);
sap.ui.predefine('sap/ui/vk/tools/RotateToolHandler',["jquery.sap.global","sap/ui/base/EventProvider"],function(q,E){"use strict";
var R=E.extend("sap.ui.vk.tools.RotateToolHandler",{
metadata:{},
constructor:function(t){this._tool=t;this._gizmo=t.getGizmo();this._rect=null;this._rayCaster=new THREE.Raycaster();this._rayCaster.linePrecision=0.2;this._handleIndex=-1;this._gizmoIndex=-1;this._handleAxis=new THREE.Vector3();this._gizmoOrigin=new THREE.Vector3();this._matrixOrigin=new THREE.Matrix4();this._mouse=new THREE.Vector2();}
});
R.prototype.destroy=function(){this._tool=null;this._gizmo=null;this._rect=null;this._rayCaster=null;this._handleAxis=null;this._gizmoOrigin=null;this._mouse=null;};
R.prototype._updateMouse=function(e){var s=this.getViewport().getRenderer().getSize();this._mouse.x=((e.x-this._rect.x)/s.width)*2-1;this._mouse.y=((e.y-this._rect.y)/s.height)*-2+1;this._rayCaster.setFromCamera(this._mouse,this.getViewport().getCamera().getCameraRef());};
R.prototype._updateHandles=function(e,h){var p=this._handleIndex;this._handleIndex=-1;for(var i=0,l=this._gizmo.getGizmoCount();i<l;i++){var t=this._gizmo.getTouchObject(i);var a=this._rayCaster.intersectObject(t,true);if(a.length>0){this._handleIndex=t.children.indexOf(a[0].object);if(this._handleIndex>=0&&this._handleIndex<3){this._gizmoIndex=i;this._matrixOrigin.copy(t.matrixWorld);this._gizmoOrigin.setFromMatrixPosition(t.matrixWorld);var b=new THREE.Vector3().setFromMatrixColumn(t.matrixWorld,(this._handleIndex+1)%3),c=new THREE.Vector3().setFromMatrixColumn(t.matrixWorld,(this._handleIndex+2)%3);this._handleAxis.crossVectors(b,c).normalize();}}}this._gizmo.highlightHandle(this._handleIndex,h||this._handleIndex===-1);if(p!==this._handleIndex){this.getViewport().setShouldRenderFrame();}};
R.prototype.hover=function(e){if(this._inside(e)&&!this._gesture){this._updateMouse(e);this._updateHandles(e,true);e.handled|=this._handleIndex>0;}};
R.prototype._getPlaneOffset=function(){var r=this._rayCaster.ray;var d=this._gizmoOrigin.clone().sub(r.origin);var a=this._handleAxis.dot(d)/this._handleAxis.dot(r.direction);return r.direction.clone().multiplyScalar(a).sub(d);};
R.prototype.beginGesture=function(e){if(this._inside(e)&&!this._gesture){this._updateMouse(e);this._updateHandles(e,false);if(this._handleIndex>=0&&this._handleIndex<3&&e.n===1){this._gesture=true;e.handled=true;this._gizmo.beginGesture();if(this._handleIndex<3){this._dragOriginDirection=this._getPlaneOffset().normalize();}}}};
R.prototype.move=function(e){if(this._gesture){e.handled=true;this._updateMouse(e);if(this._dragOriginDirection){var d=this._dragOriginDirection,a=this._getPlaneOffset().normalize(),b=new THREE.Vector3().setFromMatrixColumn(this._matrixOrigin,(this._handleIndex+1)%3).normalize(),c=new THREE.Vector3().setFromMatrixColumn(this._matrixOrigin,(this._handleIndex+2)%3).normalize();var f=Math.atan2(d.dot(c),d.dot(b));var g=Math.atan2(a.dot(c),a.dot(b));if(!isNaN(f)&&!isNaN(g)){this._gizmo._setRotationAxisAngle(this._handleIndex,f,g);}}}};
R.prototype.endGesture=function(e){if(this._gesture){this._gesture=false;e.handled=true;this._updateMouse(e);this._gizmo.endGesture();this._dragOriginDirection=undefined;this._updateHandles(e,true);this.getViewport().setShouldRenderFrame();}};
R.prototype.click=function(e){};
R.prototype.doubleClick=function(e){};
R.prototype.contextMenu=function(e){};
R.prototype.getViewport=function(){return this._tool._viewport;};
R.prototype._getOffset=function(o){var r=o.getBoundingClientRect();var p={x:r.left+window.pageXOffset,y:r.top+window.pageYOffset};return p;};
R.prototype._inside=function(e){if(this._rect===null||true){var i=this._tool._viewport.getIdForLabel();var d=document.getElementById(i);if(d===null){return false;}var o=this._getOffset(d);this._rect={x:o.x,y:o.y,w:d.offsetWidth,h:d.offsetHeight};}return(e.x>=this._rect.x&&e.x<=this._rect.x+this._rect.w&&e.y>=this._rect.y&&e.y<=this._rect.y+this._rect.h);};
return R;},true);
sap.ui.predefine('sap/ui/vk/tools/ScaleToolHandler',["jquery.sap.global","sap/ui/base/EventProvider"],function(q,E){"use strict";
var S=E.extend("sap.ui.vk.tools.ScaleToolHandler",{
metadata:{},
constructor:function(t){this._tool=t;this._gizmo=t.getGizmo();this._rect=null;this._rayCaster=new THREE.Raycaster();this._handleIndex=-1;this._gizmoIndex=-1;this._handleAxis=new THREE.Vector3();this._handleDirection=new THREE.Vector3();this._gizmoOrigin=new THREE.Vector3();this._mouse=new THREE.Vector2();this._mouseOrigin=new THREE.Vector2();}
});
S.prototype.destroy=function(){this._tool=null;this._gizmo=null;this._rect=null;this._rayCaster=null;this._handleAxis=null;this._gizmoOrigin=null;this._mouse=null;};
S.prototype._updateMouse=function(e){var s=this.getViewport().getRenderer().getSize();this._mouse.x=((e.x-this._rect.x)/s.width)*2-1;this._mouse.y=((e.y-this._rect.y)/s.height)*-2+1;this._rayCaster.setFromCamera(this._mouse,this.getViewport().getCamera().getCameraRef());};
S.prototype._updateHandles=function(e,h){var p=this._handleIndex;this._handleIndex=-1;for(var i=0,l=this._gizmo.getGizmoCount();i<l;i++){var t=this._gizmo.getTouchObject(i);var a=this._rayCaster.intersectObjects(t.children,false);if(a.length>0){this._handleIndex=t.children.indexOf(a[0].object);if(this._handleIndex>=0){this._gizmoIndex=i;this._gizmoOrigin.setFromMatrixPosition(t.matrixWorld);this._handleAxis.setFromMatrixColumn(t.matrixWorld,this._handleIndex%3).normalize();var b=new THREE.Vector3().setFromMatrixColumn(t.matrixWorld,(this._handleIndex+1)%3).normalize();var c=new THREE.Vector3().setFromMatrixColumn(t.matrixWorld,(this._handleIndex+2)%3).normalize();this._handleDirection.addVectors(b,c).normalize();}}}this._gizmo.highlightHandle(this._handleIndex,h||this._handleIndex===-1);if(p!==this._handleIndex){this.getViewport().setShouldRenderFrame();}};
S.prototype.hover=function(e){if(this._inside(e)&&!this._gesture){this._updateMouse(e);this._updateHandles(e,true);e.handled|=this._handleIndex>0;}};
S.prototype._getAxisOffset=function(){var r=this._rayCaster.ray;var d=this._handleAxis.clone().cross(r.direction).cross(r.direction).normalize();var a=r.origin.clone().sub(this._gizmoOrigin);return d.dot(a)/d.dot(this._handleAxis);};
S.prototype._getPlaneOffset=function(){var r=this._rayCaster.ray;var d=this._gizmoOrigin.clone().sub(r.origin);var a=this._handleAxis.dot(d)/this._handleAxis.dot(r.direction);return r.direction.clone().multiplyScalar(a).sub(d);};
S.prototype.beginGesture=function(e){if(this._inside(e)&&!this._gesture){this._updateMouse(e);this._updateHandles(e,false);if(this._handleIndex>=0&&e.n===1){this._gesture=true;e.handled=true;this._mouseOrigin.set(e.x,e.y);this._gizmo.beginGesture();if(this._handleIndex<3){this._dragOrigin=this._getAxisOffset();}else if(this._handleIndex<6){this._dragOrigin=this._handleDirection.dot(this._getPlaneOffset());}}}};
S.prototype.move=function(e){if(this._gesture){e.handled=true;this._updateMouse(e);var s=new THREE.Vector3().setScalar(1);if(this._handleIndex<3){if(this._gizmo.getNonUniformScaleEnabled()){s.setComponent(this._handleIndex,this._getAxisOffset()/this._dragOrigin);}else{s.setScalar(this._getAxisOffset()/this._dragOrigin);}}else if(this._handleIndex<6){s.setScalar(this._handleDirection.dot(this._getPlaneOffset())/this._dragOrigin).setComponent(this._handleIndex-3,1);}else{var d=(this._mouseOrigin.y-e.y)/60;s.setScalar(d>=0?1+d:1/(1-d));}if(s.x&&s.y&&s.z){this._gizmo._setScale(s);}}};
S.prototype.endGesture=function(e){if(this._gesture){this._gesture=false;e.handled=true;this._updateMouse(e);this._gizmo.endGesture();this._dragOrigin=undefined;this._updateHandles(e,true);this.getViewport().setShouldRenderFrame();}};
S.prototype.click=function(e){};
S.prototype.doubleClick=function(e){};
S.prototype.contextMenu=function(e){};
S.prototype.getViewport=function(){return this._tool._viewport;};
S.prototype._getOffset=function(o){var r=o.getBoundingClientRect();var p={x:r.left+window.pageXOffset,y:r.top+window.pageYOffset};return p;};
S.prototype._inside=function(e){if(this._rect===null||true){var i=this._tool._viewport.getIdForLabel();var d=document.getElementById(i);if(d===null){return false;}var o=this._getOffset(d);this._rect={x:o.x,y:o.y,w:d.offsetWidth,h:d.offsetHeight};}return(e.x>=this._rect.x&&e.x<=this._rect.x+this._rect.w&&e.y>=this._rect.y&&e.y<=this._rect.y+this._rect.h);};
return S;},true);
sap.ui.predefine('sap/ui/vk/totara/CallbackHandler',["jquery.sap.global"],function(q){"use strict";var C=function(){var c=[];this.attach=function(a){c.push(a);};this.detach=function(a){var i=c.indexOf(a);if(i!==-1){c.splice(i,1);return true;}return false;};this.execute=function(a){for(var i=0;i<c.length;i++){c[i](a);}};};return C;});
sap.ui.predefine('sap/ui/vk/totara/CameraHandler',["jquery.sap.global","./TotaraUtils"],function(q,T){"use strict";var C=function(){};
C.setCameraSingle=function(s,c){if(!c.near){c.near=1;}if(!c.far){c.far=200000;}if(!c.zoom){c.zoom=0.02;}s.sceneBuilder.createCamera(c);return s.sceneBuilder.getCamera(c.id);};
C.setCamera=function(s,c){if(T.checkError(c)){return c;}var r={};var a=c.cameras;if(Array.isArray(a)){for(var i=0;i<a.length;i++){C.setCameraSingle(s,a[i]);}}return r;};
return C;});
sap.ui.predefine('sap/ui/vk/totara/Coder',["jquery.sap.global"],function(q){"use strict";var C=function(){};
C.encode=function(c){var u=unescape(encodeURIComponent(c));var a=new Uint8Array(u.length);for(var i=0;i<u.length;i++){a[i]=u.charCodeAt(i);}return a.buffer;};
C.uint8ArrayToString=function(u){var f="";try{var a=0x8000;var i=0;var l=u.length;var s;while(i<l){s=u.slice(i,Math.min(i+a,l));f+=String.fromCharCode.apply(null,s);i+=a;}}catch(e){f="";}return f;};
C.decode=function(u){var e=C.uint8ArrayToString(u);return decodeURIComponent(escape(e));};
});
sap.ui.predefine('sap/ui/vk/totara/Commands',["jquery.sap.global"],function(q){"use strict";var C=function(){};C.setStreamingToken="setStreamingToken";C.setCamera="setCamera";C.notifyFinishedTree="notifyFinishedTree";C.notifyFinishedMaterial="notifyFinishedMaterial";C.notifyFinishedImage="notifyFinishedImage";C.notifyFinishedMesh="notifyFinishedMesh";C.notifyFinishedGeometry="notifyFinishedGeometry";C.setMesh="setMesh";C.setMaterial="setMaterial";C.setGeometry="setGeometry";C.setImage="setImage";C.notifyError="notifyError";C.setTree="setTree";C.setTreeNode="setTreeNode";C.requestScene="requestScene";C.getTree="getTree";C.getMesh="getMesh";C.getMaterial="getMaterial";C.getGeometry="getGeometry";C.getImage="getImage";C.addClientLog="addClientLog";C.timestamp="timestamp";C.getView="getView";C.getDynamicView="getDynamicView";C.setView="setView";C.setViewNode="setViewNode";C.notifyFinishedView="notifyFinishedView";return C;});
sap.ui.predefine('sap/ui/vk/totara/Generator',["jquery.sap.global","./Commands"],function(q,C){"use strict";var G=function(){};
G.createSetStreamingTokenCommand=function(o){var r=JSON.stringify(o);var a=C.setStreamingToken+("["+r.length+"]")+r;return a;};
G.createGetTreeCommand=function(o){var r=JSON.stringify(o);var a=C.getTree+("["+r.length+"]")+r;return a;};
G.createGetViewCommand=function(o){var r=JSON.stringify(o);var a=C.getView+("["+r.length+"]")+r;return a;};
G.createGetDynamicViewCommand=function(o){var r=JSON.stringify(o);var a=C.getDynamicView+("["+r.length+"]")+r;return a;};
function c(i,t){var a={ids:i};if(t){a.token=t;}return JSON.stringify(a);}
G.createGetMeshCommand=function(i,t){var a=c(i,t);a=C.getMesh+("["+a.length+"]")+a;return a;};
G.createGetMaterialCommand=function(i,t){var a=c(i,t);a=C.getMaterial+("["+a.length+"]")+a;return a;};
G.createGetGeometryCommand=function(i,t){var a=c(i,t);a=C.getGeometry+("["+a.length+"]")+a;return a;};
G.createGetImageCommand=function(i,t){var a=c(i,t);a=C.getImage+("["+a.length+"]")+a;return a;};
G.createAddClientLogCommand=function(l){var a={duration:l.duration};if(l.name){a.name=l.name;}if(l.message){a.message=l.message;}if(l.token){a.token=l.token;}if(l.error){a.error=l.error;}if(l.timestamp){a.timestamp=l.timestamp;}a=JSON.stringify(a);a=C.addClientLog+("["+a.length+"]")+a;return a;};
return G;});
sap.ui.predefine('sap/ui/vk/totara/GeometryFactory',["jquery.sap.global","./IndexCompressor"],function(q,I){"use strict";var a=1;var H=2;var b=4;var V=0;var c=3;var P=Math.PI*2;var G=function(){};
G.getGeometryInfo=function(g,f){var h=new DataView(f.buffer,f.byteOffset,f.byteLength);var o=0;var k=(g.flags&H)>0;var l=(g.flags&b)>0;var m=(g.flags&a)>0;var n=false;var p=[];var r=[];var u=[];var s=[];var t=1;var v=1;var w=1;var x=new THREE.Vector3(0,0,0);var y=[x.x-t/2,x.y-v/2,x.z-w/2,x.x+t/2,x.y+v/2,x.z+w/2];var z=new I(f,f.length);z.setCurByte(o);if(!z.ReadCommand()){throw"buffer over flow";}var A=z.rvalue;var B;if(A){B=U(z,g.pointCount,A,y,p);if(B.isOk){p=B.array;n=true;}else{return false;}}var C=1;if(k){if(!z.ReadCommand()){return false;}C=z.rvalue;if(C){B=d(z,g.pointCount,C);if(B.isOk){r=B.array;}else{return false;}}}var D=1;var N=false;if(l){if(!z.ReadCommand()){return false;}D=z.rvalue;if(D){B=e(z,g.pointCount,D);if(B.isOk){N=true;u=B.array;}else{return false;}}}if(!A||!C||!D||N){if(N){o=z.getCurByte();var E=h.getFloat32(o,true);var F=h.getFloat32(o+4,true);z.moveCurByte(8);if((E!==0.0)||(F!==1.0)){var J=F-E;for(var K=0;K<g.pointCount*2;K++){u[K]=u[K]*J+E;}}}var L;if(!A){o=z.getCurByte();for(L=0;L<g.pointCount;L++){p.push(h.getFloat32(o+L*4,true));p.push(h.getFloat32(o+(L+g.pointCount)*4,true));p.push(h.getFloat32(o+(L+g.pointCount*2)*4,true));}z.moveCurByte(g.pointCount*3*4);}if(!C){o=z.getCurByte();for(L=0;L<g.pointCount;L++){r.push(h.getFloat32(o+(L)*4,true));r.push(h.getFloat32(o+(L+g.pointCount*1)*4,true));r.push(h.getFloat32(o+(L+g.pointCount*2)*4,true));}z.moveCurByte(g.pointCount*3*4);}if(!D){if(l){o=z.getCurByte();for(L=0;L<g.pointCount;L++){u.push(h.getFloat32(o+(L)*4,true));u.push(h.getFloat32(o+(L+g.pointCount*1)*4,true));}z.moveCurByte(g.pointCount*2*4);}}}var M=z.getCurByte();z.Reset();z.setCurByte(M);var O=[0,0,0];var Q=m?2:3;for(var i=0;i<g.elementCount;i++){for(var j=0;j<Q;j++){if(!z.ReadCommand(O[j])){throw"UIC1 Decompression error!!!";}else{s.push(z.rvalue);O[j]=z.rvalue;}}}var R={};R.isPolyline=m;R.isPositionQuantized=n;R.data={};R.data.indices=s;R.data.points=p;R.data.normals=r;R.data.uvs=u;R.id=g.id;return R;};
function U(f,p,n,g){var r={array:new Array(p*3),isOk:false};for(var x=0;x<3;x++){var v=g[V+x];var h=(g[c+x]-v)/n;for(var i=0;i<p;i++){if(!f.ReadCommand()){return r;}r.array[i*3+x]=h*f.rvalue+v;}}r.isOk=true;return r;}
function d(i,p,n){var r={array:[],isOk:false};var t=[];var f;for(f=0;f<p;f++){if(!i.ReadCommand()){return r;}t.push(i.rvalue);}var g=P/n;var h;var j;var k;for(f=0;f<p;f++){if(!i.ReadCommand()){return r;}h=g*t[f];j=g*i.rvalue;k=Math.sin(j);r.array.push(k*Math.cos(h));r.array.push(k*Math.sin(h));r.array.push(Math.cos(j));}r.isOk=true;return r;}
function e(f,p,n){var r={array:new Array(p*2),isOk:false};var g=1.0/n;for(var u=0;u<2;u++){for(var i=0;i<p;i++){if(!f.ReadCommand()){return false;}r.array[i*2+u]=g*f.rvalue;}}r.isOk=true;return r;}
return G;});
sap.ui.predefine('sap/ui/vk/totara/ImageHandler',["jquery.sap.global","./MaterialHandler","./TotaraUtils","./Coder"],function(q,M,T,C){"use strict";var I=function(){};
I.setImage=function(s,i,a){if(T.checkError(i)){return i;}var r={};if(!a){if(i.error){r.error=i.error;}else{r.error="no image content for "+i.id;}return r;}i.binaryData=a;s.sceneBuilder.createImage(i);M.updateTexture(s,i.id);r.id=i.id;return r;};
return I;});
sap.ui.predefine('sap/ui/vk/totara/IndexCompressor',["jquery.sap.global"],function(q){"use strict";var I=function(b,a){var V=32;var c=16;var C=13;var e=14;var f=0;var g=1;var h=3;var i=4;var k=5;var l=6;var m=7;var n=8;var o=9;var p=10;var r=11;var s=12;var t=15;var E=0;var u=1;var v=2;var w=3;var x=4;var y=5;var z=6;var A=7;var B=8;var D=9;var F=10;var G=11;var H=12;var J=13;var K=4294967295;var L=0;this.rvalue=0;var M=0;var N=b;var O=a;var P=0;var Q=new Array(V);var R=new Array(c);var S=V-1;var T=c-1;var U=false;this.Reset=function(){L=0;this.rvalue=0;M=0;P=0;var j;for(j=0;j<V;j++){Q[j]=V-j-1;}for(j=0;j<c;j++){R[j]=1;}S=V-1;T=c-1;};this.Reset();function W(d){return Q[(S>=d)?(S-d):(V+S-d)];}function X(d){return R[(T>=d)?(T-d):(c+T-d)];}function Y(d){S++;if(S>=V){S=0;}Q[S]=d;}function Z(d){T++;if(T>=c){T=0;}R[T]=d;}function $(){if(P<O){return N[P++];}U=true;return 0;}function _(){return $()+$()*256;}function a1(){return $()+$()*256+$()*65536+$()*16777216;}this.ReadCommand=function(j){if(j===undefined){j=K;}U=false;var b1=this.rvalue;if(L){L--;this.rvalue=W(M);}else{var c1=$();if(U){c1=g;}var d1=c1>>>4;switch(c1&0xF){case f:this.rvalue=W(d1);break;case k:this.rvalue=W(16+d1);break;case C:this.rvalue=W(d1>>>2);M=d1&3;L=1;break;case e:this.rvalue=W(0);M=0;L=d1+2;break;case l:this.rvalue+=X(d1);break;case g:if(c1&16){this.rvalue+=(c1>>>5)+1;}else{this.rvalue-=(c1>>>5)+1;}break;case h:this.rvalue=j+(d1+1);break;case i:this.rvalue=j-(d1+1);break;case m:this.rvalue=j+(d1+17);break;case n:this.rvalue=j-(d1+17);break;case o:this.rvalue+=d1+(($())<<4)+3;break;case p:this.rvalue-=d1+(($())<<4)+3;break;case r:this.rvalue=d1+(($())<<4);break;case s:var e1=_();this.rvalue=d1+(e1<<4);break;case t:switch(c1>>>4){case E:case u:case v:case w:case x:this.rvalue=c1>>>4;break;case y:this.rvalue=0x000000FF;break;case z:this.rvalue=0x0000FF00;break;case A:this.rvalue=0x00FF0000;break;case B:this.rvalue=0xFF000000;break;case D:this.rvalue=0x00FFFFFF;break;case F:this.rvalue=0xFFFFFFFF;break;case J:M=0;L=_()+36;break;case G:{var bl=$();this.rvalue=(_()<<8)+bl;}break;case H:this.rvalue=a1();break;default:return false;}break;default:return false;}}if(this.rvalue>0xFFFFFFFF){this.rvalue=this.rvalue-0xFFFFFFFF-1;}Y(this.rvalue);var d;if(this.rvalue!=b1){if(this.rvalue>b1){d=this.rvalue-b1;if(d<0x7FFFFFFF){Z(d);}}else{d=b1-this.rvalue;if(d<0x7FFFFFFF){Z(-d);}}}if(U){L=0;this.rvalue=0;return false;}return true;};this.getCurByte=function(){return P;};this.setCurByte=function(d){P=d;};this.moveCurByte=function(d){P=P+d;};};return I;});
sap.ui.predefine('sap/ui/vk/totara/ListMap',["jquery.sap.global"],function(q){"use strict";var L=function(){this.map=new Map();};
L.prototype.get=function(k){return this.map.get(k);};
L.prototype.getOrCreate=function(k){var v=this.map.get(k);if(!v){v=[];this.map.set(k,v);}return v;};
L.prototype.set=function(k,v){return this.map.set(k,v);};
L.prototype.keys=function(){return this.map.keys();};
L.prototype.values=function(){return this.map.values();};
L.prototype.delete=function(k){return this.map.delete(k);};
L.prototype.clear=function(){this.map.clear();};
Object.defineProperty(L.prototype,"size",{get:function(){return this.map.size;}});return L;});
sap.ui.predefine('sap/ui/vk/totara/MaterialHandler',["jquery.sap.global","./TotaraUtils"],function(q,T){"use strict";var M=function(){};
M.setMaterial=function(s,c){if(T.checkError(c)){return c;}var m=c.materials;var r={imageIdSet:new Set()};for(var i=0;i<m.length;i++){var a=m[i];var b=[];b=s.sceneBuilder.createMaterial(a);if(b.length){for(var d=0;d<b.length;d++){var p=b[d];var t=s.texturesToUpdate;var e=t.get(p.imageId);if(!e){e=[];t.set(p.imageId,e);}e.push({textureType:p.textureType,materialId:a.id});r.imageIdSet.add(p.imageId);}}var v=s.contextMap.values();var f=v.next();while(!f.done){var g=f.value;f=v.next();var n=g.materialIdNodeListMapForOpacityUpdate.get(a.id);if(n){for(var j=0;j<n.length;j++){s.sceneBuilder.applyNodeOpacityToSubmeshes(n[j],g.sceneId,a.id);}g.materialIdNodeListMapForOpacityUpdate.delete(a.id);}}s.materialIdsToRequest.delete(a.id);}return r;};
M.updateTexture=function(s,a){var t=s.texturesToUpdate.get(a);if(t){for(var i=0,b=t.length;i<b;i++){var c=t[i];s.sceneBuilder.updateTextureMap(c.materialId,c.textureType);}s.texturesToUpdate.delete(a);}};
return M;});
sap.ui.predefine('sap/ui/vk/totara/MeshHandler',["jquery.sap.global","./TotaraUtils","./GeometryFactory","./MaterialHandler","./SceneStateContext"],function(q,T,G,M,S){"use strict";var a=function(){};
a.setMesh=function(s,c,b){if(T.checkError(c)){return c;}var r={updatedContexts:[],materialIdSet:new Set(),geometryIdMap:new Map()};var m=c.meshes;var d=s.materialIdsToRequest;var e;var v=s.contextMap.values();var f=v.next();while(!f.done){f.value.isUpdatedBySetMesh=false;f=v.next();}for(var i=0;i<m.length;i++){var g=m[i];var h=g.id;for(var j=0;j<g.submeshes.length;j++){var l=g.submeshes[j];var o=s.sceneBuilder.setSubmesh(h,l);if(o.needUpdataMaterial){r.materialIdSet.add(l.materialId);d.add(l.materialId);}if(o.geometryIdToRequest){r.geometryIdMap.set(o.geometryIdToRequest,o.geometryPriority);s.geometryIdMaterialIdMap.set(o.geometryIdToRequest,l.materialId);}}v=s.contextMap.values();f=v.next();while(!f.done){e=f.value;f=v.next();var p=e.meshGroupListMap.get(h);if(p){e.isUpdatedBySetMesh=true;var t=function(C){var D=[];C.forEach(function(E){D.push(E);});return D;};for(var k=0;k<p.length;k++){var u=p[k];var w=s.sceneBuilder.attachSubMeshesToNode(u,e.sceneId);s.sceneBuilder.applyNodeMaterialToSubmeshes(u,e.sceneId);var x=s.sceneBuilder.applyNodeOpacityToSubmeshes(u,e.sceneId);if(x.materialIds.length){for(var y=0;y<x.materialIds.length;y++){var z=e.materialIdNodeListMapForOpacityUpdate.getOrCreate(x.materialIds[y]);z.push(u);}}var A=t(w.idOfGeometriesToUpdate);for(var n=0;n<A.length;n++){var B=e.boundingBoxNodeIdsListMap.getOrCreate(A[n]);B.push(u);}}e.meshGroupListMap.delete(h);e.progressCount.mesh.count++;}}}v=s.contextMap.values();f=v.next();while(!f.done){e=f.value;f=v.next();if(e.isUpdatedBySetMesh){r.updatedContexts.push(e);delete e.isUpdatedBySetMesh;}}return r;};
a.setGeometry=function(s,g,b){if(T.checkError(g)){return g;}var r={updatedContexts:[]};var c=g.id;if(!b||b.length===0){r.error="missing geometry "+c;return r;}var d=G.getGeometryInfo(g,b);s.sceneBuilder.setGeometry(d);var v=s.contextMap.values();var e=v.next();while(!e.done){var f=e.value;e=v.next();var n=f.boundingBoxNodeIdsListMap.get(c);if(n){r.updatedContexts.push(f);for(var i=0;i<n.length;i++){s.sceneBuilder.updateGeometryInNode(n[i],c,f.sceneId);}f.boundingBoxNodeIdsListMap.delete(c);}if(f.boundingBoxNodeIdsListMap.size===0){f.phase=S.Phase.FinishedGeometry;}f.progressCount.geometry.count++;}if(g&&g.flags){var h=(g.flags&2)>0;if(!h){var m=s.geometryIdMaterialIdMap.get(c);if(m){s.sceneBuilder.updateMaterialForGeometryWithoutNormal(m);}}}return r;};
return a;});
sap.ui.predefine('sap/ui/vk/totara/NotificationHandler',["jquery.sap.global"],function(q){"use strict";var N=function(){};
N.notifyError=function(s,e){return e?e:{error:"unknown error"};};
N.notifyFinishedMaterial=function(s,c){var r={};return r;};
N.notifyFinishedImage=function(s,c){var r={};return r;};
N.notifyFinishedMesh=function(s,c){var r={};return r;};
N.notifyFinishedGeometry=function(s,c){var r={};return r;};
N.timestamp=function(s,c){var r={};return r;};
return N;});
sap.ui.predefine('sap/ui/vk/totara/Parser',["jquery.sap.global","./Coder"],function(q,C){"use strict";var P=function(){};
P.createCommandList=function(a,o){var b=new Uint8Array(a);var c=[];var s=0;var d=0;var h;var j;var i;while(d<b.length){d=f("[".charCodeAt(0),s,b);if(d===-1){break;}var k=C.decode(b.slice(s,d)).replace(/\n|\r|\s/g,"");s=d+1;d=f("]".charCodeAt(0),s,b);if(d===-1){throw"No matching [] for command length. abort";}h=g(C.decode(b.slice(s,d)));s=d+1;d=s+h.jsonContentLength;j=C.decode(b.slice(s,d));try{j=JSON.parse(j);}catch(e){var l=k+": "+e;throw l;}if(h.binaryContentLength){s=d;d=s+h.binaryContentLength;i=b.slice(s,d);}else{i=undefined;}s=d;var m={name:k,jsonContent:j,binaryContent:i};if(o){o(m);}c.push(m);}return c;};
function f(c,s,u){for(var i=s;i<u.length;i++){if(u[i]===c){return i;}}return-1;}
function g(c){var l=c.split(",");if(l.length<0||l.length>2){throw"invalid content length";}var j=0;var b=0;try{j=parseInt(l[0],10);if(l.length===2){b=parseInt(l[1],10);}}catch(e){throw"invalid content length";}return{jsonContentLength:j,binaryContentLength:b};}
});
sap.ui.predefine('sap/ui/vk/totara/Processor',["jquery.sap.global","./Commands","./CameraHandler","./TreeHandler","./NotificationHandler","./MeshHandler","./MaterialHandler","./ImageHandler","./ViewHandler"],function(q,C,a,T,N,M,b,I,V){"use strict";var P=function(){var c=new Map();var n=0;this.setCommandCallback=function(d,e){c.set(d,e);};this.process=function(s,d){var r;var e=false;if(d.sceneId){s.currentSceneInfo.id=d.sceneId;}switch(d.name){case C.setCamera:r=a.setCamera(s,d.jsonContent,d.binaryContent);break;case C.notifyFinishedMaterial:r=N.notifyFinishedMaterial(s,d.jsonContent,d.binaryContent);break;case C.notifyFinishedImage:r=N.notifyFinishedImage(s,d.jsonContent,d.binaryContent);break;case C.notifyFinishedMesh:r=N.notifyFinishedMesh(s,d.jsonContent,d.binaryContent);break;case C.notifyFinishedGeometry:r=N.notifyFinishedGeometry(s,d.jsonContent,d.binaryContent);break;case C.setMesh:r=M.setMesh(s,d.jsonContent,d.binaryContent);break;case C.setMaterial:r=b.setMaterial(s,d.jsonContent,d.binaryContent);break;case C.setGeometry:r=M.setGeometry(s,d.jsonContent,d.binaryContent);break;case C.setImage:r=I.setImage(s,d.jsonContent,d.binaryContent);break;case C.notifyError:r=N.notifyError(s,d.jsonContent,d.binaryContent);break;case C.timestamp:r=N.timestamp(s,d.jsonContent,d.binaryContent);break;case C.setTree:r=T.setTree(s,d.jsonContent);break;case C.setTreeNode:r=T.setTreeNode(s,d.jsonContent);break;case C.notifyFinishedTree:r=T.notifyFinishedTree(s,d.jsonContent);break;case C.setView:r=V.setView(s,d.jsonContent);break;case C.setViewNode:r=V.setViewNode(s,d.jsonContent);break;case C.notifyFinishedView:r=V.notifyFinishedView(s,d.jsonContent);break;default:e=true;break;}var f=d.name;if(r&&r.error&&f!==C.notifyError){var g=c.get(C.notifyError);if(g){g(r);}}var h=c.get(f);if(h){h(r);}if(e){n++;}return r;};this.getNumberOfCommandsSkipped=function(){return n;};};return P;});
sap.ui.predefine('sap/ui/vk/totara/ProgressCounter',["jquery.sap.global"],function(q){"use strict";
function C(){this._count=0;this._total=0;var o;this.setOnValueChanged=function(c){o=c;};this.callOnValueChanged=function(){if(o){o();}};}
var p=C.prototype;Object.defineProperty(p,"count",{get:function(){return this._count;},set:function(v){if(v!==this._count){this._count=v;this.callOnValueChanged();}}});Object.defineProperty(p,"total",{get:function(){return this._total;},set:function(v){if(v!==this._total){this._total=v;this.callOnValueChanged();}}});var P=function(){var o;function a(){if(o){o(this);}}this.mesh=new C();this.geometry=new C();this.mesh.setOnValueChanged(a);this.geometry.setOnValueChanged(a);this.setOnProgressChanged=function(c){o=c;};};return P;});
sap.ui.predefine('sap/ui/vk/totara/RequestCommandGenerator',["jquery.sap.global","./Generator","./Coder","./Commands"],function(q,G,C,c){"use strict";var t=function(a){if(Array.isArray(a)){var b=Array(a.length);for(var i=0;i<a.length;i++){b[i]=a[i];}return b;}else{var d=[];a.forEach(function(v){d.push(v);});return d;}};var R=function(){var m=200;var d=200;var e;var f;var i;var g;var h;this.init=function(){e=new Set();f=new Set();i=new Set();h=new Map();g=[];};this.init();this.pushMeshIds=function(a){e=new Set([].concat(t(e),t(a)));};this.pushMaterialIds=function(a){f=new Set([].concat(t(f),t(a)));};this.pushImageIds=function(a){i=new Set([].concat(t(i),t(a)));};this.pushGeometryIds=function(j){j.forEach(function(p,a){h.set(a,p);g.push(a);});g.sort(function(a,b){return h.get(a)-h.get(b);});};this.canGenerateCommand=function(){return e.size>0||f.size>0||i.size>0||g.length>0;};this.generateRequestCommand=function(a,b){var j,k;var l={};if(e.size>0){k=s(e,m);if(k){l.command=G.createGetMeshCommand(k,b);l.method=c.getMesh;}}else if(f.size>0){k=s(f,d);if(k){l.command=G.createGetMaterialCommand(k,b);l.method=c.getMaterial;}}else if(i.size>0){j=i.values().next().value;i.delete(j);l.command=G.createGetImageCommand([j],b);l.method=c.getImage;l.resource=j;}else if(g.length>0){j=g.pop();h.delete(j);l.command=G.createGetGeometryCommand([j],b);l.method=c.getGeometry;l.resource=j;}if(l.command){if(!a){l.command=C.encode(l.command);}return l;}return null;};function s(a,b){if(a.size===0){return null;}var j=[];a.forEach(function(v){j.push(v);});var k=j.slice(0,b);var _=true;var l=false;var n;var o;var p;try{for(o=k[Symbol.iterator]();!(_=(p=o.next()).done);_=true){var r=p.value;a.delete(r);}}catch(u){l=true;n=u;}finally{try{if(!_&&o.return){o.return();}}finally{if(l){throw n;}}}return k;}};return R;});
sap.ui.predefine('sap/ui/vk/totara/SceneHandler',["jquery.sap.global"],function(q){"use strict";var S=function(){};
S.rotateNodeByUpAxies=function(a,b,t,c){var x=0,y=0,z=0;if(b==="z_positive"){if(a==="x_positive"){x=-90*Math.PI/180;}else if(a==="y_positive"){x=-90*Math.PI/180;z=-90*Math.PI/180;}else if(a==="x_nagetive"){x=-90*Math.PI/180;z=180*Math.PI/180;}else{x=-90*Math.PI/180;z=90*Math.PI/180;}}else if(b==="y_positive"){if(a==="x_positive"){return;}else if(a==="x_nagetive"){y=180*Math.PI/180;}else if(a==="z_positive"){y=90*Math.PI/180;}else if(a==="z_negative"){y=-90*Math.PI/180;}}t.rotation.x=x;t.rotation.y=y;t.rotation.z=z;if(c){var e=new THREE.Euler(x,y,z,"XYZ");var n=new THREE.Matrix4().makeRotationFromEuler(e);c.updateMatrix();c.matrix.multiplyMatrices(n,c.matrix);c.matrix.decompose(c.position,c.quaternion,c.scale);}};
return S;});
sap.ui.predefine('sap/ui/vk/totara/SceneState',["jquery.sap.global","./ListMap","./RequestCommandGenerator","./CallbackHandler","./SceneStateContext","sap/ui/vk/threejs/SceneBuilder"],function(q,L,R,C,S,a){"use strict";var b=function(){this.currentSceneInfo={};this.sceneBuilder=new a();this.contextMap=new Map();this.texturesToUpdate=new Map();this.materialIdsToRequest=new Set();this.geometryIdMaterialIdMap=new Map();this.requestCommandGenerator=new R();this.onErrorCallbacks=new C();this.onMaterialFinishedCallbacks=new C();this.onImageFinishedCallbacks=new C();this.onSetGeometryCallbacks=new C();this.getContext=function(s){if(!s){return null;}return this.contextMap.get(s);};this.createContext=function(u,p){var c=new S();Object.assign(c,p);c.sceneId=u;if(c.onActiveCamera){c.onActiveCameraCallbacks.attach(c.onActiveCamera);delete c.onActiveCamera;}if(c.onMeshFinished){c.onMeshFinishedCallbacks.attach(c.onMeshFinished);delete c.onMeshFinished;}if(c.onInitialSceneFinished){c.onInitialSceneFinishedCallbacks.attach(c.onInitialSceneFinished);delete c.onInitialSceneFinished;}if(c.onPartialRetrievalFinished){c.onPartialRetrievalFinishedCallbacks.attach(c.onPartialRetrievalFinished);delete c.onPartialRetrievalFinished;}if(c.onViewFinished){c.onViewFinishedCallbacks.attach(c.onViewFinished);delete c.onViewFinished;}if(c.onSceneCompleted){c.onSceneCompletedCallbacks.attach(c.onSceneCompleted);delete c.onSceneCompleted;}if(c.onProgressChanged){c.setOnProgressChanged(c.onProgressChanged);delete c.onProgressChanged;}this.contextMap.set(u,c);return c;};this.sidToObject3D=function(s){var c=this.contextMap.values();var d=c.next();var n=null;while(!d.done){var e=d.value;d=c.next();n=this.sceneBuilder.getNode(s,e.sceneId);if(n){break;}}return n;};this.object3DToSid=function(o){return this.sceneBuilder.getObjectId(o);};this.dispose=function(){this.currentSceneInfo=null;this.contextMap=null;this.sceneBuilder.clearup();this.sceneBuilder=null;this.texturesToUpdate=null;this.materialIdsToRequest=null;this.geometryIdMaterialIdMap=null;this.onErrorCallbacks=null;this.onMaterialFinishedCallbacks=null;this.onImageFinishedCallbacks=null;this.onSetGeometryCallbacks=null;};this.cleanup=function(){this.currentSceneInfo={};this.contextMap.clear();this.sceneBuilder.cleanup();this.texturesToUpdate.clear();this.materialIdsToRequest.clear();this.geometryIdMaterialIdMap.clear();};};return b;});
sap.ui.predefine('sap/ui/vk/totara/SceneStateContext',["jquery.sap.global","./ListMap","./CallbackHandler","./ProgressCounter","./RequestCommandGenerator"],function(q,L,C,P,R){"use strict";var a={Started:0,FinishedHierarchy:1,FinishedMesh:2,FinishedGeometry:3};var b={Initial:0,Partial:1};var S=function(){this.phase=a.Started;this.retrievalType=b.Initial;this.sceneId=null;this.rootNodeId=null;this.root=null;this.requestCommandGenerator=new R();this.meshGroupListMap=new L();this.boundingBoxNodeIdsListMap=new L();this.materialIdNodeListMapForOpacityUpdate=new L();this.progressCount=new P();this.treeNodes=[];this.nodeSidsForPartialTree=new Set();this.replacedNodes=new Map();this.updatedNodes=new Set();this.authorizationHandler=null;this.onActiveCameraCallbacks=new C();this.onInitialSceneFinishedCallbacks=new C();this.onPartialRetrievalFinishedCallbacks=new C();this.onSceneCompletedCallbacks=new C();this.onViewFinishedCallbacks=new C();this.onMeshFinishedCallbacks=new C();this.setOnProgressChanged=function(c){this.progressCount.setOnProgressChanged(c);};this.isSceneCompleted=function(){return this.meshGroupListMap.size===0&&this.boundingBoxNodeIdsListMap.size===0;};this.dispose=function(){this.sceneId=null;this.meshGroupListMap=null;this.progressCount=null;this.requestCommandGenerator=null;this.suppressedBoundingBoxListMap=null;this.boundingBoxNodeIdsListMap=null;this.treeNodes=null;this.nodeSidsForPartialTree=null;this.materialIdNodeListMapForOpacityUpdate=null;this.replacedNodes=null;this.updatedNodes=null;this.onActiveCameraCallbacks=null;this.onInitialSceneFinishedCallbacks=null;this.onPartialRetrievalFinishedCallbacks=null;this.onSceneCompletedCallbacks=null;this.onViewFinishedCallbacks=null;this.onMeshFinishedCallbacks=null;};};S.Phase={Started:0,FinishedHierarchy:1,FinishedMesh:2,FinishedGeometry:3};S.RetrievalType={Initial:0,Partial:1};return S;});
sap.ui.predefine('sap/ui/vk/totara/TotaraLoader',["jquery.sap.global","./ListMap","./RequestCommandGenerator","./CallbackHandler","./SceneStateContext","./Processor","./Commands","./Generator","./SceneState","./TotaraUtils"],function(q,L,R,C,S,P,a,G,b,T){"use strict";var c=function(){var _=new b();var d=false;var e=new P();var f=null;var g=this;function s(r,t){if(!g._worker){return false;}var i=false;if(r){while(r.canGenerateCommand()){var n=r.generateRequestCommand(true,t);g._worker.postMessage(n);i=true;}}return i;}function h(){var i=false;var t;var v=_.contextMap.values();var j=v.next();while(!j.done){var k=j.value;j=v.next();if(s(k.requestCommandGenerator,k.token)){i=true;}t=k.token;}if(!i){s(_.requestCommandGenerator,t);}}this.getUrl=function(){return f;};this.init=function(j){f=j;function o(i){if(i){i.phase=S.Phase.FinishedHierarchy;}if(!d){var m=i.meshGroupListMap;var k=new Set(m.keys());i.requestCommandGenerator.pushMeshIds(k);if(k.size===0){if(i.retrievalType===S.RetrievalType.Initial){i.onInitialSceneFinishedCallbacks.execute();}if(i.retrievalType===S.RetrievalType.Partial){i.onPartialRetrievalFinishedCallbacks.execute();}if(i.isSceneCompleted()){i.onSceneCompletedCallbacks.execute();}}}var n=_.materialIdsToRequest;if(n&&n.size){_.requestCommandGenerator.pushMaterialIds(n);}h();}e.setCommandCallback(a.notifyFinishedTree,function(i){if(i.error){return;}var k=i.context;o(k);});e.setCommandCallback(a.setMesh,function(k){if(k.error){return;}_.requestCommandGenerator.pushMaterialIds(k.materialIdSet);_.requestCommandGenerator.pushGeometryIds(k.geometryIdMap);if(k.updatedContexts){for(var i=0;i<k.updatedContexts.length;i++){var m=k.updatedContexts[i];if(m.meshGroupListMap.size===0){m.phase=S.Phase.FinishedMesh;m.onMeshFinishedCallbacks.execute();if(m.retrievalType===S.RetrievalType.Initial){m.onInitialSceneFinishedCallbacks.execute();}else if(m.retrievalType===S.RetrievalType.Partial){m.onPartialRetrievalFinishedCallbacks.execute();}if(m.isSceneCompleted()){m.onSceneCompletedCallbacks.execute();}m.progressCount.geometry.total=m.boundingBoxNodeIdsListMap.size;var t=m.token;if(m.isSceneCompleted()){l(m,"sceneCompleted",t);}else{l(m,"meshFinished",t);}}}}h();});e.setCommandCallback(a.setGeometry,function(k){if(k.error){return;}_.onSetGeometryCallbacks.execute(k);if(k.updatedContexts){for(var i=0;i<k.updatedContexts.length;i++){var m=k.updatedContexts[i];if(m.isSceneCompleted()){m.onSceneCompletedCallbacks.execute();var t=m.token;if(m.isSceneCompleted()){l(m,"sceneCompleted",t);}else{l(m,"geometryFinished",t);}m.finishedTime=Date.now();}}}});e.setCommandCallback(a.setTree,function(i){if(i.error&&i.context){_.contextMap.delete(i.context.sceneId);}});e.setCommandCallback(a.notifyFinishedView,function(r){if(r.error){return;}var i=r.context;if(i){var m=_.materialIdsToRequest;if(m&&m.size){_.requestCommandGenerator.pushMaterialIds(m);h();}if(r.view){var n=[];i.updatedNodes.forEach(function(v){n.push(v);});r.view.updatedNodes=n;}if(i.meshGroupListMap.size===0){i.onViewFinishedCallbacks.execute(r.view);}else{i.retrievalType=S.RetrievalType.Partial;var k=new Set(i.meshGroupListMap.keys());i.requestCommandGenerator.pushMeshIds(k);var p=function(){i.onPartialRetrievalFinishedCallbacks.detach(p);i.onViewFinishedCallbacks.execute(r.view);};i.onPartialRetrievalFinishedCallbacks.attach(p);l(i,"notifyFinishedView",i.token);h();}}});e.setCommandCallback(a.setMaterial,function(r){if(r.error){return;}_.requestCommandGenerator.pushImageIds(r.imageIdSet);if(_.materialIdsToRequest.size===0){_.onMaterialFinishedCallbacks.execute();}h();});e.setCommandCallback(a.setImage,function(r){if(r.error){return;}if(_.texturesToUpdate.size===0){_.onImageFinishedCallbacks.execute();}});e.setCommandCallback(a.setView,function(r){if(r.error){return;}var i=r.context;var t=i?i.token:null;l(i,"setView",t);});e.setCommandCallback(a.notifyError,function(r){_.onErrorCallbacks.execute(r);});var g=this;return new Promise(function(r){if(!g._work){g._worker=new Worker(sap.ui.require.toUrl("sap/ui/vk/totara/TotaraLoaderWorker.js"));g._worker.onmessage=function(i){var k=i.data;if(k.ready){return;}if(k.name==="getAuthorization"){if(_.getContext(_.currentSceneInfo.id).authorizationHandler){_.getContext(_.currentSceneInfo.id).authorizationHandler(k.jsonContent.url).then(function(t){g._worker.postMessage({"method":"setAuthorization","authorizationToken":t});}).catch(function(n){g._worker.postMessage({"method":"setAuthorization","authorizationToken":null,"error":n.toString()});});}else{g._worker.postMessage({"method":"setAuthorization","authorizationToken":null});}return;}var m={name:k.name,jsonContent:k.jsonContent};if(k.binaryContent){m.binaryContent=k.binaryContent;}e.process(_,m);};g._worker.onerror=function(i){};}});};this.enablePushMesh=function(i){d=i;};this.dispose=function(){e=null;if(_){if(_.contextMap){var v=_.contextMap.values();var i=v.next();while(!i.done){var j=i.value;i=v.next();j.dispose();}}_.dispose();_=null;}if(this._worker){this._worker.terminate();this._worker=undefined;}};function l(i,n,t){if(i&&i.progressLogger&&t&&n){i.progressLogger.logPerformance(n,t);}}this.request=function(i,j,k){if(!j.root){throw"context must include root where three js objects are attached to";}var m=_.createContext(i,j);_.currentSceneInfo.id=i;m.retrievalType=S.RetrievalType.Initial;m.authorizationHandler=k;m.initialRequestTime=Date.now();var t;if(m.enableLogger){var n=T.createLogger(i,m,this);if(n){t=T.generateToken();m.token=t;}}var o=j.includeHidden!==undefined?j.includeHidden:true;var p=j.$select!==undefined?j.$select:"name,transform,meshId,materialId,contentType,visible,opacity,renderOrder";var r={pushMaterials:true,pushMeshes:d,includeHidden:o,pushPMI:j.pushPMI||false,metadataFilter:j.metadataFilter,token:t,$select:p};if(j.activateView){r.activateView=j.activateView;}r.sceneId=i;r.context=i;var u=G.createGetTreeCommand(r);l(m,"modelRequested",t);this._worker.postMessage({method:"initializeConnection",url:f,useSecureConnection:j.useSecureConnection,token:m.token,command:u});};this.postMessage=function(m){this._worker.postMessage(m);};this.update=function(i,j,v){var g=this;return new Promise(function(r,k){var m=_.getContext(i);if(!m){k("no context for ${sceneVeId}.");}m.nodeSidsForPartialTree=new Set(j);m.retrievalType=S.RetrievalType.Partial;var n=m.includeHidden!==undefined?m.includeHidden:true;var o=m.$select!==undefined?m.$select:undefined;var p={pushMaterials:true,pushMeshes:d,filter:j.join(),includeHidden:n,pushPMI:m.pushPMI||false,metadataFilter:m.metadataFilter,$select:o,breadcrumbs:true};var t;if(m.progressLogger){t=T.generateToken();m.token=t;}p.sceneId=i;p.context=i;if(v){p.activateView=v;}var u=G.createGetTreeCommand(p);var w=function(){m.onPartialRetrievalFinishedCallbacks.detach(w);l(m,"updateFinished(mesh)",t);var x=[];var y=[];m.replacedNodes.forEach(function(B,D){y.push(B);x.push(D);});var z=x;var A=y;r({sceneVeId:i,sids:j,replacedNodeRefs:z,replacementNodeRefs:A});};m.onPartialRetrievalFinishedCallbacks.attach(w);l(m,"updateRequested",t);g._worker.postMessage({method:"update",command:u});});};this.requestView=function(i,v,j){if(v!=="static"&&v!=="dynamic"){return Promise.reject("invalid arg: supported type - static, dynamic");}if(!j){return Promise.reject("invalid arg: viewId undefined");}var k=_.getContext(i);if(!k){return Promise.reject("no scene exist for ${sceneVeId}");}var t;if(k.progressLogger){t=T.generateToken();k.token=t;}var m=k.includeHidden!==undefined?k.includeHidden:false;var n=k.$select!==undefined?k.$select:undefined;var g=this;var o;var p=new Promise(function(r,u){var w="";var x;if(v==="static"){o={sceneId:i,id:j,token:t,includeHidden:m,$select:n};w+=G.createGetViewCommand(o);x=a.getView;}else{o={sceneId:i,type:j,token:t};w+=G.createGetDynamicViewCommand(o);x=a.getDynamicView;}var y=function(z){k.onViewFinishedCallbacks.detach(y);l(k,"onViewFinished",t);if(z){r(z);}else{u("no view data");}};k.onViewFinishedCallbacks.attach(y);l(k,"viewRequested",t);g._worker.postMessage({method:x,command:w});});return p;};this.requestMaterial=function(i){if(!i){return Promise.reject("invalid arg: materialId undefined");}var p=new Promise(function(r,j){var k=_.sceneBuilder.getMaterial(i);if(k){r(k);return;}_.requestCommandGenerator.pushMaterialIds([i]);var n=function(){_.onMaterialFinishedCallbacks.detach(n);var m=_.sceneBuilder.getMaterial(i);if(m!=null){r(m);}else{j("no material data");}};_.onMaterialFinishedCallbacks.attach(n);h();});return p;};this.getState=function(){return _;};this.decrementResourceCountersForDeletedTreeNode=function(i,j,n){i.sceneBuilder.decrementResourceCountersForDeletedTreeNode(n,j.sceneId);};this.printLogTokens=function(){if(!_||!_.contextMap){console.log("printLogTokens:no data to print");return;}var i=_.contextMap.entries();var j=i.next();while(!j.done){var k=j.key;var m=j.value;j=i.next();console.log("log tokens for scene => "+k);console.log("---------------------------------------");if(m.progressLogger){var n=m.progressLogger.getTokens();var o=n.keys();var p=o.next();while(!p.done){var t=p.value;o.next();console.log(t);}}console.log("---------------------------------------");}};};return c;});
sap.ui.predefine('sap/ui/vk/totara/TotaraUtils',["jquery.sap.global","./Generator"],function(q,G){"use strict";var T=function(){};
T.calculateVolumeFromBoundingBox=function(b){var m=new THREE.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);var a=new THREE.Vector3(Number.MIN_VALUE,Number.MIN_VALUE,Number.MIN_VALUE);var c=new THREE.Vector3(-0.5,-0.5,-0.5);var d=new THREE.Vector3(0.5,0.5,0.5);for(var i=0;i<8;i++){var x=i&1?c.x:d.x;var y=i&2?c.y:d.y;var z=i&4?c.z:d.z;var p=new THREE.Vector3(x,y,z);p.applyMatrix4(b.matrixWorld);m.x=Math.min(m.x,p.x);m.y=Math.min(m.y,p.y);m.z=Math.min(m.z,p.z);a.x=Math.max(a.x,p.x);a.y=Math.max(a.y,p.y);a.z=Math.max(a.z,p.z);}var e=new THREE.Vector3().subVectors(a,m);return e.x*e.y*e.z;};
function P(i,c,t){if(!i||!c||!t){throw"ProgressLogger: invalid args";}this.context=c;this.loader=t;var a=new Set();this.logPerformance=function(n,b){if(!n||!b){return;}a.add(b);var l={name:n,timestamp:Date.now(),token:b};var d=G.createAddClientLogCommand(l);var m={method:"AddClientLogCommand",url:this.loader.getUrl(),authorizationHandler:c.authorizationHandler,token:c.token,command:d};this.loader.postMessage(m);};this.getTokens=function(){return a;};}
T.createLogger=function(i,c,a){if(!c){return null;}c.progressLogger=new P(i,c,a);return c.progressLogger;};
T.arrayToMatrix=function(a){var m=new THREE.Matrix4();if(a.length===3){m.setPosition(new THREE.Vector3().fromArray(a));}else if(a.length===12){m.set(a[0],a[3],a[6],a[9],a[1],a[4],a[7],a[10],a[2],a[5],a[8],a[11],0.0,0.0,0.0,1.0);}else if(a.length===16){m.set(a[0],a[4],a[8],a[12],a[1],a[5],a[9],a[13],a[2],a[6],a[10],a[14],a[3],a[7],a[11],a[15]);}else{throw"Invalid matrix format";}return m;};
T.arrayToColumnMajorMatrixArray16=function(a){if(a.length===16){return[a[0],a[4],a[8],a[12],a[1],a[5],a[9],a[13],a[2],a[6],a[10],a[14],a[3],a[7],a[11],a[15]];}if(a.length===12){return[a[0],a[3],a[6],a[9],a[1],a[4],a[7],a[10],a[2],a[5],a[8],a[11],0.0,0.0,0.0,1.0];}if(a.length===3){return[1,0,0,a[0],0,1,0,a[1],0,0,1,a[2],0,0,0,1];}return null;};
T.generateToken=function(){return g();};
function g(){function s(){return Math.floor((1+Math.random())*0x10000).toString(16).substring(1);}return s()+s()+"-"+s()+"-"+s()+"-"+s()+"-"+s()+s()+s();}
T.reportError=function(s,c,e){var a={error:e,context:c};s.onErrorCallbacks.execute(a);};
T.checkError=function(c){if(!c){return true;}var r=c.result==="failure";if(r){if(c.message){c.error=c.message;delete c.message;}else{c.message="unknown error";}}return r;};
return T;});
sap.ui.predefine('sap/ui/vk/totara/TreeBuilder',["jquery.sap.global","./ListMap","./TotaraUtils"],function(q,L,T){"use strict";var a=function(){};
a.getPartialTreeNodes=function(t,c,s){var p=[];var b=[];var i,j,d;if(t&&t.length){for(i=0;i<t.length;i++){d=t[i];if(d&&d.children){for(j=0;j<d.children.length;j++){var e=d.children[j];t[e].parentNode=d;}}}}if(t&&t.length){for(i=0;i<t.length;i++){d=t[i];if(d.parent){p.push(d);}else if(!d.parentNode){p.push(d);if(c&&c.rootNodeId){d.parent=c.rootNodeId;}}if(c&&c.nodeSidsForPartialTree.has(d.sid)){b.push(d);}}}if(c){c.nodeSidsForPartialTree.clear();}if(!b.length){return p;}p=[];for(j=0;j<b.length;j++){var n=b[j];var f=n.parentNode;while(f){if(s.sceneBuilder.getNode(f.sid,c.sceneId)){n.parent=f.sid;p.push(n);break;}else{n=f;f=f.parentNode;}}}if(p.length){return p;}else{return b;}};
a.buildTree=function(s,c){var r={};if(!c.treeNodes||!c.treeNodes.length){r.error="no tree information";return r;}var t=c.treeNodes;var p=a.getPartialTreeNodes(t,c,s);c.replacedNodes.clear();var b=[];var i;var d;for(i=0;i<p.length;i++){d=p[i].parent;if(s.sceneBuilder.getNode(d,c.sceneId)){a.buildNode(s,c,p[i],d);}else{b.push(p[i]);}}for(i=0;i<b.length;i++){d=b[i].parent;if(s.sceneBuilder.getNode(d,c.sceneId)){a.buildNode(s,c,p[i],d);}else{if(!r.error){r.error="";}r.error+="parent ${parentSid} does not exist in the scene. \n";}}c.treeNodes=[];c.progressCount.mesh.total=c.meshGroupListMap.size;return r;};
a.buildNode=function(s,c,t,p){if(!t||!p){T.reportError(s,c,"totaraTreeBuilder - buildNode - invalid args");return;}var e=s.sceneBuilder.getNode(t.sid,c.sceneId);if(e){s.sceneBuilder.remove(t.sid,c.sceneId);}if(t.suppressed===true){return;}if(!t.sid){T.reportError(s,c,"sid is missing in treeNode");return;}var r=s.sceneBuilder.createNode(t,p,c.sceneId);if(r.needSetSubmesh){var m=c.meshGroupListMap;var g=m.getOrCreate(t.meshId);g.push(t.sid);}if(r.needUpdataMaterial){s.materialIdsToRequest.add(t.materialId);}if(r.materialIds.length){for(var b=0;b<r.materialIds.length;b++){var n=c.materialIdNodeListMapForOpacityUpdate.getOrCreate(t.res.materialIds[b]);n.push(t.sid);}}var d=s.sceneBuilder.getNode(t.sid,c.sceneId);if(e&&d){c.replacedNodes.set(e,d);}if(t.children){var f=c.treeNodes;for(var i=0;i<t.children.length;i++){var h=t.children[i];a.buildNode(s,c,f[h],t.sid);}}};
return a;});
sap.ui.predefine('sap/ui/vk/totara/TreeHandler',["jquery.sap.global","./ListMap","./CameraHandler","./TotaraUtils","./TreeBuilder"],function(q,L,C,T,a){"use strict";var b=function(){};
b.setTree=function(s,c){if(T.checkError(c)){if(c.events&&c.events.length){var e=c.events[0];if(e.values&&e.values.id){var r=s.getContext(e.values.id);c.context=r;}}return c;}var d={};var f=s.getContext(c.sceneId);if(c.sid){var g=s.sceneBuilder.getNode(c.sid,f.sceneId);if(!g){var h=f.root;h.userData.treeNode={sid:c.sid,name:"root"};if(f){s.sceneBuilder.setRootNode(h,c.sid,c.sceneId);f.rootNodeId=c.sid;}else{d.error="faital error: no context. model not loaded";}}}if(c.camera){var i=C.setCameraSingle(s,c.camera);if(i){f.onActiveCameraCallbacks.execute(i);}}return d;};
b.setTreeNode=function(s,c){if(c.error){return c;}var r={};if(!c.sceneId){r.error="setTreeNode error: no sceneId";}var d=s.getContext(c.sceneId);if(!d){r.error="setTreeNode: no loading context";return r;}d.treeNodes=d.treeNodes.concat(c.nodes);return r;};
b.notifyFinishedTree=function(s,c){var r={};if(c.error){return c;}if(c.sceneId){r.context=s.getContext(c.sceneId);a.buildTree(s,r.context);}else{r.error="notifyFinishedTree error: no sceneId";}return r;};
return b;});
sap.ui.predefine('sap/ui/vk/totara/ViewBuilder',["jquery.sap.global","./ListMap","./CameraHandler","./TotaraUtils","./TreeBuilder"],function(q,L,C,T,a){"use strict";var V=function(){};
V.buildView=function(s,b){var r={};if(!b.treeNodes||!b.treeNodes.length){r.error="no tree information";return r;}var t=b.treeNodes;var p=a.getPartialTreeNodes(t);var n=[];for(var i=0;i<p.length;i++){var d=p[i].parent;V.processNode(s,b,p[i],n,d);}r.nodeInfos=n;b.treeNodes=[];return r;};
V.buildViewNode=function(s,b,t,n){if(!t){T.reportError(s,b,"totaraTreeBuilder - buildNode - invalid args");return;}var d=s.sceneBuilder.getNode(t.sid);var e={target:d};var r=s.sceneBuilder.updateMaterialInNode(t,b.sceneId);if(r.needUpdateMaterial){if(t.opacity){var f=b.materialIdNodeListMapForOpacityUpdate.getOrCreate(t.materialId);f.push(t.sid);}s.materialIdsToRequest.add(t.materialId);}if(r.nodeUpdated){b.updatedNodes.add(s.sceneBuilder.getNode(t.sid,b.scenedId));}if(t.transform){e.transform=T.arrayToColumnMajorMatrixArray16(t.transform);}else{e.transform=[1.0,0.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,0.0,1.0];}if(t.visible===undefined){e.visible=true;}else{e.visible=t.visible;}n.push(e);var g=s.sceneBuilder.getChildNodeIds(t.sid,b.sceneId);var h=c(b.treeNodes,t);var k;var i;for(i=0;i<g.length;i++){k=g[i];for(var j=0;j<h.length;j++){if(k===h[j]){g[i]=undefined;break;}}}for(i=0;i<g.length;i++){var l=g[i];if(l!==undefined){n.push({target:s.sceneBuilder.getNode(l),visible:false});}}if(t.children){for(i=0;i<t.children.length;i++){var m=t.children[i];var o=b.treeNodes[m];V.processNode(s,b,o,n,t.sid);}}};
V.processNode=function(s,b,t,n,p){var d=s.sceneBuilder.getNode(t.sid,b.sceneId);if(d){V.buildViewNode(s,b,t,n);}else{a.buildNode(s,b,t,p);var e=s.sceneBuilder.getNode(t.sid,b.sceneId);if(e){e.visible=false;n.push({target:e,visible:t.visible===undefined?true:t.visible});}}};
function c(t,b){var s=[];var d=0;if(b&&b.children){for(var i=0;i<b.children.length;i++){d=b.children[i];s.push(t[d].sid);}}return s;}
return V;});
sap.ui.predefine('sap/ui/vk/totara/ViewHandler',["jquery.sap.global","./ViewBuilder","./CameraHandler"],function(q,V,C){"use strict";var a=function(){};
a.setView=function(s,v){if(v.error){return v;}var r={};if(v.sceneId){var c=s.getContext(v.sceneId);c.currentView=v;c.treeNodes=[];r.context=c;if(v.camera){v.camera=C.setCameraSingle(s,v.camera);}}else{r.error="setView: no sceneId";}return r;};
a.setViewNode=function(s,c){if(c.error){return c;}var r={};if(c.sceneId){var b=s.getContext(c.sceneId);r.context=b;if(!b.currentView){r.error="error: setViewNode - no setView was in the chain";return r;}b.treeNodes=b.treeNodes.concat(c.nodes);}else{r.error="setViewNode: no sceneId";}return r;};
a.notifyFinishedView=function(s,c){var r={};if(c.sceneId){var b=s.getContext(c.sceneId);r.context=b;var d=b.currentView;if(!d){r.error="error: notifyFinishedView - no currentView";return r;}if(d.activeCameraId!==undefined){d.camera=s.sceneBuilder.getCamera(d.activeCameraId);}b.updatedNodes.clear();var v=V.buildView(s,b);d.viewNodes=v.nodeInfos;r.view=d;delete b.currentView;}else{r.error="notifyFinishedView - no sceneId";}return r;};
return a;});
/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine('sap/ui/vk/ContainerBase',["jquery.sap.global","./library","sap/ui/core/Control","sap/ui/core/IconPool","sap/ui/core/Popup","sap/ui/Device","sap/m/library","./ContainerBaseRenderer"],function(q,l,C,I,P,D,m,a){"use strict";
var b=C.extend("sap.ui.vk.ContainerBase",{metadata:{library:"sap.ui.vk",properties:{"showFullScreen":{type:"boolean",group:"Misc",defaultValue:true},"showSettings":{type:"boolean",group:"Misc",defaultValue:true},"showSelection":{type:"boolean",group:"Misc",defaultValue:true},"fullScreen":{type:"boolean",group:"Misc",defaultValue:false},"title":{type:"string",group:"Misc",defaultValue:""},"autoAdjustHeight":{type:"boolean",group:"Misc",defaultValue:false}},defaultAggregation:"content",aggregations:{content:{type:"sap.ui.vk.ContainerContent",multiple:true,singularName:"content"},"toolbar":{type:"sap.m.Toolbar",multiple:false,visibility:"hidden"}},associations:{},events:{"contentChange":{parameters:{selectedItemId:"string"}},"settingsPressed":{}}}});
b.prototype.switchContent=function(c){this.setSelectedContent(c);this.rerender();};
b.prototype.updateContainer=function(){this._contentChanged=true;this.rerender();};
b.prototype.setSelectedContent=function(c){this._oSelectedContent=c;};
b.prototype.getSelectedContent=function(){return this._oSelectedContent;};
b.prototype.init=function(){this._selectionState="SINGLE";this._firstTime=true;this._aContentIcons=[];this._selectedContent=null;this._oSelectedContent=null;this._bSegmentedButtonSaveSelectState=false;this._oMenu=null;this._customButtons=[];var L=new sap.m.OverflowToolbarLayoutData({priority:sap.m.OverflowToolbarPriority.High});var c=sap.m.ButtonType.Transparent;this._oFullScreenButton=new sap.m.OverflowToolbarButton({layoutData:L,type:c,icon:"sap-icon://full-screen",text:sap.ui.vk.getResourceBundle().getText("CONTAINERBASE_FULLSCREEN"),tooltip:sap.ui.vk.getResourceBundle().getText("CONTAINERBASE_FULLSCREEN"),press:function(){this._bSegmentedButtonSaveSelectState=true;this._toggleFullScreen();}.bind(this)});this._oSettingsButton=new sap.m.OverflowToolbarButton({layoutData:L.clone(),type:c,icon:"sap-icon://action-settings",text:sap.ui.vk.getResourceBundle().getText("CONTAINERBASE_SETTINGS"),tooltip:sap.ui.vk.getResourceBundle().getText("CONTAINERBASE_SETTINGS"),press:function(){this._bSegmentedButtonSaveSelectState=true;this.fireSettingsPressed();}.bind(this)});this._oSelectionButtonSingle=new sap.m.SegmentedButtonItem({icon:"sap-icon://map-container/selection-single",tooltip:sap.ui.vk.getResourceBundle().getText("CONTAINERBASE_MENU_SINGLE"),press:this._handleSelection.bind(this,"SINGLE")});this._oSelectionButtonRectangle=new sap.m.SegmentedButtonItem({icon:"sap-icon://map-container/selection-rectangle",tooltip:sap.ui.vk.getResourceBundle().getText("CONTAINERBASE_MENU_RECT"),press:this._handleSelection.bind(this,"RECT")});this._oSelectionButtonLasso=new sap.m.SegmentedButtonItem({icon:"sap-icon://map-container/selection-lasso",tooltip:sap.ui.vk.getResourceBundle().getText("CONTAINERBASE_MENU_LASSO"),press:this._handleSelection.bind(this,"LASSO")});this._selectionMenu=new sap.m.SegmentedButton({items:[this._oSelectionButtonSingle,this._oSelectionButtonRectangle,this._oSelectionButtonLasso]});this._oPopup=new P({modal:true,shadow:false,autoClose:false});this._oContentSegmentedButton=new sap.m.SegmentedButton({layoutData:L.clone(),select:this._onContentButtonSelect.bind(this)});this._oContTitle=new sap.m.Label();this._oToolbar=new sap.m.OverflowToolbar({width:"auto"}).addStyleClass("sapUiVkContainerBaseToolbar");this.setAggregation("toolbar",this._oToolbar);this.sResizeListenerId=null;if(D.system.desktop){this.sResizeListenerId=sap.ui.core.ResizeHandler.register(this,q.proxy(this._performHeightChanges,this));}else{D.orientation.attachHandler(this._performHeightChanges,this);D.resize.attachHandler(this._performHeightChanges,this);}q.sap.require("sap.ui.thirdparty.URI");var d=[{name:"selection-lasso",unicode:"E000"},{name:"selection-rectangle",unicode:"E001"},{name:"selection-single",unicode:"E002"}],e="map-container",f="map-container";d.forEach(function(i){sap.ui.core.IconPool.addIcon(i.name,e,f,i.unicode);});};
b.prototype.exit=function(){if(this._oFullScreenButton){this._oFullScreenButton.destroy();this._oFullScreenButton=undefined;}if(this._oPopup){this._oPopup.destroy();this._oPopup=undefined;}if(this._oContentSegmentedButton){this._oContentSegmentedButton.destroy();this._oContentSegmentedButton=undefined;}if(this._oSelectedContent){this._oSelectedContent.destroy();this._oSelectedContent=undefined;}if(this._oToolbar){this._oToolbar.destroy();this._oToolbar=undefined;}if(D.system.desktop&&this.sResizeListenerId){sap.ui.core.ResizeHandler.deregister(this.sResizeListenerId);this.sResizeListenerId=null;}else{D.orientation.detachHandler(this._performHeightChanges,this);D.resize.detachHandler(this._performHeightChanges,this);}};
b.prototype.setFullScreen=function(f){if(this._firstTime){return;}if(this.getFullScreen()==f){return;}var c=this.getProperty("fullScreen");if(c!==f){this._toggleFullScreen();}};
b.prototype.onAfterRendering=function(){var t=this;if((this.sResizeListenerId===null)&&(D.system.desktop)){this.sResizeListenerId=sap.ui.core.ResizeHandler.register(this,q.proxy(this._performHeightChanges,this));}if(this.getAutoAdjustHeight()||this.getFullScreen()){q.sap.delayedCall(500,this,function(){t._performHeightChanges();});}this._firstTime=false;if(this.getSelectedContent()!==null){var c=this.getSelectedContent().getContent();if(c instanceof sap.ui.vbm.GeoMap||c instanceof sap.ui.vbm.AnalyticMap){if(this.getShowSelection()){if(this._selectionState==="LASSO"){c.setLassoSelection(true);}else if(this._selectionState==="RECT"){c.setRectangularSelection(true);}else if(this._selectionState==="SINGLE"){c.setRectangularSelection(false);c.setLassoSelection(false);}}}}};
b.prototype.onBeforeRendering=function(){var t=this;if(t._contentChanged){t._contentChange();}t._oToolbar.getContent().forEach(function(e){var c=e.getId();var d=e["getPressed"]?e.getPressed():null;for(var i in t._customButtons){if(t._customButtons[i].button&&t._customButtons[i].button.getId()==c){t._customButtons[i].toggled=d;}}});t._oToolbar.removeAllContent();t._addToolbarContent();};
b.prototype.setTitle=function(v){this._oContTitle.setText(v);this.setProperty("title",v,true);};
b.prototype.addContent=function(o){this.addAggregation("content",o);this._contentChanged=true;};
b.prototype.insertContent=function(o,i){this.insertAggregation("content",o,i);this._contentChanged=true;};
b.prototype.updateContent=function(){this.updateAggregation("content");this._contentChanged=true;};
b.prototype._toggleFullScreen=function(){var f=this.getProperty("fullScreen");var s;var h;var c;if(f){this._closeFullScreen();this.setProperty("fullScreen",false,true);c=this.getSelectedContent().getContent();s=c.getId();c.setWidth("100%");h=this._contentHeight[s];if(h){c.setHeight(h);}this.invalidate();}else{var o=this.getAggregation("content");this._contentHeight={};if(o){for(var i=0;i<o.length;i++){c=o[i].getContent();s=c.getId();if(q.isFunction(c.getHeight)){h=c.getHeight();}else{h=0;}this._contentHeight[s]=h;}}this._openFullScreen(true);this.setProperty("fullScreen",true,true);}var d=(f?"sap-icon://full-screen":"sap-icon://exit-full-screen");this._oFullScreenButton.setIcon(d);this._oFullScreenButton.focus();};
b.prototype._openFullScreen=function(n){if((n!==null)&&(n===true)){this._oScrollEnablement=new sap.ui.core.delegate.ScrollEnablement(this,this.getId()+"-wrapper",{horizontal:true,vertical:true});}this.$content=this.$();if(this.$content){this.$tempNode=q("<div></div>");this.$content.before(this.$tempNode);this._$overlay=q("<div id='"+q.sap.uid()+"'></div>");this._$overlay.addClass("sapUiVkContainerBaseOverlay");this._$overlay.append(this.$content);this._oPopup.setContent(this._$overlay);}else{q.sap.log.warn("Overlay: content does not exist or contains more than one child");}this._oPopup.open(200,undefined,undefined,q("body"));};
b.prototype._closeFullScreen=function(){if(this._oScrollEnablement!==null){this._oScrollEnablement.destroy();this._oScrollEnablement=null;}this.$tempNode.replaceWith(this.$content);this._oToolbar.setDesign(sap.m.ToolbarDesign.Auto);this._oPopup.close();this._$overlay.remove();};
b.prototype._performHeightChanges=function(){if(this.getAutoAdjustHeight()||this.getFullScreen()){var $=this.$();if(($.find(".sapUiVkContainerBaseToolbarArea").children()[0])&&($.find(".sapUiVkContainerBaseContentArea").children()[0])){var o=this.getSelectedContent().getContent();if(o.getDomRef().offsetWidth!==this.getDomRef().clientWidth){this.rerender();}}}};
b.prototype._switchContent=function(c){var o=this._findContentById(c);this.setSelectedContent(o);this.fireContentChange({selectedItemId:c});this.rerender();};
b.prototype._contentChange=function(){var c=this.getContent();this._oContentSegmentedButton.removeAllButtons();this._destroyButtons(this._aContentIcons);this._aContentIcons=[];if(c.length===0){this._oContentSegmentedButton.removeAllButtons();this._setDefaultOnSegmentedButton();this.switchContent(null);}if(c){for(var i=0;i<c.length;i++){var d=c[i].getContent();if(d.setWidth){d.setWidth("100%");}var B=new sap.m.SegmentedButtonItem({icon:c[i].getIcon(),tooltip:c[i].getTitle(),key:d.getId()});this._aContentIcons.push(B);this._oContentSegmentedButton.addItem(B);if(i===0){this.setSelectedContent(c[i]);}}}this._contentChanged=false;};
b.prototype._onContentButtonSelect=function(e){var c=e.getParameter("key");this._switchContent(c);};
b.prototype._findContentById=function(s){var c=null;var o=this.getAggregation("content");if(o){for(var i=0;!c&&i<o.length;i++){if(o[i].getContent().getId()===s){c=o[i];}}}return c;};
b.prototype._addToolbarContent=function(){this._oToolbar.addContent(new sap.m.ToolbarSpacer());if(this._aContentIcons.length>1){this._oToolbar.addContent(this._oContentSegmentedButton);}if(this.getSelectedContent()!==null){var c=this.getSelectedContent().getContent();if(c instanceof sap.ui.vbm.GeoMap||c instanceof sap.ui.vbm.AnalyticMap){if(this.getShowSelection()){this._oToolbar.addContent(this._selectionMenu);}}}this._customButtons.forEach(function(i){if(i.visible){var s={type:sap.m.ButtonType.Transparent,layoutData:new sap.m.OverflowToolbarLayoutData({priority:sap.m.OverflowToolbarPriority.High})};if("active"in i){s.enabled=i.active;}if("icon"in i){s.icon=i.icon;}if("activeIcon"in i){s.activeIcon=i.activeIcon;}if("text"in i){s.text=i.text;}if("tooltip"in i){s.tooltip=i.tooltip;}if("press"in i){s.press=i.press;}if("toggled"in i){s.pressed=i.toggled;}if("overflow"in i){s.overflow=i.overflow;}switch(i.type){case sap.ui.vk.MapContainerButtonType.Click:i.button=s.overflow?new sap.m.OverflowToolbarButton(s):new sap.m.Button(s);break;default:i.button=s.overflow?new sap.m.OverflowToolbarToggleButton(s):new sap.m.ToggleButton(s);break;}this._oToolbar.addContent(i.button);}},this);if(this.getShowSettings()){this._oToolbar.addContent(this._oSettingsButton);}if(!D.system.phone&&this.getShowFullScreen()){this._oToolbar.addContent(this._oFullScreenButton);}};
b.prototype._setDefaultOnSegmentedButton=function(){if(!this._bSegmentedButtonSaveSelectState){this._oContentSegmentedButton.setSelectedButton(null);}this._bSegmentedButtonSaveSelectState=false;};
b.prototype._destroyButtons=function(c){c.forEach(function(B){B.destroy();});};
b.prototype._handleSelection=function(c){var d=this.getSelectedContent().getContent();if(d instanceof sap.ui.vbm.GeoMap||d instanceof sap.ui.vbm.AnalyticMap){if(c==="LASSO"){d.setLassoSelection(true);this._selectionState=c;}else if(c==="RECT"){d.setRectangularSelection(true);this._selectionState=c;}else if(c==="SINGLE"){d.setRectangularSelection(false);d.setLassoSelection(false);this._selectionState=c;}}};
return b;});
sap.ui.predefine('sap/ui/vk/ContainerBaseRenderer',function(){"use strict";var C={};
C.render=function(r,c){r.write("<div");r.writeControlData(c);r.addClass("sapUiVkContainerBase");r.writeClasses(c);r.write(">");r.write("<div");r.writeAttributeEscaped("id",c.getId()+"-wrapper");r.addClass("sapUiVkContainerBaseWrapper");r.writeClasses();r.write(">");this.writeContentArea(r,c);this.writeToolbarArea(r,c);r.write("</div>");r.write("</div>");};
C.writeContentArea=function(r,c){var s=c.getSelectedContent();r.write("<div");r.addClass("sapUiVkContainerBaseContentArea");r.writeClasses();r.write(">");if(s!==null){r.renderControl(s);}else if(c.getContent().length>0){s=c.getContent()[0];r.renderControl(s);}r.write("</div>");};
C.writeToolbarArea=function(r,c){r.write("<div");r.addClass("sapUiVkContainerBaseToolbarArea");r.writeClasses();r.write(">");r.renderControl(c._oToolbar);r.write("</div>");};
return C;},true);
sap.ui.predefine('sap/ui/vk/ContainerContent',["./library","sap/ui/core/Control","./ContainerContentRenderer"],function(l,C,a){"use strict";
var b=C.extend("sap.ui.vk.ContainerContent",{metadata:{library:"sap.ui.vk",properties:{"icon":{type:"string",group:"Misc",defaultValue:null},"title":{type:"string",group:"Misc",defaultValue:null}},aggregations:{"content":{type:"sap.ui.core.Control",multiple:false}}}});
b.prototype.setContent=function(c){if(c instanceof sap.ui.vbm.GeoMap){c.setNavcontrolVisible(false);c.setWidth("100%");c.setHeight("100%");}this.setAggregation("content",c);return this;};
return b;});
sap.ui.predefine('sap/ui/vk/ContainerContentRenderer',function(){"use strict";var C={};
C.render=function(r,c){r.renderControl(c.getContent());};
return C;},true);
sap.ui.predefine('sap/ui/vk/LegendItem',["./library","sap/m/StandardListItem","./LegendItemRenderer"],function(l,S,L){"use strict";
var a=S.extend("sap.ui.vk.LegendItem",{metadata:{library:"sap.ui.vk",properties:{color:{type:"sap.ui.core.CSSColor",group:"Appearance",defaultValue:null},semanticSpotType:{type:"sap.ui.vbm.SemanticType",group:"Behavior",defaultValue:null}},aggregations:{}}});
return a;});
sap.ui.predefine('sap/ui/vk/LegendItemRenderer',["sap/m/StandardListItemRenderer","sap/ui/core/Renderer"],function(B,R){"use strict";var L=R.extend(B);
L.renderLIContent=function(r,c){var s=c.getColor();var t=c.getSemanticSpotType();var i=null;if(s){r.write("<span");r.addClass("sapUiVkLegendItemSquare");r.addStyle("background-color",s);r.writeStyles();r.writeClasses();r.write(">");r.write("</span>");}if(t){switch(t){case sap.ui.vbm.SemanticType.Error:i=sap.ui.resource("sap.ui.vbm","themes/base/img/Pin_Red.png");break;case sap.ui.vbm.SemanticType.Warning:i=sap.ui.resource("sap.ui.vbm","themes/base/img/Pin_Orange.png");break;case sap.ui.vbm.SemanticType.Success:i=sap.ui.resource("sap.ui.vbm","themes/base/img/Pin_Green.png");break;case sap.ui.vbm.SemanticType.Default:i=sap.ui.resource("sap.ui.vbm","themes/base/img/Pin_Blue.png");break;case sap.ui.vbm.SemanticType.Inactive:i=sap.ui.resource("sap.ui.vbm","themes/base/img/Pin_Grey.png");break;default:break;}if(i){c.addStyleClass("sapUiVkLegendItemSpotType");c.setIcon(i);}}B.renderLIContent(r,c);};
return L;},true);
sap.ui.predefine('sap/ui/vk/ListPanel',["./library","sap/ui/core/Control","sap/m/library","./ListPanelRenderer"],function(l,C,m,L){"use strict";
var a=C.extend("sap.ui.vk.ListPanel",{metadata:{library:"sap.ui.vk",properties:{"headerText":{type:"string",group:"Misc"},"headerIcon":{type:"sap.ui.core.URI",group:"Misc"},"expanded":{type:"boolean",group:"Misc",defaultValue:true},"expandAnimation":{type:"boolean",group:"Misc",defaultValue:true},"selectionMode":{type:"sap.m.ListMode",group:"Misc",defaultValue:sap.m.ListMode.MultiSelect}},aggregations:{"items":{type:"sap.m.ListItemBase",multiple:true,singularName:"item"},"panel":{type:"sap.m.Panel",multiple:false,visibility:"hidden"}},events:{headerIconPress:{},expand:{},selectionChange:{parameters:{listItem:{type:"sap.m.ListItemBase"},listItems:{type:"sap.m.ListItemBase[]"},selected:{type:"boolean"}}},itemPress:{parameters:{listItem:{type:"sap.m.ListItemBase"},srcControl:{type:"sap.ui.core.Control"}}}}}});
a.prototype.getSelectedItem=function(){return this._oList.getSelectedItem();};
a.prototype.setSelectedItem=function(o,s,f){this._oList.setSelectedItem(o,s,f);};
a.prototype.getSelectedItems=function(){return this._oList.getSelectedItems();};
a.prototype.init=function(){this._oList=new sap.m.ListBase({mode:this.getSelectionMode(),itemPress:this.fireItemPress.bind(this),selectionChange:this.fireSelectionChange.bind(this)});this._oPanel=new sap.m.Panel({expandable:true,expanded:true,expandAnimation:true,headerToolbar:new sap.m.Toolbar({active:false}),content:[this._oList],expand:this.fireExpand.bind(this)});this._oPanel.getHeaderToolbar().addStyleClass("sapUiVkLPTb");this.setAggregation("panel",this._oPanel,true);this._oHeaderIcon=null;this._oHeaderText=null;this._bHeaderToolbarChanged=true;};
a.prototype.exit=function(){this._destroyControl(this._oList);this._destroyControl(this._oPanel);this._destroyControl(this._oHeaderIcon);this._destroyControl(this._oHeaderText);};
a.prototype.getItems=function(){return this._oList.getItems();};
a.prototype.addItem=function(o){return this._oList.addItem(o);};
a.prototype.insertItem=function(o,i){return this._oList.insertItem(o,i);};
a.prototype.removeItem=function(o){return this._oList.removeItem(o);};
a.prototype.removeAllItems=function(){return this._oList.removeAllItems();};
a.prototype.setHeaderText=function(v){if(!this._oHeaderText){this._oHeaderText=new sap.m.Title();}this._oHeaderText.setText(v);this._bHeaderToolbarChanged=true;if(this._oHeaderIcon){this._oHeaderIcon.setTooltip(v);this._oHeaderIcon.addAriaLabelledBy(this._oHeaderText);this._oHeaderIcon.addAriaDescribedBy(this._oHeaderText);}return this.setProperty("headerText",v);};
a.prototype.getExpanded=function(){return this._oPanel.getExpanded();};
a.prototype.setExpanded=function(v){return this._oPanel.setExpanded(v);};
a.prototype.getExpandAnimation=function(){return this._oPanel.getExpandAnimation();};
a.prototype.setExpandAnimation=function(v){return this._oPanel.setExpandAnimation(v);};
a.prototype.setHeaderIcon=function(v){if(!this._oHeaderIcon){this._oHeaderIcon=new sap.m.Button({press:this.fireHeaderIconPress.bind(this),type:sap.m.ButtonType.Transparent,tooltip:this.getHeaderText()});}this._oHeaderIcon.setIcon(v);this._bHeaderToolbarChanged=true;if(this._oHeaderText){this._oHeaderIcon.addAriaLabelledBy(this._oHeaderText);this._oHeaderIcon.addAriaDescribedBy(this._oHeaderText);}return this.setProperty("headerIcon",v);};
a.prototype.setSelectionMode=function(v){this._oList.setMode(v);return this.setProperty("selectionMode",v);};
a.prototype.onBeforeRendering=function(){if(this._bHeaderToolbarChanged){var t=this._oPanel.getHeaderToolbar();t.removeAllContent();if(this._oHeaderIcon){t.addContent(this._oHeaderIcon);}if(this._oHeaderText){t.addContent(this._oHeaderText);}this._bHeaderToolbarChanged=false;}};
a.prototype._destroyControl=function(c){if(c){c.destroy();c=undefined;}};
return a;});
sap.ui.predefine('sap/ui/vk/ListPanelRenderer',function(){"use strict";var L={};
L.render=function(r,c){var p=c._oPanel;p.addStyleClass("sapUiVkListPanel");r.write("<div");r.writeControlData(c);r.write(">");r.renderControl(p);r.write("</div>");};
return L;},true);
sap.ui.predefine('sap/ui/vk/ListPanelStack',["./library","sap/ui/core/Control","sap/ui/layout/library","./ListPanelStackRenderer"],function(l,C,a,L){"use strict";
var b=C.extend("sap.ui.vk.ListPanelStack",{metadata:{library:"sap.ui.vk",properties:{"width":{type:"sap.ui.core.CSSSize",group:"Misc",defaultValue:"100%"},"expanded":{type:"boolean",group:"Misc",defaultValue:true},"expandAnimation":{type:"boolean",group:"Misc",defaultValue:true},"collapsible":{type:"boolean",group:"Misc",defaultValue:true}},aggregations:{"content":{type:"sap.ui.vk.ListPanel",multiple:true,singularName:"content"},"layout":{type:"sap.ui.layout.VerticalLayout",multiple:false,visibility:"hidden"}}}});
b.prototype.init=function(){this._oLayout=new sap.ui.layout.VerticalLayout();this._oLayout.addStyleClass("sapUiVkLPSTrans");this.setAggregation("layout",this._oLayout,true);this._bFirstTime=true;};
b.prototype.exit=function(){if(this._oLayout){this._oLayout.destroy();this._oLayout=undefined;}};
b.prototype.getContent=function(){return this._oLayout.getContent();};
b.prototype.addContent=function(o){o.attachExpand(this._onContentExpand.bind(this));o.attachHeaderIconPress(this._onContentHeaderIconPress.bind(this));return this._oLayout.addContent(o);};
b.prototype.removeContent=function(o){return this._oLayout.removeContent(o);};
b.prototype.insertContent=function(o,i){return this._oLayout.insertContent(o,i);};
b.prototype.removeAllContent=function(){return this._oLayout.removeAllContent();};
b.prototype.getWidth=function(){return this._oLayout.getWidth();};
b.prototype.setWidth=function(v){this.setProperty("width",v,true);return this._oLayout.setWidth(v);};
b.prototype.setExpanded=function(v){if(v!=this.getExpanded()){if(v){this._expand();}else{this._collapse();}}return this;};
b.prototype.setExpandAnimation=function(v){this._oLayout.removeStyleClass("sapUiVkLPSTrans");if(v){this._oLayout.addStyleClass("sapUiVkLPSTrans");}return this.setProperty("expandAnimation",v,true);};
b.prototype.onBeforeRendering=function(){if(this._bFirstTime){var e=false;var c=this.getContent();for(var i=0;i<c.length;++i){if(c[i].getExpanded()){e=true;}}this.setExpanded(e);this._bFirstTime=false;}};
b.prototype.onAfterRendering=function(){if(!this.getExpanded()){this._updateCollapsedLayoutWidth();}};
b.prototype._onContentExpand=function(e){var c=false;var d=this._oLayout.getContent();for(var i=0;i<d.length;++i){if(d[i].getExpanded()){c=true;}}this.setExpanded(c);};
b.prototype._onContentHeaderIconPress=function(e){var c=e.oSource.getExpanded()?false:true;e.oSource.setExpanded(c);var E=false;var d=this._oLayout.getContent();for(var i=0;i<d.length;++i){if(d[i].getExpanded()){E=true;break;}}this.setExpanded(E);};
b.prototype._expand=function(){this._oLayout.removeStyleClass("sapUiVkLPSCollapse");this._oLayout.setWidth(this.getProperty("width"));this.setProperty("expanded",true,true);};
b.prototype._collapse=function(){if(!this.getCollapsible()){return;}var c=this.getContent();for(var i=0;i<c.length;++i){c[i].setExpanded(false);}this._oLayout.addStyleClass("sapUiVkLPSCollapse");this._updateCollapsedLayoutWidth();this.setProperty("expanded",false,true);};
b.prototype._updateCollapsedLayoutWidth=function(){if(this._oLayout.$().closest(".sapUiSizeCompact").length===0){this._oLayout.setWidth("3rem");}else{this._oLayout.setWidth("2.5rem");}};
return b;});
sap.ui.predefine('sap/ui/vk/ListPanelStackRenderer',function(){"use strict";var L={};
L.render=function(r,c){c._oLayout.addStyleClass("sapUiVkListPanelStack");r.renderControl(c._oLayout);};
return L;},true);
sap.ui.predefine('sap/ui/vk/MapContainer',["jquery.sap.global","./library","sap/ui/vk/ContainerBase","sap/ui/core/IconPool","sap/ui/vbm/lib/sapvbi","sap/ui/Device","./MapContainerRenderer"],function(q,l,C,I,s,D,M){"use strict";
var a=C.extend("sap.ui.vk.MapContainer",{metadata:{library:"sap.ui.vk",properties:{"showNavbar":{type:"boolean",group:"Misc",defaultValue:true},"showHome":{type:"boolean",group:"Misc",defaultValue:true},"showMapLayer":{type:"boolean",group:"Misc",defaultValue:true},"showRectangularZoom":{type:"boolean",group:"Misc",defaultValue:true},"showZoom":{type:"boolean",group:"Misc",defaultValue:true}},aggregations:{"listPanelStack":{type:"sap.ui.vk.ListPanelStack",multiple:false},"scrollCont":{type:"sap.m.ScrollContainer",multiple:false,visibility:"hidden"}},associations:{},events:{}}});
a.prototype.init=function(){this._currentText=new sap.m.Text({}).addStyleClass("mapLayerSelectedText");C.prototype.init.apply(this,arguments);var m=new sap.ui.model.json.JSONModel();m.setData({rectZoom:false});this.setModel(m,"rectZoom");this._oNavbar=new sap.m.Toolbar({width:"auto"});this._oScrollCont=new sap.m.ScrollContainer({horizontal:false,vertical:true,focusable:false});this.setAggregation("scrollCont",this._oScrollCont,true);this._oHomeButton=new sap.m.Button({icon:"sap-icon://home",type:sap.m.ButtonType.Transparent,tooltip:sap.ui.vk.getResourceBundle().getText("MAPCONTAINER_HOME"),press:this._onNavbarHome.bind(this)});this._oRectZoomButton=new sap.m.ToggleButton({icon:"sap-icon://draw-rectangle",type:sap.m.ButtonType.Transparent,pressed:"{rectZoom>/rectZoom}",tooltip:sap.ui.vk.getResourceBundle().getText("MAPCONTAINER_RECT_ZOOM")}).setModel(m,"rectZoom");this._oZoomInButton=new sap.m.Button({icon:"sap-icon://add",type:sap.m.ButtonType.Transparent,tooltip:sap.ui.vk.getResourceBundle().getText("MAPCONTAINER_ZOOMIN"),press:this._onNavbarZoomIn.bind(this)});this._oZoomOutButton=new sap.m.Button({icon:"sap-icon://less",type:sap.m.ButtonType.Transparent,tooltip:sap.ui.vk.getResourceBundle().getText("MAPCONTAINER_ZOOMOUT"),press:this._onNavbarZoomOut.bind(this)});if(D.system.phone){this._oMenuOpenButton=new sap.m.Button({layoutData:new sap.m.OverflowToolbarLayoutData({priority:sap.m.OverflowToolbarPriority.NeverOverflow}),icon:"sap-icon://menu2",type:sap.m.ButtonType.Transparent,tooltip:sap.ui.vk.getResourceBundle().getText("CONTAINERBASE_MENU"),press:function(){this._bSegmentedButtonSaveSelectState=true;this._showListPanelStack();}.bind(this)});this._oMenuCloseButton=new sap.m.Button({type:sap.m.ButtonType.Transparent,icon:"sap-icon://nav-back",press:function(){this._bSegmentedButtonSaveSelectState=true;this._hideListPanelStack();}.bind(this)});}};
a.prototype.exit=function(){if(this._oNavbar){this._oNavbar.destroy();this._oNavbar=undefined;}if(this._oScrollCont){this._oScrollCont.destroy();this._oScrollCont=undefined;}C.prototype.exit.apply(this,arguments);};
a.prototype.getListPanelStack=function(){return this._oScrollCont.getContent()[0];};
a.prototype.setListPanelStack=function(p){if(D.system.phone){p.setCollapsible(false);p.setWidth("100%");}this._oScrollCont.removeAllContent();return this._oScrollCont.addContent(p);};
a.prototype.onBeforeRendering=function(){C.prototype.onBeforeRendering.apply(this,arguments);this._oNavbar.removeAllContent();var c=this.getSelectedContent();if(c!==null){var b=c.getContent();this._isInstanceGeoAnalytic=b instanceof sap.ui.vbm.GeoMap||b instanceof sap.ui.vbm.AnalyticMap;if(this._isInstanceGeoAnalytic){if(this.getShowHome()){this._oNavbar.addContent(this._oHomeButton);}if(!D.system.phone&&this.getShowRectangularZoom()){this._oNavbar.addContent(this._oRectZoomButton);}if(this.getShowZoom()){this._oNavbar.addContent(this._oZoomInButton);this._oNavbar.addContent(this._oZoomOutButton);}this._shouldRenderListPanel=true;}else{this._shouldRenderListPanel=false;}this._isSupportingMapLayerSwitch=b instanceof sap.ui.vbm.GeoMap&&!(b instanceof sap.ui.vbm.AnalyticMap);if(this._isSupportingMapLayerSwitch&&b.getMapConfiguration()!==null&&this.getShowMapLayer()){var d=b.getMapConfiguration();var e=[].concat(d.MapLayerStacks);if(e.length>1){this._box=new sap.m.HBox({}).addStyleClass("mapContainerHboxPopover");this._popover=new sap.m.Popover({enableScrolling:false,placement:sap.m.PlacementType.Horizontal,content:this._box,showHeader:false});this._selectionMap=new sap.m.Image({width:"4.7rem",press:function(f){if(this._popover.isOpen()){this._popover.close();}else{this._popover.openBy(this._selectionMap);}}.bind(this)}).addStyleClass("mapLayerPopoverItem");}this._shouldRenderMapLayerSwitch=true;}else{this._shouldRenderMapLayerSwitch=false;}}};
a.prototype.onAfterRendering=function(){if(D.system.phone){var L=document.getElementById(this.getId()+"-LPW");this.getDomRef().appendChild(L);}C.prototype.onAfterRendering.apply(this,arguments);if(this.getSelectedContent()!==null){var c=this.getSelectedContent().getContent();if(this._isSupportingMapLayerSwitch===true&&c.getMapConfiguration()){var b=c.getMapConfiguration();var d=[].concat(b.MapLayerStacks);if(d.length>1){d.forEach(function(v,i){var e=new sap.ui.layout.VerticalLayout({});var f=c.mVBIContext.GetMainScene();var g=c.mVBIContext.m_MapLayerStackManager.GetMapLayerStack(v.name);var o=new sap.m.Image({width:"4.5rem",press:function(j){this._popover.close();o.setAlt(v.name);var k=j.getSource();var t=k.getAlt();c.setRefMapLayerStack(t);this._currentText.setText(v.name);f.GetPreviewImage(g,function(m){q(".mapLayerPopoverItem").attr("src",m.src);});this._currentMapLayerStackIndex=i;}.bind(this)});var h=new sap.m.Text({text:v.name}).addStyleClass("mapLayerPopoverItemText");o.addStyleClass("layerType");f.GetPreviewImage(g,function(j){o.setSrc(j.src);});f.GetPreviewImage(f.m_MapLayerStack,function(j){q(".mapLayerPopoverItem").attr("src",j.src);});var n=d[this._currentMapLayerStackIndex||0].name;this._currentText.setText(n);this._box.addItem(e);e.addContent(o);e.addContent(h);},this);}}}};
a.prototype.setToolbarItem=function(b){if(!b||!b.id){return null;}var o;for(var i=0;i<this._customButtons.length;++i){if(b.id===this._customButtons[i].id){o=this._customButtons[i];o.index=i;this._customButtons.splice(i,1);break;}}if(!o){o={id:b.id,visible:true,active:true,index:this._customButtons.length,type:sap.ui.vk.MapContainerButtonType.Click};}if("index"in b){o.index=b.index;}if("visible"in b){o.visible=b.visible;}if("overflow"in b){o.overflow=b.overflow;}if("active"in b){o.active=b.active;}if("text"in b){o.text=b.text;}if("tooltip"in b){o.tooltip=b.tooltip;}if("icon"in b){o.icon=b.icon;}if("activeIcon"in b){o.activeIcon=b.activeIcon;}if("press"in b){o.press=b.press;}if("toggled"in b){o.toggled=b.toggled;if(o.button){o.button.setPressed(b.toggled);}}if("type"in b){o.type=b.type;}if(o.index>this._customButtons.length){o.index=this._customButtons.length;}else if(o.index<0){o.index=0;}this._customButtons.splice(o.index,0,o);this.invalidate();return o;};
a.prototype.setSelectedContent=function(c){var o;if(this._oSelectedContent){if((o=this._oSelectedContent.getContent())instanceof sap.ui.vbm.GeoMap){o.unbindProperty("rectZoom","rectZoom>/rectZoom");}}C.prototype.setSelectedContent.apply(this,arguments);var n=this._oSelectedContent.getContent();if(n instanceof sap.ui.vbm.GeoMap){n.bindProperty("rectZoom","rectZoom>/rectZoom");}};
a.prototype._addToolbarContent=function(){if(D.system.phone){this._oToolbar.addContent(this._oMenuOpenButton);}C.prototype._addToolbarContent.apply(this,arguments);};
a.prototype._onNavbarZoomIn=function(e){var c=this.getSelectedContent().getContent();if(c.getZoomlevel&&c.setZoomlevel&&c.setEnableAnimation){c.setEnableAnimation(true);c.setZoomlevel(c.getZoomlevel()+1);}};
a.prototype._onNavbarZoomOut=function(e){var c=this.getSelectedContent().getContent();if(c.getZoomlevel&&c.setZoomlevel&&c.setEnableAnimation){c.setEnableAnimation(true);c.setZoomlevel(c.getZoomlevel()-1);}};
a.prototype._onNavbarHome=function(e){var c=this.getSelectedContent().getContent();if(c.goToStartPosition){c.goToStartPosition();}};
a.prototype._showListPanelStack=function(){q("#"+this.getId()+"-LPW").addClass("sapUiVkMapContainerLPWIn");q("#"+this.getId()+"-wrapper").addClass("sapUiVkMapContainerMapOut");};
a.prototype._hideListPanelStack=function(){q("#"+this.getId()+"-LPW").removeClass("sapUiVkMapContainerLPWIn");q("#"+this.getId()+"-wrapper").removeClass("sapUiVkMapContainerMapOut");};
return a;});
sap.ui.predefine('sap/ui/vk/MapContainerRenderer',["./ContainerBaseRenderer","sap/ui/core/Renderer","sap/ui/Device"],function(B,R,D){"use strict";var M=R.extend(B);
M.render=function(r,c){c.addStyleClass("sapUiVkMapContainer");B.render.apply(this,arguments);};
M.writeToolbarArea=function(r,c){r.write("<div");r.addClass("sapUiVkMapContainerOverlay");r.writeClasses();r.write(">");if(c.getShowNavbar()){r.write("<div");r.addClass("sapUiVkMapContainerNavbarArea");r.writeClasses();r.write(">");if(c.getShowMapLayer()&&c._shouldRenderMapLayerSwitch){r.renderControl(c._currentText);r.renderControl(c._selectionMap);}r.write("<div");r.addClass("sapUiVkMapContainerNavbarContainer");r.writeClasses();r.write(">");r.renderControl(c._oNavbar);r.write("</div>");r.write("</div>");}if(!D.system.phone&&c._shouldRenderListPanel){c._oScrollCont.addStyleClass("sapUiVkMapContainerListPanelArea");r.renderControl(c._oScrollCont);}B.writeToolbarArea(r,c);r.write("</div>");if(D.system.phone){r.write("<div id="+c.getId()+"-LPW");r.addClass("sapUiVkMapContainerLPW");r.writeClasses();r.write(">");r.renderControl(c._oMenuCloseButton);c._oScrollCont.addStyleClass("sapUiVkMapContainerListPanelArea");r.renderControl(c._oScrollCont);r.write("</div>");}};
return M;},true);
sap.ui.predefine('sap/ui/vk/NativeViewport',["jquery.sap.global","./library","sap/ui/core/Control","sap/ui/core/ResizeHandler","./Loco","./ViewportHandler","./Messages","./ContentConnector","./NativeViewportRenderer"],function(q,l,C,R,L,V,M,a,N){"use strict";
var b=C.extend("sap.ui.vk.NativeViewport",{metadata:{library:"sap.ui.vk",properties:{limitZoomOut:{type:"boolean",group:"Behavior",defaultValue:false}},associations:{contentConnector:{type:"sap.ui.vk.ContentConnector",multiple:false}},events:{"resize":{parameters:{oldSize:"object",size:"object"}},"move":{parameters:{pan:"object",zoom:"float"}}}}});
b.prototype.init=function(){if(C.prototype.init){C.prototype.init.call(this);}this._canvas=null;this._canvas=document.createElement("div");this._canvas.style.textAlign="left";this._canvas.id=q.sap.uid();this._resizeListenerId=null;this._viewportHandler=new V(this);this._loco=new L();this._loco.addHandler(this._viewportHandler);this._reset();this._svgid=this.getId()+"-svg";};
b.prototype.exit=function(){this._loco.removeHandler(this._viewportHandler);this._viewportHandler.destroy();if(this._resizeListenerId){R.deregister(this._resizeListenerId);this._resizeListenerId=null;}if(C.prototype.exit){C.prototype.exit.call(this);}};
b.prototype.onBeforeRendering=function(){if(this._resizeListenerId){R.deregister(this._resizeListenerId);this._resizeListenerId=null;}};
b.prototype.onAfterRendering=function(){if(this._canvas){var d=this.getDomRef();d.appendChild(this._canvas);this._resizeListenerId=R.register(this,this._handleResize.bind(this));this._handleResize({size:{width:d.clientWidth,height:d.clientHeight}});}};
b.prototype._handleResize=function(e){this.fireResize({oldSize:e.oldSize,size:e.size});if(!e.oldSize||!e.oldSize.width||!e.oldSize.height||this._svgError){this._bestFit();}else{this._update();}};
b.prototype._reset=function(){this._img=null;this._svg=null;this._svgError=null;this._imageW=0;this._imageH=0;this._s4BestFit=1;this._s=1;this._x=0;this._y=0;this._gx=0;this._gy=0;this._canvas.style.visibility="hidden";while(this._canvas.lastChild){this._canvas.removeChild(this._canvas.lastChild);}};
b.prototype._update=function(){var i=this._svgError||this._img||this._svg;if(i){var x=this._x-(this._imageW-this._canvas.clientWidth)/2;var y=this._y-(this._imageH-this._canvas.clientHeight)/2;var t="matrix("+this._s+",0,0,"+this._s+","+x+","+y+")";i.style.transform=t;i.style.webkitTransform=t;i.style.msTransform=t;i.style.MozTransform=t;i.style.OTransform=t;}};
b.prototype._bestFit=function(){if(this._svgError){this._imageW=550;this._imageH=512;}else if(this._svg){this._imageW=this._svg.clientWidth;this._imageH=this._svg.clientHeight;}else if(this._img){this._imageW=this._img.width;this._imageH=this._img.height;}else{return;}if(!this._imageW||!this._imageH||!this._canvas.clientWidth||!this._canvas.clientHeight){return;}var s=Math.min(this._canvas.clientWidth/this._imageW,this._canvas.clientHeight/this._imageH);this._s4BestFit=s;this._s=s;this._x=0;this._y=0;this._update();this._canvas.style.visibility="visible";};
b.prototype.loadUrl=function(u,o,c,d,e){if(/^(svg)$/.test(e.toLowerCase())){this._reset();this._svg=document.createElement("object");this._svg.setAttribute("type","image/svg+xml");this._svg.setAttribute("data",u);this._svg.setAttribute("id",this._svgid);this._svg.setAttribute("class","SVGImage");this._canvas.appendChild(this._svg);var s=document.createElement("div");s.style.position="absolute";s.style.top=0;s.style.left=0;s.style.height="100%";s.style.width="100%";this._canvas.appendChild(s);this._svg.onload=function(){this._svg.onload=null;setTimeout(function(){this._bestFit();if(o){o();}}.bind(this),0);}.bind(this);this._svg.onerror=function(){q.sap.log.error(sap.ui.vk.getResourceBundle().getText(M.VIT1.summary),M.VIT1.code,"sap.ui.vk.NativeViewport");this._reset();if(c){c();}}.bind(this);this._svg.src=u;return this;}else if(/^(jpg|jpeg|png|gif|bmp|tif|tiff)$/.test(e.toLowerCase())){this._reset();this._img=new Image();this._img.draggable=false;this._img.onload=function(){setTimeout(function(){this._bestFit();this._canvas.appendChild(this._img);if(o){o();}}.bind(this),0);}.bind(this);this._img.onerror=function(){q.sap.log.error(sap.ui.vk.getResourceBundle().getText(M.VIT2.summary),M.VIT2.code,"sap.ui.vk.NativeViewport");if(c){c();}};this._img.src=u;return this;}else{q.sap.log.error(sap.ui.vk.getResourceBundle().getText(M.VIT3.summary),M.VIT3.code,"sap.ui.vk.NativeViewport");if(c){c();}}};
b.prototype.loadFailed=function(t){this._reset();this._svgError=document.createElement("div");this._svgError.className="svgErrorContainer";this._svgErrorElement=document.createElementNS("http://www.w3.org/2000/svg","svg");this._svgErrorElement.setAttribute("width","550px");this._svgErrorElement.setAttribute("height","512px");this._svgErrorElement.setAttribute("viewBox","-244 -244 512 512");this._svgErrorElement.setAttribute("enable-background","new -244 -244 512 512");this._svgErrorElement.setAttribute("id","SVGError");var c=document.createElementNS("http://www.w3.org/2000/svg","rect");c.setAttribute("fill","#FFFFFF");c.setAttribute("x","-244");c.setAttribute("y","-244");c.setAttribute("width","512");c.setAttribute("height","512");c.setAttribute("opacity","0.1");this._svgErrorElement.appendChild(c);var d=document.createElementNS("http://www.w3.org/2000/svg","path");d.setAttribute("fill","#474747");d.setAttribute("d","M12.833,89.742c-70.781,0-128.366-57.584-128.366-128.366c0-70.781,57.584-128.365,128.366-128.365 s128.365,57.584,128.365,128.365C141.198,32.158,83.614,89.742,12.833,89.742z M12.833-146.989 c-59.753,0-108.366,48.612-108.366,108.365c0,59.752,48.613,108.366,108.366,108.366S121.198,21.129 121.198-38.624 C121.198-98.376,72.586-146.989,12.833-146.989z");d.setAttribute("opacity","0.3");this._svgErrorElement.appendChild(d);var e=document.createElementNS("http://www.w3.org/2000/svg","rect");e.setAttribute("fill","#474747");e.setAttribute("x","-2.167");e.setAttribute("y","-120.847");e.setAttribute("width","30");e.setAttribute("height","119.447");e.setAttribute("fill","#474747");e.setAttribute("opacity","0.3");this._svgErrorElement.appendChild(e);var f=document.createElementNS("http://www.w3.org/2000/svg","rect");f.setAttribute("fill","#474747");f.setAttribute("x","-2.167");f.setAttribute("y","13.6");f.setAttribute("width","30");f.setAttribute("height","30");f.setAttribute("opacity","0.3");this._svgErrorElement.appendChild(f);var g=document.createElementNS("http://www.w3.org/2000/svg","path");g.setAttribute("fill","#474747");g.setAttribute("d","M10.833,87.33c-70.781,0-128.366-57.584-128.366-128.365c0-70.781,57.584-128.365,128.366-128.365 s128.365,57.584,128.365,128.365C139.198,29.746,81.614,87.33,10.833,87.33z M10.833-149.4 c-59.753,0-108.366,48.612-108.366,108.365S-48.92,67.33,10.833,67.33S119.198,18.718,119.198-41.035S70.586-149.4,10.833-149.4z");this._svgErrorElement.appendChild(g);var h=document.createElementNS("http://www.w3.org/2000/svg","rect");h.setAttribute("fill","#474747");h.setAttribute("x","-4.167");h.setAttribute("y","-123.259");h.setAttribute("width","30");h.setAttribute("height","119.447");h.setAttribute("fill","#474747");this._svgErrorElement.appendChild(h);var i=document.createElementNS("http://www.w3.org/2000/svg","rect");i.setAttribute("fill","#474747");i.setAttribute("x","-4.167");i.setAttribute("y","11.188");i.setAttribute("width","30");i.setAttribute("height","30");i.setAttribute("fill","#474747");this._svgErrorElement.appendChild(i);var j=document.createElementNS("http://www.w3.org/2000/svg","text");j.setAttribute("id","textError");j.setAttribute("left","auto");j.setAttribute("right","auto");j.setAttribute("y","150");j.setAttribute("x","10");j.setAttribute("display","block");j.setAttribute("text-anchor","middle");j.setAttribute("fill","#474747");j.setAttribute("style","font-family:Arial");j.setAttribute("font-size","32");j.textContent=t?t:sap.ui.vk.getResourceBundle().getText("VIEWPORT_MESSAGEUNSUPPORTEDFILEFORMAT");this._svgErrorElement.appendChild(j);this._svgError.appendChild(this._svgErrorElement);this._bestFit();this._canvas.appendChild(this._svgError);return this;};
b.prototype.beginGesture=function(x,y){this._gx=(x-this._canvas.clientWidth/2-this._x)/this._s;this._gy=(y-this._canvas.clientHeight/2-this._y)/this._s;return this;};
b.prototype.endGesture=function(){this._gx=0;this._gy=0;return this;};
b.prototype.pan=function(d,c){if(this._svgError){return this;}this._x+=d;this._y+=c;this._update();this.fireMove({pan:{x:d,y:c},zoom:1.0});return this;};
b.prototype.rotate=function(d,c){if(this._svgError){return this;}this._x+=d;this._y+=c;this._update();this.fireMove({pan:{x:d,y:c},zoom:1.0});return this;};
b.prototype._getZoomInLimit=function(){return 500;};
b.prototype._getZoomOutLimit=function(){return(this.getLimitZoomOut())?this._s4BestFit*0.25:0.0001;};
b.prototype._getZoomFactor=function(){return this._s;};
b.prototype.zoom=function(z){if(this._svgError){return this;}var g=this._gx*this._s;var c=this._gy*this._s;var o=this._s;this._s=Math.min(Math.max(this._s*z,this._getZoomOutLimit()),this._getZoomInLimit());z=this._s/o;var d=this._gx*this._s;var e=this._gy*this._s;var f=g-d;var h=c-e;this._x+=f;this._y+=h;this._update();this.fireMove({pan:{x:f,y:h},zoom:z});return this;};
b.prototype.tap=function(x,y,i){if(i){this._bestFit();}return this;};
b.prototype.queueCommand=function(c){c();return this;};
b.prototype.getViewInfo=function(){var v={};v.camera=[this._s,0,0,this._s,this._x,this._y];return v;};
b.prototype.setViewInfo=function(v){if(this._svgError){return this;}var c=v.camera;this._s=c[0];this._x=c[4];this._y=c[5];this._update();return this;};
b.prototype.getOutputSize=function(){var c=this.getViewInfo().camera,d=this.getDomRef().getBoundingClientRect();return{left:d.width/2+c[4],top:d.height/2+c[5],sideLength:this._canvas.children[0].getBoundingClientRect().width};};
b.prototype._onAfterUpdateContentConnector=function(){this._setImage(this._contentConnector.getContent());};
b.prototype._onBeforeClearContentConnector=function(){this._setImage(null);};
b.prototype._handleContentReplaced=function(e){this._setImage(e.getParameter("newContent"));};
b.prototype._setImage=function(i){this._reset();if(i instanceof HTMLObjectElement){this._svg=i;i.setAttribute("id",this._svgid);i.onload=function(){i.onload=null;setTimeout(function(){this._bestFit();}.bind(this),0);}.bind(this);if(sap.ui.Device.browser.msie||sap.ui.Device.browser.edge){setTimeout(function(){this._bestFit();}.bind(this),0);}this._canvas.appendChild(i);var s=document.createElement("div");s.style.position="absolute";s.style.top=0;s.style.left=0;s.style.height="100%";s.style.width="100%";this._canvas.appendChild(s);}else if(i instanceof HTMLImageElement){this._img=i;i.draggable=false;setTimeout(function(){this._bestFit();this._canvas.appendChild(i);}.bind(this),0);}};
var r=2;var p=2;[{key:"left",dx:-p,dy:0},{key:"right",dx:+p,dy:0},{key:"up",dx:0,dy:-p},{key:"down",dx:0,dy:+p}].forEach(function(i){b.prototype["onsap"+i.key]=function(e){this.beginGesture(this.$().width()/2,this.$().height()/2);this.pan(i.dx,i.dy);this.endGesture();e.preventDefault();e.stopPropagation();};});[{key:"left",dx:-r,dy:0},{key:"right",dx:+r,dy:0},{key:"up",dx:0,dy:-r},{key:"down",dx:0,dy:+r}].forEach(function(i){b.prototype["onsap"+i.key+"modifiers"]=function(e){if(e.shiftKey&&!(e.ctrlKey||e.altKey||e.metaKey)){this.beginGesture(this.$().width()/2,this.$().height()/2);this.rotate(i.dx,i.dy);this.endGesture();e.preventDefault();e.stopPropagation();}};});[{key:"minus",d:0.98},{key:"plus",d:1.02}].forEach(function(i){b.prototype["onsap"+i.key]=function(e){this.beginGesture(this.$().width()/2,this.$().height()/2);this.zoom(i.d);this.endGesture();e.preventDefault();e.stopPropagation();};});a.injectMethodsIntoClass(b);return b;});
sap.ui.predefine('sap/ui/vk/Notifications',["jquery.sap.global","./library","sap/ui/core/Control","./Messages","sap/m/ToggleButton","./NotificationsRenderer"],function(q,l,C,M,T,N){"use strict";
var a=C.extend("sap.ui.vk.Notifications",{metadata:{library:"sap.ui.vk",publicMethods:["clearAllMessages"],aggregations:{_messagePopover:{type:"sap.m.MessagePopover",multiple:false,visibility:"hidden"},_messagePopoverToggleButton:{type:"sap.m.ToggleButton",multiple:false,visibility:"hidden"}},events:{allMessagesCleared:{},messageAdded:{}}}});
a.prototype.init=function(){if(C.prototype.init){C.prototype.init.call(this);}var m;var b=new T({icon:"sap-icon://message-popup",type:sap.m.ButtonType.Emphasized,tooltip:sap.ui.vk.getResourceBundle().getText("MESSAGEPOPOVERBUTTON"),text:"0",press:function(e){if(b.getPressed()){m.openBy(b);}else{m.close();}}});b.addStyleClass("messagePopoverButton");this.setAggregation("_messagePopoverToggleButton",b);m=new sap.m.MessagePopover({headerButton:new sap.m.Button({text:sap.ui.vk.getResourceBundle().getText("MESSAGEPOPOVER_CLEARBUTTON"),type:sap.m.ButtonType.Emphasized,tooltip:sap.ui.vk.getResourceBundle().getText("MESSAGEPOPOVER_CLEARBUTTON"),press:function(e){m.getParent().clearAllMessages();}}),afterClose:b.setPressed.bind(b,false)});m.addStyleClass("sapVizKitNotificationPopover");this.setAggregation("_messagePopover",m);q.sap.log.addLogListener(this);};
a.prototype.exit=function(){q.sap.log.removeLogListener(this);if(C.prototype.exit){C.prototype.exit.call(this);}};
a.prototype.onLogEntry=function(e){if(/^sap\.ui\.vk/.test(e.component)){var m=e.details,c,r,b;if(M[e.details]){m=sap.ui.vk.getResourceBundle().getText(M[e.details].summary);c=sap.ui.vk.getResourceBundle().getText(M[e.details].cause);r=sap.ui.vk.getResourceBundle().getText(M[e.details].resolution);b=sap.ui.vk.getResourceBundle().getText("ERROR_DESCRIPTION_CODE");}var d=sap.ui.vk.getResourceBundle().getText("ERROR_DESCRIPTION_COMPONENT");var f=sap.ui.vk.getResourceBundle().getText("ERROR_DESCRIPTION_DATE");var t=sap.ui.vk.getResourceBundle().getText("ERROR_DESCRIPTION_TIME");var g=sap.ui.vk.getResourceBundle().getText("ERROR_DESCRIPTION_LEVEL");var h=sap.ui.vk.getResourceBundle().getText("ERROR_DESCRIPTION_MESSAGE");var i=sap.ui.vk.getResourceBundle().getText("ERROR_DESCRIPTION_CAUSE");var j=sap.ui.vk.getResourceBundle().getText("ERROR_DESCRIPTION_RESOLUTION");var k="<div><b>"+d+":</b><br>"+e.component+"</div><br>"+"<div><b>"+f+":</b><br>"+e.date+"</div><br>"+(b?"<div><b>"+b+":</b><br>"+e.details+"</div><br>":"")+"<div><b>"+t+":</b><br>"+e.time.slice(0,e.time.indexOf("."))+"</div><br>"+"<div><b>"+g+":</b><br>"+e.level+"</div><br>"+"<div><b>"+h+":</b><br>"+m+"</div><br>"+(c?"<div><b>"+i+":</b><br>"+c+"</div><br>":"")+(r?"<div><b>"+j+":</b><br>"+r+"</div>":"");var n=new sap.m.MessagePopoverItem({markupDescription:true,title:e.message,description:k});var o=this.getAggregation("_messagePopover");o.addItem(n);this.getAggregation("_messagePopoverToggleButton").setText(o.getItems().length);this.fireMessageAdded();}};
a.prototype.clearAllMessages=function(){var m=this.getAggregation("_messagePopover");m.removeAllItems();m.close();this.getAggregation("_messagePopoverToggleButton").setText(m.getItems().length);this.fireAllMessagesCleared();return this;};
return a;});
sap.ui.predefine('sap/ui/vk/Overlay',["jquery.sap.global","./library","sap/ui/core/Control","sap/ui/vbm/library","sap/ui/vbm/lib/sapvbi","./Messages","./OverlayRenderer"],function(q,l,C,v,a,M,O){"use strict";
var b=C.extend("sap.ui.vk.Overlay",{metadata:{library:"sap.ui.vk",properties:{zoomOnResize:{type:"boolean",group:"Behavior",defaultValue:true}},aggregations:{areas:{type:"sap.ui.vk.OverlayArea",multiple:true,singularName:"area"}},associations:{target:{type:"sap.ui.core.Control",cardinality:"0..1"}},events:{click:{parameters:{clientX:{type:"int"},clientY:{type:"int"},pos:{type:"string"}}},contextMenu:{parameters:{pos:{type:"string"},menu:{type:"sap.ui.unified.Menu"}}}}}});
b.prototype.getPositionInteractive=function(p,c){if(!this.mIACreateCB&&c&&typeof(c)==="function"){this.mIACreateCB=c;var t="POS";if(p){t+="ARRAY";}var L={"SAPVB":{"Automation":{"Call":{"handler":"OBJECTCREATIONHANDLER","name":"CreateObject","object":"MainScene","scene":"MainScene","instance":"","Param":{"name":"data","#":"{"+t+"}"}}}}};this._load(L);return true;}else{return false;}};
b.prototype.openContextMenu=function(m){this._openContextMenu("Overlay",this,m);};
b.prototype.setPanAndZoom=function(n,c,z){if(n===0&&c===0&&z===1){return;}var s=this.mVBIContext.GetMainScene();this.totalCenterOffset.dx+=n;this.totalCenterOffset.dy+=c;if(z===1){s.MoveMap(n,c);}else{var d=s.m_Canvas[0];var e=d.m_nExactLOD+Math.log(z)*Math.LOG2E;s.ZoomToGeoPosition(VBI.MathLib.DegToRad([0.5,0.5]),e);s.MoveMap(this.totalCenterOffset.dx,this.totalCenterOffset.dy);}};
b.prototype.reset=function(){this.totalCenterOffset.dx=this.totalCenterOffset.dy=0;var s=this.mVBIContext.GetMainScene();if(s){s.ZoomToGeoPosition(VBI.MathLib.DegToRad([0.5,0.5]),this.initialZoom);}return this;};
b.prototype.init=function(){this.aLoadQueue=null;this.oTargetDomRef=null;this.mVBIContext=new VBI.VBIContext(this);this.resizeID="";this.resizeIDTarget="";this.bVosDirty=true;this.bWindowsDirty=true;this.bSceneDirty=true;this.bDataDeltaUpdate=false;this.bHandleDataChangeActive=false;this.bForceDataUpdate=false;this.mAddMenuItems=[];this.totalCenterOffset={dx:0,dy:0};this.initialZoom=10;};
b.prototype.exit=function(){if(this.mVBIContext){this.mVBIContext.clear();}if(this.resizeID!=""){sap.ui.core.ResizeHandler.deregister(this.resizeID);this.resizeID="";}if(this.resizeIDTarget!=""){sap.ui.core.ResizeHandler.deregister(this.resizeIDTarget);this.resizeIDTarget="";}};
b.prototype.resize=function(e){var c=(this.oControl!=undefined)?this.oControl:this;var d=c.mVBIContext;if(d){var s=d.GetMainScene();if(s){if(c.getZoomOnResize()&&e&&e.oldSize.width>0){var z=Math.log(e.size.width/e.oldSize.width)*Math.LOG2E;s.ZoomToGeoPosition(s.GetCenterPos(),s.GetCurrentZoomlevel()+z,false,true,true);}s.resizeCanvas(e,true,true);}}};
b.prototype.setTarget=function(t){if(!t){return;}this.setAssociation("target",t);this.reset();if(t instanceof sap.m.Image){t.addDelegate({onAfterRendering:function(e){this.oTargetDomRef=t.getDomRef();this.oTargetDomRef.addEventListener("load",q.proxy(this._adaptSizeOfTarget,this));}.bind(this)});}else{t.addDelegate({onAfterRendering:function(e){this.oTargetDomRef=t.getDomRef();this._adaptSizeOfTarget();}.bind(this)});}if(this.resizeIDTarget!=""){sap.ui.core.ResizeHandler.deregister(this.resizeIDTarget);this.resizeIDTarget="";}this.resizeIDTarget=sap.ui.core.ResizeHandler.register(t,this._adaptSizeOfTarget.bind(this));};
b.prototype._adaptSizeOfTarget=function(){var t=this.oTargetDomRef;var d=this.getDomRef();if(t){try{var T=q(t);var p={top:T.offset().top,left:T.offset().left,width:T.outerWidth(),height:T.outerHeight()};q(d).width(p.width).height(p.height).css("position","absolute");q(d).css("top","0px").css("left","0px").css("visibility","");}catch(e){q.sap.log.error(e);}}else{q(d).css("position","fixed").width("0px").height("0px").css("top","0px").css("left","0px").css("visibility","hidden");}};
b.prototype.onAfterRendering=function(){if(this.$oldContent.length>0){this.$().append(this.$oldContent);}this._adaptSizeOfTarget();if(this.aLoadQueue){var n;for(n=0;n<this.aLoadQueue.length;++n){this._load(this.aLoadQueue[n]);}this.aLoadQueue=null;}if(this.resizeID==""){this.resize();this.resizeID=sap.ui.core.ResizeHandler.register(this,this.resize);}var o=this.getId();if(this.mVBIContext.m_Windows){this.mVBIContext.m_Windows.Awake(o);}};
b.prototype.onBeforeRendering=function(){this.$oldContent=sap.ui.core.RenderManager.findPreservedContent(this.getId());};
b.prototype.invalidate=function(s){this.bSceneDirty=true;if(s instanceof sap.ui.vk.OverlayArea){this.bVosDirty=true;this.bDataDeltaUpdate=this.bHandleDataChangeActive;}sap.ui.core.Control.prototype.invalidate.apply(this,arguments);};
b.prototype._load=function(d){if(!this.isRendered()){if(!this.aLoadQueue){this.aLoadQueue=[];}this.aLoadQueue.push(d);return;}this._loadHtml(d);};
b.prototype._loadHtml=function(d){var o=this.getId();var c=null;if(typeof d=="string"){c=JSON.parse(d.indexOf("{")?d.substr(d.indexOf("{")):d);}else if(typeof d=="object"){c=d;}if(!c){return;}if(!c["SAPVB"]){var m;if(this.mVBIContext&&(m=(new VBI.Adaptor(this.mVBIContext)).CreateLoadData(c))){this.loadHtml(m);return;}else{return;}}var e=false;var f=false;var g=false;if(q.type(c)=="object"){if(c.SAPVB){if(c.SAPVB.Config){this.mVBIContext.GetConfig().load(c.SAPVB.Config,this.mVBIContext);}if(c.SAPVB.Resources){this.mVBIContext.GetResources().load(c.SAPVB.Resources,this.mVBIContext);}if(c.SAPVB.DataTypes){if(!this.mVBIContext["m_DataTypeProvider"]){this.mVBIContext["m_DataTypeProvider"]=new VBI.DataTypeProvider();}this.mVBIContext["m_DataTypeProvider"].load(c.SAPVB.DataTypes,this.mVBIContext);}if(c.SAPVB.Data){if(!this.mVBIContext["m_DataProvider"]){this.mVBIContext["m_DataProvider"]=new VBI.DataProvider();}this.mVBIContext["m_DataProvider"].load(c.SAPVB.Data,this.mVBIContext);e=true;}if(c.SAPVB.Windows){if(!this.mVBIContext["m_Windows"]){this.mVBIContext["m_Windows"]=new VBI.Windows();}this.mVBIContext["m_Windows"].load(c.SAPVB.Windows,this.mVBIContext);g=true;}if(c.SAPVB.Actions){if(!this.mVBIContext["m_Actions"]){this.mVBIContext["m_Actions"]=new VBI.Actions();}this.mVBIContext["m_Actions"].load(c.SAPVB.Actions,this.mVBIContext);}if(c.SAPVB.Automation){if(!this.mVBIContext["m_Automations"]){this.mVBIContext["m_Automations"]=new VBI.Automations();}this.mVBIContext["m_Automations"].load(c.SAPVB.Automation,this.mVBIContext);}if(c.SAPVB.Menus){if(!this.mVBIContext["m_Menus"]){this.mVBIContext["m_Menus"]=new VBI.Menus();}this.mVBIContext["m_Menus"].load(c.SAPVB.Menus,this.mVBIContext);}if(c.SAPVB.Scenes){if(!this.mVBIContext["m_SceneManager"]){this.mVBIContext["m_SceneManager"]=new VBI.SceneManager();}this.mVBIContext["m_SceneManager"].load(c.SAPVB.Scenes,this.mVBIContext);f=true;}}if(e){if(this.mVBIContext["m_Windows"]){this.mVBIContext["m_Windows"].NotifyDataChange();}}if(f||g){if(this.mVBIContext["m_Windows"]){this.mVBIContext["m_Windows"].Awake(o);}}if(f||e){if(this.mVBIContext["m_Windows"]){this.mVBIContext["m_Windows"].RenderAsync();}}}};
b.prototype._openContextMenu=function(t,i,m){if(m&&m.vbi_data&&m.vbi_data.VBIName=="DynContextMenu"){if(!this.mVBIContext["m_Menus"]){this.mVBIContext["m_Menus"]=new window.VBI.Menus();}for(var n=0;n<this.mAddMenuItems.length;++n){m.addItem(this.mAddMenuItems[n]);}this.mVBIContext.m_Menus.m_menus.push(m);this._loadHtml({"SAPVB":{"version":"2.0","Automation":{"Call":{"earliest":"0","handler":"CONTEXTMENUHANDLER","instance":i.sId,"name":"SHOW","object":t,"refID":"CTM","Param":[{"name":"x","#":i.mClickPos[0]},{"name":"y","#":i.mClickPos[1]},{"name":"scene","#":"MainScene"}]}}}});}this.mAddMenuItems=[];};
b.prototype._update=function(){var A={SAPVB:{}};if(this.bSceneDirty){this._updateScene(A);}this._updateWindows(A);if(A.SAPVB.Actions){Array.prototype.push.apply(A.SAPVB.Actions.Set.Action,this._getActionArray());}return this._minimizeApp(A);};
b.prototype._minimizeApp=function(A){var t,s;var c;s=null;if(!this.bWindowsDirty){c=(t=A)&&(t=t.SAPVB)&&(t=t.Windows)&&(s=JSON.stringify(t))&&(s==this.mCurWindows)&&(delete A.SAPVB.Windows);if(!c){this.mCurWindows=s?s:this.mCurWindows;}}else{this.bWindowsDirty=false;}s=null;c=(t=A)&&(t=t.SAPVB)&&(t=t.Scenes)&&(s=JSON.stringify(t))&&(s==this.mCurScenes)&&(delete A.SAPVB.Scenes);if(!c){this.mCurScenes=s?s:this.mCurScenes;}s=null;c=(t=A)&&(t=t.SAPVB)&&(t=t.Actions)&&(s=JSON.stringify(t))&&(s==this.mCurActions)&&(delete A.SAPVB.Actions);if(!c){this.mCurActions=s?s:this.mCurActions;}s=null;c=(t=A)&&(t=t.SAPVB)&&(t=t.DataTypes)&&(s=JSON.stringify(t))&&(s==this.mCurDataTypes)&&(delete A.SAPVB.DataTypes);if(!c){this.mCurDataTypes=s?s:this.mCurDataTypes;}if(!this.bForceDataUpdate){s=null;c=(t=A)&&(t=t.SAPVB)&&(t=t.Data)&&(s=JSON.stringify(t))&&(s==this.mCurData)&&(delete A.SAPVB.Data);if(!c){this.mCurData=s?s:this.mCurData;}}else{this.bForceDataUpdate=false;}return A;};
b.prototype._updateWindows=function(A){A.SAPVB.Windows={"Set":[{"name":"Main","Window":{"id":"Main","caption":"MainWindow","type":"geo","refParent":"","refScene":"MainScene","modal":"true"}}]};};
b.prototype._updateScene=function(A){var s=[];var c=[];var d=[];var e=[];this._updateVOData(s,c,d,e);var _=JSON.stringify(s);var m=true;if(!this.saVO){((((A.SAPVB.Scenes={}).Set={}).SceneGeo={id:"MainScene",scaleVisible:"false",navControlVisible:"false",VisualFrame:{minLOD:5},NavigationDisablement:{move:"true",zoom:"true"},initialZoom:this.initialZoom.toString(),initialStartPosition:"0.5;0.5;0"}).VO=s);}else if(this.bRefMapLayerStackDirty||!(this.saVO===_)){(A.SAPVB.Scenes=this._getSceneVOdelta(JSON.parse(this.m_saVO),s));}else{m=false;}this.saVO=_;if(this.bDataDeltaUpdate){A.SAPVB.Data=[];for(var n=0;n<c.length;++n){A.SAPVB.Data.push({Set:{name:c[n].name,type:"N",N:c[n]}});}}else{((A.SAPVB.Data={}).Set={}).N=c;}if(m){(((A.SAPVB.DataTypes={}).Set={}).N=d);}(((A.SAPVB.Actions={}).Set={}).Action=e);this.bSceneDirty=this.bVosDirty=this.bDataDeltaUpdate=false;};
b.prototype._isEventRegistered=function(A,e){var c=this.getAggregation(A);if(!c){return false;}for(var n=0;n<c.length;++n){var i=c[n];if(i.hasListeners(e)){return true;}}return false;};
b.prototype._getTemplateBindingInfo=function(A){var B=this.getBindingInfo(A);if(B&&B.template){return B.template.mBindingInfos;}};
b.prototype._getBindInfo=function(A){var B={};var t=this._getTemplateBindingInfo(A);B.C=(t)?t.hasOwnProperty("color"):true;B.CB=(t)?t.hasOwnProperty("colorBorder"):true;B.DCH=(t)?t.hasOwnProperty("deltaColorHot"):true;B.CS=(t)?t.hasOwnProperty("colorSelect"):true;B.CNS=(t)?t.hasOwnProperty("colorNonSelect"):true;B.TT=(t)?t.hasOwnProperty("tooltip"):true;B.M=(t)?t.hasOwnProperty("changeable"):true;B.hasTemplate=(t)?true:false;return B;};
b.prototype._updateVOData=function(s,c,d,e){var B,V;this.AreaBindInfo=B=(this.AreaBindInfo)?this.AreaBindInfo:this._getBindInfo("areas");V=(B.hasTemplate)?this.getBindingInfo("areas").template:null;var o={id:"OverlayArea",datasource:"OverlayArea",type:"{00100000-2012-0004-B001-F311DE491C77}"};o["posarray.bind"]=o.id+".P";if(B.C){o["color.bind"]=o.id+".C";}else{o.color=V.getColor();}if(B.CB){o["colorBorder.bind"]=o.id+".C";}else{o.colorBorder=V.getColorBorder();}if(B.DCH){o["hotDeltaColor.bind"]=o.id+".DCH";}else{o.hotDeltaColor=V.getDeltaColorHot();}if(B.CS){o["colorSelect.bind"]=o.id+".C";}else{o.colorSelect=V.getColorSelect();}if(B.CNS){o["colorNonSelect.bind"]=o.id+".C";}else{o.colorNonSelect=V.getColorNonSelect();}if(!B.M){o["VB:c"]=V.getChangeable();}s.push(o);var f={name:o.id,key:"K"};f.A=[{"name":"K","alias":"K","type":"string"},{"name":"VB:s","alias":"VB:s","type":"boolean"},{"name":"P","alias":"P","type":"vectorarray","changeable":"true"}];if(B.C){f.A.push({"name":"C","alias":"C","type":"color"});}if(B.CB){f.A.push({"name":"CB","alias":"CB","type":"string"});}if(B.DCH){f.A.push({"name":"DCH","alias":"DCH","type":"string"});}if(B.CS){f.A.push({"name":"CS","alias":"CS","type":"string"});}if(B.CNS){f.A.push({"name":"CNS","alias":"CNS","type":"string"});}if(B.TT){f.A.push({"name":"TT","alias":"TT","type":"string"});}d.push(f);var i=o.id;if(this._isEventRegistered("areas","click")){e.push({"id":i+"1","name":"click","refScene":"MainScene","refVO":i,"refEvent":"Click","AddActionProperty":[{"name":"pos"}]});}if(this._isEventRegistered("areas","contextMenu")){e.push({"id":i+"2","name":"contextMenu","refScene":"MainScene","refVO":i,"refEvent":"ContextMenu"});}if(this._isEventRegistered("areas","edgeClick")){e.push({"id":i+"7","name":"edgeClick","refScene":"MainScene","refVO":i,"refEvent":"EdgeClick"});}e.push({"id":i+"4","name":"handleMoved","refScene":"MainScene","refVO":i,"refEvent":"HandleMoved"});e.push({"id":i+"5","name":"handleContextMenu","refScene":"MainScene","refVO":i,"refEvent":"HandleContextMenu"});e.push({"id":i+"8","name":"edgeContextMenu","refScene":"MainScene","refVO":i,"refEvent":"EdgeContextMenu"});if(this._isEventRegistered("areas","handleClick")){e.push({"id":i+"6","name":"handleClick","refScene":"MainScene","refVO":i,"refEvent":"HandleClick"});}var g={name:o.id,E:[]};var h=this.getAreas();for(var n=0;n<h.length;++n){g.E.push(h[n].getDataElement());}c.push(g);};
b.prototype._getSceneVOdelta=function(c,n){var V=[];var r=[];var o={};for(var d=0,e=c.length;d<e;++d){o[c[d].id]=c[d];}for(var f=0;f<n.length;++f){if(o[n[f].id]){if(JSON.stringify(n[f])!=JSON.stringify(o[n[f].id])){r.push({"id":n[f].id,"type":"VO"});V.push(n[f]);}}else{V.push(n[f]);}delete o[n[f].id];}for(var i in o){r.push({"id":i,"type":"VO"});}var g={"Merge":{"name":"MainScene","type":"SceneGeo","SceneGeo":{"id":"MainScene"}}};if(r.length){g.Merge.SceneGeo.Remove=r;}if(V.length){g.Merge.SceneGeo.VO=V;}return g;};
b.prototype._getActionArray=function(){var A=[];if(this.mEventRegistry["click"]){A.push({"id":"Overlay1","name":"click","refScene":"MainScene","refVO":"Map","refEvent":"Click","AddActionProperty":[{"name":"pos"}]});}if(this.mEventRegistry["contextMenu"]){A.push({"id":"Overlay2","name":"contextMenu","refScene":"MainScene","refVO":"Map","refEvent":"ContextMenu","AddActionProperty":[{"name":"pos"}]});}A.push({"id":"Overlay3","name":"GetPosComplete","refScene":"MainScene","refVO":"General","refEvent":"CreateComplete"});return A;};
b.prototype._handleChangedData=function(n){try{this.bHandleDataChangeActive=true;if(n&&n.length){for(var c=0,N;c<n.length;++c){N=n[c];if(N.E&&N.E.length){for(var d=0,e,i;d<N.E.length;++d){e=N.E[d];i=this._findInstance(e.K);if(i){i.handleChangedData(e);}}}}}this.bHandleDataChangeActive=false;}catch(f){this.bHandleDataChangeActive=false;throw f;}};
b.prototype._findInstance=function(i){var I=(i.indexOf(".")!==-1)?i.split(".")[1]:i;var A=this.getAreas();for(var n=0;n<A.length;++n){var e=A[n];if(e.getId()===I){return e;}}return null;};
b.prototype._handleAggregationEvent=function(e){var E;if((E=this._findInstance(e.Action.instance))){try{E.handleEvent(e);}catch(c){q.sap.log.error(sap.ui.vk.getResourceBundle().getText(M.VIT11.summary),M.VIT11.code,"sap.ui.vk.Overlay");}}};
b.prototype.isRendered=function(){return this.getDomRef()?true:false;};
b.prototype.fireSubmit=function(e){var d=JSON.parse(e.data);if(d.Data&&d.Data.Merge){this._handleChangedData(d.Data.Merge.N);}if(d.Action.object==="OverlayArea"){this._handleAggregationEvent(d);}else{var A=d.Action.name,c;if(A==="click"||A==="contextMenu"){c=[d.Action.Params.Param[0]["#"],d.Action.Params.Param[1]["#"]];}switch(A){case"GetPosComplete":if(this.mIACreateCB){try{this.mIACreateCB(d.Action.Params.Param[0]["#"]);this.mIACreateCB=null;}catch(f){this.mIACreateCB=null;throw f;}}break;case"click":this.fireClick({clientX:c[0],clientY:c[1],pos:d.Action.AddActionProperties.AddActionProperty[0]["#"]});break;case"contextMenu":if(this.mVBIContext.m_Menus){this.mVBIContext.m_Menus.deleteMenu("DynContextMenu");}sap.ui.getCore().loadLibrary("sap.ui.unified");var m=new sap.ui.unified.Menu();m["vbi_data"]={};m["vbi_data"].menuRef="CTM";m["vbi_data"].VBIName="DynContextMenu";this.mClickPos=c;this.fireContextMenu({pos:d.Action.AddActionProperties.AddActionProperty[0]["#"],menu:m});break;default:break;}}};
b.prototype.fireRender=function(d){};
b.prototype.fireMove=function(d){};
b.prototype.fireZoom=function(d){};
b.prototype.fireOpenWindow=function(d){};
b.prototype.fireCloseWindow=function(d){};
return b;});
sap.ui.predefine('sap/ui/vk/OverlayArea',["./library","sap/ui/core/Element"],function(l,E){"use strict";
var O=E.extend("sap.ui.vk.OverlayArea",{metadata:{library:"sap.ui.vk",properties:{key:{type:"string",group:"Misc",defaultValue:null},position:{type:"string",group:"Misc",defaultValue:null},color:{type:"sap.ui.core.CSSColor",group:"Misc",defaultValue:"rgba(200, 50, 50, 0.3)"},colorBorder:{type:"sap.ui.core.CSSColor",group:"Misc",defaultValue:"rgba(200, 50, 50, 1.0)"},colorSelect:{type:"string",group:"Misc",defaultValue:null},colorNonSelect:{type:"string",group:"Misc",defaultValue:null},deltaColorHot:{type:"string",group:"Misc",defaultValue:"RHLSA(0;1.3;1.0;1.0)"},select:{type:"boolean",group:"Misc",defaultValue:false},changeable:{type:"boolean",group:"Misc",defaultValue:false}},events:{click:{clientX:{type:"int"},clientY:{type:"int"}},contextMenu:{parameters:{menu:{type:"sap.ui.unified.Menu"}}},edgeClick:{parameters:{index:{type:"int"}}},edgeContextMenu:{parameters:{index:{type:"int"},menu:{type:"sap.ui.unified.Menu"}}},handleMoved:{},handleContextMenu:{parameters:{index:{type:"int"},menu:{type:"sap.ui.unified.Menu"}}},handleClick:{index:{type:"int"}}}}});
O.prototype.openContextMenu=function(m){this.getParent().openContextMenu("OverlayArea",this,m);};
O.prototype.getDataElement=function(){var e={};var b=this.getParent().AreaBindInfo;e.K=this.getId();if(b.C){e.C=this.getColor();}if(b.CB){e.CB=this.getColorBorder();}if(b.DCH){e.DCH=this.getDeltaColorHot();}if(b.CS){e.CS=this.getColorSelect();}if(b.CNS){e.CNS=this.getColorNonSelect();}if(b.TT){e.TT=this.getTooltip();}e["VB:s"]=this.getSelect();e.P=this.getPosition();if(b.M){e["VB:c"]=this.getChangeable();}return e;};
O.prototype.handleChangedData=function(e){if(e.P){this.setPosition(e.P);}};
O.prototype.handleEvent=function(e){var a=e.Action.name;var f="fire"+a[0].toUpperCase()+a.slice(1);if(a==="contextMenu"||a==="edgeContextMenu"||a==="handleContextMenu"){var p=this.getParent();this.mClickPos=[e.Action.Params.Param[0]["#"],e.Action.Params.Param[1]["#"]];if(p.mVBIContext.m_Menus){p.mVBIContext.m_Menus.deleteMenu("DynContextMenu");}sap.ui.getCore().loadLibrary("sap.ui.unified");var m=new sap.ui.unified.Menu();m["vbi_data"]={};m["vbi_data"].menuRef="CTM";m["vbi_data"].VBIName="DynContextMenu";if(this.getChangeable()){if(a==="edgeContextMenu"){var s=e.Action.Params.Param[2]["#"];p.mAddMenuItems.push(new sap.ui.unified.MenuItem({text:sap.ui.vk.getResourceBundle().getText("OVL_AREA_EDGE_SPLIT"),select:this._handleCtxFunction.bind(this,"SPLIT",s)}));}else if(a==="handleContextMenu"){var h=e.Action.Params.Param[2]["#"];p.mAddMenuItems.push(new sap.ui.unified.MenuItem({text:sap.ui.vk.getResourceBundle().getText("OVL_AREA_HANDLE_REMOVE"),select:this._handleCtxFunction.bind(this,"REMOVE",h)}));}}if(this.hasListeners(a)){if(a==="contextMenu"){this.firecontextMenu({menu:m});}else{this[f]({index:e.Action.Params.Param[2]["#"],menu:m});}}else{p._openContextMenu(e.Action.object,this,m);}}else if(a=="click"){this.mClickPos=e.Action.AddActionProperties.AddActionProperty[0]["#"];this.fireClick({clientX:e.Action.Params.Param[0]["#"],clientY:e.Action.Params.Param[1]["#"]});}else if(a.indexOf("Click")>-1){this[f]({index:e.Action.Params.Param[2]["#"]});}else{this[f]();}};
O.prototype.getKey=function(){var k=this.getProperty("key");if(!k){k=this.getId();}return k;};
O.prototype._handleCtxFunction=function(f,c){var p=this.getPosition().split(";");var o=c*3;if(f==="REMOVE"){p.splice(o,3);}else if(f==="SPLIT"){var s=[p[o],p[o+1]];var e=(o+3<p.length)?[p[o+3],p[o+4]]:[p[0],p[1]];var m=[parseFloat(s[0])+(e[0]-s[0])/2,parseFloat(s[1])+(e[1]-s[1])/2];p.splice(o+3,0,m[0].toString(),m[1].toString(),"0");}this.setPosition(p.toString().replace(/,/g,";"));};
return O;});
sap.ui.predefine('sap/ui/vk/OverlayRenderer',function(){"use strict";var O={};
O.render=function(r,c){r.write("<div");r.writeControlData(c);r.addClass("sapUiVkOverlay");r.writeClasses(c);r.write(">");r.write("</div>");var a;if((a=c._update())){c._load(a);}};
return O;},true);
sap.ui.predefine('sap/ui/vk/Viewer',["jquery.sap.global","./library","sap/ui/core/Control","./Scene","./ContentResource","./ContentConnector","./dvl/ContentManager","./FlexibleControl","sap/m/VBox","sap/m/FlexItemData","sap/ui/layout/Splitter","sap/ui/layout/SplitterLayoutData","./DvlException","./Messages","./ProgressIndicator","./Notifications","./ViewStateManager","./Toolbar","./SceneTree","./StepNavigation","./Viewport","./NativeViewport","./RedlineDesign","./ViewerRenderer"],function(q,a,C,S,b,c,D,F,V,d,e,f,g,M,P,N,h,T,j,k,m,n,R,o){"use strict";var p=q.sap.log;
var r=C.extend("sap.ui.vk.Viewer",{metadata:{library:"sap.ui.vk",properties:{enableOverlay:{type:"boolean",defaultValue:false},enableSceneTree:{type:"boolean",defaultValue:true},showSceneTree:{type:"boolean",defaultValue:true},enableStepNavigation:{type:"boolean",defaultValue:true},enableNotifications:{type:"boolean",defaultValue:true},showStepNavigation:{type:"boolean",defaultValue:false},showStepNavigationThumbnails:{type:"boolean",defaultValue:true},enableToolbar:{type:"boolean",defaultValue:true},enableProgressIndicator:{type:"boolean",defaultValue:true},width:{type:"sap.ui.core.CSSSize",defaultValue:null},height:{type:"sap.ui.core.CSSSize",defaultValue:null},toolbarTitle:{type:"string",defaultValue:""},shouldTrackVisibilityChanges:{type:"boolean",defaultValue:false},recursiveSelection:{type:"boolean",defaultValue:false},runtimeSettings:{type:"object",defaultValue:{}},webGLContextAttributes:{type:"object",defaultValue:{antialias:true,alpha:true,premultipliedAlpha:false}},showAllHotspots:{type:"boolean",defaultValue:false},hotspotColorABGR:{type:"int",defaultValue:0xc00000ff},hotspotColor:{type:"sap.ui.core.CSSColor",defaultValue:"rgba(255, 0, 0, 0.7529411764705882)"}},aggregations:{contentResources:{type:"sap.ui.vk.ContentResource",forwarding:{getter:"_getContentConnector",aggregation:"contentResources"}},overlay:{type:"sap.ui.vk.Overlay",multiple:false},progressIndicator:{type:"sap.ui.vk.ProgressIndicator",multiple:false,visibility:"hidden"},layout:{type:"sap.m.VBox",multiple:false,visibility:"hidden"},contentConnector:{type:"sap.ui.vk.ContentConnector",multiple:false,visibility:"hidden"},viewStateManager:{type:"sap.ui.vk.ViewStateManager",multiple:false,visibility:"hidden"}},defaultAggregation:"contentResources",events:{contentResourceChangesProcessed:{},sceneLoadingSucceeded:{parameters:{scene:{type:"sap.ui.vk.Scene"}}},sceneLoadingFailed:{parameters:{reason:{type:"object"}}},sceneDestroying:{parameters:{scene:{type:"sap.ui.vk.Scene"},preventGarbageCollection:{type:"function"}}},selectionChanged:{parameters:{selected:{type:"any[]"},unselected:{type:"any[]"}}},fullScreen:{parameters:{isFullScreen:{type:"boolean"}}},urlClicked:{parameters:{nodeRef:"any",url:"string"}},nodeClicked:{parameters:{nodeRef:"any",x:"int",y:"int"}}}}});
r.prototype.applySettings=function(i){this._inApplySettings=true;C.prototype.applySettings.apply(this,arguments);delete this._inApplySettings;if(this._viewStateManager){this._viewStateManager.setShouldTrackVisibilityChanges(this.getShouldTrackVisibilityChanges());this._viewStateManager.setRecursiveSelection(this.getRecursiveSelection());}this._componentsState={sceneTree:{defaultEnable:this.getEnableSceneTree(),shouldBeEnabled:true,userInteractionShow:this.getShowSceneTree()},stepNavigation:{defaultEnable:this.getEnableStepNavigation(),userInteractionShow:this.getShowStepNavigation()},progressIndicator:{defaultEnable:this.getEnableProgressIndicator()},messagePopover:{defaultEnable:this.getEnableNotifications()}};this.setEnableSceneTree(false);this.setEnableStepNavigation(false);};
r.prototype.init=function(){if(C.prototype.init){C.prototype.init.apply(this);}this._contentConnector=new c(this.getId()+"-contentconnector");this.setAggregation("contentConnector",this._contentConnector);this._contentConnector.attachContentReplaced(this._handleContentReplaced,this);this._contentConnector.attachContentChangesStarted(this._handleContentChangesStarted,this);this._contentConnector.attachContentChangesFinished(this._handleContentChangesFinished,this);this._contentConnector.attachContentChangesProgress(this._handleContentChangesProgress,this);this._viewStateManager=new h(this.getId()+"-viewstatemanager",{contentConnector:this._contentConnector});this.setAggregation("viewStateManager",this._viewStateManager);p.debug("sap.ui.vk.Viewer.init() called.");this._mainScene=null;this._busyIndicatorCounter=0;this._viewport=null;this._nativeViewport=null;this._redlineDesign=null;this._stepNavigation=null;this._sceneTree=null;this._overlayManager={initialized:false,changed:false,control:null,onNativeViewportMove:function(i){var l=i.getParameter("pan");var z=i.getParameter("zoom");this.control.setPanAndZoom(l.x,l.y,z);},onViewportZoom:function(i){var z=i.getParameter("zoomFactor");this.control.setPanAndZoom(0,0,z);},onViewportPan:function(i){var l=i.getParameter("dx");var t=i.getParameter("dy");this.control.setPanAndZoom(l,t,1);}};this._overlayManager.delegate={onAfterRendering:this._onAfterRenderingOverlay.bind(this,this._viewport,this._nativeViewport,this._overlayManager)};this._toolbar=new T({title:this.getToolbarTitle(),visible:this.getEnableToolbar(),viewer:this});this._stackedViewport=new F(this.getId()+"-stackedViewport",{width:"100%",height:"100%",layout:"Stacked",layoutData:new f({size:"auto",minSize:200})});this._splitter=new e(this.getId()+"-splitter",{layoutData:new sap.m.FlexItemData({growFactor:1,minHeight:"200px"}),contentAreas:[this._stackedViewport]}).addStyleClass("sapUiVizKitSplitter");this._messagePopover=new N({visible:true});this._messagePopover.attachAllMessagesCleared(this._updateLayout,this);this._messagePopover.attachMessageAdded(this._updateLayout,this);this._layout=new V(this.getId()+"-vbox",{height:"100%",items:[this._toolbar,this._splitter,this._messagePopover]}).addStyleClass("sapUiVizKitLayout");this.setAggregation("layout",this._layout);this.setTooltip(sap.ui.vk.getResourceBundle().getText("VIEWER_TITLE"));if(this.getEnableProgressIndicator()){this._progressIndicator=new P({visible:false}).addStyleClass("sapUiVizKitProgressIndicator");this.setAggregation("progressIndicator",this._progressIndicator);}};
r.prototype.exit=function(){p.debug("sap.ui.vk.Viewer.exit() called.");if(this._viewport){this._viewport.detachEvent("viewActivated",this._onViewportViewActivated,this);this._viewport.destroy();this._viewport=null;}if(this._nativeViewport){this._nativeViewport.destroy();this._nativeViewport=null;}this._setMainScene(null);this._toolbar=null;this._messagePopover=null;this._sceneTree=null;this._stepNavigation=null;this._componentsState=null;this._viewStateManager=null;this._contentConnector=null;if(C.prototype.exit){C.prototype.exit.apply(this);}};
r.prototype._setMainScene=function(i){if(i){if(i!==this._mainScene){this._mainScene=i;this._showViewport();if(this._componentsState.sceneTree.defaultEnable){this._instantiateSceneTree();this.setEnableSceneTree(true);if(this._componentsState.sceneTree.userInteractionShow&&this._componentsState.sceneTree.shouldBeEnabled){this.setShowSceneTree(true);this._sceneTree.setVisible(true);}else{this.setShowSceneTree(false);}}else if(this._sceneTree&&this._viewStateManager){this._sceneTree.setScene(i,this._viewStateManager);}this.setEnableStepNavigation(i instanceof sap.ui.vk.dvl.Scene&&(this.getEnableStepNavigation()||this._componentsState.stepNavigation.defaultEnable));if(this.getEnableStepNavigation()){this._instantiateStepNavigation();this.setShowStepNavigation(this._componentsState.stepNavigation.userInteractionShow);}}if(this._stepNavigation){this._stepNavigation.refresh(i);}}else{this._mainScene=null;this.setEnableSceneTree(false);this.setEnableStepNavigation(false);}return this;};
r.prototype.getGraphicsCore=function(){return this._mainScene instanceof sap.ui.vk.dvl.Scene?this._mainScene.getGraphicsCore():null;};
r.prototype.getScene=function(){return this._mainScene;};
r.prototype.getViewStateManager=function(){return this._viewStateManager;};
r.prototype.getViewport=function(){if(!this._viewport){this._viewport=new m(this.getId()+"-viewport",{viewStateManager:this._viewStateManager,selectionMode:sap.ui.vk.SelectionMode.Exclusive,contentConnector:this._contentConnector});this._viewport.attachEvent("viewActivated",this._onViewportViewActivated,this);}return this._viewport;};
r.prototype.getNativeViewport=function(){return this._nativeViewport;};
r.prototype.getToolbar=function(){return this._toolbar;};
r.prototype.getSceneTree=function(){return this._sceneTree;};
r.prototype.getRedlineDesign=function(){return this._redlineDesign;};
r.prototype.getOverlay=function(){return this._overlayManager.control;};
r.prototype.setEnableOverlay=function(i){if(i!==this.getProperty("enableOverlay")){this.setProperty("enableOverlay",i);this._overlayManager.changed=true;}return this;};
r.prototype.setEnableSceneTree=function(i){this.setProperty("enableSceneTree",i,true);if(!i){this.setProperty("showSceneTree",false);}this._updateLayout();return this;};
r.prototype.setEnableNotifications=function(i){this.setProperty("enableNotifications",i,true);this._messagePopover.setVisible(false);this._updateLayout();return this;};
r.prototype.setShowSceneTree=function(i){this.setProperty("showSceneTree",i,true);this._updateLayout();return this;};
r.prototype.setEnableStepNavigation=function(i){this.setProperty("enableStepNavigation",i,true);if(!i){this.setProperty("showStepNavigation",false);}this._updateLayout();return this;};
r.prototype.setShowStepNavigation=function(i){this.setProperty("showStepNavigation",i,true);this._updateLayout();return this;};
r.prototype.setEnableToolbar=function(v){this.setProperty("enableToolbar",v,true);this._toolbar.setVisible(v);return this;};
r.prototype.setRecursiveSelection=function(i){this.setProperty("recursiveSelection",i,true);if(this._viewStateManager){this._viewStateManager.setRecursiveSelection(i);}return this;};
r.prototype.setToolbarTitle=function(v){this.setProperty("toolbarTitle",v);this._toolbar.setTitle(v);return this;};
r.prototype.activateFullScreenMode=function(v){var i=function(u){return!!(u.fullScreen||u.webkitIsFullScreen||u.mozFullScreen||u.msFullscreenElement);};if(v){if(!i(document)){if(!this._fullScreenHandler){var t=this;this._fullScreenHandler=function(u){var w=i(document);if(!w){t.removeStyleClass("sapVizKitViewerFullScreen");document.removeEventListener("fullscreenchange",t._fullScreenHandler);document.removeEventListener("mozfullscreenchange",t._fullScreenHandler);document.removeEventListener("webkitfullscreenchange",t._fullScreenHandler);document.removeEventListener("MSFullscreenChange",t._fullScreenHandler);}t.fireFullScreen({isFullScreen:w});};}var l=document.getElementsByTagName("body")[0];if(l.requestFullScreen){document.addEventListener("fullscreenchange",this._fullScreenHandler);l.requestFullScreen();}else if(l.webkitRequestFullScreen){document.addEventListener("webkitfullscreenchange",this._fullScreenHandler);l.webkitRequestFullScreen();}else if(l.mozRequestFullScreen){document.addEventListener("mozfullscreenchange",this._fullScreenHandler);l.mozRequestFullScreen();}else if(l.msRequestFullscreen){document.addEventListener("MSFullscreenChange",this._fullScreenHandler);l.msRequestFullscreen();}}this.addStyleClass("sapVizKitViewerFullScreen");}else{if(i(document)){if(document.cancelFullScreen){document.cancelFullScreen();}else if(document.webkitCancelFullScreen){document.webkitCancelFullScreen();}else if(document.mozCancelFullScreen){document.mozCancelFullScreen();}else if(document.msExitFullscreen){document.msExitFullscreen();}}this.removeStyleClass("sapVizKitViewerFullScreen");}return this;};
function s(v){if(!v){return false;}return v instanceof sap.ui.vk.dvl.Viewport;}
r.prototype.getShowAllHotspots=function(){var v=this.getViewport().getImplementation();return s(v)?v.getShowAllHotspots():this.getProperty("showAllHotspots");};
r.prototype.setShowAllHotspots=function(v){this.setProperty("showAllHotspots",v,true);var i=this.getViewport().getImplementation();if(s(i)){i.setShowAllHotspots(v);}return this;};
r.prototype.getHotspotColorABGR=function(){var v=this.getViewport().getImplementation();return s(v)?v.getHotspotColorABGR():this.getProperty("hotspotColorABGR");};
r.prototype.setHotspotColorABGR=function(v){this.setProperty("hotspotColorABGR",v,true);this.setProperty("hotspotColor",sap.ui.vk.colorToCSSColor(sap.ui.vk.abgrToColor(v)),true);var i=this.getViewport().getImplementation();if(s(i)){i.setHotspotColorABGR(v);}return this;};
r.prototype.getHotspotColor=function(){var v=this.getViewport().getImplementation();return s(v)?v.getHotspotColor():this.getProperty("hotspotColor");};
r.prototype.setHotspotColor=function(v){this.setProperty("hotspotColor",v,true);this.setProperty("hotspotColorABGR",sap.ui.vk.colorToABGR(sap.ui.vk.cssColorToColor(v)),true);var i=this.getViewport().getImplementation();if(s(i)){i.setHotspotColor(v);}return this;};
r.prototype.setRuntimeSettings=function(i){if(this._inApplySettings){this.setProperty("runtimeSettings",i,true);D.setRuntimeSettings(i);}else{p.error(sap.ui.vk.getResourceBundle().getText(M.VIT29.summary),M.VIT29.code,"sap.ui.vk.Viewer");}return this;};
r.prototype.setWebGLContextAttributes=function(i){if(this._inApplySettings){this.setProperty("webGLContextAttributes",i,true);D.setWebGLContextAttributes(i);}else{p.error(sap.ui.vk.getResourceBundle().getText(M.VIT30.summary),M.VIT30.code,"sap.ui.vk.Viewer");}return this;};
r.prototype.invalidate=function(i){if(i instanceof b){this._contentConnector.invalidate(i);return;}C.prototype.invalidate.apply(this,arguments);};
r.prototype._getContentConnector=function(){return this._contentConnector;};
r.prototype.onBeforeRendering=function(){this._showOverlay();};
r.prototype.isTreeBinding=function(i){return i==="contentResources";};
r.prototype.setBusy=function(i){if(i){if(this._busyIndicatorCounter===0){this.setBusyIndicatorDelay(0);C.prototype.setBusy.call(this,true);}this._busyIndicatorCounter+=1;}else{this._busyIndicatorCounter-=1;if(this._busyIndicatorCounter==0){C.prototype.setBusy.call(this,false);}}};
r.prototype._updateLayout=function(){if(this._sceneTree){if(this.getShowSceneTree()&&this.getEnableSceneTree()){this._sceneTree.setVisible(true);if(this._splitter.indexOfContentArea(this._sceneTree)<0){this._splitter.insertContentArea(this._sceneTree,0);}}else{if(this._splitter.indexOfContentArea(this._sceneTree)>=0){this._splitter.removeContentArea(this._sceneTree);}this._sceneTree.setVisible(false);}}if(this._stepNavigation){this._stepNavigation.setVisible(this.getShowStepNavigation()&&this.getEnableStepNavigation()&&this._mainScene instanceof sap.ui.vk.dvl.Scene);}if(this._messagePopover){this._messagePopover.setVisible(this.getEnableNotifications()&&this._messagePopover.getAggregation("_messagePopover").getItems().length>0);}if(this._toolbar){this._toolbar.refresh();}};
r.prototype._instantiateSceneTree=function(){if(!this._sceneTree){this._sceneTree=new j({layoutData:new f({size:"320px",minSize:200}),viewStateManager:this._viewStateManager,contentConnector:this._contentConnector});}return this;};
r.prototype._instantiateStepNavigation=function(){if(!this._stepNavigation){this._stepNavigation=new k(this.getId()+"-stepNavigation",{showThumbnails:this.getShowStepNavigationThumbnails(),contentConnector:this._contentConnector});this._layout.insertItem(this._stepNavigation,3);}return this;};
r.prototype._showViewport=function(){var v=this.getViewport().getImplementation();if(s(v)){v.setHotspotColor(this.getProperty("hotspotColor"));v.setHotspotColorABGR(this.getProperty("hotspotColorABGR"));v.setShowAllHotspots(this.getProperty("showAllHotspots"));}if(this._nativeViewport){this._nativeViewport.setVisible(false);}this._stackedViewport.removeAllContent();this._stackedViewport.addContent(this._viewport);this._viewport.setVisible(true);return this;};
r.prototype._showNativeViewport=function(){if(!this._nativeViewport){this._nativeViewport=new n(this.getId()+"-nativeViewport",{limitZoomOut:true,contentConnector:this._contentConnector});}if(this._viewport){this._viewport.setVisible(false);}this._stackedViewport.removeAllContent();this._stackedViewport.addContent(this._nativeViewport);this._nativeViewport.setVisible(true);return this;};
r.prototype._showOverlay=function(){var O=this._overlayManager;if(O.changed){var i;if(this.getEnableOverlay()){sap.ui.require(["sap/ui/vk/Overlay"],function(l){if(!O.initialized){if(!(i=this.getAggregation("overlay"))){i=new l();}i.setZoomOnResize(false);O.control=i;O.initialized=true;}else{i=O.control;i.reset();}if(this._nativeViewport&&this._nativeViewport.getVisible()){i.setTarget(this._nativeViewport);O.savedLimitZoomOutState=this._nativeViewport.getLimitZoomOut();this._nativeViewport.setLimitZoomOut(true);this._nativeViewport.attachEvent("move",O.onNativeViewportMove,O);}else if(this._viewport&&this._viewport.getVisible()){i.setTarget(this._viewport);O.savedLimitZoomOutState=false;this._viewport.attachEvent("zoom",O.onViewportZoom,O);this._viewport.attachEvent("pan",O.onViewportPan,O);}this._stackedViewport.addContent(i);this._stackedViewport.addDelegate(O.delegate);}.bind(this));}else{this._nativeViewport.detachEvent("move",O.onNativeViewportMove,O);this._stackedViewport.removeDelegate(O.delegate);this._stackedViewport.removeContent(O.control);this._nativeViewport.setLimitZoomOut(O.savedLimitZoomOutState);}O.changed=false;}};
r.prototype._onAfterRenderingOverlay=function(E){var i=this._overlayManager.control.getDomRef();if(i&&(this._nativeViewport||this._viewport)){var v=this._nativeViewport&&this._nativeViewport.getVisible()?this._nativeViewport.getDomRef():this._viewport.getDomRef();if(i.parentNode!==v){i.parentNode.style.display="none";}v.appendChild(i);i.style.width="100%";i.style.height="100%";}};
r.prototype.setDecryptionHandler=function(i){this._contentConnector.setDecryptionHandler(i);return this;};
r.prototype.setAuthorizationHandler=function(i){this._contentConnector.setAuthorizationHandler(i);return this;};
r.prototype._instantiateRedlineDesign=function(i){var v=this.getViewport().getImplementation();if((v&&v.getVisible())||(this.getNativeViewport()&&this.getNativeViewport().getVisible())){var l=v&&v.getVisible()?v:this.getNativeViewport();var t=l.getOutputSize();this._redlineDesign=new R({visible:false,virtualTop:t.top,virtualLeft:t.left,virtualSideLength:t.sideLength,redlineElements:i});this._redlineDesign._setTargetViewport(l);}return this;};
r.prototype.activateRedlineDesign=function(i){var v=this.getViewport().getImplementation();if(v instanceof sap.ui.vk.threejs.Viewport&&v.getCamera().getCameraRef().type==="PerspectiveCamera"){v._viewportGestureHandler._activateRedline();}if(v instanceof sap.ui.vk.dvl.Viewport&&v.getViewInfo().camera&&v.getViewInfo().camera.projectionType==="perspective"){v._activateRedline();}i=i||[];this._instantiateRedlineDesign(i);this.getRedlineDesign().placeAt(this._stackedViewport);this.getRedlineDesign().setVisible(true);var l=function(z){var A=z.getParameter("deltaX"),B=z.getParameter("deltaY");v.queueCommand(function(A,B){v.pan(A,B);v.endGesture();}.bind(this,A,B));};var t=function(z){var A=z.getParameter("originX"),B=z.getParameter("originY"),E=z.getParameter("zoomFactor");v.queueCommand(function(A,B,E){v.beginGesture(A,B);v.zoom(E);v.endGesture();}.bind(this,A,B,E));};var u=function(z){var A=z.getParameter("deltaX"),B=z.getParameter("deltaY");this.getNativeViewport().queueCommand(function(){this.getNativeViewport().pan(A,B);this.getNativeViewport().endGesture();}.bind(this));};var w=function(z){var A=z.getParameter("originX"),B=z.getParameter("originY"),E=z.getParameter("zoomFactor");this.getNativeViewport().queueCommand(function(A,B,E){this.getNativeViewport().beginGesture(A,B);this.getNativeViewport().zoom(E);this.getNativeViewport().endGesture();}.bind(this,A,B,E));};var x=function(z){var A=z.getParameter("deltaX"),B=z.getParameter("deltaY");v.queueCommand(function(A,B){v._viewportGestureHandler._cameraController.beginGesture(A,B);v._viewportGestureHandler._cameraController.pan(A,B);v._viewportGestureHandler._cameraController.endGesture();}.bind(this,A,B));};var y=function(z){var A=z.getParameter("originX"),B=z.getParameter("originY"),E=z.getParameter("zoomFactor");v.queueCommand(function(A,B,E){v._viewportGestureHandler._cameraController.beginGesture(A,B);v._viewportGestureHandler._cameraController.zoom(E);v._viewportGestureHandler._cameraController.endGesture();}.bind(this,A,B,E));};if(this.getNativeViewport()&&this.getNativeViewport().getVisible()){this.getRedlineDesign().attachEvent("pan",u.bind(this));this.getRedlineDesign().attachEvent("zoom",w.bind(this));}else if(v&&s(v)&&v.getVisible()){this.getRedlineDesign().attachEvent("pan",l.bind(this));this.getRedlineDesign().attachEvent("zoom",t.bind(this));}else if(v instanceof sap.ui.vk.threejs.Viewport&&v.getVisible()){this.getRedlineDesign().attachEvent("pan",x.bind(this));this.getRedlineDesign().attachEvent("zoom",y.bind(this));}else{q.sap.log.Error("Error: Viewport not supported");}return this;};
r.prototype.destroyRedlineDesign=function(){if(this.getRedlineDesign()){var v=this.getViewport().getImplementation();if(v instanceof sap.ui.vk.dvl.Viewport){v._deactivateRedline();}else if(v instanceof sap.ui.vk.threejs.Viewport){v._viewportGestureHandler._deactivateRedline();}this.getRedlineDesign().destroy();this._redlineDesign=null;}return this;};
r.prototype._onViewportViewActivated=function(i){this._componentsState.sceneTree.shouldBeEnabled=i.getParameter("type")==="3D";};
r.prototype._handleContentReplaced=function(i){var l=i.getParameter("newContent");if(l&&l instanceof sap.ui.vk.Scene){this._showViewport();if(this.getRedlineDesign()){this.getRedlineDesign().updatePanningRatio();}this._setMainScene(l);}else if(l instanceof HTMLImageElement||l instanceof HTMLObjectElement){this._setMainScene(null);this._showNativeViewport();if(this.getEnableOverlay()){this._overlayManager.changed=true;this._showOverlay();}}else{this._setMainScene(null);if(this._viewport){this._viewport.setVisible(false);}if(this._nativeViewport){this._nativeViewport.setVisible(false);}this._stackedViewport.removeAllContent();}};
r.prototype._handleContentChangesStarted=function(i){this.setBusy(true);if(this._componentsState.progressIndicator.defaultEnable){this._progressIndicator.setPercentValue(0.0);this._progressIndicator.setVisible(true);}};
r.prototype._handleContentChangesFinished=function(i){p.info("Finished");setTimeout(function(){this._progressIndicator.setVisible(false);this._progressIndicator.setDisplayValue("");this._progressIndicator.setPercentValue(0);}.bind(this),0);this.setBusy(false);var l=i.getParameter("content");if(l){this.fireSceneLoadingSucceeded({scene:l});}var t=i.getParameter("failureReason");if(t){this.fireSceneLoadingFailed({reason:t});this._showNativeViewport();var u=sap.ui.vk.getResourceBundle().getText("VIEWER_UNKNOWN_CONTENT_RESOURCE_TYPE_CAUSE");if(t.errorMessage===u){this._nativeViewport.loadFailed();}else{var v=sap.ui.vk.getResourceBundle().getText("VIEWPORT_MESSAGEERRORLOADINGFILE");this._nativeViewport.loadFailed(v);}(Array.isArray(t)?t:[t]).forEach(function(w){p.error(sap.ui.vk.getResourceBundle().getText(M.VIT13.summary),w.errorMessage,"sap.ui.vk.Viewer");});}this.fireContentResourceChangesProcessed();};
r.prototype._handleContentChangesProgress=function(t){function u(z,v){for(var i=0,l=z.length;i<l;i++){var A=z[i];var B=A.getSource();if((B===v)||(B instanceof File&&B.name===v)){return A;}A=u(A.getContentResources(),v);if(A){return A;}}return null;}if(this._progressIndicator.getVisible()){var v=t.getParameter("source"),w=t.getParameter("percentage");var x=u(this.getContentResources(),v);if(x&&x.getName()!==undefined){v=x.getName();}else{var y=v.match(/\..{3,4}$/);v=y&&y[0]?v.split(/\\|\//).pop():"";}this._progressIndicator.setPercentValue(w);this._progressIndicator.setDisplayValue(v+" "+sap.ui.vk.getResourceBundle().getText("PROGRESS_INDICATOR_DOWNLOADING")+" "+(w?Math.floor(w)+"%":""));}};
r.prototype._handleContentDestroying=function(i){this.fireSceneDestroying({scene:i.getParameter("content").scene,preventGarbageCollection:i.getParameter("preventGarbageCollection")});};
return r;});
sap.ui.predefine('sap/ui/vk/library',["jquery.sap.global","./TransformationMatrix","./DvlException","./Core"],function(q,T,D,C){"use strict";var l=q.sap.log;sap.ui.getCore().initLibrary({name:"sap.ui.vk",dependencies:["sap.ui.core"],types:["sap.ui.vk.CameraFOVBindingType","sap.ui.vk.CameraProjectionType","sap.ui.vk.ContentResourceSourceCategory","sap.ui.vk.dvl.GraphicsCoreApi","sap.ui.vk.SelectionMode","sap.ui.vk.TransformationMatrix","sap.ui.vk.VisibilityMode","sap.ui.vk.ZoomTo"],interfaces:["sap.ui.vk.DecryptionHandler","sap.ui.vk.AuthorizationHandler"],controls:["sap.ui.vk.ContainerBase","sap.ui.vk.ContainerContent","sap.ui.vk.FlexibleControl","sap.ui.vk.LegendItem","sap.ui.vk.ListPanel","sap.ui.vk.ListPanelStack","sap.ui.vk.MapContainer","sap.ui.vk.NativeViewport","sap.ui.vk.Notifications","sap.ui.vk.Overlay","sap.ui.vk.RedlineDesign","sap.ui.vk.RedlineSurface","sap.ui.vk.SceneTree","sap.ui.vk.StepNavigation","sap.ui.vk.Toolbar","sap.ui.vk.Viewer","sap.ui.vk.Viewport","sap.ui.vk.ViewportBase","sap.ui.vk.dvl.Viewport","sap.ui.vk.threejs.Viewport"],elements:["sap.ui.vk.ContentConnector","sap.ui.vk.OverlayArea","sap.ui.vk.RedlineElement","sap.ui.vk.RedlineElementEllipse","sap.ui.vk.RedlineElementFreehand","sap.ui.vk.RedlineElementLine","sap.ui.vk.RedlineElementText","sap.ui.vk.RedlineElementRectangle","sap.ui.vk.ViewStateManager","sap.ui.vk.ViewStateManagerBase","sap.ui.vk.dvl.ViewStateManager","sap.ui.vk.threejs.ViewStateManager"],noLibraryCSS:false,version:"1.61.0"});q.sap.registerModuleShims({"sap/ui/vk/threejs/thirdparty/three":{exports:"THREE",amd:true},"sap/ui/vk/ve/thirdparty/html2canvas":{exports:"html2canvas",amd:true},"sap/ui/vk/threejs/thirdparty/totara":{exports:"Totara",amd:true}});var a=function(b,s){var m="new extend getMetadata";if(s){m+=" "+s;}sap.ui.lazyRequire("sap.ui.vk."+b,m);};a("Camera");a("ContentConnector","registerSourceType");a("ContentResource");a("ContentManager");a("DownloadManager");a("ImageContentManager");a("Loco");a("LayerProxy");a("NodeHierarchy");a("NodeProxy");a("Scene");a("View");a("ViewportHandler");a("dvl.GraphicsCore");a("dvl.BaseNodeProxy");a("dvl.ContentManager","getRuntimeSettings setRuntimeSettings getWebGLContextAttributes setWebGLContextAttributes getDecryptionHandler setDecryptionHandler");a("dvl.LayerProxy");a("dvl.NodeHierarchy");a("dvl.NodeProxy");a("dvl.Scene");a("threejs.BaseNodeProxy");a("threejs.ContentManager","registerLoader");a("threejs.LayerProxy");a("threejs.NodeHierarchy");a("threejs.NodeProxy");a("threejs.Billboard");a("threejs.Callout");a("threejs.DetailView");a("threejs.OrthographicCamera");a("threejs.PerspectiveCamera");a("threejs.Scene");sap.ui.vk.dvl.GraphicsCoreApi={LegacyDvl:"LegacyDvl"};sap.ui.vk.ContentResourceSourceCategory={"3D":"3D","2D":"2D"};sap.ui.vk.CameraProjectionType={Perspective:"perspective",Orthographic:"orthographic"};sap.ui.vk.CameraFOVBindingType={Minimum:"minimum",Maximum:"maximum",Horizontal:"horizontal",Vertical:"vertical"};sap.ui.vk.VisibilityMode={Complete:"complete",Differences:"differences"};sap.ui.vk.ZoomTo={All:"all",Visible:"visible",Selected:"selected",Node:"node",NodeSetIsolation:"node_setisolation",Restore:"restore",RestoreRemoveIsolation:"restore_removeisolation",ViewLeft:"view_left",ViewRight:"view_right",ViewTop:"view_top",ViewBottom:"view_bottom",ViewBack:"view_back",ViewFront:"view_front"};sap.ui.vk.SelectionMode={None:"none",Exclusive:"exclusive",Sticky:"sticky"};sap.ui.vk.RenderMode={Default:"default",XRay:"xray"};sap.ui.vk.BillboardCoordinateSpace={Viewport:"Viewport",Screen:"Screen",World:"World"};sap.ui.vk.BillboardTextEncoding={PlainText:"PlainText",HtmlText:"HtmlText"};sap.ui.vk.BillboardStyle={RectangularShape:"RectangularShape",CircularShape:"CircularShape",None:"None",TextGlow:"TextGlow"};sap.ui.vk.BillboardBorderLineStyle={None:"None",Solid:"Solid",Dash:"Dash",Dot:"Dot",DashDot:"DashDot",DashDotDot:"DashDotDot"};sap.ui.vk.BillboardHorizontalAlignment={Left:"left",Center:"center",Right:"right"};sap.ui.vk.LeaderLineMarkStyle={None:"None",Point:"Point",Arrow:"Arrow"};sap.ui.vk.DetailViewType={DetailView:"DetailView",Cutaway:"Cutaway"};sap.ui.vk.DetailViewShape={Box:"Box",Circle:"Circle",CircleLine:"CircleLine",CirclePointer:"CirclePointer",CircleArrow:"CircleArrow",CircleBubbles:"CircleBubbles",BoxLine:"BoxLine",BoxNoOutline:"BoxNoOutline",SolidPointer:"SolidPointer",SolidArrow:"SolidArrow"};sap.ui.vk.MapContainerButtonType={Click:"Click",Toggle:"Toggle"};sap.ui.vk.ContentResourceSourceTypeToCategoryMap={"vds":sap.ui.vk.ContentResourceSourceCategory["3D"],"vdsl":sap.ui.vk.ContentResourceSourceCategory["3D"],"cgm":sap.ui.vk.ContentResourceSourceCategory["3D"],"png":sap.ui.vk.ContentResourceSourceCategory["2D"],"jpg":sap.ui.vk.ContentResourceSourceCategory["2D"],"jpeg":sap.ui.vk.ContentResourceSourceCategory["2D"],"gif":sap.ui.vk.ContentResourceSourceCategory["2D"],"bmp":sap.ui.vk.ContentResourceSourceCategory["2D"],"tiff":sap.ui.vk.ContentResourceSourceCategory["2D"],"tif":sap.ui.vk.ContentResourceSourceCategory["2D"],"svg":sap.ui.vk.ContentResourceSourceCategory["2D"]};var d="sap.ve.dvl";
sap.ui.vk.dvl.checkResult=function(r){if(r<0){var m=sap.ve.dvl.DVLRESULT.getDescription?sap.ve.dvl.DVLRESULT.getDescription(r):"";l.error(m,JSON.stringify({errorCode:r}),d);throw new D(r,m);}return r;};
sap.ui.vk.dvl.getPointer=function(p){if(typeof p==="number"){var r=p;var m=sap.ve.dvl.DVLRESULT.getDescription?sap.ve.dvl.DVLRESULT.getDescription(r):"";l.error(m,JSON.stringify({errorCode:r}),d);throw new D(r,m);}return p;};
sap.ui.vk.dvl.getJSONObject=function(o){if(typeof o==="number"){var r=o;var m=sap.ve.dvl.DVLRESULT.getDescription?sap.ve.dvl.DVLRESULT.getDescription(r):"";l.error(m,JSON.stringify({errorCode:r}),d);throw new D(r,m);}return o;};
sap.ui.vk.getResourceBundle=function(){var r=sap.ui.getCore().getLibraryResourceBundle("sap.ui.vk.i18n");sap.ui.vk.getResourceBundle=function(){return r;};return r;};
sap.ui.vk.utf8ArrayBufferToString=function(b){return decodeURIComponent(escape(String.fromCharCode.apply(null,new Uint8Array(b))));};
sap.ui.vk.Redline={ElementType:{Line:"line",Rectangle:"rectangle",Ellipse:"ellipse",Freehand:"freehand",Text:"text"},svgNamespace:"http://www.w3.org/2000/svg"};sap.ui.vk.cssColorToColor=(function(){var i=false;var b=document.createElement("div");b.id="sap.ui.vk.colorConverter";b.style.setProperty("display","none","important");return function(c){if(!i){if(document.body){document.body.appendChild(b);i=true;}else{return{red:0,green:0,blue:0,alpha:1};}}b.style.setProperty("color","rgba(0, 0, 0, 0)","important");b.style.setProperty("color",c,"important");var e=window.getComputedStyle(b).color;if(e==="transparent"){return{red:0,green:0,blue:0,alpha:0};}else{var f=e.split("(")[1].split(")")[0].split(",");return{red:parseInt(f[0],10),green:parseInt(f[1],10),blue:parseInt(f[2],10),alpha:f.length===4?parseFloat(f[3]):1};}};})();
sap.ui.vk.colorToCSSColor=function(c){return"rgba("+c.red+","+c.green+","+c.blue+","+c.alpha+")";};
sap.ui.vk.abgrToColor=function(b){return{red:b&0xff,green:b>>>8&0xff,blue:b>>>16&0xff,alpha:(b>>>24&0xff)/255};};
sap.ui.vk.colorToABGR=function(c){return(c.alpha*255<<24|c.blue<<16|c.green<<8|c.red)>>>0;};
return sap.ui.vk;});
sap.ui.predefine('sap/ui/vk/tools/library',["jquery.sap.global"],function(q){"use strict";sap.ui.getCore().initLibrary({name:"sap.ui.vk.tools",dependencies:["sap.ui.core"],types:["sap.ui.vk.tools.HitTestIdMode","sap.ui.vk.tools.HitTestClickType","sap.ui.vk.tools.CoordinateSystem","sap.ui.vk.tools.PredefinedView"],interfaces:[],controls:["sap.ui.vk.tools.MoveTool","sap.ui.vk.tools.RotateTool","sap.ui.vk.tools.ScaleTool","sap.ui.vk.tools.TooltipTool","sap.ui.vk.tools.SceneOrientationTool","sap.ui.vk.tools.RotateOrbitTool","sap.ui.vk.tools.RotateOrbitToolGizmo","sap.ui.vk.tools.RotateTurntableTool","sap.ui.vk.tools.RotateTurntableToolGizmo","sap.ui.vk.tools.HitTestTool","sap.ui.vk.tools.RectSelectTool","sap.ui.vk.tools.Tool"],elements:[],noLibraryCSS:true,version:"1.61.0"});sap.ui.vk.tools.HitTestIdMode={ThreeJS:"ThreeJS",VEsID:"VEsID",Callback:"Callback"};sap.ui.vk.tools.CoordinateSystem={Local:"Local",World:"World",Screen:"Screen"};sap.ui.vk.tools.PredefinedView={Initial:"Initial",Front:"Front",Back:"Back",Left:"Left",Right:"Right",Top:"Top",Bottom:"Bottom"};sap.ui.vk.tools.HitTestClickType={Single:"Single",Double:"Double",Context:"Context"};return sap.ui.vk.tools;});
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.predefine('sap/ui/vk/BaseNodeProxy',["jquery.sap.global","sap/ui/base/Object"],function(q,B){"use strict";
var a=B.extend("sap.ui.vk.BaseNodeProxy",{metadata:{"abstract":true}});
return a;});
sap.ui.predefine('sap/ui/vk/Camera',["jquery.sap.global","sap/ui/base/ManagedObject"],function(q,M){"use strict";
var C=M.extend("sap.ui.vk.Camera",{metadata:{properties:{"position":{type:"float[]"},"targetDirection":{type:"float[]"},"upDirection":{type:"float[]"},"nearClipPlane":{type:"float"},"farClipPlane":{type:"float"}}}});
C.prototype.getCameraRef=function(){return null;};
return C;});
sap.ui.predefine('sap/ui/vk/ContentConnector',["jquery.sap.global","sap/ui/base/ManagedObjectObserver","sap/ui/core/Element","./Messages","./Core"],function(q,M,E,a,V){"use strict";var l=q.sap.log;
var C=E.extend("sap.ui.vk.ContentConnector",{metadata:{library:"sap.ui.vk",aggregations:{contentResources:{type:"sap.ui.vk.ContentResource",bindable:"bindable"},viewStateManagers:{type:"sap.ui.vk.ViewStateManager"},contentManagers:{type:"sap.ui.vk.ContentManager",visibility:"hidden"}},defaultAggregation:"contentResources",events:{contentChangesStarted:{parameters:{}},contentChangesFinished:{parameters:{content:{type:"any"},failureReason:{type:"any"}}},contentChangesProgress:{parameters:{phase:{type:"string"},percentage:{type:"float"},source:{type:"any"}}},contentReplaced:{parameters:{newContent:{type:"any"},oldContent:{type:"any"}}},contentDestroying:{parameters:{content:{type:"any"},preventGarbageCollection:{type:"function"}}}}}});
sap.ui.vk.getCore().registerClass(C);var b=C.getMetadata().getParent().getClass().prototype;
C.prototype.isTreeBinding=function(n){return n==="contentResources";};
C.prototype.init=function(){if(b.init){b.init.call(this);}this._inLoading=false;this._delayContentResourcesUpdate=false;this._scheduleContentResourcesUpdateTimerId=null;this._content=null;this._contentManager=null;this._decryptionHandler=null;this._authorizationHandler=null;this._selfObserver=new M(this._observeChanges.bind(this));this._selfObserver.observe(this,{aggregations:["contentResources","viewStateManagers"]});};
C.prototype.exit=function(){this._selfObserver.disconnect();this._selfObserver=null;if(this._scheduleContentResourcesUpdateTimerId){q.sap.clearDelayedCall(this._scheduleContentResourcesUpdateTimerId);this._scheduleContentResourcesUpdateTimerId=null;}this._delayContentResourcesUpdate=false;this._setContent(null,null);if(b.exit){b.exit.call(this);}};
C.prototype._observeChanges=function(d){if(d.name==="contentResources"){this._scheduleContentResourcesUpdate();}else if(d.name==="viewStateManagers"){if(d.mutation==="insert"){d.child.setContentConnector(this);}else if(d.mutation==="remove"){d.child.setContentConnector(null);}}};
C.prototype.invalidate=function(o){if(sap.ui.vk.ContentResource&&o instanceof sap.ui.vk.ContentResource){this._scheduleContentResourcesUpdate();return;}b.invalidate.apply(this,arguments);};
C.prototype._scheduleContentResourcesUpdate=function(){if(this._inLoading){this._delayContentResourcesUpdate=true;return this;}if(!this._scheduleContentResourcesUpdateTimerId){this._scheduleContentResourcesUpdateTimerId=q.sap.delayedCall(0,this,function(){this._scheduleContentResourcesUpdateTimerId=null;var d=this.getContentResources();if(d.length>0){this._collectContentResourceSourceTypeInformation(d).then(function(i){if(i.dimensions.length>1){q.sap.delayedCall(0,this,function(){this.fireContentChangesStarted();this._setContent(null,null);this.fireContentChangesFinished({content:null,failureReason:{errorMessage:sap.ui.vk.getResourceBundle().getText(a.VIT17.cause)}});l.error(sap.ui.vk.getResourceBundle().getText(a.VIT17.summary),a.VIT17.code,"sap.ui.vk.ContentConnector");});}else if(i.contentManagerClassNames.length>1){q.sap.delayedCall(0,this,function(){this.fireContentChangesStarted();this._setContent(null,null);this.fireContentChangesFinished({content:null,failureReason:{errorMessage:sap.ui.vk.getResourceBundle().getText(a.VIT35.cause)}});l.error(sap.ui.vk.getResourceBundle().getText(a.VIT35.summary),a.VIT35.code,"sap.ui.vk.ContentConnector");});}else if(i.contentManagerClassNames.length===0){q.sap.delayedCall(0,this,function(){this.fireContentChangesStarted();this._setContent(null,null);this.fireContentChangesFinished({content:null,failureReason:{errorMessage:sap.ui.vk.getResourceBundle().getText(a.VIT36.cause)}});l.error(sap.ui.vk.getResourceBundle().getText(a.VIT36.summary),a.VIT36.code,"sap.ui.vk.ContentConnector");});}else if(i.contentManagerClassNames.length===1){var e=this._getContentManagerByClassName(i.contentManagerClassNames[0]);if(e!==this._contentManager){this._setContent(null,null);}e.loadContent(this._content,d);}}.bind(this));}else{q.sap.delayedCall(0,this,function(){this.fireContentChangesStarted();this._setContent(null,null);this.fireContentChangesFinished({content:null});});}});}return this;};
C.prototype._handleContentChangesStarted=function(e){this._inLoading=true;this.fireContentChangesStarted();};
C.prototype._handleContentChangesFinished=function(e){var d=e.getParameter("content");this._setContent(d,e.getSource());this.fireContentChangesFinished({content:d,failureReason:e.getParameter("failureReason")});this._inLoading=false;if(this._delayContentResourcesUpdate){this._delayContentResourcesUpdate=false;this._scheduleContentResourcesUpdate();}};
C.prototype._handleContentChangesProgress=function(e){this.fireContentChangesProgress({phase:e.getParameter("phase"),source:e.getParameter("source"),percentage:e.getParameter("percentage")});};
C.prototype._getContentManagerByClassName=function(d){var e,g=this.getAggregation("contentManagers",[]);for(var i=0,h=g.length;i<h;++i){e=g[i];if(e.getMetadata().getName()===d){return e;}}q.sap.require(d);e=new(q.sap.getObject(d));this.addAggregation("contentManagers",e);e.attachContentChangesStarted(this._handleContentChangesStarted,this);e.attachContentChangesFinished(this._handleContentChangesFinished,this);e.attachContentChangesProgress(this._handleContentChangesProgress,this);this._assignDecryptionHandler([e]);this._assignAuthorizationHandler([e]);return e;};
C.prototype.getContent=function(){return this._content;};
C.prototype.getContentManager=function(){return this._contentManager;};
C.prototype._assignDecryptionHandler=function(d){for(var i=0;i<d.length;i++){d[i].setDecryptionHandler(this._decryptionHandler);}};
C.prototype._assignAuthorizationHandler=function(d){for(var i=0;i<d.length;i++){d[i].setAuthorizationHandler(this._authorizationHandler);}};
C.prototype.setDecryptionHandler=function(h){this._decryptionHandler=h;this._assignDecryptionHandler(this.getAggregation("contentManagers",[]));return this;};
C.prototype.setAuthorizationHandler=function(h){this._authorizationHandler=h;this._assignAuthorizationHandler(this.getAggregation("contentManagers",[]));return this;};
C.prototype._setContent=function(n,d){var o=this._content,e=this._contentManager;if(o!==n){this._content=n;this._contentManager=d;this.fireContentReplaced({oldContent:o,newContent:n});if(o){var p=false;this.fireContentDestroying({content:o,preventGarbageCollection:function(v){p=v;}});e.destroyContent(o);if(!p){e.collectGarbage();}}}return this;};
var r=[{pattern:/(^threejs[:.])|(^(threejs|stream)$)/,dimension:3,contentManagerClassName:"sap.ui.vk.threejs.ContentManager"},{pattern:/^vdsl?$/,dimension:3,contentManagerClassName:"sap.ui.vk.dvl.ContentManager"},{pattern:/^(png|jpg|jpeg|gif|bmp|tiff?|svg)$/,dimension:2,contentManagerClassName:"sap.ui.vk.ImageContentManager"},{pattern:"cgm",dimension:2,contentManagerClassName:"sap.ui.vk.dvl.ContentManager"}];var c=function(d){return new Promise(function(e,g){var h=r.slice();var t=function(i){if(i>=h.length){g();return;}var j=h[i];(function(){var s=d.getSourceType();if(s){s=s.toLowerCase();}if(typeof j==="function"){return j(d);}else if(typeof j.pattern==="string"){var p=j.pattern.toLowerCase();if(p===s){return Promise.resolve(j);}}else if(j.pattern instanceof RegExp){if(j.pattern.test(s)){return Promise.resolve(j);}}return Promise.reject();})().then(function(v){e({dimension:v.dimension,contentManagerClassName:v.contentManagerClassName,settings:v.settings});},function(){t(i+1);});};t(0);});};
C.addContentManagerResolver=function(d){if(typeof d==="function"){r.unshift(d);}else{r.unshift({pattern:d.pattern,dimension:d.dimension,contentManagerClassName:d.contentManagerClassName,settings:d.settings});}return this;};
C.removeAllContentManagerResolvers=function(){r=[];return this;};
C.removeContentManagerResolver=function(d){var e=typeof d==="function",g=typeof d==="string",h=d instanceof RegExp;for(var i=0,j=r.length;i<j;++i){if(e||g){if(r[i]===d){r.splice(i,1);return true;}}else if(h){if(typeof r[i]==="object"&&r[i].pattern instanceof RegExp&&r[i].pattern.source===d.source){r.splice(i,1);return true;}}}return false;};
C.prototype._collectContentResourceSourceTypeInformation=function(d){var n=false,u=false,e={},g={},h=[];d.forEach(function flatten(i){h.push(i);i.getContentResources().forEach(flatten);});return Promise.all(h.map(function(i){return c(i).then(function(j){e[j.dimension]=true;g[j.contentManagerClassName]=true;return j;},function(){if(i.getSourceType()){u=true;}else{n=true;}return false;});})).then(function(j){for(var i=0,k=h.length;i<k;++i){if(j[i]){h[i]._contentManagerResolver=j[i];}}return{noSourceTypes:n,unknownSourceTypes:u,dimensions:Object.getOwnPropertyNames(e).sort(),contentManagerClassNames:Object.getOwnPropertyNames(g)};});};
var f=C.getMetadata().getName();var m={init:function(){this._contentConnector=null;sap.ui.vk.getCore().attachEvent(f+"-created",this._handleContentConnectorCreated,this).attachEvent(f+"-destroying",this._handleContentConnectorDestroying,this);},exit:function(){this.setContentConnector(null);sap.ui.vk.getCore().detachEvent(f+"-destroying",this._handleContentConnectorDestroying,this).detachEvent(f+"-created",this._handleContentConnectorCreated,this);},setContentConnector:function(d){this.setAssociation("contentConnector",d,true);this._updateContentConnector();return this;},_updateContentConnector:function(){var n=this.getContentConnector(),d=n&&sap.ui.getCore().byId(n)||null;if(this._contentConnector!==d){this._clearContentConnector();if(d){if(this._handleContentChangesStarted){d.attachContentChangesStarted(this._handleContentChangesStarted,this);}if(this._handleContentChangesFinished){d.attachContentChangesFinished(this._handleContentChangesFinished,this);}if(this._handleContentChangesProgress){d.attachContentChangesProgress(this._handleContentChangesProgress,this);}if(this._handleContentReplaced){d.attachContentReplaced(this._handleContentReplaced,this);}if(this._handleContentDestroying){d.attachContentDestroying(this._handleContentDestroying,this);}this._contentConnector=d;if(this._onAfterUpdateContentConnector){this._onAfterUpdateContentConnector();}}}return this;},_clearContentConnector:function(){if(this._contentConnector){if(this._onBeforeClearContentConnector){this._onBeforeClearContentConnector();}if(this._handleContentDestroying){this._contentConnector.detachContentDestroying(this._handleContentDestroying,this);}if(this._handleContentReplaced){this._contentConnector.detachContentReplaced(this._handleContentReplaced,this);}if(this._handleContentChangesProgress){this._contentConnector.detachContentChangesProgress(this._handleContentChangesProgress,this);}if(this._handleContentChangesFinished){this._contentConnector.detachContentChangesFinished(this._handleContentChangesFinished,this);}if(this._handleContentChangesStarted){this._contentConnector.detachContentChangesStarted(this._handleContentChangesStarted,this);}this._contentConnector=null;}return this;},_handleContentConnectorCreated:function(e){if(this.getContentConnector()===e.getParameter("object").getId()){this._updateContentConnector();}},_handleContentConnectorDestroying:function(e){if(this.getContentConnector()===e.getParameter("object").getId()){this._clearContentConnector();}}};
C.injectMethodsIntoClass=function(d){var p=d.prototype,i=p.init,e=p.exit;p.init=function(){if(i){i.call(this);}m.init.call(this);};p.exit=function(){m.exit.call(this);if(e){e.call(this);}};p.setContentConnector=m.setContentConnector;p._updateContentConnector=m._updateContentConnector;p._clearContentConnector=m._clearContentConnector;p._handleContentConnectorCreated=m._handleContentConnectorCreated;p._handleContentConnectorDestroying=m._handleContentConnectorDestroying;};
return C;});
sap.ui.predefine('sap/ui/vk/ContentManager',["jquery.sap.global","sap/ui/base/ManagedObject"],function(q,M){"use strict";
var C=M.extend("sap.ui.vk.ContentManager",{metadata:{"abstract":true,library:"sap.ui.vk",events:{contentChangesStarted:{parameters:{}},contentChangesFinished:{parameters:{content:{type:"any"},failureReason:{type:"object"}}},contentChangesProgress:{parameters:{phase:{type:"string"},percentage:{type:"float"},source:{type:"any"}}}}}});
var b=C.getMetadata().getParent().getClass().prototype;
C.prototype.init=function(){if(b.init){b.init.call(this);}this._decryptionHandler=null;this._authorizationHandler=null;};
C.prototype.destroyContent=function(c){return this;};
C.prototype.collectGarbage=function(){return this;};
C.prototype.createOrthographicCamera=function(){return null;};
C.prototype.createPerspectiveCamera=function(){return null;};
C.prototype.destroyCamera=function(c){return this;};
C.prototype.setDecryptionHandler=function(h){this._decryptionHandler=h;return this;};
C.prototype.setAuthorizationHandler=function(h){this._authorizationHandler=h;return this;};
return C;});
sap.ui.predefine('sap/ui/vk/ContentResource',["jquery.sap.global","./library","sap/ui/base/ManagedObject"],function(q,l,M){"use strict";
var C=M.extend("sap.ui.vk.ContentResource",{
metadata:{properties:{source:"any",sourceType:"string",sourceId:"string",localMatrix:"sap.ui.vk.TransformationMatrix",name:"string",password:"string",useSecureConnection:{type:"boolean",defaultValue:true},veid:"string",includeHidden:"boolean",pushPMI:"boolean",metadataFilter:"string",activateView:"string",enableLogger:"boolean"},aggregations:{contentResources:"sap.ui.vk.ContentResource"}},
constructor:function(i,s,S){M.apply(this,arguments);}
});
C.prototype.isTreeBinding=function(n){return n==="contentResources";};
C.prototype.destroy=function(){M.prototype.destroy.call(this);};
C.prototype.setLocalMatrix=function(v){var n=this.getNodeProxy();if(n){n.setLocalMatrix(v);}this.setProperty("localMatrix",v,true);return this;};
C.prototype.getSourceProperties=function(){return this._shadowContentResource&&this._shadowContentResource.sourceProperties||{};};
C.prototype.getNodeProxy=function(){return this._shadowContentResource&&this._shadowContentResource.nodeProxy||null;};
C.collectCategories=function(r){var c=[];var m={};function g(a){var s=(a.getSourceType()||"").toLowerCase();if(s){var b=sap.ui.vk.ContentResourceSourceTypeToCategoryMap[s]||"unknown";if(!m.hasOwnProperty(b)){m[b]=true;c.push(b);}}a.getContentResources().forEach(g);}r.forEach(g);return c;};
return C;});
sap.ui.predefine('sap/ui/vk/Core',["jquery.sap.global","sap/ui/base/ManagedObject"],function(q,M){"use strict";
var C=M.extend("sap.ui.vk.Core",{
metadata:{publicMethods:["registerClass"]},
constructor:function(){if(sap.ui.vk.getCore&&sap.ui.vk.getCore()){return sap.ui.vk.getCore();}M.call(this);sap.ui.vk.getCore=q.sap.getter(this);this._classes=[];}
});
C.prototype.registerClass=function(c){if(this._classes.indexOf(c)>=0){return this;}var t=this,f=c.getMetadata().getName(),e=f+"-created",a=f+"-destroying",b=c.prototype.register,d=c.prototype.deregister;c.prototype.register=function(){if(b){b.call(this);}t.fireEvent(e,{object:this});};c.prototype.deregister=function(){t.fireEvent(a,{object:this});if(d){d.call(this);}};this._classes.push(c);return this;};
return new C();});
sap.ui.predefine('sap/ui/vk/DownloadManager',["jquery.sap.global","./library","sap/ui/base/EventProvider","./Messages"],function(q,l,E,M){"use strict";
var D=E.extend("sap.ui.vk.DownloadManager",{
metadata:{publicMethods:["start","attachItemSucceeded","detachItemSucceeded","attachItemFailed","detachItemFailed","attachAllItemsCompleted","detachAllItemsCompleted"],events:{itemSucceeded:{parameters:{source:{type:"any"},response:{type:"object"}}},itemProgress:{parameters:{source:{type:"any"},loaded:{type:"int"},total:{type:"int"}}},itemFailed:{parameters:{source:{type:"any"},status:{type:"any"},statusText:{type:"string"}}},allItemsCompleted:{}}},
constructor:function(s,m){E.apply(this);this._maxParallelTasks=m||5;this._sourcesToProcess=s.slice();this._sourcesBeingProcessed=[];}
});
D.prototype.start=function(){while(this._pickAndDispatchTask()){}return this;};
D.prototype.queue=function(s){this._sourcesToProcess.push(s);this._pickAndDispatchTask();return this;};
D.prototype._pickAndDispatchTask=function(){if(this._sourcesToProcess.length>0&&this._sourcesBeingProcessed.length<this._maxParallelTasks){var s=this._sourcesToProcess.shift();this._sourcesBeingProcessed.push(s);this._runTask(s);return true;}return false;};
D.prototype._taskFinished=function(s){var i=this._sourcesBeingProcessed.indexOf(s);if(i>=0){this._sourcesBeingProcessed.splice(i,1);}return this;};
D.prototype._queueIsEmpty=function(){return this._sourcesToProcess.length===0&&this._sourcesBeingProcessed.length===0;};
D.prototype._runTask=function(s){var t=this;if(typeof s==="string"){var x=new(typeof sinon==="object"&&sinon.xhr&&sinon.xhr.XMLHttpRequest||XMLHttpRequest);x.onerror=function(e){t._taskFinished(s);t._pickAndDispatchTask();t.fireItemFailed({source:s,status:x.status,statusText:x.statusText});if(t._queueIsEmpty()){t._asyncFireAllItemsCompleted();}};x.onload=function(e){t._taskFinished(s);t._pickAndDispatchTask();if(x.status===200||x.status===0){t.fireItemSucceeded({source:s,response:x.response});}else{t.fireItemFailed({source:s,status:x.status,statusText:x.statusText});}if(t._queueIsEmpty()){t._asyncFireAllItemsCompleted();}};x.onprogress=function(e){t.fireItemProgress({source:s,loaded:e.loaded,total:e.total});};x.open("GET",s,true);x.responseType="arraybuffer";x.send(null);}else if(s instanceof File){var f=new FileReader();f.onload=function(e){t._taskFinished(s);t._pickAndDispatchTask();t.fireItemSucceeded({source:s,response:f.result});if(t._queueIsEmpty()){t._asyncFireAllItemsCompleted();}};f.onerror=function(e){t._taskFinished(s);t._pickAndDispatchTask();t.fireItemFailed({source:s,status:f.error.name,statusText:f.error.message});if(t._queueIsEmpty()){t._asyncFireAllItemsCompleted();}};f.onprogress=function(e){t.fireItemProgress({source:s.name,loaded:e.loaded,total:e.total});};f.readAsArrayBuffer(s);}else{q.sap.log.error(sap.ui.vk.getResourceBundle().getText(M.VIT5.summary),M.VIT5.code,"sap.ui.vk.DownloadManager");}return this;};
D.prototype._asyncFireAllItemsCompleted=function(){q.sap.delayedCall(0,this,this.fireAllItemsCompleted);};
D.prototype.attachItemSucceeded=function(d,f,a){return this.attachEvent("itemSucceeded",d,f,a);};
D.prototype.detachItemSucceeded=function(f,a){return this.detachEvent("itemSucceeded",f,a);};
D.prototype.fireItemSucceeded=function(p,a,e){return this.fireEvent("itemSucceeded",p,a,e);};
D.prototype.attachItemFailed=function(d,f,a){return this.attachEvent("itemFailed",d,f,a);};
D.prototype.detachItemFailed=function(f,a){return this.detachEvent("itemFailed",f,a);};
D.prototype.fireItemFailed=function(p,a,e){return this.fireEvent("itemFailed",p,a,e);};
D.prototype.attachAllItemsCompleted=function(d,f,a){return this.attachEvent("allItemsCompleted",d,f,a);};
D.prototype.detachAllItemsCompleted=function(f,a){return this.detachEvent("allItemsCompleted",f,a);};
D.prototype.fireAllItemsCompleted=function(p,a,e){return this.fireEvent("allItemsCompleted",p,a,e);};
D.prototype.attachItemProgress=function(d,f,a){return this.attachEvent("itemProgress",d,f,a);};
D.prototype.detachItemProgress=function(f,a){return this.detachEvent("itemProgress",f,a);};
D.prototype.fireItemProgress=function(p,a,e){return this.fireEvent("itemProgress",p,a,e);};
return D;});
sap.ui.predefine('sap/ui/vk/DvlException',["sap/ui/base/Exception"],function(E){"use strict";var D=function(c,m){this.name="DvlException";this.code=c;this.message=m;};D.prototype=Object.create(E.prototype);return D;});
sap.ui.predefine('sap/ui/vk/FlexibleControl',["jquery.sap.global","sap/ui/core/Control","sap/ui/core/EnabledPropagator","./FlexibleControlRenderer"],function(q,C,E,F){"use strict";
var a=C.extend("sap.ui.vk.FlexibleControl",{metadata:{library:"sap.ui.vk",properties:{width:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:null},height:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:null},layout:{type:"string",group:"Behavior",defaultValue:"Stacked"},enabled:{type:"boolean",group:"Behavior",defaultValue:true}},defaultAggregation:"content",aggregations:{content:{type:"sap.ui.core.Control",multiple:true,singularName:"content"}},designTime:true}});
E.call(a.prototype);return a;},true);
sap.ui.predefine('sap/ui/vk/FlexibleControlLayoutData',["jquery.sap.global","sap/ui/core/LayoutData","./library"],function(q,L,l){"use strict";
var F=L.extend("sap.ui.vk.FlexibleControlLayoutData",{metadata:{library:"sap.ui.vk",properties:{size:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:"auto"},minSize:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:"0px"},marginTop:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:"0px"},marginBottom:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:"0px"}}}});
return F;},true);
sap.ui.predefine('sap/ui/vk/FlexibleControlRenderer',["jquery.sap.global"],function(q){"use strict";var F={};
F.render=function(r,f){var a=r;a.write("<div");a.writeControlData(f);a.addClass("sapUiFlexControl");if(f.getWidth()&&f.getWidth()!=""){a.addStyle("width",f.getWidth());}if(f.getHeight()&&f.getHeight()!=""){a.addStyle("height",f.getHeight());}a.writeStyles();a.writeClasses();a.write(">");var c=f.getContent();var l=f.getLayout();var b="sapUiFlexCellStacked";if(l=="Vertical"){b="sapUiFlexCellVertical";}for(var i=0;i<c.length;i++){var d=c[i];a.write("<div id=\""+f.getId()+"Content_"+i+"\" class=\""+b+"\"");var e=d.getLayoutData();if(e&&l!="Stacked"){a.write(" style=\"");if(e.getSize()&&e.getSize()!=""){a.write("height: "+e.getSize()+";");}if(e.getMinSize()&&e.getMinSize()!=""){a.write("min-height: "+e.getMinSize()+";");}if(e.getMarginTop()&&e.getMarginTop()!=""){a.write("margin-top: "+e.getMarginTop()+";");}if(e.getMarginBottom()&&e.getMarginBottom()!=""){a.write("margin-bottom: "+e.getMarginBottom()+";");}a.write("\"");}a.write(">");a.renderControl(d);a.write("</div>");}a.write("</div>");};
return F;},true);
sap.ui.predefine('sap/ui/vk/ImageContentManager',["jquery.sap.global","./Messages","./ContentManager"],function(q,M,C){"use strict";
var I=C.extend("sap.ui.vk.ImageContentManager",{metadata:{library:"sap.ui.vk"}});
var b=I.getMetadata().getParent().getClass().prototype;
I.prototype.init=function(){if(b.init){b.init.call(this);}this._handleLoadSucceededProxy=this._handleLoadSucceeded.bind(this);this._handleLoadFailedProxy=this._handleLoadFailed.bind(this);};
I.prototype.exit=function(){if(b.exit){b.exit.call(this);}};
I.prototype.loadContent=function(c,a){if(a.length!==1){q.sap.delayedCall(0,this,function(){this.fireContentChangesStarted();this.fireContentChangesFinished({content:null,failureReason:{errorMessage:"Only a single image can be loaded."}});});}else if(a[0].getContentResources().length>0){q.sap.delayedCall(0,this,function(){this.fireContentChangesStarted();this.fireContentChangesFinished({content:null,failureReason:{errorMessage:"Cannot load a hierarchy of images."}});});}else{var d=a[0],s=d.getSource(),e=d.getSourceType();if(s instanceof File){var f=new FileReader();f.onload=function(g){this._loadImageFromUrl(c,f.result,e);}.bind(this);f.readAsDataURL(s);}else{var t=new sap.m.Image({src:s});s=t.getSrc();t.destroy();this._loadImageFromUrl(c,s,e);}}};
I.prototype._addEventListeners=function(h){h.addEventListener("load",this._handleLoadSucceededProxy);h.addEventListener("error",this._handleLoadFailedProxy);};
I.prototype._removeEventListeners=function(h){h.removeEventListener("error",this._handleLoadFailedProxy);h.removeEventListener("load",this._handleLoadSucceededProxy);};
I.prototype._addSvgQuirks=function(h){h.style.setProperty("visibility","collapse");h.style.setProperty("width","0");h.style.setProperty("height","0");h.style.setProperty("position","absolute");document.body.appendChild(h);return this;};
I.prototype._removeSvgQuirks=function(h){h.parentElement.removeChild(h);h.style.removeProperty("visibility");h.style.removeProperty("width");h.style.removeProperty("height");h.style.removeProperty("position");return this;};
I.prototype._loadImageFromUrl=function(c,u,s){this.fireContentChangesStarted();switch(s.toLowerCase()){case"svg":var a=document.createElement("object");this._addEventListeners(a);a.type="image/svg+xml";a.data=u;a.className="SVGImage";this._addSvgQuirks(a);break;case"jpg":case"jpeg":case"png":case"gif":case"bmp":case"tif":case"tiff":var i=document.createElement("img");this._addEventListeners(i);i.src=u;break;default:q.sap.delayedCall(0,this,function(){this.fireContentChangesFinished({content:null,failureReason:{errorMessage:"Unsupported image type.",sourcesFailedToDownload:[{source:u}]}});});break;}};
I.prototype._handleLoadSucceeded=function(a){var c=a.target;if(c instanceof HTMLObjectElement){try{if(!c.getSVGDocument()){this._handleLoadFailed(a);return;}}catch(e){}}this._removeEventListeners(c);if(c instanceof HTMLObjectElement){this._removeSvgQuirks(c);}this.fireContentChangesFinished({content:c});};
I.prototype._handleLoadFailed=function(e){var c=e.target;this._removeEventListeners(c);if(c instanceof HTMLObjectElement){this._removeSvgQuirks(c);}this.fireContentChangesFinished({content:null,failureReason:{errorMessage:"Failed to load the image.",sourcesFailedToDownload:[{source:c instanceof HTMLImageElement?c.src:c.data}]}});};
return I;});
sap.ui.predefine('sap/ui/vk/InputDeviceKeyboard',["jquery.sap.global","sap/ui/base/EventProvider"],function(q,E){"use strict";
var I=E.extend("sap.ui.vk.InputDeviceKeyboard",{
metadata:{publicMethods:["enable","disable"]},
constructor:function(l){this._loco=l;}
});
I.prototype.enable=function(c){this._control=c;this._control.attachBrowserEvent("keydown keyup keypress",this._onKeyEvent,this);};
I.prototype.disable=function(){this._control.detachBrowserEvent("keydown keyup keypress",this._onKeyEvent,this);};
I.prototype._onKeyEvent=function(e){this._loco.keyEventHandler(e,this._control);};
return I;},true);
sap.ui.predefine('sap/ui/vk/InputDeviceMouse',["jquery.sap.global","sap/ui/base/EventProvider"],function(q,E){"use strict";
var I=E.extend("sap.ui.vk.InputDeviceMouse",{
metadata:{publicMethods:["isSupported","enable","disable"]},
constructor:function(L){this._loco=L;this._buttons=0;this._buttonFlagsValue=0;this._zoomOrigin={x:0,y:0};this._mousedownProxy=this._onmousedown.bind(this);this._mouseupProxy=this._onmouseup.bind(this);this._mousemoveProxy=this._onmousemove.bind(this);this._mousewheelProxy=this._onmousewheel.bind(this);this._contextmenuProxy=this._oncontextmenu.bind(this);this._onmouseupWindowListenerProxy=this._onmouseupWindowListener.bind(this);}
});
I.prototype._buttonFlags=function(b,d){if(d){this._buttonFlagsValue|=(1<<b);}else{this._buttonFlagsValue&=~(1<<b);}return this._buttonFlagsValue;};
I.prototype._eventToInput=function(e,b){var a=(e.buttons!=undefined)?e.buttons:this._buttonFlagsValue;if(b){a=b;}var i={x:0,y:0,z:0,d:0,n:0,buttons:a,scroll:e.wheelDelta,points:[],handled:false,jqueryEvent:e};var n=0;switch(a){case 0:case 1:n=1;i.points.push({x:e.pageX,y:e.pageY,z:0});break;case 3:case 4:case 5:n=2;i.points.push({x:e.pageX,y:e.pageY,z:0});i.points.push({x:e.pageX,y:e.pageY,z:0});break;case 2:n=2;i.points.push({x:this._zoomOrigin.x,y:e.pageY,z:0});i.points.push({x:this._zoomOrigin.x,y:e.pageY+(this._zoomOrigin.y-e.pageY)*2,z:0});break;default:n=0;break;}i.n=n;return i;};
I.prototype._onmouseup=function(e){this._capturedByControl=true;var b=(e.buttons!=undefined)?e.buttons:this._buttonFlags(e.button,false);if(e["_sapui_handledByControl"]){return;}var i=this._eventToInput(e,this._buttons);this._loco.endGesture(i,this._control);if(b==2){this._zoomOrigin.x=e.pageX;this._zoomOrigin.y=e.pageY;}i=this._eventToInput(e);if(b!=0){i.handled=false;this._loco.beginGesture(i,this._control);}this._buttons=b;};
I.prototype._onmouseupWindowListener=function(e){if(!this._capturedByControl){this._onmouseup(e);}this._capturedByControl=false;};
I.prototype._onmousemove=function(e){if(e["_sapui_handledByControl"]){return;}if(sap.ui.Device.os.name===sap.ui.Device.os.OS.MACINTOSH&&e.buttons===2){e.buttons=3;}var i=this._eventToInput(e);this._loco.move(i,this._control);};
I.prototype._onmousedown=function(e){var b=(e.buttons!=undefined)?e.buttons:this._buttonFlags(e.button,true);if(e["_sapui_handledByControl"]){return;}var i;if(this._buttons!=0){i=this._eventToInput(e,this._buttons);this._loco.endGesture(i,this._control);}if(b==2){this._zoomOrigin.x=e.pageX;this._zoomOrigin.y=e.pageY;}i=this._eventToInput(e);i.handled=false;this._loco.beginGesture(i,this._control);this._prevButtons=b;this._buttons=b;};
I.prototype._onmousewheel=function(e){var a=e.originalEvent?e.originalEvent:e;if(a["_sapui_handledByControl"]||this._buttons!=0){return;}this._zoomOrigin.x=a.pageX;this._zoomOrigin.y=a.pageY;var d=a.detail?a.detail*(-40):a.wheelDelta;if(d==null){d=-a.deltaY;}var s={pageX:a.pageX,pageY:a.pageY,buttons:2,wheelDelta:d};var i=this._eventToInput(s);this._loco.beginGesture(i,this._control);s.pageY-=d/5;i=this._eventToInput(s);i.handled=false;this._loco.move(i,this._control);i.handled=false;this._loco.endGesture(i,this._control);if(i.handled){a["_sapui_handledByControl"]=true;a.preventDefault();}};
I.prototype._oncontextmenu=function(e){var i=this._eventToInput(e);this._loco.contextMenu(i,this._control);if(i.handled){e["_sapui_handledByControl"]=true;e.preventDefault();}};
I.prototype.isSupported=function(){return true;};
I.prototype.enable=function(c){this._buttonFlagsValue=0;this._buttons=0;this._control=c;var f=this._control?this._control.attachBrowserEvent.bind(this._control):window.document.addEventListener;f("mousedown",this._mousedownProxy);f("mouseup",this._mouseupProxy);f("mousemove",this._mousemoveProxy);f("mousewheel",this._mousewheelProxy);f("DOMMouseScroll",this._mousewheelProxy);f("contextmenu",this._contextmenuProxy);window.document.addEventListener("mouseup",this._onmouseupWindowListenerProxy);};
I.prototype.disable=function(){var f=this._control?this._control.detachBrowserEvent.bind(this._control):window.document.removeEventListener;f("mousedown",this._mousedownProxy);f("mouseup",this._mouseupProxy);f("mousemove",this._mousemoveProxy);f("mousewheel",this._mousewheelProxy);f("DOMMouseScroll",this._mousewheelProxy);f("contextmenu",this._contextmenuProxy);window.document.removeEventListener("mouseup",this._onmouseupWindowListenerProxy);};
return I;},true);
sap.ui.predefine('sap/ui/vk/InputDevicePointer',["jquery.sap.global","sap/ui/base/EventProvider","./InputDeviceMouse"],function(q,E,I){"use strict";
var a=E.extend("sap.ui.vk.InputDevicePointer",{
metadata:{publicMethods:["isSupported","enable","disable"]},
constructor:function(L){this._loco=L;this._pointerIds=[];this._pointers=[];this._count=0;this._points=0;this._buttons=0;this._mouse=new I(this._loco);this._pointerdownProxy=this._onpointerdown.bind(this);this._pointerupProxy=this._onpointerup.bind(this);this._pointermoveProxy=this._onpointermove.bind(this);this._mousewheelProxy=this._mouse._onmousewheel.bind(this._mouse);this._contextmenuProxy=this._mouse._oncontextmenu.bind(this._mouse);this._onpointerupWindowListenerProxy=this._onpointerupWindowListener.bind(this);}
});
a.prototype._clearPointers=function(){this._pointerIds=[];this._pointers=[];this._count=0;this._points=0;this._buttons=0;};
a.prototype._addPointer=function(i,_,b){if(this._pointerIds[i]==null){this._pointerIds[i]=this._count;}var c=this._pointerIds[i];if(this._pointers.length<=c||this._pointers[c]==null){this._count++;}this._pointers[c]={x:_,y:b};return this._count;};
a.prototype._removePointer=function(i){if(this._pointerIds[i]==null){return this._count;}var b=this._pointerIds[i];this._pointerIds[i]=null;if(this._pointers.length>b&&this._pointers[b]!=null){this._count--;}this._pointers[b]=null;return this._count;};
a.prototype._eventToInput=function(e){var b={x:0,y:0,z:0,d:0,n:this._count,buttons:0,scroll:0,points:[],handled:false,jqueryEvent:e};var t=this._pointers;var l=t.length;for(var i=0;i<l;i++){var c=t[i];if(c!=null){b.points.push({x:c.x,y:c.y,z:0});}}return b;};
a.prototype._onpointerdown=function(e){var b=e.originalEvent?e.originalEvent:e;if(b.pointerType!="touch"&&b.pointerType!="pen"){this._buttons=b.buttons;this._mouse._onmousedown(b);return;}if(b.isPrimary){this._clearPointers();}this._addPointer(b.pointerId,b.pageX,b.pageY);b.target.setPointerCapture(b.pointerId);var i=this._eventToInput(b);if(this._points!=0&&this._points!=i.n){this._loco.endGesture(i,this._control);this._loco._resetClickTimer();}this._points=i.n;i.handled=false;this._loco.beginGesture(i,this._control);if(i.handled){}else{this._removePointer(b.pointerId);}};
a.prototype._onpointerup=function(e){this._capturedByControl=true;var b=e.originalEvent?e.originalEvent:e;if(b.pointerType!="touch"&&b.pointerType!="pen"){this._buttons=0;this._mouse._onmouseup(b);return;}this._removePointer(b.pointerId);b.target.releasePointerCapture(b.pointerId);var i=this._eventToInput(b);this._loco.endGesture(i,this._control);if(i.n!=0&&this._points!=i.n){i.handled=false;this._loco.beginGesture(i,this._control);this._loco._resetClickTimer();}this._points=i.n;};
a.prototype._onpointerupWindowListener=function(e){if(!this._capturedByControl){this._onpointerup(e);}this._capturedByControl=false;};
a.prototype._onpointermove=function(e){if(e.buttons!==0||sap.ui.Device.system.desktop){var b=e.originalEvent?e.originalEvent:e;if(b.pointerType!="touch"&&b.pointerType!="pen"){this._mouse._onmousemove(b);return;}this._addPointer(b.pointerId,b.pageX,b.pageY);var i=this._eventToInput(b);if(this._points!=i.n){this._loco.endGesture(i,this._control);this._loco._resetClickTimer();i.handled=false;this._loco.beginGesture(i,this._control);this._loco._resetClickTimer();this._points=i.n;}else{this._loco.move(i,this._control);}}};
a.prototype.isSupported=function(){if((sap.ui.Device.browser.edge||sap.ui.Device.browser.msie)&&sap.ui.Device.support.pointer){return true;}return false;};
a.prototype.enable=function(c){this._pointerIds=[];this._pointers=[];this._points=0;this._count=0;this._buttons=0;this._mouse._buttons=0;this._control=c;this._mouse._control=c;var f=this._control?this._control.attachBrowserEvent.bind(this._control):window.document.addEventListener;f("pointerdown",this._pointerdownProxy);f("pointerup",this._pointerupProxy);f("pointermove",this._pointermoveProxy);f("mousewheel",this._mousewheelProxy);f("DOMMouseScroll",this._mousewheelProxy);f("contextmenu",this._contextmenuProxy);window.document.addEventListener("pointerup",this._onpointerupWindowListenerProxy);};
a.prototype.disable=function(){var f=this._control?this._control.detachBrowserEvent.bind(this._control):window.document.removeEventListener;f("pointerdown",this._pointerdownProxy);f("pointerup",this._pointerupProxy);f("pointermove",this._pointermoveProxy);f("mousewheel",this._mousewheelProxy);f("DOMMouseScroll",this._mousewheelProxy);f("contextmenu",this._contextmenuProxy);window.document.removeEventListener("pointerup",this._onpointerupWindowListenerProxy);};
return a;},true);
sap.ui.predefine('sap/ui/vk/InputDeviceTouch',["jquery.sap.global","sap/ui/base/EventProvider"],function(q,E){"use strict";
var I=E.extend("sap.ui.vk.InputDeviceTouch",{
metadata:{publicMethods:["isSupported","enable","disable"]},
constructor:function(L){this._loco=L;this._points=0;this._touchdownProxy=this._ontouchdown.bind(this);this._touchupProxy=this._ontouchup.bind(this);this._touchmoveProxy=this._ontouchmove.bind(this);}
});
I.prototype._eventToInput=function(e){var a={x:0,y:0,z:0,d:0,n:e.touches.length,buttons:0,scroll:0,points:[],handled:false,jqueryEvent:e};for(var i=0;i<a.n;i++){var b=e.touches[i];a.points.push({x:b.pageX,y:b.pageY,z:0});}return a;};
I.prototype._ontouchdown=function(e){var i=this._eventToInput(e);if(this._points!=0&&this._points!=i.n){this._loco.endGesture(i,this._control);}this._points=i.n;i.handled=false;this._loco.beginGesture(i,this._control);if(i.handled){e["_sapui_handledByControl"]=true;e.preventDefault();}};
I.prototype._ontouchup=function(e){var i=this._eventToInput(e);this._loco.endGesture(i,this._control);this._points=0;if(i.handled){e["_sapui_handledByControl"]=true;e.preventDefault();}};
I.prototype._ontouchmove=function(e){var i=this._eventToInput(e);if(this._points!=i.n){this._loco.endGesture(i,this._control);i.handled=false;this._loco.beginGesture(i,this._control);this._points=i.n;}else{this._loco.move(i,this._control);}if(i.handled){e["_sapui_handledByControl"]=true;e.preventDefault();}};
I.prototype.isSupported=function(){return typeof window.ontouchstart!=="undefined";};
I.prototype.enable=function(c){this._points=0;this._control=c;var f=this._control?this._control.attachBrowserEvent.bind(this._control):window.document.addEventListener;f("touchstart",this._touchdownProxy);f("touchend",this._touchupProxy);f("touchmove",this._touchmoveProxy);};
I.prototype.disable=function(){var f=this._control?this._control.detachBrowserEvent.bind(this._control):window.document.removeEventListener;f("touchstart",this._touchdownProxy);f("touchend",this._touchupProxy);f("touchmove",this._touchmoveProxy);};
return I;},true);
sap.ui.predefine('sap/ui/vk/LayerProxy',["jquery.sap.global","sap/ui/base/Object"],function(q,B){"use strict";
var L=B.extend("sap.ui.vk.LayerProxy",{metadata:{"abstract":true}});
return L;});
sap.ui.predefine('sap/ui/vk/Loco',["jquery.sap.global","sap/ui/base/EventProvider","./InputDevicePointer","./InputDeviceMouse","./InputDeviceTouch","./InputDeviceKeyboard"],function(q,E,I,a,b,c){"use strict";
var L=E.extend("sap.ui.vk.Loco",{
metadata:{publicMethods:["addHandler","removeHandler","beginGesture","move","endGesture","contextMenu"]},
constructor:function(){if(L._instance){return L._instance;}E.apply(this);this._handlers=[];this._handlerMap=[];this._gesture=[];this._touchOrigin={x:0,y:0,z:0};this._touchMoved=false;this._touchButton=0;this._touchStart=0;this._touchEnd=0;this._clickTimer=0;this._isDoubleClick=false;L._instance=this;}
});
L.prototype.destroy=function(){this._gesture=[];this._handlers=[];};
L.prototype.addHandler=function(h){if(this._handlers.indexOf(h)>=0){return;}this._handlers.push(h);var v=h.getViewport();var d=this._handlerMap[v];if(d==null){this._handlerMap[v]=[];d=this._handlerMap[v];d.push(h);}else if(d.indexOf(h)==-1){d.push(h);}var p=new I(this);if(p.isSupported()){p.enable(v);v._pointer=p;}else{var m=new a(this);if(m.isSupported()){m.enable(v);v._mouse=m;}var t=new b(this);if(t.isSupported()){t.enable(v);v._touch=t;}}v._keyboard=new c(this);v._keyboard.enable(v);};
L.prototype.removeHandler=function(d){var v=d.getViewport();var h=this._handlers;var e=this._handlerMap[v];var f;if(e!=null){f=e.indexOf(d);if(f>=0){e.splice(f,1);}}f=h.indexOf(d);if(f>=0){h.splice(f,1);if(v._pointer){v._pointer.disable();v._pointer=null;}if(v._touch){v._touch.disable();v._touch=null;}if(v._mouse){v._mouse.disable();v._mouse=null;}if(v._keyboard){v._keyboard.disable();v._keyboard=null;}}};
L.prototype._processClick=function(d,v){this._clickTimer=0;var e={x:this._touchOrigin.x,y:this._touchOrigin.y,z:this._touchOrigin.z,d:0,n:0,buttons:this._touchButton,scrolls:[],points:[],handled:false};var h=this._handlerMap[v];if(h!=null){for(var i=h.length-1;i>=0&&!e.handled;i--){if(d){var n=h[i].getViewport().getId();var p=/-nativeViewport$/.test(n)?n.replace(/-nativeViewport$/,""):null;var f=sap.ui.getCore().byId(p);if(!f||!f.getOverlay()||!(typeof f.getOverlay().mIACreateCB==="function")){h[i].doubleClick(e,v);}}else{h[i].click(e,v);}}}};
L.prototype._processInput=function(e){var d=e.points;switch(e.n){case 0:e.x=0;e.y=0;e.z=0;e.d=0;break;case 2:var f=d[0].x-d[1].x,g=d[0].y-d[1].y,h=d[0].z-d[1].z;e.x=(d[0].x+d[1].x)/2;e.y=(d[0].y+d[1].y)/2;e.z=(d[0].z+d[1].z)/2;e.d=Math.sqrt(f*f+g*g+h*h);break;default:e.x=d[0].x;e.y=d[0].y;e.z=d[0].z;e.d=0;break;}return e;};
L.prototype.beginGesture=function(e,v){if(this._gesture[v]){return;}if(this._clickTimer>0){clearTimeout(this._clickTimer);this._clickTimer=0;this._isDoubleClick=true;if(e.n==1&&e.buttons<=1&&this._touchButton<=1){this._processClick(true,v);}if(e.jqueryEvent&&e.jqueryEvent.preventDefault){e.jqueryEvent.preventDefault();e.jqueryEvent.stopPropagation();}}this._processInput(e);var h=this._handlerMap[v];if(h!=null){for(var i=h.length-1;i>=0;i--){h[i].beginGesture(e);if(e.handled){break;}}}var n=new Date();this._touchStart=n.getTime();this._touchMoved=false;this._gesture[v]=true;this._touchOrigin.x=e.x;this._touchOrigin.y=e.y;this._touchOrigin.z=e.z;this._touchButton=e.buttons;if(this._touchEnd!=0&&this._touchStart-this._touchEnd<50){this._touchMoved=true;}};
L.prototype.move=function(e,v){this._processInput(e);var h=this._handlerMap[v];var i;if(this._gesture[v]){if(h!=null){for(i=h.length-1;i>=0;i--){h[i].move(e);if(e.handled){break;}}}var d=this._touchOrigin.x-e.x;var f=this._touchOrigin.y-e.y;var g=this._touchOrigin.z-e.z;if((d*d+f*f+g*g)>8){this._touchMoved=true;}}else if(h!=null){for(i=h.length-1;i>=0;i--){if(h[i].hover!=undefined){h[i].hover(e);if(e.handled){break;}}}}};
L.prototype.endGesture=function(e,v){if(!this._gesture[v]){return;}this._processInput(e);var h=this._handlerMap[v];if(h!=null){for(var i=h.length-1;i>=0;i--){h[i].endGesture(e);if(e.handled){break;}}}var n=new Date();this._touchEnd=n.getTime();if(!this._touchMoved&&!this._isDoubleClick&&(this._touchEnd-this._touchStart)<2000){this._clickTimer=setTimeout(function(l){l._processClick(false,v);},200,this);}this._isDoubleClick=false;this._gesture[v]=false;};
L.prototype._resetClickTimer=function(){if(this._clickTimer>0){clearTimeout(this._clickTimer);this._clickTimer=0;}};
L.prototype.contextMenu=function(e,v){this._processInput(e);var h=this._handlerMap[v];if(h!=null){for(var i=h.length-1;i>=0;i--){h[i].contextMenu(e);if(e.handled){break;}}}};
L.prototype.keyEventHandler=function(e,v){var h=this._handlerMap[v];if(h!==null&&h!==undefined){for(var i=h.length-1;i>=0;i--){if(h[i].keyEventHandler){h[i].keyEventHandler(e);}}}};
return L;},true);
sap.ui.predefine('sap/ui/vk/Material',["jquery.sap.global","sap/ui/base/ManagedObject"],function(q,M){"use strict";
var a=M.extend("sap.ui.vk.Material",{metadata:{properties:{"id":{type:"string"},"name":{type:"string"},"ambientColour":{type:"sap.ui.core.CSSColor",defaultValue:"rgba(0, 0, 0, 1)"},"diffuseColour":{type:"sap.ui.core.CSSColor",defaultValue:"rgba(0, 0, 0, 1)"},"specularColour":{type:"sap.ui.core.CSSColor",defaultValue:"rgba(0, 0, 0, 1)"},"emissiveColour":{type:"sap.ui.core.CSSColor",defaultValue:"rgba(0, 0, 0, 1)"},"opacity":{type:"float",defaultValue:1.0},"glossiness":{type:"float",defaultValue:0.0},"lineColour":{type:"sap.ui.core.CSSColor",defaultValue:"rgba(0, 0, 0, 1)"},"lineWidth":{type:"float",defaultValue:0.0},"textureDiffuse":{type:"sap.ui.vk.Texture",defaultValue:null},"textureBump":{type:"sap.ui.vk.Texture",defaultValue:null},"textureOpacity":{type:"sap.ui.vk.Texture",defaultValue:null},"textureReflection":{type:"sap.ui.vk.Texture",defaultValue:null},"textureEmissive":{type:"sap.ui.vk.Texture",defaultValue:null},"textureAmbientOcclusion":{type:"sap.ui.vk.Texture",defaultValue:null}}}});
a.prototype.getMaterialRef=function(){return null;};
return a;});
sap.ui.predefine('sap/ui/vk/Messages',["jquery.sap.global","sap/ui/base/ManagedObject"],function(q,M){"use strict";var a={VIT1:{summary:"NATIVEVIEWPORT_MSG_NOTBELOADED_SUMMARY",cause:"NATIVEVIEWPORT_MSG_NOTBELOADED_NOTFOUND_CAUSE",resolution:"NATIVEVIEWPORT_MSG_NOTBELOADED_NOTFOUND_CHECKEXISTS_RESOLUTION",code:"VIT1"},VIT2:{summary:"NATIVEVIEWPORT_MSG_NOTBELOADED_SUMMARY",cause:"NATIVEVIEWPORT_MSG_NOTBELOADED_NOTFOUND_CAUSE",resolution:"NATIVEVIEWPORT_MSG_NOTBELOADED_NOTFOUND_CHECKEXISTS_RESOLUTION",code:"VIT2"},VIT3:{summary:"NATIVEVIEWPORT_MSG_NOTBELOADED_SUMMARY",cause:"NATIVEVIEWPORT_MSG_NOTBELOADED_UNSUPPORTEDFILEFORMAT_CAUSE",resolution:"NATIVEVIEWPORT_MSG_NOTBELOADED_UNSUPPORTEDFILEFORMAT_CHECKFILEFORMAT_RESOLUTION",code:"VIT3"},VIT4:{summary:"NATIVEVIEWPORT_MSG_NOTBELOADED_SUMMARY",cause:"NATIVEVIEWPORT_MSG_NOTBELOADED_UNSUPPORTEDFILEFORMAT_CAUSE",resolution:"NATIVEVIEWPORT_MSG_NOTBELOADED_UNSUPPORTEDFILEFORMAT_CHECKFILEFORMAT_RESOLUTION",code:"VIT4"},VIT5:{summary:"DOWNLOADMANAGER_MSG_NOTBELOADED_SUMMARY",cause:"DOWNLOADMANAGER_MSG_NOTBELOADED_VALUESOURCEUNSUPPORTED_CAUSE",resolution:"DOWNLOADMANAGER_MSG_NOTBELOADED_VALUESOURCEUNSUPPORTED_CHECKSOURCEISURLORFILE_RESOLUTION",code:"VIT5"},VIT6:{summary:"NODEHIERARCHY_MSG_COULDNOTSEARCHNODES_SUMMARY",cause:"NODEHIERARCHY_MSG_COULDNOTSEARCHNODES_INVALIDQUERY_CAUSE",resolution:"NODEHIERARCHY_MSG_COULDNOTSEARCHNODES_INVALIDQUERY_SPECIFYVALUEPROPERTY_RESOLUTION",code:"VIT6"},VIT7:{summary:"NODEHIERARCHY_MSG_COULDNOTSEARCHNODES_SUMMARY",cause:"NODEHIERARCHY_MSG_COULDNOTSEARCHNODES_PREDICATENOTSPECIFIED_CAUSE",resolution:"NODEHIERARCHY_MSG_COULDNOTSEARCHNODES_PREDICATENOTSPECIFIED_SPECIFYPREDICATE_RESOLUTION",code:"VIT7"},VIT8:{summary:"NODEHIERARCHY_MSG_COULDNOTSEARCHNODES_SUMMARY",cause:"NODEHIERARCHY_MSG_COULDNOTSEARCHNODES_INCORRECTPREDICATEVALUE_CAUSE",resolution:"NODEHIERARCHY_MSG_COULDNOTSEARCHNODES_INCORRECTPREDICATEVALUE_INVALIDPREDICATE_RESOLUTION",code:"VIT8"},VIT9:{summary:"NODEHIERARCHY_MSG_COULDNOTSEARCHNODES_SUMMARY",cause:"NODEHIERARCHY_MSG_COULDNOTSEARCHNODES_INCORRECTPREDICATEVALUE_CAUSE",resolution:"NODEHIERARCHY_MSG_COULDNOTSEARCHNODES_INCORRECTPREDICATEVALUE_INVALIDPREDICATE_RESOLUTION",code:"VIT9"},VIT10:{summary:"NODEHIERARCHY_MSG_COULDNOTSEARCHNODES_SUMMARY",cause:"NODEHIERARCHY_MSG_COULDNOTSEARCHNODES_NOMETADATASPECIFIED_CAUSE",resolution:"NODEHIERARCHY_MSG_COULDNOTSEARCHNODES_NOMETADATASPECIFIED_SPECIFYMETADATACATEGORY_RESOLUTION",code:"VIT10"},VIT11:{summary:"OVERLAY_MSG_EVENTHANDLERFAILED_SUMMARY",cause:"OVERLAY_MSG_EVENTHANDLERFAILED_UNSUPPORTEDEVENTTYPE_CAUSE",resolution:"OVERLAY_MSG_EVENTHANDLERFAILED_UNSUPPORTEDEVENTTYPE_CHECKEVENTTYPE_RESOLUTION",code:"VIT11"},VIT12:{summary:"STEPNAVIGATION_MSG_STEPCOULDNOTBEPLAYED_SUMMARY",cause:"STEPNAVIGATION_MSG_STEPCOULDNOTBEPLAYED_INCORRECTSTEPEVENTTYPE_CAUSE",resolution:"STEPNAVIGATION_MSG_STEPCOULDNOTBEPLAYED_INCORRECTSTEPEVENTTYPE_CHECKSTEPEVENTTYPEVALUE_RESOLUTION",code:"VIT12"},VIT13:{summary:"VIEWER_MSG_CONTENTRESOURCESNOTLOADED_SUMMARY",cause:"VIEWER_MSG_CONTENTRESOURCESNOTLOADED_NONEXISTINGORUNSUPPORTEDFILE_CAUSE",resolution:"VIEWER_MSG_CONTENTRESOURCESNOTLOADED_NONEXISTINGORUNSUPPORTEDFILE_CHECKFILEEXISTSANDIFSUPPORT_RESOLUTION",code:"VIT13"},VIT14:{summary:"VIEWER_MSG_FAILEDTOBUILDSCENE_SUMMARY",cause:"VIEWER_MSG_FAILEDTOBUILDSCENE_COULDNOTCREATESCENE_CAUSE",resolution:"VIEWER_MSG_FAILEDTOBUILDSCENE_COULDNOTCREATESCENE_RELOADORSELECTANOTHERFILE_RESOLUTION",code:"VIT14"},VIT15:{summary:"VIEWER_MSG_ERRORLOADINGMULTIPLEFILES_SUMMARY",cause:"VIEWER_MSG_ERRORLOADINGMULTIPLEFILES_LOADINGMULTIPLE2DNOTSUPPORTED_CAUSE",resolution:"VIEWER_MSG_ERRORLOADINGMULTIPLEFILES_LOADINGMULTIPLE2DNOTSUPPORTED_LOADONE2D_RESOLUTION",code:"VIT15"},VIT16:{summary:"VIEWER_MSG_NOTBELOADED_SUMMARY",cause:"VIEWER_MSG_NOTBELOADED_NONATIVESUPPORT_CAUSE",resolution:"VIEWER_MSG_NOTBELOADED_NONATIVESUPPORT_CHECKFILEFORMATSUPPORT_RESOLUTION",code:"VIT16"},VIT17:{summary:"VIEWER_MSG_ERRORLOADINGMULTIPLEFILES_SUMMARY",cause:"VIEWER_MSG_ERRORLOADINGMULTIPLEFILES_COMBINATIONOF2D3DNOTSUPPORTED_CAUSE",resolution:"VIEWER_MSG_ERRORLOADINGMULTIPLEFILES_COMBINATIONOF2D3DNOTSUPPORTED_MULTIPLESUPPORTFOR3DONLY_RESOLUTION",code:"VIT17"},VIT18:{summary:"VIEWPORT_MSG_ERRORLOADINGVIEWPORT_SUMMARY",cause:"VIEWPORT_MSG_ERRORLOADINGVIEWPORT_CREATINGMULTIPLEVIEWPORTINSTANCES_CAUSE",resolution:"VIEWPORT_MSG_ERRORLOADINGVIEWPORT_CREATINGMULTIPLEVIEWPORTINSTANCES_ONEINSTANCEOFVIEWPORTSUPPORTED_RESOLUTION",code:"VIT18"},VIT19:{summary:"VIEWPORT_MSG_COULDNOTSETCAMERAPROJECTION_SUMMARY",cause:"VIEWPORT_MSG_COULDNOTSETCAMERAPROJECTION_SPECIFIEDCAMERAPROJECTIONNOTSUPPORTED_CAUSE",resolution:"VIEWPORT_MSG_COULDNOTSETCAMERAPROJECTION_SPECIFIEDCAMERAPROJECTIONNOTSUPPORTED_CHECKPROJECTIONTYPESUPPORTED_RESOLUTION",code:"VIT19"},VIT20:{summary:"DOWNLOADMANAGER_MSG_VDS4_BETA_WARNING_SUMMARY",cause:"DOWNLOADMANAGER_MSG_VDS4_BETA_WARNING_CAUSE",resolution:"DOWNLOADMANAGER_MSG_VDS4_BETA_WARNING_RESOLUTION",code:"VIT20"},VIT21:{summary:"VIEWER_MSG_FAILEDTOBUILDSCENE_SUMMARY",cause:"VIEWER_MSG_FAILEDTOBUILDSCENE_MISSINGPASSWORD_CAUSE",resolution:"VIEWER_MSG_FAILEDTOBUILDSCENE_MISSINGPASSWORD_PROVIDEPASSWORD_RESOLUTION",code:"VIT21"},VIT22:{summary:"GRAPHICSCORE_MSG_VDSL_NOFILEPROPERTY_SUMMARY",cause:"GRAPHICSCORE_MSG_VDSL_EMPTY_CAUSE",resolution:"GRAPHICSCORE_MSG_VDSL_FIRSTLINE_WRONGFORMAT_RESOLUTION",code:"VIT22"},VIT23:{summary:"GRAPHICSCORE_MSG_VDSL_FIRSTLINE_WRONGFORMAT_SUMMARY",cause:"GRAPHICSCORE_MSG_VDSL_WRONGFORMAT_CAUSE",resolution:"GRAPHICSCORE_MSG_VDSL_FIRSTLINE_WRONGFORMAT_RESOLUTION",code:"VIT23"},VIT24:{summary:"GRAPHICSCORE_MSG_VDSL_RELATIVE_IN_LOCAL_SUMMARY",cause:"GRAPHICSCORE_MSG_VDSL_WRONGFORMAT_CAUSE",resolution:"GRAPHICSCORE_MSG_VDSL_RELATIVE_IN_LOCAL_RESOLUTION",code:"VIT24"},VIT25:{summary:"GRAPHICSCORE_MSG_VDS3ENCRYPTED_SUMMARY",cause:"GRAPHICSCORE_MSG_VDS3ENCRYPTED_CAUSE",resolution:"GRAPHICSCORE_MSG_VDS3ENCRYPTED_RESOLUTION",code:"VIT25"},VIT26:{summary:"VIEWPORT_UNSUPPORTED_STEP_INDEX_SUMMARY",cause:"VIEWPORT_UNSUPPORTED_STEP_INDEX_CAUSE",resolution:"VIEWPORT_UNSUPPORTED_STEP_INDEX_RESOLUTION",code:"VIT26"},VIT27:{summary:"VIEWPORT_UNSUPPORTED_PROCEDURE_INDEX_SUMMARY",cause:"VIEWPORT_UNSUPPORTED_PROCEDURE_INDEX_CAUSE",resolution:"VIEWPORT_UNSUPPORTED_PROCEDURE_INDEX_RESOLUTION",code:"VIT27"},VIT28:{summary:"VIEWPORT_UNSUPPORTED_VISIBILITY_MODE_SUMMARY",cause:"VIEWPORT_UNSUPPORTED_VISIBILITY_MODE_CAUSE",resolution:"VIEWPORT_UNSUPPORTED_VISIBILITY_MODE_RESOLUTION",code:"VIT28"},VIT29:{summary:"VIEWER_RUNTIME_SETTINGS_NOT_CHANGEABLE_SUMMARY",cause:"VIEWER_RUNTIME_SETTINGS_NOT_CHANGEABLE_CAUSE",resolution:"VIEWER_RUNTIME_SETTINGS_NOT_CHANGEABLE_RESOLUTION",code:"VIT29"},VIT30:{summary:"VIEWER_WEBGLCONTEXTATTRIBUTES_NOT_CHANGEABLE_SUMMARY",cause:"VIEWER_WEBGLCONTEXTATTRIBUTES_NOT_CHANGEABLE_CAUSE",resolution:"VIEWER_WEBGLCONTEXTATTRIBUTES_NOT_CHANGEABLE_RESOLUTION",code:"VIT30"},VIT31:{summary:"VIEWPORT_UNSUPPORTED_RESET_OPTIONS_SUMMARY",cause:"VIEWPORT_UNSUPPORTED_RESET_OPTIONS_CAUSE",resolution:"VIEWPORT_UNSUPPORTED_RESET_OPTIONS_RESOLUTION",code:"VIT31"},VIT32:{summary:"VIEWPORT_UNSUPPORTED_VISIBILITY_TRACKING_SUMMARY",cause:"VIEWPORT_UNSUPPORTED_VISIBILITY_TRACKING_CAUSE",resolution:"VIEWPORT_UNSUPPORTED_VISIBILITY_TRACKING_RESOLUTION",code:"VIT32"},VIT33:{summary:"VIEWER_SOURCE_FAILED_TO_DOWNLOAD_SUMMARY",cause:"VIEWER_SOURCE_FAILED_TO_DOWNLOAD_CAUSE",resolution:"VIEWER_SOURCE_FAILED_TO_DOWNLOAD_RESOLUTION",code:"VIT33"},VIT34:{summary:"VIEWER_SOURCE_FAILED_TO_LOAD_SUMMARY",cause:"VIEWER_SOURCE_FAILED_TO_LOAD_CAUSE",resolution:"VIEWER_SOURCE_FAILED_TO_LOAD_RESOLUTION",code:"VIT34"},VIT35:{summary:"VIEWER_MSG_ERRORLOADINGMULTIPLEFILES_SUMMARY",cause:"VIEWER_MSG_ERRORLOADINGMULTIPLEFILES_COMBINATIONOFDIFFRENTCONTENTMANAGERSNOTSUPPORTED_CAUSE",resolution:"VIEWER_MSG_ERRORLOADINGMULTIPLEFILES_COMBINATIONOFDIFFRENTCONTENTMANAGERSNOTSUPPORTED_MULTIPLESUPPORTFORSAMECONTENTMANAGER_RESOLUTION",code:"VIT35"},VIT36:{summary:"VIEWER_UNKNOWN_CONTENT_RESOURCE_TYPE_SUMMARY",cause:"VIEWER_UNKNOWN_CONTENT_RESOURCE_TYPE_CAUSE",resolution:"VIEWER_UNKNOWN_CONTENT_RESOURCE_TYPE_RESOLUTION",code:"VIT36"},VIT37:{summary:"VIEWER_MSG_FAILEDTOLOADCONTENT_SUMMARY",cause:"VIEWER_MSG_FAILEDTOLOADCONTENT_URLORAUTHENTICATION_CAUSE",resolution:"VIEWER_MSG_FAILEDTOLOADCONTENT_URLORAUTHENTICATION_RESOLUTION",code:"VIT37"}};q.sap.setObject("sap.ui.vk.Messages",a);return a;});
sap.ui.predefine('sap/ui/vk/NativeViewportRenderer',["jquery.sap.global"],function(q){"use strict";var N={};
N.render=function(r,c){r.write("<div");r.writeControlData(c);r.addClass("sapVizKitNativeViewport");r.writeClasses();r.writeAttribute("tabindex",0);r.write(">");r.write("</div>");};
return N;},true);
sap.ui.predefine('sap/ui/vk/NodeHierarchy',["jquery.sap.global","sap/ui/base/ManagedObject","./Messages"],function(q,M,a){"use strict";
var N=M.extend("sap.ui.vk.NodeHierarchy",{metadata:{"abstract":true,events:{changed:{},nodeCreated:{parameters:{nodeRef:{type:"any"},nodeId:{type:"string"}}},nodeRemoving:{parameters:{nodeRef:{type:"any"},nodeId:{type:"string"}}},nodeReplaced:{parameters:{ReplacedNodeRef:{type:"any"},ReplacementNodeRef:{type:"any"},ReplacedNodeId:{type:"string"},ReplacementNodeId:{type:"string"}}},nodeUpdated:{parameters:{nodeRef:{type:"any"},nodeId:{type:"string"}}}}}});
N.prototype.findNodesById=function(b){if(b.fields.some(function(g){return!g.caseSensitive;})){b=q.extend(true,{},b);b.fields.forEach(function(g){if(!g.caseSensitive){g.value=g.value.toLowerCase();}});}var c=function(p,g,v,h){var m;p=p||"equals";h=h||"";var j=g?v:v.toLowerCase();switch(p){case"equals":m=(j===h);break;case"contains":m=(j.indexOf(h)!==-1);break;case"startsWith":m=(j.indexOf(h)===0);break;default:m=false;q.sap.log.error(sap.ui.vk.getResourceBundle().getText(a.VIT8.summary),a.VIT8.code,"sap.ui.vk.dvl.NodeHierarchy");}return m;};var i=function(l,g){return!l.some(function(v){return g.name===v.name?c(g.predicate,g.caseSensitive,v.value,g.value):false;});};var f=function(b,v){return b.source===v.source&&b.type===v.type&&!b.fields.some(i.bind(undefined,v.fields));};var d=this.findNodesByName();var e=d.filter(function(n){var g=this.createNodeProxy(n);var v=g.getVeIds();this.destroyNodeProxy(g);return v.some(f.bind(undefined,b));}.bind(this));return e;};
N.prototype.findNodesByMetadata=function(b){var c=function(m,j,k,v,h,i){if(m.hasOwnProperty(j)){var l=m[j];if(l.hasOwnProperty(k)){var n=l[k];if(!i){n=n.toLowerCase();}return v.some(h.bind(undefined,n));}}return false;};var d=function(m,j){if(m==null){return false;}return m.hasOwnProperty(j);};var g=function(e,f,j,k,v,h,i){var n=this._baseNodeProxyPool.borrowObject();var r=e.filter(function(l){n.init(this,l);var m=n.getNodeMetadata();var o=f(m,j,k,v,h,i);n.reset();return o;}.bind(this));this._baseNodeProxyPool.returnObject(n);return r;};var e=this.findNodesByName(),r=[];if(b===undefined||b===null||q.isEmptyObject(b)){r=e;}else if(b.category!==null&&b.category!==undefined&&b.category!==""){var f,v,p,h,i=!!(b&&b.caseSensitive);if(b.key===undefined||b.key===null){f=d;}else{v=b.value;p=b.predicate||"equals";if(v===undefined||v===null){v="";p="contains";}if(!Array.isArray(v)){v=[v];}if(!i){v=v.map(function(j){return j.toLowerCase();});}switch(p){case"equals":h=function(m,j){return m===j;};break;case"contains":h=function(m,j){return m.indexOf(j)!==-1;};break;case"startsWith":h=function(m,j){return m.indexOf(j)===0;};break;default:q.sap.log.error(sap.ui.vk.getResourceBundle().getText(a.VIT9.summary),a.VIT9.code,"sap.ui.vk.dvl.NodeHierarchy");}f=c;}r=g.bind(this)(e,f,b.category,b.key,v,h,i);}else{q.sap.log.error(sap.ui.vk.getResourceBundle().getText(a.VIT10.summary),a.VIT10.code,"sap.ui.vk.dvl.NodeHierarchy");}return q.sap.unique(r);};
N.prototype._appendAncestors=function(n,s){s=s?new Set(s):null;var b=new Set(n);n.forEach(function(d){var e=this.getAncestors(d);e.forEach(function(f){if(s===null||!s.has(f)){b.add(f);}});},this);var c=[];b.forEach(function(d){c.push(d);});return c;};
return N;});
sap.ui.predefine('sap/ui/vk/NodeProxy',["jquery.sap.global","./library","sap/ui/base/ManagedObject"],function(q,l,M){"use strict";
var N=M.extend("sap.ui.vk.NodeProxy",{metadata:{properties:{nodeRef:"any",veIds:"object[]",name:"string",localMatrix:{type:"sap.ui.vk.TransformationMatrix",bindable:"bindable"},worldMatrix:{type:"sap.ui.vk.TransformationMatrix",bindable:"bindable"},material:{type:"sap.ui.vk.Material"},opacity:{type:"float",bindable:"bindable"},tintColorABGR:{type:"int",bindable:"bindable"},tintColor:{type:"sap.ui.core.CSSColor",bindable:"bindable"},nodeMetadata:"object",hasChildren:"boolean",closed:"boolean"}}});
N.prototype.setClosed=function(v){return this;};
N.prototype.setHasChildren=function(v){return this;};
N.prototype.setName=function(v){return this;};
N.prototype.setNodeId=function(v){return this;};
N.prototype.setNodeMetadata=function(v){return this;};
N.prototype.setVeIds=function(v){return this;};
N.prototype.assignMaterial=function(v){return this;};
return N;});
sap.ui.predefine('sap/ui/vk/NotificationsRenderer',["jquery.sap.global"],function(q){"use strict";var N={};
N.render=function(r,c){r.write("<div");r.writeControlData(c);r.addClass("sapVizKitNotifications");r.writeClasses();r.write(">");r.renderControl(c.getAggregation("_messagePopoverToggleButton"));r.write("</div>");};
return N;},true);
sap.ui.predefine('sap/ui/vk/OrthographicCamera',["jquery.sap.global","./Camera"],function(q,C){"use strict";
var O=C.extend("sap.ui.vk.OrthographicCamera",{metadata:{properties:{"zoomFactor":{type:"float"}}}});
return O;});
sap.ui.predefine('sap/ui/vk/PerspectiveCamera',["jquery.sap.global","./Camera"],function(q,C){"use strict";
var P=C.extend("sap.ui.vk.PerspectiveCamera",{metadata:{properties:{"fov":{type:"float"}}}});
return P;});
sap.ui.predefine('sap/ui/vk/ProgressIndicator',["jquery.sap.global","./library","sap/m/ProgressIndicator","./ProgressIndicatorRenderer"],function(q,l,M,P){"use strict";
var a=M.extend("sap.ui.vk.ProgressIndicator");
a.prototype.setPercentValue=function(p){var i=function i(v){return(typeof(v)==="number")&&!isNaN(v)&&v>=0&&v<=100;};var t=this,$,f,b=this.$(),A,u=false;if(!i(p)){p=0;q.sap.log.warning(this+": percentValue ("+p+") is not correct! Setting the default percentValue:0.");}if(this.getPercentValue()!==p){f=this.getPercentValue()-p;this.setProperty("percentValue",p,true);if(!b.length){return this;}["sapMPIValueMax","sapMPIValueMin","sapMPIValueNormal","sapMPIValueGreaterHalf"].forEach(function(c){b.removeClass(c);});b.addClass(this._getCSSClassByPercentValue(p));b.addClass("sapMPIAnimate").attr("aria-valuenow",p).attr("aria-valuetext",this._getAriaValueText({fPercent:p}));A=u?Math.abs(f)*20:0;$=this.$("bar");$.animate({"flex-basis":p+"%"},A,"linear",function(){t._setText.apply(t);t.$().removeClass("sapMPIAnimate");});}return this;};
return a;},true);
sap.ui.predefine('sap/ui/vk/ProgressIndicatorRenderer',["jquery.sap.global","sap/m/ProgressIndicatorRenderer"],function(q,P){"use strict";return P;},true);
sap.ui.predefine('sap/ui/vk/RedlineDesign',["jquery.sap.global","./library","sap/ui/core/Control","./RedlineSurface","./RedlineElement","./RedlineGesturesHandler","./RedlineDesignHandler","./Loco","./RedlineDesignRenderer"],function(q,l,C,R,a,b,c,L,d){"use strict";
var e=R.extend("sap.ui.vk.RedlineDesign",{metadata:{library:"sap.ui.vk",events:{elementCreated:{parameters:{element:"object"}}},aggregations:{activeElementInstance:{type:"sap.ui.vk.RedlineElement",multiple:false,visibility:"hidden"}}}});
e.prototype.init=function(){this._isAddingModeActive=false;this._isDrawingOn=false;this._activeElementInstance=null;this.addStyleClass("sapUiVizkitRedlineInteractionMode");this._gestureHandler=new b(this);this._designHandler=new c(this);};
e.prototype.onBeforeRendering=function(){if(this._loco){this._loco.removeHandler(this._gestureHandler);this._loco.removeHandler(this._designHandler);}};
e.prototype.onAfterRendering=function(){var f=this.getDomRef();f.style.width="100%";f.style.height="100%";this._loco=new L();if(this._isAddingModeActive){this._loco.addHandler(this._designHandler);}else{this._loco.addHandler(this._gestureHandler);}this.updatePanningRatio();};
e.prototype._editElement=function(f,o,g){f.edit(o,g);return this;};
e.prototype._getIsDrawingOn=function(){return this._isDrawingOn;};
e.prototype._setIsDrawingOn=function(i){this._isDrawingOn=i;return this;};
e.prototype.startAdding=function(f){this._isAddingModeActive=true;this._activeElementInstance=f;this.setAggregation("activeElementInstance",this._activeElementInstance);this.addStyleClass("sapUiVizkitRedlineDesignMode");this.removeStyleClass("sapUiVizkitRedlineInteractionMode");return this;};
e.prototype.stopAdding=function(){this._isAddingModeActive=false;this._setIsDrawingOn(false);this.setAggregation("activeElementInstance",null);this._activeElementInstance=null;this.addStyleClass("sapUiVizkitRedlineInteractionMode");this.removeStyleClass("sapUiVizkitRedlineDesignMode");return this;};
e.prototype._getOffset=function(o){var r=o.getBoundingClientRect();return{x:r.left+window.pageXOffset,y:r.top+window.pageYOffset};};
e.prototype._getTargetViewport=function(){return this._targetViewport;};
e.prototype._setTargetViewport=function(v){this._targetViewport=v;this._targetViewport.attachEvent("resize",this,this._onresize,this);};
e.prototype._onresize=function(f){var v=f.oSource.getOutputSize();this.setProperty("virtualLeft",v.left,true);this.setProperty("virtualTop",v.top,true);this.setProperty("virtualSideLength",v.sideLength,true);this.invalidate();};
return e;});
sap.ui.predefine('sap/ui/vk/RedlineDesignHandler',["jquery.sap.global","sap/ui/base/EventProvider","sap/ui/core/ResizeHandler"],function(q,E,R){"use strict";
var a=E.extend("RedlineDesignHandler",{
metadata:{publicMethods:["beginGesture","move","endGesture","click","doubleClick","contextMenu","getViewport"]},
constructor:function(r){this._redlineDesign=r;this._x=0;this._y=0;this._gesture=false;}
});
a.prototype.destroy=function(){this._redlineDesign=null;this._rect=null;this._gesture=false;};
a.prototype._getOffset=function(d){var r=d.getBoundingClientRect();return{x:r.left+window.pageXOffset,y:r.top+window.pageYOffset};};
a.prototype._inside=function(e,r){var b=r.getDomRef(),i=false;if(b!==null){var c=this._getOffset(b);var d={x:c.x,y:c.y,width:b.getBoundingClientRect().width,height:b.getBoundingClientRect().height};i=(e.x>=d.x&&e.x<=d.x+d.width&&e.y>=d.y&&e.y<=d.y+d.height);}return i;};
a.prototype._onresize=function(e){this._gesture=false;};
a.prototype.beginGesture=function(e){var v=this.getViewport();if(this._inside(e,v)&&v._activeElementInstance){this._gesture=true;this._x=e.x;this._y=e.y;v._setIsDrawingOn(true);var d=v.getDomRef();var t=v._toVirtualSpace(e.x-d.getBoundingClientRect().left-window.pageXOffset,e.y-d.getBoundingClientRect().top-window.pageYOffset);v._activeElementInstance.setOriginX(t.x);v._activeElementInstance.setOriginY(t.y);if(sap.ui.Device.browser.msie||sap.ui.Device.browser.edge){v.invalidate();}else{var r=sap.ui.getCore().createRenderManager();v._activeElementInstance.render(r);r.flush(v.getDomRef(),false,true);r.destroy();var x=v.$();x.html(x.html());}e.handled=true;}return this;};
a.prototype.move=function(e){var v=this.getViewport();if(v._activeElementInstance&&v._getIsDrawingOn()){var b=v.getDomRef().getBoundingClientRect(),o=e.x-b.left-window.pageXOffset,c=e.y-b.top-window.pageYOffset;v._editElement(v._activeElementInstance,o,c);}e.handled=true;return this;};
a.prototype.endGesture=function(e){var v=this.getViewport();this._gesture=false;if(v._activeElementInstance){v.addRedlineElement(v._activeElementInstance);v.fireElementCreated({element:v._activeElementInstance});v.stopAdding();}return this;};
a.prototype.click=function(e){};
a.prototype.doubleClick=function(e){};
a.prototype.contextMenu=function(e){e.handled=true;};
a.prototype.getViewport=function(){return this._redlineDesign;};
return a;},true);
sap.ui.predefine('sap/ui/vk/RedlineDesignRenderer',["jquery.sap.global","./RedlineSurfaceRenderer","sap/ui/core/Renderer"],function(q,R,a){"use strict";var b=a.extend(R);
b.render=function(r,c){R.render.call(this,r,c);};
b.renderAfterRedlineElements=function(r,c){if(c._activeElementInstance&&c._getIsDrawingOn()){c._activeElementInstance.render(r);}};
return b;},true);
sap.ui.predefine('sap/ui/vk/RedlineElement',["jquery.sap.global","sap/ui/core/Element"],function(q,E){"use strict";
var R=E.extend("sap.ui.vk.RedlineElement",{metadata:{library:"sap.ui.vk",properties:{originX:{type:"float",defaultValue:0},originY:{type:"float",defaultValue:0},opacity:{type:"float",defaultValue:1},strokeWidth:{type:"float",defaultValue:2},strokeColor:{type:"sap.ui.core.CSSColor",defaultValue:"#e6600d"},strokeDashArray:{type:"float[]",defaultValue:[]}}}});
R.prototype.init=function(){};
R.prototype.applyZoom=function(){};
R.prototype.render=function(r){};
R.prototype.exportJSON=function(){var j={originX:this.getOriginX(),originY:this.getOriginY(),opacity:this.getOpacity(),strokeColor:this.getStrokeColor(),strokeWidth:this.getStrokeWidth()};if(this.getStrokeDashArray().length>0){j["strokeDashArray"]=this.getStrokeDashArray();}return j;};
R.prototype.importJSON=function(j){if(j.hasOwnProperty("originX")){this.setOriginX(j.originX);}if(j.hasOwnProperty("originY")){this.setOriginY(j.originY);}if(j.hasOwnProperty("opacity")){this.setOpacity(j.opacity);}if(j.hasOwnProperty("strokeColor")){this.setStrokeColor(j.strokeColor);}if(j.hasOwnProperty("strokeWidth")){this.setStrokeWidth(j.strokeWidth);}if(j.hasOwnProperty("strokeDashArray")){this.setStrokeDashArray(j.strokeDashArray);}return this;};
R.prototype.exportSVG=function(){return null;};
R.prototype.importSVG=function(s){if(s.getAttribute("x")){this.setOriginX(parseFloat(s.getAttribute("x")));}if(s.getAttribute("y")){this.setOriginY(parseFloat(s.getAttribute("y")));}if(s.getAttribute("opacity")){this.setOpacity(parseFloat(s.getAttribute("opacity")));}if(s.getAttribute("stroke")){this.setStrokeColor(s.getAttribute("stroke"));}if(s.getAttribute("stroke-width")){this.setStrokeWidth(parseFloat(s.getAttribute("stroke-width")));}if(s.getAttribute("stroke-dasharray")){this.setStrokeDashArray(s.getAttribute("stroke-dasharray").split(",").map(parseFloat));}return this;};
return R;});
sap.ui.predefine('sap/ui/vk/RedlineElementEllipse',["jquery.sap.global","./RedlineElement"],function(q,R){"use strict";
var a=R.extend("sap.ui.vk.RedlineElementEllipse",{metadata:{library:"sap.ui.vk",properties:{radiusX:{type:"float",defaultValue:0.0001},radiusY:{type:"float",defaultValue:0.0001},fillColor:{type:"sap.ui.core.CSSColor",defaultValue:"rgba(0, 0, 0, 0)"}}}});
a.prototype.init=function(){};
a.prototype.edit=function(o,b){var p=this.getParent(),t=p._toVirtualSpace(o,b),r=t.x-this.getOriginX(),c=t.y-this.getOriginY();this.setRadiusX(r>0?r:-r);this.setRadiusY(c>0?c:-c);return this;};
a.prototype.applyZoom=function(z){this.setProperty("radiusX",this.getRadiusX()*z,true);this.setProperty("radiusY",this.getRadiusY()*z,true);return this;};
a.prototype.setRadiusX=function(r){this.setProperty("radiusX",r,true);var d=this.getDomRef();if(d){d.setAttribute("rx",this.getParent()._toPixelSpace(r));}};
a.prototype.setRadiusY=function(r){this.setProperty("radiusY",r,true);var d=this.getDomRef();if(d){d.setAttribute("ry",this.getParent()._toPixelSpace(r));}};
a.prototype.render=function(r){var p=this.getParent();r.write("<ellipse");r.writeElementData(this);var o=p._toPixelSpace(this.getOriginX(),this.getOriginY());r.writeAttribute("cx",o.x);r.writeAttribute("cy",o.y);r.writeAttribute("rx",p._toPixelSpace(this.getRadiusX()));r.writeAttribute("ry",p._toPixelSpace(this.getRadiusY()));r.writeAttribute("fill",this.getFillColor());r.writeAttribute("stroke",this.getStrokeColor());r.writeAttribute("stroke-width",this.getStrokeWidth());if(this.getStrokeDashArray().length>0){r.writeAttribute("stroke-dasharray",this.getStrokeDashArray().toString());}r.writeAttribute("opacity",this.getOpacity());r.write("></ellipse>");};
a.prototype.exportJSON=function(){return q.extend(true,R.prototype.exportJSON.call(this),{type:sap.ui.vk.Redline.ElementType.Ellipse,version:1,radiusX:this.getRadiusX(),radiusY:this.getRadiusY(),fillColor:this.getFillColor()});};
a.prototype.importJSON=function(j){if(j.type===sap.ui.vk.Redline.ElementType.Ellipse){if(j.version===1){R.prototype.importJSON.call(this,j);if(j.hasOwnProperty("radiusX")){this.setRadiusX(j.radiusX);}if(j.hasOwnProperty("radiusY")){this.setRadiusY(j.radiusY);}if(j.hasOwnProperty("fillColor")){this.setFillColor(j.fillColor);}}else{q.sap.log.error("wrong version number");}}else{q.sap.log.error("Redlining JSON import: Wrong element type");}return this;};
a.prototype.exportSVG=function(){var e=document.createElementNS(sap.ui.vk.Redline.svgNamespace,"ellipse");e.setAttribute("x",this.getOriginX());e.setAttribute("y",this.getOriginY());e.setAttribute("rx",this.getRadiusX());e.setAttribute("ry",this.getRadiusY());e.setAttribute("fill",this.getFillColor());e.setAttribute("stroke",this.getStrokeColor());e.setAttribute("stroke-width",this.getStrokeWidth());if(this.getStrokeDashArray().length>0){e.setAttribute("stroke-dasharray",this.getStrokeDashArray().toString());}if(this.getOpacity()<1){e.setAttribute("opacity",this.getOpacity());}return e;};
a.prototype.importSVG=function(s){if(s.tagName==="ellipse"){R.prototype.importSVG.call(this,s);if(s.getAttribute("rx")){this.setRadiusX(parseFloat(s.getAttribute("rx")));}if(s.getAttribute("ry")){this.setRadiusY(parseFloat(s.getAttribute("ry")));}if(s.getAttribute("fill")){this.setFillColor(s.getAttribute("fill"));}}else{q.sap.log("Redlining SVG import: Wrong element type");}return this;};
return a;});
sap.ui.predefine('sap/ui/vk/RedlineElementFreehand',["jquery.sap.global","./RedlineElement"],function(q,R){"use strict";
var a=R.extend("sap.ui.vk.RedlineElementFreehand",{metadata:{library:"sap.ui.vk",properties:{path:{type:"float[]",defaultValue:null}}}});
a.prototype.init=function(){};
a.prototype.setPath=function(p){this.setProperty("path",p,true);var d=this.getDomRef();if(d){d.setAttribute("d",this._getProcessedPath());}};
a.prototype.edit=function(o,b){var p=this.getParent();var t=p._toVirtualSpace(o,b);var c=this.getPath()||[];c.push(t.x-this.getOriginX(),t.y-this.getOriginY());this.setPath(c);var d=this.getDomRef();if(d){d.setAttribute("d",this._getProcessedPath());}return this;};
a.prototype.applyZoom=function(z){this.setProperty("path",this.getPath().map(function(v){return v*z;}),true);return this;};
a.prototype._getProcessedPath=function(){var p=this.getParent(),o=p._toPixelSpace(this.getOriginX(),this.getOriginY());var d="";(this.getPath()||[]).forEach(function(e,i){e=p._toPixelSpace(e);if(i===0){d+="M "+(o.x+e);}else if(i===1){d+=" "+(o.y+e);}else{d+=" "+(i%2===0?"L "+(o.x+e):(o.y+e));}});return d;};
a.prototype.render=function(r){r.write("<path");r.writeElementData(this);r.writeAttribute("d",this._getProcessedPath());r.writeAttribute("stroke",this.getStrokeColor());r.writeAttribute("stroke-width",this.getStrokeWidth());if(this.getStrokeDashArray().length>0){r.writeAttribute("stroke-dasharray",this.getStrokeDashArray().toString());}r.writeAttribute("opacity",this.getOpacity());r.writeAttribute("fill","none");r.write("></path>");};
a.prototype.exportJSON=function(){return q.extend(true,R.prototype.exportJSON.call(this),{type:sap.ui.vk.Redline.ElementType.Freehand,version:1,path:(this.getPath()||[]).slice()});};
a.prototype.importJSON=function(j){if(j.type===sap.ui.vk.Redline.ElementType.Freehand){if(j.version===1){R.prototype.importJSON.call(this,j);if(j.hasOwnProperty("path")){this.setPath(j.path.slice());}}else{q.sap.log.error("wrong version number");}}else{q.sap.log.error("Redlining JSON import: Wrong element type");}return this;};
a.prototype.exportSVG=function(){var e=document.createElementNS(sap.ui.vk.Redline.svgNamespace,"path");e.setAttribute("x",this.getOriginX());e.setAttribute("y",this.getOriginY());e.setAttribute("d",this.getPath());e.setAttribute("fill","none");e.setAttribute("stroke",this.getStrokeColor());e.setAttribute("stroke-width",this.getStrokeWidth());if(this.getStrokeDashArray().length>0){e.setAttribute("stroke-dasharray",this.getStrokeDashArray().toString());}if(this.getOpacity()<1){e.setAttribute("opacity",this.getOpacity());}return e;};
a.prototype.importSVG=function(s){if(s.tagName==="path"){R.prototype.importSVG.call(this,s);if(s.getAttribute("d")){this.setPath(s.getAttribute("d").split(",").map(parseFloat));}}else{q.sap.log.error("Redlining SVG import: Wrong element type");}return this;};
return a;});
sap.ui.predefine('sap/ui/vk/RedlineElementLine',["jquery.sap.global","./RedlineElement"],function(q,R){"use strict";
var a=R.extend("sap.ui.vk.RedlineElementLine",{metadata:{library:"sap.ui.vk",properties:{deltaX:{type:"float",defaultValue:0},deltaY:{type:"float",defaultValue:0}}}});
a.prototype.edit=function(o,b){var p=this.getParent(),t=p._toVirtualSpace(o,b);this.setDeltaX(t.x-this.getOriginX());this.setDeltaY(t.y-this.getOriginY());return this;};
a.prototype.applyZoom=function(z){this.setProperty("deltaX",this.getDeltaX()*z);this.setProperty("deltaY",this.getDeltaY()*z);return this;};
a.prototype.getP2=function(v){return this.getParent()._toPixelSpace(this.getOriginX()+this.getDeltaX(),this.getOriginY()+this.getDeltaY());};
a.prototype.setDeltaX=function(v){this.setProperty("deltaX",v);var d=this.getDomRef();if(d){d.setAttribute("x2",this.getP2().x);}};
a.prototype.setDeltaY=function(v){this.setProperty("deltaY",v);var d=this.getDomRef();if(d){d.setAttribute("y2",this.getP2().y);}};
a.prototype.render=function(r){var p=this.getParent()._toPixelSpace(this.getOriginX(),this.getOriginY());var b=this.getP2();r.write("<line");r.writeElementData(this);r.writeAttribute("x1",p.x);r.writeAttribute("y1",p.y);r.writeAttribute("x2",b.x);r.writeAttribute("y2",b.y);r.writeAttribute("stroke",this.getStrokeColor());r.writeAttribute("stroke-width",this.getStrokeWidth());if(this.getStrokeDashArray().length>0){r.writeAttribute("stroke-dasharray",this.getStrokeDashArray().toString());}r.writeAttribute("opacity",this.getOpacity());r.write("></line>");};
a.prototype.exportJSON=function(){return q.extend(true,R.prototype.exportJSON.call(this),{type:sap.ui.vk.Redline.ElementType.Line,version:1,deltaX:this.getDeltaX(),deltaY:this.getDeltaY()});};
a.prototype.importJSON=function(j){if(j.type===sap.ui.vk.Redline.ElementType.Line){if(j.version===1){R.prototype.importJSON.call(this,j);if(j.hasOwnProperty("deltaX")){this.setDeltaX(j.deltaX);}if(j.hasOwnProperty("deltaY")){this.setDeltaY(j.deltaY);}}else{q.sap.log.error("wrong version number");}}else{q.sap.log.error("Redlining JSON import: Wrong element type");}return this;};
a.prototype.exportSVG=function(){var e=document.createElementNS(sap.ui.vk.Redline.svgNamespace,"line");e.setAttribute("x1",this.getOriginX());e.setAttribute("y1",this.getOriginY());e.setAttribute("x2",this.getOriginX()+this.getDeltaX());e.setAttribute("y2",this.getOriginY()+this.getDeltaY());e.setAttribute("stroke",this.getStrokeColor());e.setAttribute("stroke-width",this.getStrokeWidth());if(this.getStrokeDashArray().length>0){e.setAttribute("stroke-dasharray",this.getStrokeDashArray().toString());}if(this.getOpacity()<1){e.setAttribute("opacity",this.getOpacity());}return e;};
a.prototype.importSVG=function(s){if(s.tagName==="line"){R.prototype.importSVG.call(this,s);if(s.getAttribute("x1")){this.setOriginX(parseFloat(s.getAttribute("x1")));}if(s.getAttribute("y1")){this.setOriginY(parseFloat(s.getAttribute("y1")));}if(s.getAttribute("x2")){this.setDeltaX(parseFloat(s.getAttribute("x2"))-this.getOriginX());}if(s.getAttribute("y2")){this.setDeltaY(parseFloat(s.getAttribute("y2"))-this.getOriginY());}}else{q.sap.log("Redlining SVG import: Wrong element type");}return this;};
return a;});
sap.ui.predefine('sap/ui/vk/RedlineElementRectangle',["jquery.sap.global","./RedlineElement"],function(q,R){"use strict";
var a=R.extend("sap.ui.vk.RedlineElementRectangle",{metadata:{library:"sap.ui.vk",properties:{width:{type:"float",defaultValue:0.001},height:{type:"float",defaultValue:0.001},fillColor:{type:"sap.ui.core.CSSColor",defaultValue:"rgba(0, 0, 0, 0)"}}}});
a.prototype.init=function(){this._originX=0;this._originY=0;};
a.prototype.setOriginX=function(o){this.setProperty("originX",o);this._originX=o;};
a.prototype.setOriginY=function(o){this.setProperty("originY",o);this._originY=o;};
a.prototype.edit=function(o,b){var p=this.getParent(),t=p._toVirtualSpace(o,b),w=t.x-this._originX,h=t.y-this._originY;this.setProperty("originX",w<0?t.x:this._originX);this.setProperty("originY",h<0?t.y:this._originY);this.setWidth(Math.abs(w));this.setHeight(Math.abs(h));return this;};
a.prototype.applyZoom=function(z){this.setProperty("width",this.getWidth()*z,true);this.setProperty("height",this.getHeight()*z,true);return this;};
a.prototype.setWidth=function(w){this.setProperty("width",w,true);var d=this.getDomRef();if(d){d.setAttribute("width",this.getParent()._toPixelSpace(w));}};
a.prototype.setHeight=function(h){this.setProperty("height",h,true);var d=this.getDomRef();if(d){d.setAttribute("height",this.getParent()._toPixelSpace(h));}};
a.prototype.render=function(r){var p=this.getParent();r.write("<rect");r.writeElementData(this);var o=p._toPixelSpace(this.getOriginX(),this.getOriginY());r.writeAttribute("x",o.x);r.writeAttribute("y",o.y);r.writeAttribute("width",p._toPixelSpace(this.getWidth()));r.writeAttribute("height",p._toPixelSpace(this.getHeight()));r.writeAttribute("fill",this.getFillColor());r.writeAttribute("stroke",this.getStrokeColor());r.writeAttribute("stroke-width",this.getStrokeWidth());if(this.getStrokeDashArray().length>0){r.writeAttribute("stroke-dasharray",this.getStrokeDashArray().toString());}r.writeAttribute("opacity",this.getOpacity());r.write("></rect>");};
a.prototype.exportJSON=function(){return q.extend(true,R.prototype.exportJSON.call(this),{type:sap.ui.vk.Redline.ElementType.Rectangle,version:1,width:this.getWidth(),height:this.getHeight(),fillColor:this.getFillColor()});};
a.prototype.importJSON=function(j){if(j.type===sap.ui.vk.Redline.ElementType.Rectangle){if(j.version===1){R.prototype.importJSON.call(this,j);if(j.hasOwnProperty("width")){this.setWidth(j.width);}if(j.hasOwnProperty("height")){this.setHeight(j.height);}if(j.hasOwnProperty("fillColor")){this.setFillColor(j.fillColor);}}else{q.sap.log("wrong version number");}}else{q.sap.log("Redlining JSON import: Wrong element type");}return this;};
a.prototype.exportSVG=function(){var e=document.createElementNS(sap.ui.vk.Redline.svgNamespace,"rect");e.setAttribute("x",this.getOriginX());e.setAttribute("y",this.getOriginY());e.setAttribute("height",this.getHeight());e.setAttribute("width",this.getWidth());e.setAttribute("fill",this.getFillColor());e.setAttribute("stroke",this.getStrokeColor());e.setAttribute("stroke-width",this.getStrokeWidth());if(this.getStrokeDashArray().length>0){e.setAttribute("stroke-dasharray",this.getStrokeDashArray().toString());}if(this.getOpacity()<1){e.setAttribute("opacity",this.getOpacity());}return e;};
a.prototype.importSVG=function(s){if(s.tagName==="rect"){R.prototype.importSVG.call(this,s);if(s.getAttribute("width")){this.setWidth(parseFloat(s.getAttribute("width")));}if(s.getAttribute("height")){this.setHeight(parseFloat(s.getAttribute("height")));}if(s.getAttribute("fill")){this.setFillColor(s.getAttribute("fill"));}}else{q.sap.log("Redlining SVG import: Wrong element type");}return this;};
return a;});
sap.ui.predefine('sap/ui/vk/RedlineElementText',["jquery.sap.global","./RedlineElement"],function(q,R){"use strict";
var a=R.extend("sap.ui.vk.RedlineElementText",{metadata:{library:"sap.ui.vk",properties:{text:{type:"string",defaultValue:"Text"},font:{type:"string",defaultValue:""},fontSize:{type:"float",defaultValue:32},fillColor:{type:"sap.ui.core.CSSColor",defaultValue:"rgba(0,0,0,0)"}}}});
a.prototype.edit=function(p,b){var c=this.getParent(),d=c._toVirtualSpace(p,b);this.setOriginX(d.x);this.setOriginY(d.y);return this;};
a.prototype.applyZoom=function(z){this.setFontSize(this.getFontSize()*z);return this;};
a.prototype.render=function(r){var p=this.getParent()._toPixelSpace(this.getOriginX(),this.getOriginY());r.write("<text");r.writeElementData(this);r.writeAttribute("x",p.x);r.writeAttribute("y",p.y);if(this.getFont()){r.writeAttribute("font-family",this.getFont());}r.writeAttribute("font-size",this.getFontSize());r.writeAttribute("fill",this.getFillColor());r.writeAttribute("stroke",this.getStrokeColor());r.writeAttribute("stroke-width",this.getStrokeWidth());if(this.getStrokeDashArray().length>0){r.writeAttribute("stroke-dasharray",this.getStrokeDashArray().toString());}r.writeAttribute("opacity",this.getOpacity());r.write(">");r.write(this.getText());r.write("</text>");};
a.prototype.exportJSON=function(){return q.extend(true,R.prototype.exportJSON.call(this),{type:sap.ui.vk.Redline.ElementType.Text,version:1,text:this.getText(),font:this.getFont(),fontSize:this.getFontSize(),fillColor:this.getFillColor()});};
a.prototype.importJSON=function(j){if(j.type===sap.ui.vk.Redline.ElementType.Text){if(j.version===1){R.prototype.importJSON.call(this,j);if(j.hasOwnProperty("text")){this.setText(j.text);}if(j.hasOwnProperty("font")){this.setFont(j.font);}if(j.hasOwnProperty("fontSize")){this.setFontSize(j.fontSize);}if(j.hasOwnProperty("fillColor")){this.setFillColor(j.fillColor);}}else{q.sap.log.error("wrong version number");}}else{q.sap.log.error("Redlining JSON import: Wrong element type");}return this;};
a.prototype.exportSVG=function(){var e=document.createElementNS(sap.ui.vk.Redline.svgNamespace,"text");e.setAttribute("x",this.getOriginX());e.setAttribute("y",this.getOriginY());if(this.getFont()){e.setAttribute("font-family",this.getFont());}e.setAttribute("font-size",this.getFontSize());e.setAttribute("fill",this.getFillColor());e.setAttribute("stroke",this.getStrokeColor());e.setAttribute("stroke-width",this.getStrokeWidth());if(this.getStrokeDashArray().length>0){e.setAttribute("stroke-dasharray",this.getStrokeDashArray().toString());}if(this.getOpacity()<1){e.setAttribute("opacity",this.getOpacity());}e.textContent=this.getText();return e;};
a.prototype.importSVG=function(e){if(e.tagName==="text"){R.prototype.importSVG.call(this,e);if(e.getAttribute("x")){this.setOriginX(parseFloat(e.getAttribute("x")));}if(e.getAttribute("y")){this.setOriginY(parseFloat(e.getAttribute("y")));}if(e.getAttribute("text")){this.setText(e.getAttribute("text"));}if(e.getAttribute("font-family")){this.setFont(e.getAttribute("font-family"));}if(e.getAttribute("font-size")){this.setFontSize(parseFloat(e.getAttribute("font-size")));}if(e.getAttribute("fill")){this.setFillColor(e.getAttribute("fill"));}}else{q.sap.log("Redlining SVG import: Wrong element type");}return this;};
return a;});
sap.ui.predefine('sap/ui/vk/RedlineGesturesHandler',["jquery.sap.global","sap/ui/base/EventProvider","sap/ui/core/ResizeHandler"],function(q,E,R){"use strict";
var a=E.extend("RedlineGesturesHandler",{
metadata:{publicMethods:["beginGesture","move","endGesture","click","doubleClick","contextMenu","getViewport"]},
constructor:function(r){this._redlineDesign=r;this._x=0;this._y=0;this._gesture=false;var v=this.getViewport();v._currentPosition={x:0,y:0};v._totalMoveX=0;v._totalMoveY=0;}
});
a.prototype.destroy=function(){this._redlineDesign=null;this._rect=null;this._gesture=false;};
a.prototype._getOffset=function(d){var r=d.getBoundingClientRect();return{x:r.left+window.pageXOffset,y:r.top+window.pageYOffset};};
a.prototype._inside=function(e,r){var b=r.getDomRef(),i=false;if(b!==null){var c=this._getOffset(b);var d={x:c.x,y:c.y,width:b.getBoundingClientRect().width,height:b.getBoundingClientRect().height};i=(e.x>=d.x&&e.x<=d.x+d.width&&e.y>=d.y&&e.y<=d.y+d.height);}return i;};
a.prototype._onresize=function(e){this._gesture=false;};
a.prototype.beginGesture=function(e){var v=this.getViewport();if(this._inside(e,v)){this._gesture=true;this._x=e.x;this._y=e.y;var o=this._getOffset(v.getDomRef());this._gestureOriginX=e.x-o.x;this._gestureOriginY=e.y-o.y;this._distanceBetweenTouchPoints=null;if(e.n===1){this._lastMoveCoordinates={};this._totalDeltaMove={x:0,y:0};}e.handled=true;}return this;};
a.prototype._pan=function(e){if(this._totalDeltaMove){var v=this.getViewport(),d=e.x-(this._lastMoveCoordinates.x||e.x),b=e.y-(this._lastMoveCoordinates.y||e.y);this._totalDeltaMove.x+=d;this._totalDeltaMove.y+=b;if(d||b){var p=v.getPanningRatio();v.firePan({deltaX:d*p,deltaY:b*p});v.getRedlineElements().forEach(function(c){c.setOriginX(c.getOriginX()+v._toVirtualSpace(d));c.setOriginY(c.getOriginY()+v._toVirtualSpace(b));});this._manualRender(v);}this._lastMoveCoordinates.x=e.x;this._lastMoveCoordinates.y=e.y;}else{this._totalDeltaMove={x:0,y:0};this._lastMoveCoordinates={};}};
a.prototype._zoom=function(e){var v=this.getViewport(),z;if(e.scroll!==undefined){if(e.scroll>0){z=1.05;}else if(e.scroll<0){z=1/1.05;}else if(this._distanceBetweenTouchPoints!==null){var d=e.d-this._distanceBetweenTouchPoints;if(d>0){z=1.05;}else if(d<0){z=1/1.05;}else{return;}this._distanceBetweenTouchPoints=e.d;}else{this._distanceBetweenTouchPoints=e.d;return;}}else if(e.points[0].y<e.points[1].y){z=1.05;}else{z=1/1.05;}var t=v._getTargetViewport();if(t instanceof sap.ui.vk.NativeViewport){var b=t._getZoomInLimit();var c=t._getZoomOutLimit();var f=t._getZoomFactor();var n=f*z;if(n>b){z=b/f;}else if(n<c){z=c/f;}}var s=1-z,p=v._toVirtualSpace(this._gestureOriginX,this._gestureOriginY);v.getRedlineElements().forEach(function(g){g.applyZoom(z);var o=g.getOriginX(),h=g.getOriginY();o+=(p.x-o)*s;h+=(p.y-h)*s;g.setOriginX(o);g.setOriginY(h);});this._manualRender(v);v.fireZoom({originX:this._gestureOriginX,originY:this._gestureOriginY,zoomFactor:z});};
a.prototype.move=function(e){if(this.getViewport().getDomRef()){if(e.n===2&&(e.buttons===4||e.buttons===3)||e.n===1){this._pan(e);}else if((e.n===2&&e.buttons===2)||(sap.ui.Device.system.tablet&&e.n===2&&e.buttons===0)){this._zoom(e);}}e.handled=true;return this;};
a.prototype._manualRender=function(r){if(sap.ui.Device.browser.msie||sap.ui.Device.browser.edge){r.invalidate();}else{var b=sap.ui.getCore().createRenderManager();r.getRedlineElements().forEach(function(e){e.render(b);});b.flush(r.getDomRef(),false,false);b.destroy();var x=r.$();x.html(x.html());}};
a.prototype.endGesture=function(e){this._gestureOriginX=0;this._gestureOriginY=0;this._lastMoveCoordinates={};this._totalDeltaMove={x:0,y:0};this._gesture=false;e.handled=true;return this;};
a.prototype.click=function(e){};
a.prototype.doubleClick=function(e){};
a.prototype.contextMenu=function(e){e.handled=true;};
a.prototype.getViewport=function(){return this._redlineDesign;};
return a;},true);
sap.ui.predefine('sap/ui/vk/RedlineSurface',["jquery.sap.global","./library","sap/ui/core/Control","./Loco","./RedlineGesturesHandler","./RedlineSurfaceRenderer"],function(q,l,C,L,R){"use strict";
var a=C.extend("sap.ui.vk.RedlineSurface",{metadata:{library:"sap.ui.vk",aggregations:{redlineElements:{type:"sap.ui.vk.RedlineElement"}},properties:{virtualLeft:{type:"float"},virtualTop:{type:"float"},virtualSideLength:{type:"float"},panningRatio:{type:"float",defaultValue:1}},events:{pan:{parameters:{deltaX:"float",deltaY:"float"}},zoom:{parameters:{originX:"float",originY:"float",zoomFactor:"float"}}}}});
a.prototype.init=function(){};
a.prototype.onAfterRendering=function(){};
a.prototype.exportJSON=function(){return this.getRedlineElements().map(function(e){return e.exportJSON();});};
a.prototype.importJSON=function(j){if(!q.isArray(j)){j=[j];}j.forEach(function(b){var E;switch(b.type){case sap.ui.vk.Redline.ElementType.Rectangle:E=sap.ui.vk.RedlineElementRectangle;break;case sap.ui.vk.Redline.ElementType.Ellipse:E=sap.ui.vk.RedlineElementEllipse;break;case sap.ui.vk.Redline.ElementType.Freehand:E=sap.ui.vk.RedlineElementFreehand;break;case sap.ui.vk.Redline.ElementType.Line:E=sap.ui.vk.RedlineElementLine;break;case sap.ui.vk.Redline.ElementType.Text:E=sap.ui.vk.RedlineElementText;break;default:q.sap.log.warning("Unsupported JSON element type "+b.type);}this.addRedlineElement(new E().importJSON(b));}.bind(this));return this;};
a.prototype._toVirtualSpace=function(x,y){if(arguments.length===1){return x/this.getVirtualSideLength();}else{return{x:(x-this.getVirtualLeft())/this.getVirtualSideLength(),y:(y-this.getVirtualTop())/this.getVirtualSideLength()};}};
a.prototype._toPixelSpace=function(x,y){if(arguments.length===1){return x*this.getVirtualSideLength();}else{return{x:x*this.getVirtualSideLength()+this.getVirtualLeft(),y:y*this.getVirtualSideLength()+this.getVirtualTop()};}};
a.prototype.setPanningRatio=function(p){this.setProperty("panningRatio",p,true);};
a.prototype.updatePanningRatio=function(){var v=this.getVirtualLeft(),b=this.getVirtualTop(),r=this.getDomRef(),c=r.getBoundingClientRect(),h=c.height,w=c.width,p;if(v===0&&(h<w&&b<0||(h>w&&b>0))){p=h/w;}else{p=1;}this.setPanningRatio(p);return this;};
a.prototype.exportSVG=function(){var s=document.createElementNS(sap.ui.vk.Redline.svgNamespace,"svg");this.getRedlineElements().map(function(e){s.appendChild(e.exportSVG());});return s;};
a.prototype.importSVG=function(s){s.childNodes.forEach(function(t){if(t.getAttribute){var E;switch(t.tagName){case"rect":E=sap.ui.vk.RedlineElementRectangle;break;case"ellipse":E=sap.ui.vk.RedlineElementEllipse;break;case"path":E=sap.ui.vk.RedlineElementFreehand;break;case"line":E=sap.ui.vk.RedlineElementLine;break;case"text":E=sap.ui.vk.RedlineElementText;break;default:q.sap.log.warning("Unsupported SVG element type "+E);}if(E){this.addRedlineElement(new E().importSVG(t));}}}.bind(this));return this;};
return a;});
sap.ui.predefine('sap/ui/vk/RedlineSurfaceRenderer',["jquery.sap.global"],function(q){"use strict";var R={};
R.render=function(r,c){r.write("<svg");r.writeControlData(c);r.addClass("sapUiVizkitRedlineSurface");r.writeClasses();r.write(">");c.getRedlineElements().forEach(function(a){a.render(r);});this.renderAfterRedlineElements(r,c);r.write("</svg>");};
R.renderAfterRedlineElements=function(r,c){};
return R;},true);
sap.ui.predefine('sap/ui/vk/Scene',["jquery.sap.global","sap/ui/base/ManagedObject"],function(q,B){"use strict";
var S=B.extend("sap.ui.vk.Scene",{metadata:{"abstract":true,properties:{doubleSided:{type:"boolean",defaultValue:false}}}});
return S;});
sap.ui.predefine('sap/ui/vk/SceneTree',["jquery.sap.global","./library","sap/ui/core/Control","sap/ui/table/TreeTable","sap/ui/table/Column","sap/ui/model/json/JSONModel","sap/ui/core/ResizeHandler","sap/m/Title","sap/m/SearchField","sap/m/Toolbar","sap/m/ToolbarLayoutData","sap/m/ToolbarSpacer","sap/m/Text","sap/ui/core/Icon","./ContentConnector","./ViewStateManager","./SceneTreeRenderer"],function(q,a,C,T,b,J,R,c,S,d,e,f,g,I,h,V,j){"use strict";
var k=C.extend("sap.ui.vk.SceneTree",{metadata:{library:"sap.ui.vk",properties:{title:{type:"string",defaultValue:sap.ui.vk.getResourceBundle().getText("SCENETREE_TITLE")},showTitle:{type:"boolean",defaultValue:true},showSearchField:{type:"boolean",defaultValue:true}},aggregations:{treeTable:{type:"sap.ui.table.TreeTable",multiple:false}},associations:{contentConnector:{type:"sap.ui.vk.ContentConnector",multiple:false},viewStateManager:{type:"sap.ui.vk.ViewStateManager",multiple:false}},events:{contentChanged:{enableEventBubbling:true}}}});
var m="sap-icon://show",n="sap-icon://hide";var t=sap.ui.vk.getResourceBundle().getText("SCENETREE_VISIBILITYSTATEVISIBLE"),o=sap.ui.vk.getResourceBundle().getText("SCENETREE_VISIBILITYSTATEHIDDEN");
k.prototype._createNodeForSceneTree=function(i,l,v){var p=v.getVisibilityState(l);return{name:i,id:l,visible:p};};
k.prototype.setScene=function(s,v){this.setViewStateManager(v);this._setScene(s);};
k.prototype._setScene=function(s){this._scene=s;this.refresh();};
k.prototype.init=function(){if(C.prototype.init){C.prototype.init.apply(this);}var i=this;this._title=new c({width:"100%",textAlign:sap.ui.core.TextAlign.Center,text:this.getTitle()});this._searchField=new S({layoutData:new e({shrinkable:true,maxWidth:"400px"}),search:function(l){var p=l.getParameter("query"),r=i._scene.getDefaultNodeHierarchy(),s=i._viewStateManager;if(r&&s){var u=!p?[]:r.findNodesByName({value:p,predicate:"contains"});var w=new Set(u);var x=[];s.enumerateSelection(function(y){if(!w.has(y)){x.push(y);}});s.setSelectionState(x,false,false);s.setSelectionState(u,true,false);}}});this._toolbar=new d({content:[this._title,new f(),this._searchField]});var v=new I({src:m,tooltip:t,width:"2em",height:"1.3em",size:"1.2em",press:function(l){var p=this.getSrc()!==m;this.setSrc(p?m:n);this.setTooltip(p?t:o);i._toggleVisibilityForAllChildren(i._model.getData(),p);}});this._tree=new T({title:this._toolbar,columnHeaderHeight:32,columns:[new b({label:sap.ui.vk.getResourceBundle().getText("SCENETREE_NAME"),tooltip:sap.ui.vk.getResourceBundle().getText("SCENETREE_NAME"),template:new g({text:"{name}",maxLines:1,tooltip:"{name}"}),resizable:false}),new b(this.getId()+"-visibilityColumn",{label:v,template:new I({src:{path:"",formatter:function(l){if(!l){return null;}return l.visible?m:n;}},tooltip:{path:"",formatter:function(l){if(!l){return null;}return l.visible?t:o;}},width:"2em",height:"1.3em",size:"1.2em",press:function(l){var p=i._tree.getContextByIndex(this.getParent().getIndex());var r=p?p.getObject():null;if(r){i._viewStateManager.setVisibilityState(r.id,!r.visible,true);}}}),width:"2.5em",resizable:false,hAlign:"Center"})],enableSelectAll:false,selectionMode:"MultiToggle",selectionBehavior:"RowSelector",visibleRowCountMode:"Fixed",expandFirstLevel:false,collapseRecursive:false,rowHeight:32});this.setAggregation("treeTable",this._tree);this.attachContentChanged(function(l){v.setSrc(m);v.setTooltip(t);});this._scene=null;this._syncing=false;this._updateSelectionTimer=0;this._updateVisibilityTimer=0;this._model=new J();this._tree.setModel(this._model);this._tree.bindRows({path:"/"});this._tree.attachRowSelectionChange(this._handleRowSelectionChange.bind(this));this._tree.attachFirstVisibleRowChanged(this._updateSelection.bind(this));this._tree.getBinding("rows").attachChange(this._dataChange.bind(this));};
k.prototype.setTitle=function(v){this.setProperty("title",v,true);this._title.setText(v);return this;};
k.prototype.setShowTitle=function(v){this.setProperty("showTitle",v,true);this._title.setVisible(v);this._updateTitleBar();return this;};
k.prototype.setShowSearchField=function(v){this.setProperty("showSearchField",v,true);this._searchField.setVisible(v);this._updateTitleBar();return this;};
k.prototype._updateTitleBar=function(){this._tree.setTitle(this.getShowTitle()||this.getShowSearchField()?this._toolbar:null);this._handleResize();};
k.prototype.onBeforeRendering=function(){this._tree.setVisible(true);if(!this._resizeListenerId){this._resizeListenerId=R.register(this,this._handleResize.bind(this));}};
k.prototype._handleRowSelectionChange=function(l){if(this._syncing||this._tree.getBinding("rows")._aSelectedContexts!=undefined){return;}var s=[];var p=[];var r=l.getParameter("rowIndices");for(var i in r){var u=r[i];var v=this._tree.getContextByIndex(u);var w=v?v.getObject().id:null;if(w){(this._tree.isIndexSelected(u)?s:p).push(w);}}if(s.length>0){this._viewStateManager.setSelectionState(s,true);}if(p.length>0){this._viewStateManager.setSelectionState(p,false);}};
k.prototype._handleSelectionChanged=function(p){if(this._syncing){return;}function r(u,v){var w=u.getBinding("rows");if(w){for(var i=u.getFirstVisibleRow(),l=Math.min(i+u.getVisibleRowCount(),w.getLength());i<l;i++){var x=w.getContextByIndex(i);if(x&&x.getObject().id===v){return true;}}}return false;}var s=p.getParameter("selected");if(s.length===1&&!r(this._tree,s[0])){if(this._updateSelectionTimer>0){clearTimeout(this._updateSelectionTimer);this._updateSelectionTimer=0;}this._expandToNode(s[0],this._updateSelection.bind(this));}else if(this._updateSelectionTimer===0){this._updateSelectionTimer=setTimeout(this._updateSelection.bind(this),0);}};
k.prototype._updateSelection=function(){this._updateSelectionTimer=0;if(this._syncing){return;}this._syncing=true;var v=this._viewStateManager,p=this._tree,r=p.getBinding("rows");if(v&&r){for(var i=p.getFirstVisibleRow(),l=Math.min(i+p.getVisibleRowCount(),r.getLength());i<l;i++){var s=r.getContextByIndex(i);if(s){var u=s.getObject().id;if(u){var w=v.getSelectionState(u);if(w!=p.isIndexSelected(i)){p[w?"addSelectionInterval":"removeSelectionInterval"](i,i);}}}}}this._syncing=false;};
k.prototype._expandToNode=function(i,l){var p={tree:this._tree,rows:this._tree.getBinding("rows"),index:0,nodeRef:i,ancestors:new Set(this._scene.getDefaultNodeHierarchy().getAncestors(i)),callback:l};function s(u,v,w){var x=u.getFirstVisibleRow(),y=u.getVisibleRowCount();if((v<x)||(v>=(x+y))){x=Math.min(Math.max(v-(y>>1),0),w-y);setTimeout(function(){u.setFirstVisibleRow(x);},0);}}function r(p,u){if(u&&u.getParameter("reason")!=="expand"){return;}var v=p.rows.getLength();while(p.index<v){var w=p.rows.getContextByIndex(p.index);if(!w){break;}var i=w.getObject().id;if(i===p.nodeRef){s(p.tree,p.index,v);break;}if(p.ancestors.has(i)&&!p.tree.isExpanded(p.index)){p.tree.expand(p.index++);return;}p.index++;}p.rows.detachChange(p.expandHandlerProxy);p.callback();}p.expandHandlerProxy=r.bind(this,p);p.rows.attachChange(p.expandHandlerProxy);r(p);};
k.prototype._dataChange=function(i){var r=i.getParameter("reason");if((r==="expand"||r==="collapse")&&this._updateSelectionTimer===0){this._updateSelectionTimer=setTimeout(this._updateSelection.bind(this),0);}};
k.prototype._toggleVisibilityForAllChildren=function(l,p){var r=l.hasOwnProperty("children")?l.children:l;for(var i=0;r[i]!=null;i++){this._viewStateManager.setVisibilityState(r[i].id,p,true);}};
k.prototype._handleVisibilityChanged=function(i){if(this._updateVisibilityTimer===0){this._updateVisibilityTimer=setTimeout(this._updateVisibility.bind(this),0);}};
k.prototype._updateVisibility=function(){this._updateVisibilityTimer=0;this._getNodeVisibilityRecursive(this._model.getData());this._tree.getModel().refresh(true);};
k.prototype._getNodeVisibilityRecursive=function(l){if(l.id!=null){l.visible=this._viewStateManager.getVisibilityState(l.id);}var p=l.hasOwnProperty("children")?l.children:l;for(var i=0;p[i]!=null;i++){this._getNodeVisibilityRecursive(p[i]);}};
k.prototype._handleResize=function(i){var l=i?i.size.height:this.getDomRef().clientHeight;var p=this._tree.getTitle()?2.1:1.1;this._tree.setVisibleRowCount(Math.max(Math.floor(l/(this._tree.getRowHeight()+1)-p),0));this._updateSelection();};
k.prototype.refresh=function(){if(!this._scene||!this._viewStateManager||!this._viewStateManager.getNodeHierarchy()){this._model.setData([]);return;}var i=this._scene.getDefaultNodeHierarchy();var l=[];var p=function(l,r){r.forEach(function(s,u){var v=i.createNodeProxy(s);var w=this._createNodeForSceneTree(v.getName(),v.getNodeRef(),this._viewStateManager);l[u]=w;i.destroyNodeProxy(v);w.children=[];p(w.children,i.getChildren(s));}.bind(this));}.bind(this);p(l,i.getChildren());this._model.setData(l);this._tree.setModel(this._model);this._tree.bindRows({path:"/",parameters:{arrayNames:["children"]}});this._tree.getBinding("rows").attachChange(this._dataChange.bind(this));this.fireContentChanged();};
k.prototype._onBeforeClearContentConnector=k.prototype._onBeforeClearViewStateManager=function(){this._setScene(null);};k.prototype._onAfterUpdateContentConnector=k.prototype._onAfterUpdateViewStateManager=function(){if(this._contentConnector){this._setContent(this._contentConnector.getContent());}};
k.prototype._setContent=function(i){this._setScene(i);};
k.prototype._handleContentReplaced=function(i){this._setContent(i.getParameter("newContent"));};
k.prototype._handleNodeHierarchyReplaced=function(i){this._setScene(this._scene);};
k.prototype._handleContentChangesFinished=function(i){this.refresh();};
h.injectMethodsIntoClass(k);V.injectMethodsIntoClass(k);return k;},true);
sap.ui.predefine('sap/ui/vk/SceneTreeRenderer',["jquery.sap.global"],function(q){"use strict";var S={};
S.render=function(r,c){r.write("<div");r.writeControlData(c);r.addClass("sapUiSizeCompact");r.addClass("sapUiVkSceneTree");r.writeClasses();r.write(">");r.renderControl(c.getAggregation("treeTable"));r.write("</div>");};
return S;},true);
sap.ui.predefine('sap/ui/vk/Smart2DHandler',["jquery.sap.global","sap/ui/base/EventProvider","sap/ui/core/ResizeHandler"],function(q,E,R){"use strict";
var S=E.extend("Smart2DHandler",{
metadata:{publicMethods:["beginGesture","move","endGesture","click","doubleClick","contextMenu","getViewport"]},
constructor:function(v,a){this._viewport=v;this._rect=null;this._x=0;this._y=0;this._gesture=false;this._hitEndTimer=0;this._lastRender=0;this._viewport.attachEvent("resize",this,this._onresize);this._viewStateManager=a;this._previousColoring={nodeRef:null,nodeId:null,color:null};}
});
S.prototype.destroy=function(){this._viewport=null;this._rect=null;this._gesture=false;this._viewport.detachEvent("resize",this,this._onresize);this._viewStateManager=null;this._previousColoring=null;};
S.prototype._getOffset=function(d){var r=d.getBoundingClientRect();var p={x:r.left+window.pageXOffset,y:r.top+window.pageYOffset};return p;};
S.prototype._inside=function(e){var v=this._viewport.getDomRef();if(v==null){return false;}var a=this._getOffset(v);this._rect={x:a.x,y:a.y,w:v.offsetWidth,h:v.offsetHeight};return(e.x>=this._rect.x&&e.x<=this._rect.x+this._rect.w&&e.y>=this._rect.y&&e.y<=this._rect.y+this._rect.h);};
S.prototype._onresize=function(e){this._gesture=false;this._rect=null;};
S.prototype.beginGesture=function(e){if(this._inside(e)){this._gesture=true;this._x=e.x;this._y=e.y;}};
S.prototype.callbackHover=function(){var n=this._viewStateManager.getNodeHierarchy();this._lastRender=Date.now();this._hitEndTimer=0;var h=this._viewport.hitTest(this._x,this._y);if(this._highlightedNodeRef!==h){if(this._highlightedNodeRef!==sap.ve.dvl.DVLID_INVALID){var t=this._highlightedNodeRef===this._previousColoring.nodeRef?this._previousColoring.color:0;this._viewport.showHotspots(this._highlightedNodeRef,true,t);}if(n.getHotspotNodeIds().indexOf(h)!==-1){var a=n.createNodeProxy(h);this._previousColoring={nodeRef:h,nodeId:h,color:a.getTintColorABGR()};n.destroyNodeProxy(a);this._viewport.showHotspots(h,true);}this._highlightedNodeRef=h;}this._viewport.renderFrame();};
S.prototype.hover=function(e){if(e.n==1&&this._inside(e)){this._x=e.x-this._rect.x;this._y=e.y-this._rect.y;if(!this.getViewport().getShowAllHotspots()){var t=Date.now();if(t-this._lastRender>20){this.callbackHover();}if(this._hitEndTimer!=0){clearTimeout(this._hitEndTimer);}this._hitEndTimer=setTimeout(this.callbackHover.bind(this),20);}e.handled=true;}};
S.prototype.move=function(e){if(this._gesture&&e.n==1){this._viewport.pan(e.x-this._x,e.y-this._y);this._x=e.x;this._y=e.y;e.handled=true;}};
S.prototype.endGesture=function(e){this._gesture=false;};
S.prototype.click=function(e){};
S.prototype.doubleClick=function(e){};
S.prototype.contextMenu=function(e){};
S.prototype.getViewport=function(){return this._viewport;};
return S;},true);
sap.ui.predefine('sap/ui/vk/StepNavigation',["jquery.sap.global","sap/ui/core/Control","sap/ui/core/ResizeHandler","./Messages","./DvlException","./ContentConnector","./StepNavigationRenderer"],function(q,C,R,M,D,a,S){"use strict";
var b=C.extend("sap.ui.vk.StepNavigation",{metadata:{library:"sap.ui.vk",properties:{settings:"object",width:{type:"sap.ui.core.CSSSize",defaultValue:"100%"},height:{type:"sap.ui.core.CSSSize",defaultValue:"100%"},showThumbnails:{type:"boolean",group:"Appearance",defaultValue:true},showToolbar:{type:"boolean",group:"Appearance",defaultValue:true},showStepInfo:{type:"boolean",group:"Appearance",defaultValue:false}},publicMethods:["setScene","playStep","pauseStep","playAllSteps","getStep","getNextStep","getPreviousStep","getProceduresAndSteps","refresh","clear"],associations:{contentConnector:{type:"sap.ui.vk.ContentConnector"}},aggregations:{procedureItemTemplate:{type:"sap.ui.core.Item",multiple:false},stepInfoPopup:{type:"sap.ui.core.Control",multiple:false},layout:{type:"sap.m.Toolbar",multiple:false},thumbnailsContainer:{type:"sap.m.Panel",multiple:false}},events:{"resize":{parameters:{oldSize:"object",size:"object"}},"stepChanged":{parameters:{clientId:"object",type:"object",stepId:"object"}}}}});
b.prototype._onStepEvent=function(p){var s=this.getSettings();this.instanceSettings.currentStepId=p.stepId;switch(p.type){case sap.ve.dvl.DVLSTEPEVENT.DVLSTEPEVENT_FINISHED:s.currentStepFinished=true;s.currentStepPaused=false;s.playAllActive=false;s.isPlaying=false;this._togglePlayPause(true);break;case sap.ve.dvl.DVLSTEPEVENT.DVLSTEPEVENT_SWITCHED:case sap.ve.dvl.DVLSTEPEVENT.DVLSTEPEVENT_STARTED:s.currentStepId=p.stepId;s.currentStepFinished=false;this._highlightStep(p.stepId);if(s.currentStepPaused){this.pauseStep();}break;default:q.sap.log.error(sap.ui.vk.getResourceBundle().getText(M.VIT12.summary),M.VIT12.code,"sap.ui.vk.StepNavigation");}this.fireStepChanged({clientId:p.clientId,type:p.type,stepId:p.stepId});};
b.prototype.setScene=function(s){if(this._scene){this.oDvl.Client.detachStepEvent(this._onStepEvent,this);this.oDvl=null;}if(s){var c=s.getMetadata().getName();if(c!=="sap.ui.vk.dvl.Scene"){return;}}this._scene=s;this.instanceSettings={};if(this._scene){this.oDvl=s.getGraphicsCore().getApi(sap.ui.vk.dvl.GraphicsCoreApi.LegacyDvl);this.oDvl.Client.attachStepEvent(this._onStepEvent,this);}delete this._procedures;var p=this.getProcedureList();var o=this.getSettings();o.reset();p.unbindItems();p.setSelectedItem(p.getFirstItem());if(o.stepInfo.stepMessagePopup){if(!o.stepInfo.stepMessagePopup.isOpen()){o.stepInfo.stepMessagePopup.close();}o.stepInfo.stepMessagePopup.destroy();o.stepInfo.stepMessagePopup=null;this.getShowStepInfoButton().setText(sap.ui.vk.getResourceBundle().getText("STEP_NAV_STEPDESCRIPTIONHEADING"));}var e=this._getStepThumbnails();this.oModel.setData(e);this._togglePlayPause(true);this._refreshControl();this.refresh();};
b.prototype.init=function(){this._emptyThumbnail="iVBORw0KGgoAAAANSUhEUgAAAE4AAAA8CAYAAADIQIzXAAAACXBIWXMAAAsTAAALEwEAmpwYAAAFFmlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDAgNzkuMTYwNDUxLCAyMDE3LzA1LzA2LTAxOjA4OjIxICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgKE1hY2ludG9zaCkiIHhtcDpDcmVhdGVEYXRlPSIyMDE4LTA2LTA1VDEzOjU1OjAzKzEyOjAwIiB4bXA6TW9kaWZ5RGF0ZT0iMjAxOC0wNi0wNVQxNDowMDo1MCsxMjowMCIgeG1wOk1ldGFkYXRhRGF0ZT0iMjAxOC0wNi0wNVQxNDowMDo1MCsxMjowMCIgZGM6Zm9ybWF0PSJpbWFnZS9wbmciIHBob3Rvc2hvcDpDb2xvck1vZGU9IjMiIHBob3Rvc2hvcDpJQ0NQcm9maWxlPSJzUkdCIElFQzYxOTY2LTIuMSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDoyNGZiYjQ5MS1mNzFkLTRmMTgtODA2Zi1iYjcxZjhhZTdhNjAiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6MjRmYmI0OTEtZjcxZC00ZjE4LTgwNmYtYmI3MWY4YWU3YTYwIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6MjRmYmI0OTEtZjcxZC00ZjE4LTgwNmYtYmI3MWY4YWU3YTYwIj4gPHhtcE1NOkhpc3Rvcnk+IDxyZGY6U2VxPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iY3JlYXRlZCIgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDoyNGZiYjQ5MS1mNzFkLTRmMTgtODA2Zi1iYjcxZjhhZTdhNjAiIHN0RXZ0OndoZW49IjIwMTgtMDYtMDVUMTM6NTU6MDMrMTI6MDAiIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkFkb2JlIFBob3Rvc2hvcCBDQyAoTWFjaW50b3NoKSIvPiA8L3JkZjpTZXE+IDwveG1wTU06SGlzdG9yeT4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz6QcBQiAAAGO0lEQVR4nO2ca1MbRxaGn+6emR7dzMUEOxRbla04H+LE+f+/YlO1oWIiA8IGhGQZJCSkkeZ28mEsOxtYRxoGIVx6vwip5tI8OrfuPho1DuIzoMZK82igxkEsDz2KxygNDB56EI9QA/3QI3isWoHLqRW4nHLmOdgYg1IgX0E6USp7TZKUNJVP72fVXOCiKEJEUPPeZUklIhhj0Hp+Y5gJnFIKx9EcHBxzeXmJtTbPOJdKIkIcx7x48QObm0+YTJK5zp/b4iaTyVw3WFZNwaVpmuv8uWOc4zg4zlynLaXko2/mDTuFEJBHki2KjM13AqeUIkkSoiieOystUiKgtcJ13cKueSdwYRiyvr7O8+fPiOMUWE7LM8YQBAHNZhMoxvLuBC5JYqz12dhcyz5YTm6gYDQscXZ2lr19aHBTV5UUoihd2ljneYYwDAu95mrKlVMrcDn1qAqyLDtqXFehFCQJxPF8FX9RWig4EXAcgzFZTJx3cu2XDEkMvd6AJEkol8uUKx5xJMRxutCSaGHgRMB1DXGcMByOqVQqwOwJxfMMve6Ak5MTrq+vSdMUz/PY2dnh22+f4zh6ofAWEuNEwPUMIsL+/mt+/fU/XF1d4Vk906qEtYbBYMje3h69Xg/HcbDWEscx9Xqdw6MG2ii0XpzJ3Ts4ETBGYwy8e3dCt9vFdV0ajSPCMMH3zUzwWq0WaZpSLpc/1WGu61KplGm3WvS6fTxvcbnu3u+ktcL1FCfvzmk2m1QqFXzfZzwOqP9RJ0kEx/n/w8iq/pjB4BrP8264ttYGgPE4gAXGuHsH51lN67zD4eEBruugtUZE8P0SnU6Hs7NzHFfNYHVfPmDRtfe9gRMB6xtGw5Dj4wbWWhzH+R+LKZVKtFrnBMMQv3S7y6Zpil9yqFSqhGF4Y7qUpsmnay1yyncv4ESy0mE0GrO3t0eayq1u5rouURSx/8c+cZTieTfhiQgI7O7u4jgOo9GIKaE4jhmNRuzu7rKx8YQwzLcomUeFgxMRrG9IYuH17/tMJmOstbeWHZnL+vT7VzQax2jDrZkxDBOqVZ+XL3+kVqsxmYSMx2OUUnz//Qu+++5fJImQposzuULruKxWc1AK3rw5ZDgcUqlUvliriQjlcoV2u8Xm5lOebq0xDpIb9dhkkrC+8YSfq6/o9XrEcUy1WqVa84lCIUkecQFsjMI4cFA/pt1u/SO0qbTWGGM4OjqkWv0Fax0mk5vwxkGCMZqtrXVQkCYwGWcxbtELqYW6qutpTk/anDVPKZfLM58nInieJQgCDg+PUCqr/f4upbJkMR4nRKGgTZaArG8+Zusi/5svqzBwntVcXlzx9m0D31q0nu/SmcuW6XTec3raxvXUjSwpkq0B+iWD1ormWZs39SPety/QOvvccWYrqO+qQlxVabgeBNTr9WwP1nVzLWoqpbDWcnr6ls3NDcoVj3GQuaIxOoMJdN5f0GyeMxj0SdOUdrvN2toaW99ssbmxiV9yQCCKJPf23z+psBg3HI6I4xjf93OvBIsIrusSBAEHB2/46eeXWGtQGpIYPnS6dD50uPhwkVmeX0IphYjQ7/fpdrtUq1W2t7+hVntCpVLF2vuxwMLAGWMwxty5RUJEKJVK9Ho9Dg8avPjh33x43+X8vEm/n7Xy2Y+hQEQ+fUnT7oIwDGk0jnEch1KpxM7ODtvbTwtv21jKhczP8Lr89t8R19dDIKv5/nrMbZpumIsIl5eXKKXYfva08DEuJTjISpQ0TRmNRnieO7fFTOOl53n3Mr6lBTd1+SI3kYvUarMmp1bgcmoFLqdW4HJqBS6nCsuqItn0Jk3TpekRno7nPlQYuCms7HU5wEGxzYR/VQHgsoHVajVevfplaawNPneVQ/Ff5Z3AZUVq9rfnGaw/+xrcwjSdmRW8WX0ncJ5nGQz6vP69vrS9cfC5j08pVZhH3AmcMYYoihiNRkvlon+XiHzsclqSHuDpgL6GH4zMq1Udl1MzW5xS2SJhEIyWOp7NKhEhiqKszssRZWYGlyTC9vYzarUaxiztatQcygp23/dJcvy6Xo2DuM8MDzMQEax1UF+Zc+fczB7M4aqKMHyYftv7Vp6C4Cuzn8VpBS6nVuByavXAlpxygCarRwTNq8GfDrbV1CI5dZUAAAAASUVORK5CYII=";if(C.prototype.init){C.prototype.init.call(this);}if(this.getSettings()==undefined){this.setSettings(new this._settings());}this._scene=null;this.oModel=new sap.ui.model.json.JSONModel();this._layout=new sap.m.Toolbar({design:sap.m.ToolbarDesign.Solid});this.setAggregation("layout",this._layout);if(this.getShowThumbnails()){this._thumbnailsScroller=new sap.m.ScrollContainer(this.getId()+"-scroller",{width:"100%",horizontal:true,vertical:false,focusable:true});this._thumbnailsContainer=new sap.m.Panel({expandable:false,content:[this._thumbnailsScroller]});this.setAggregation("thumbnailsContainer",this._thumbnailsContainer);}this.playPreviousButton=new sap.m.Button(this.getId()+"-playPreviousButton",{type:sap.m.ButtonType.Transparent,icon:"sap-icon://slim-arrow-left",tooltip:sap.ui.vk.getResourceBundle().getText("STEP_NAV_PREVIOUSSTEPBUTTON"),visible:true,press:function(e){var s=this.getSettings();var p=this.getPreviousStep(s.currentProcedureIndex);if(p){s.currentStepPaused=false;this.playStep(p.id,true,s.playAllActive);this._togglePlayPause(false);}}.bind(this)});this.playNextButton=new sap.m.Button(this.getId()+"-playNextButton",{type:sap.m.ButtonType.Transparent,icon:"sap-icon://slim-arrow-right",tooltip:sap.ui.vk.getResourceBundle().getText("STEP_NAV_NEXTSTEPBUTTON"),visible:true,press:function(e){var s=this.getSettings();var n=this.getNextStep(s.currentProcedureIndex);if(n){s.currentStepPaused=false;this.playStep(n.id,true,s.playAllActive);this._togglePlayPause(false);}}.bind(this)});this.playOptionButton=new sap.m.Button(this.getId()+"-playOptionButton",{type:sap.m.ButtonType.Transparent,icon:"sap-icon://media-play",tooltip:sap.ui.vk.getResourceBundle().getText("STEP_NAV_PLAYBUTTON_PLAY"),visible:true,press:function(e){var k=this.getPlayMenuButton().getSelectedKey();var s=this.getSettings();var f=null;switch(k){case"0":if(!s.currentStepId){f=this.getNextStep(s.currentProcedureIndex);if(f){s.currentStepId=f.id;}else{return;}}s.playAllActive=false;this.playStep(s.currentStepId,!s.currentStepPaused,s.playAllActive);s.isPlaying=true;s.currentStepPaused=false;this._togglePlayPause(false);break;case"1":s.playAllActive=true;s.currentStepPaused=false;this.playAllSteps(s.currentProcedureId);s.isPlaying=true;this._togglePlayPause(false);break;case"2":if(!s.currentStepId){f=this.getNextStep(s.currentProcedureIndex);if(f){s.currentStepId=f.id;}else{return;}}s.playAllActive=true;var p=!s.currentStepPaused;s.currentStepPaused=false;this.playStep(s.currentStepId,p,s.playAllActive);s.isPlaying=true;this._togglePlayPause(false);break;default:break;}}.bind(this)});this.procedureList=new sap.m.Select(this.getId()+"-procedureList",{tooltip:sap.ui.vk.getResourceBundle().getText("STEP_NAV_PROCEDURESLISTHEADING"),selectedKey:"0",type:sap.m.SelectType.Default,enabled:true,width:"30%",autoAdjustWidth:true,change:function(c){var p=this.getProcedureList();var s=this.getSettings();s.currentProcedureIndex=0;s.currentProcedureId=this.instanceSettings.currentProcedureId=p.getSelectedKey();s.currentStepId=this.instanceSettings.currentStepId=null;for(var i=0;i<this.oModel.oData.procedures.length;i++){if(this.oModel.oData.procedures[i].id==s.currentProcedureId){s.currentProcedureIndex=i;s.currentProcedure=this.oModel.oData.procedures[i];break;}}if(s.stepInfo.stepMessagePopup){if(!s.stepInfo.stepMessagePopup.isOpen()){s.stepInfo.stepMessagePopup.close();}s.stepInfo.stepMessagePopup.destroy();s.stepInfo.stepMessagePopup=null;}this._refreshItems();}.bind(this)});this.procedureList.addStyleClass("sapVizKitStepNavigationProcedureList");this.setAggregation("procedureItemTemplate",(new sap.ui.core.ListItem().bindProperty("text","name").bindProperty("key","id").bindProperty("tooltip","name")));this.playMenuButton=(new sap.m.Select(this.getId()+"-playMenuButtonIcon",{selectedKey:"0",type:sap.m.SelectType.Default,tooltip:sap.ui.vk.getResourceBundle().getText("STEP_NAV_PLAYMENU_PLAYOPTIONS"),enabled:true,autoAdjustWidth:false,items:[new sap.ui.core.ListItem({key:"0",icon:"sap-icon://media-play",text:sap.ui.vk.getResourceBundle().getText("STEP_NAV_PLAYMENU_PLAY"),tooltip:sap.ui.vk.getResourceBundle().getText("STEP_NAV_PLAYMENU_PLAY")}),new sap.ui.core.ListItem({key:"1",icon:"sap-icon://media-play",text:sap.ui.vk.getResourceBundle().getText("STEP_NAV_PLAYMENU_PLAYALL"),tooltip:sap.ui.vk.getResourceBundle().getText("STEP_NAV_PLAYMENU_PLAYALL")}),new sap.ui.core.ListItem({key:"2",icon:"sap-icon://media-play",text:sap.ui.vk.getResourceBundle().getText("STEP_NAV_PLAYMENU_PLAYALLREMAINING"),tooltip:sap.ui.vk.getResourceBundle().getText("STEP_NAV_PLAYMENU_PLAYALLREMAINING")})]}));this.playMenuButton.addStyleClass("sapVizKitStepNavigationPlayOptionsSelect");this.pauseButton=new sap.m.Button(this.getId()+"-pauseButton",{type:sap.m.ButtonType.Transparent,icon:"sap-icon://media-pause",visible:false,tooltip:sap.ui.vk.getResourceBundle().getText("STEP_NAV_PLAYMENU_PAUSE"),press:function(e){var s=this.getSettings();this.pauseStep();s.currentStepPaused=true;s.isPlaying=false;this._togglePlayPause(true);}.bind(this)});this.showStepInfoButton=new sap.m.ToggleButton(this.getId()+"-showStepInfoButton",{icon:"sap-icon://hide",type:sap.m.ButtonType.Transparent,pressed:false,text:sap.ui.vk.getResourceBundle().getText("STEP_NAV_STEPDESCRIPTIONHEADING"),tooltip:sap.ui.vk.getResourceBundle().getText("STEP_NAV_STEPDESCRIPTIONHEADING"),press:function(e){var t=e.getSource();if(t.getPressed()){this.setShowStepInfo(true);t.setIcon("sap-icon://show");t.setTooltip(sap.ui.vk.getResourceBundle().getText("STEP_NAV_HIDESTEPDESCRIPTIONBUTTON"));}else{this.setShowStepInfo(false);t.setIcon("sap-icon://hide");t.setTooltip(sap.ui.vk.getResourceBundle().getText("STEP_NAV_SHOWSTEPDESCRIPTIONBUTTON"));}}.bind(this)});this._layout.addContent(this.playPreviousButton).addContent(this.playOptionButton).addContent(this.pauseButton).addContent(this.playMenuButton).addContent(this.procedureList).addContent(this.showStepInfoButton).addContent(new sap.m.ToolbarSpacer()).addContent(this.playNextButton);};
b.prototype.destroy=function(){return C.prototype.destroy.call(this);};
b.prototype.getScroller=function(){return this._thumbnailsScroller;};
b.prototype.getProcedureList=function(){var i=this.getId()+"-procedureList";var h=this._layout;var c=sap.ui.getCore().byId(i);return h.getContent()[h.indexOfContent(c)];};
b.prototype.getPlayMenuButton=function(){var i=this.getId()+"-playMenuButtonIcon";var h=this._layout;var c=sap.ui.getCore().byId(i);return h.getContent()[h.indexOfContent(c)];};
b.prototype.getPlayOptionButton=function(){var i=this.getId()+"-playOptionButton";var h=this._layout;var c=sap.ui.getCore().byId(i);return h.getContent()[h.indexOfContent(c)];};
b.prototype.getPauseButton=function(){var i=this.getId()+"-pauseButton";var h=this._layout;var c=sap.ui.getCore().byId(i);return h.getContent()[h.indexOfContent(c)];};
b.prototype.getPlayNextButton=function(){var i=this.getId()+"-playNextButton";var h=this._layout;var c=sap.ui.getCore().byId(i);return h.getContent()[h.indexOfContent(c)];};
b.prototype.getPlayPreviousButton=function(){var i=this.getId()+"-playPreviousButton";var h=this._layout;var c=sap.ui.getCore().byId(i);return h.getContent()[h.indexOfContent(c)];};
b.prototype.getShowStepInfoButton=function(){var i=this.getId()+"-showStepInfoButton";var h=this._layout;var c=sap.ui.getCore().byId(i);return h.getContent()[h.indexOfContent(c)];};
b.prototype.exit=function(){if(this._resizeListenerId){R.deregister(this._resizeListenerId);this._resizeListenerId=null;}if(C.prototype.exit){C.prototype.exit.apply(this);}};
b.prototype._settings=function(){return{enabled:false,toggle:{addCss:function(k,p,o,c){if(!this.targets[k]){this.targets[k]={"type":"css","property":p,"onValue":o,"offValue":c};}},addMethod:function(t,m,o,c,u){var k=t.getId();if(!this.targets[k]){this.targets[k]={"type":"method","target":t,"method":m,"onValue":o,"offValue":c,"useJQuery":u};}},targets:{}},currentProcedureIndex:0,currentProcedureId:"",currentProcedure:null,currentStepId:null,currentStep:null,currentStepPaused:false,isPlaying:false,currentStepFinished:true,playAllActive:false,showToolbar:true,showThumbnails:true,portfolioMode:false,reset:function(){this.currentStep=null;this.currentProcedure=null;this.currentProcedureIndex=0;this.currentProcedureId="";this.currentStepId=null;this.currentStepPaused=false;this.currentStepFinished=true;this.playAllActive=false;this.portfolioMode=false;},stepInfo:{lastTop:null,lastLeft:null,stepMessagePopup:null,openPopup:function(p,t,c,e){this._customHeaderText=this._customHeaderText||new sap.m.Text({width:"100%",textAlign:sap.ui.core.TextAlign.Center}).addStyleClass("sapVizKitStepNavigationPopoverTitle");this._customHeaderText.setText(p);this._customHeaderText.setTooltip(p);this._customHeader=this._customHeader||new sap.m.Bar({contentLeft:[this._customHeaderText]});this._textContent=this._textContent||new sap.m.Text({});this._textContent.addStyleClass("sapVizKitStepNavigationPopoverContent");this._textContent.setText(t);this.stepMessagePopup=this.stepMessagePopup||new sap.m.ResponsivePopover({placement:e,showCloseButton:true,verticalScrolling:true,contentHeight:"10%",contentWidth:"30%",content:[this._textContent],customHeader:this._customHeader});this.stepMessagePopup.addStyleClass("sapVizKitStepNavigationPopoverStepInfo");this.stepMessagePopup.openBy(c);}}};};
b.prototype.refresh=function(s){q.sap.log.info("StepNavigation refresh() called.");if(this.getVisible()&&(this["_getStepThumbnails"]&&this._scene!=null)){var p=this.getProcedureList();var o=this.getSettings();o.reset();p.setSelectedItem(p.getFirstItem());var c=this._getStepThumbnails();if(o.stepInfo.stepMessagePopup){if(!o.stepInfo.stepMessagePopup.isOpen()){o.stepInfo.stepMessagePopup.close();}o.stepInfo.stepMessagePopup.destroy();o.stepInfo.stepMessagePopup=null;}this.oModel.setData(c);this._togglePlayPause(true);this._refreshControl();}else if(this.getVisible()){this._refreshControl();}return true;};
b.prototype.clear=function(){q.sap.log.info("StepNavigation clear() called.");return true;};
b.prototype.onBeforeRendering=function(){if(this._resizeListenerId){R.deregister(this._resizeListenerId);this._resizeListenerId=null;}if(this.getShowToolbar()){var p=this.getProcedureList();p.setModel(this.oModel);var P=this.getProcedureItemTemplate();p.bindItems("/procedures",P);}};
b.prototype.onAfterRendering=function(){if(this._canvas){var c=this.getDomRef();c.appendChild(this._canvas);this._resizeListenerId=R.register(this,this._handleResize.bind(this));this._bestFit();this.fireResize({size:{width:c.clientWidth,height:c.clientHeight}});}var s=this.getSettings();this._togglePlayPause(!s.isPlaying);if(s.currentStepId){this._highlightStep(s.currentStepId);}};
b.prototype._handleResize=function(e){this.fireResize({oldSize:e.oldSize,size:e.size});this._update();};
b.prototype._reset=function(){this._x=0;this._y=0;this._s=1.0;this._r=0;};
b.prototype._update=function(){var x=this._x-(this._imageW-this._canvas.clientWidth)/2;var y=this._y-(this._imageH-this._canvas.clientHeight)/2;var t="matrix("+this._s+",0,0,"+this._s+","+x+","+y+")";this._img.style.transform=t;this._img.style.webkitTransform=t;this._img.style.msTransform=t;this._img.style.MozTransform=t;this._img.style.OTransform=t;};
b.prototype._bestFit=function(){this._reset();var s=this._canvas.clientWidth/this._img.width;var c=this._canvas.clientHeight/this._img.height;this._s=s<c?s:c;if(this._s==0){this._s=1.0;}this._x=0;this._y=0;this._update();};
var d={onAfterRendering:function(e){e.srcControl.focus();e.srcControl.removeEventDelegate(this);}};
b.prototype._togglePlayPause=function(p){this.togglePlayPauseActive=true;if(this.getSettings().showToolbar){var c=this.getPlayOptionButton(),e=this.getPauseButton();if(p){if(sap.ui.getCore().getCurrentFocusedControlId()===e.getId()){c.addEventDelegate(d);}e.setVisible(false);c.setVisible(true);}else{if(sap.ui.getCore().getCurrentFocusedControlId()===c.getId()){e.addEventDelegate(d);}c.setVisible(false);e.setVisible(true);}}};
b.prototype._refreshControl=function(){if(!this.oModel.oData.procedures){return;}var p=this.getProcedureList();var P=this.getProcedureItemTemplate();var s=this.getSettings();if(s.stepInfo.stepMessagePopup){if(!s.stepInfo.stepMessagePopup.isOpen()){s.stepInfo.stepMessagePopup.close();}s.stepInfo.stepMessagePopup.destroy();s.stepInfo.stepMessagePopup=null;this.getShowStepInfoButton().setText(sap.ui.vk.getResourceBundle().getText("STEP_NAV_STEPDESCRIPTIONHEADING"));}p.unbindItems();if(this.oModel.oData.procedures.length>0){var f=this.oModel.oData.procedures[0];if(this.getShowToolbar()){p.bindItems("/procedures",P);p.selectedKey=f.id;p.enabled=true;}this._refreshItems();}else{if(this.getShowToolbar()){p.bindItems("/procedures",P);p.enabled=false;}if(this.getShowThumbnails()){var o=this.getScroller();o.destroyContent();}}};
b.prototype._refreshItems=function(){var t=this;var s=[];var p=this.getProcedureList();var o=t.getSettings();var c=new sap.m.HBox();if(!o.currentProcedure){o.currentProcedure=t.oModel.oData.procedures[o.currentProcedureIndex];p.setSelectedItem(p.getFirstItem());}if(o.currentProcedureId!=""||t.oModel.oData.procedures.length>0){if(t.getShowThumbnails()){var e=t.getScroller();e.removeAllContent();s=t.oModel.oData.procedures[o.currentProcedureIndex].steps;var f=function(h){o.currentStepPaused=false;var j=sap.ui.getCore().byId(h.getSource().getId());t.playStep(j.getCustomData()[0].getValue("stepId"));o.playAllActive=false;t._togglePlayPause(false);};for(var i=0;i<s.length;i++){var g=new sap.m.Image({alt:s[i].name,src:"data:image/"+s[i].thumbnailType+";base64,"+s[i].thumbnailData,densityAware:false,tooltip:s[i].name,press:f.bind(t),layoutData:new sap.m.FlexItemData({shrinkFactor:0})});g.data("stepId",s[i].id);g.addCustomData(new sap.ui.core.CustomData({key:"stepId",value:s[i].id}));g.addStyleClass("sapVizKitStepNavigationStepItem");c.addItem(g);}e.addContent(c);}}};
b.prototype._getPopupPlacement=function(e){var p=null;var y=0;while(e){y+=e.offsetTop;e=e.offsetParent;}if(y>200){p=sap.m.PlacementType.Top;}else{p=sap.m.PlacementType.Bottom;}return p;};
b.prototype._isScrollingNecessary=function(i,s){var c;if(i&&s){var e=q(i).offset().left+q(i).width();var t=q(s).width();if(e-q(i).width()<0){c=true;}else if((t-e)<q(i).width()){c=true;}else{c=false;}}else{c=false;}return c;};
b.prototype._scrollToItem=function(i,s){var p={},o=q(i).offset(),c=q(s).scrollLeft();p.scrollLeft=o.left+(c-q(s).offset().left);p.scrollLeft-=parseInt(q(i).css("marginLeft"),10)||0;p.scrollLeft-=parseInt(q(i).css("borderLeftWidth"),10)||0;q(s).animate(p,50);};
b.prototype._highlightStep=function(s){var t=this;if(t.getVisible()){var o=t.getSettings();var c=t.getStep(0,o.currentProcedureIndex,s);if(!o.currentProcedure){o.currentProcedure=t.oModel.oData.procedures[t.oSettings.currentProcedureIndex];}var e=t.getShowStepInfoButton();var p;var f=document.getElementById(e.getId());p=t._getPopupPlacement(f);if(t.getShowStepInfo()){o.stepInfo.openPopup.call(this,c.name,c.description,e,p);}else if(o.stepInfo.stepMessagePopup&&o.stepInfo.stepMessagePopup.isOpen()){o.stepInfo.stepMessagePopup.close();}if(t.getShowThumbnails()){var g=t.getScroller();var T=g.getContent()[0].getItems();for(var i=0;i<T.length;i++){if(T[i].getCustomData()[0].getValue("stepId")==s){T[i].addStyleClass("selected");if(t._isScrollingNecessary(T[i].$()[0],q("#"+g.sId)[0])){t._scrollToItem(T[i].$()[0],q("#"+g.sId)[0]);}}else{T[i].removeStyleClass("selected");}}}}};
b.prototype.getProceduresAndSteps=function(){return this._getStepThumbnails();};
b.prototype._getStepThumbnails=function(){var p=function(s,e,f){var t,i,g;try{var h=e.Scene.RetrieveThumbnail(s,f.id);if(h===sap.ve.dvl.DVLRESULT.NOTFOUND){t=this._emptyThumbnail;}else{t=sap.ui.vk.dvl.getPointer(h);}g=t.substring(0,3);if(g==="iVB"){i="png";}else{i="jpg";}f.thumbnailData=t;f.thumbnailType=i;}catch(j){if(j.code!==sap.ve.dvl.DVLRESULT.NOTFOUND){q.sap.log.error(j.message,j.code,"sap.ui.vk.StepNavigation");}f.thumbnailData=null;f.thumbnailType=null;}};var c=this._retrieveProcedures();if(c.sceneId!=null){c.procedures.forEach(function(e){e.steps.forEach(p.bind(this,c.sceneId,this.oDvl));},this);c.portfolios.forEach(function(e){e.steps.forEach(p.bind(this,c.sceneId,this.oDvl));},this);c.hasThumbnails=true;}this._procedures=c;return c;};
b.prototype._retrieveProcedures=function(c){var t=this;var p={};if(!t._procedures){p={sceneId:null,hasThumbnails:false,"procedures":[],"portfolios":[]};}else{p=t._procedures;}if(t._scene&&(p.sceneId!=(c||t._scene._dvlSceneRef))){var s=c||t._scene._dvlSceneRef;if(s!=null){p={sceneId:null,hasThumbnails:false,"procedures":[],"portfolios":[]};try{var f=sap.ui.vk.dvl.getJSONObject(t.oDvl.Scene.RetrieveProcedures(s));if(f!=null){p.hasThumbnails=false;p.sceneId=t._scene._dvlSceneRef;p.procedures=f.procedures;p.portfolios=f.portfolios;}}catch(e){if(!(e instanceof D&&e.code===sap.ve.dvl.DVLRESULT.NOTIMPLEMENTED)){throw e;}}}}return p;};
b.prototype.getStep=function(r,c,s){var t=this;var e=t.oDvl.Settings.LastLoadedSceneId;var f=null;if(e!=null){c=c!=null?c:0;var g=s?s:t.instanceSettings.currentStepId;var p=t._retrieveProcedures(e);var h=p.procedures[c];if(h&&h.steps.length>0){f=h.steps[0];}else{return null;}if(g!=""){for(var i=0;i<h.steps.length;i++){var _=h.steps[i];if(_.id==g){var x=i+r;if(x<h.steps.length&&x>=0){f=h.steps[x];}else{f=null;}break;}}}}return f;};
b.prototype.pauseStep=function(){var t=this;var s=t.oDvl.Settings.LastLoadedSceneId;if(s!=null){t.oDvl.Scene.PauseCurrentStep(s);}};
b.prototype._stepCount=function(c){var t=this;var s=t.oDvl.Settings.LastLoadedSceneId;var e=0;if(s!=null){var p=t._retrieveProcedures(s);for(var f=0;f<p.procedures.length;f++){if(p.procedures[f].id==c){e=p.procedures[f].steps.length;break;}else if(c==null){e+=p.procedures[f].steps.length;}}}return e;};
b.prototype.getPreviousStep=function(p){var t=this;return t.getStep(-1,p);};
b.prototype.getNextStep=function(p){var t=this;return t.getStep(1,p);};
b.prototype.playStep=function(c,f,e){var t=this;var s=t.oDvl.Settings.LastLoadedSceneId;if(s!=null){t.instanceSettings.currentStepId=c;t.oDvl.Scene.ActivateStep(s,c,f!=null?f:true,e!=null?e:false);}};
b.prototype.playAllSteps=function(p){var t=this;var c=t.oDvl.Settings.LastLoadedSceneId;if(c!=null){var e=t._retrieveProcedures(c);var f=0;if(p!=null&&e.procedures.length>1){for(var i=0;i<e.procedures.length;i++){if(e.procedures[i].id==p){f=i;break;}}}if(e.procedures.length>0){var s=e.procedures[f].steps[0];if(s){t.instanceSettings.currentStepId=s.id;t.oDvl.Scene.ActivateStep(c,s.id,true,true);}}}};
b.prototype._setContent=function(c){var s=null;if(c&&c instanceof sap.ui.vk.dvl.Scene){s=c;}this.setScene(s);};
b.prototype._onAfterUpdateContentConnector=function(){this._setContent(this._contentConnector.getContent());};
b.prototype._onBeforeClearContentConnector=function(){this.setScene(null);};
b.prototype._handleContentReplaced=function(e){var c=e.getParameter("newContent");this._setContent(c);};
a.injectMethodsIntoClass(b);return b;});
sap.ui.predefine('sap/ui/vk/StepNavigationRenderer',["jquery.sap.global"],function(q){"use strict";var S={};
S.render=function(r,c){if(!c.getVisible()){return;}if(c.getShowToolbar()||c.getShowThumbnails){var w=c.getWidth()!=="auto"?c.getWidth():"100%";var h=c.getHeight()!=="auto"?c.getHeight():"auto";r.write("<div");r.addStyle("width",w);r.addStyle("height",h);r.writeControlData(c);r.addClass("sapVizKitStepNavigation");r.writeClasses();var t=c.getTooltip_AsString();if(t){r.writeAttributeEscaped("title",t);}if(!c.getVisible()){r.addStyle("visibility","hidden");}r.writeStyles();r.write(">");r.renderControl(c.getAggregation("layout"));if(c.getShowThumbnails()){S._renderScrollerDiv(r,c);}r.write("</div>");}};
S._renderScrollerDiv=function(r,c){r.renderControl(c.getAggregation("thumbnailsContainer"));};
return S;},true);
sap.ui.predefine('sap/ui/vk/Texture',["jquery.sap.global","sap/ui/base/ManagedObject"],function(q,M){"use strict";
var T=M.extend("sap.ui.vk.Texture",{metadata:{properties:{"Id":{type:"string"},"filterMode":{type:"int",defaultValue:0},"uvRotationAngle":{type:"float",defaultValue:0.0},"uvHorizontalOffset":{type:"float",defaultValue:0.0},"uvVerticalOffset":{type:"float",defaultValue:0.0},"uvHorizontalScale":{type:"float",defaultValue:0.0},"uvVerticalScale":{type:"float",defaultValue:0.0},"uvHorizontalTilingEnabled":{type:"bloolean",defaultValue:true},"uvVerticalTilingEnabled":{type:"bloolean",defaultValue:true}}}});
T.prototype.load=function(i){return this;};
T.prototype.getTextRef=function(){return null;};
return T;});
sap.ui.predefine('sap/ui/vk/Toolbar',["jquery.sap.global","./library","sap/ui/core/Control","./ToolbarRenderer"],function(q,l,C,T){"use strict";
var a=C.extend("sap.ui.vk.Toolbar",{metadata:{library:"sap.ui.vk",properties:{title:{type:"string",group:"Appearance",defaultValue:""}},events:{},associations:{viewer:{type:"sap.ui.vk.Viewer",cardinality:"0..1"}},aggregations:{_toolbar:{type:"sap.m.Toolbar",multiple:false,visibility:"hidden"},_helpButton:{type:"sap.m.Button",multiple:false,visibility:"hidden"},_stepNavigationButton:{type:"sap.m.ToggleButton",multiple:false,visibility:"hidden"},_sceneTreeButton:{type:"sap.m.ToggleButton",multiple:false,visibility:"hidden"},_enterFullScreenButton:{type:"sap.m.ToggleButton",multiple:false,visibility:"hidden"},_exitFullScreenButton:{type:"sap.m.Button",multiple:false,visibility:"hidden"},_toolbarTitle:{type:"sap.m.Title",multiple:false,visibility:"hidden"}}}});
a.prototype._isUsingIOS=function(){return(sap.ui.Device.system.tablet||sap.ui.Device.system.phone)&&sap.ui.Device.os.ios;};
a.prototype._onSceneTree=function(){this.oViewer=sap.ui.getCore().byId(this.getViewer());if(this.oViewer!=null){this.oViewer._componentsState.sceneTree.userInteractionShow=this._sceneTreeButton.getPressed();this.oViewer.setShowSceneTree(this.oViewer._componentsState.sceneTree.userInteractionShow);}};
a.prototype._onStepNavigation=function(){this.oViewer=sap.ui.getCore().byId(this.getViewer());if(this.oViewer!=null){this.oViewer._componentsState.stepNavigation.userInteractionShow=this._stepNavigationButton.getPressed();this.oViewer.setShowStepNavigation(this.oViewer._componentsState.stepNavigation.userInteractionShow);}};
a.prototype._onFullScreen=function(){this.oViewer=sap.ui.getCore().byId(this.getViewer());if(this.oViewer!=null){var n=this._enterFullScreenButton.getPressed();this.oViewer.activateFullScreenMode(n);}};
a.prototype._fullScreenHandler=function(e){var f=e.mParameters.isFullScreen;this._enterFullScreenButton.setPressed(f);if(f){this._enterFullScreenButton.setIcon("sap-icon://exit-full-screen");}else{this._enterFullScreenButton.setIcon("sap-icon://full-screen");}};
a.prototype.init=function(){if(C.prototype.init){C.prototype.init.apply(this);}var _=new sap.m.Button({icon:"sap-icon://sys-help",type:sap.m.ButtonType.Transparent,tooltip:sap.ui.vk.getResourceBundle().getText("VIEWER_HELPBUTTONTOOLTIP")});this.setAggregation("_helpButton",_);this._stepNavigationButton=new sap.m.ToggleButton({icon:"sap-icon://step",type:sap.m.ButtonType.Transparent,enabled:false,tooltip:sap.ui.vk.getResourceBundle().getText("STEP_NAV_MENUBUTTONTOOLTIP"),press:this._onStepNavigation.bind(this)});this.setAggregation("_stepNavigationButton",this._stepNavigationButton);this._sceneTreeButton=new sap.m.ToggleButton({icon:"sap-icon://tree",type:sap.m.ButtonType.Transparent,tooltip:sap.ui.vk.getResourceBundle().getText("SCENETREE_MENUBUTTONTOOLTIP"),press:this._onSceneTree.bind(this)});this.setAggregation("_sceneTreeButton",this._sceneTreeButton);this._toolbarTitle=new sap.m.Title();this.setAggregation("_toolbarTitle",this._toolbarTitle);var t=t=[new sap.m.ToolbarSpacer(),this._toolbarTitle,new sap.m.ToolbarSpacer(),new sap.m.ToolbarSeparator(),this._sceneTreeButton,new sap.m.ToolbarSeparator(),this._stepNavigationButton];if(!this._isUsingIOS()){this._enterFullScreenButton=new sap.m.ToggleButton({icon:"sap-icon://full-screen",type:sap.m.ButtonType.Transparent,tooltip:sap.ui.vk.getResourceBundle().getText("VIEWER_FULLSCREENBUTTONTOOLTIP"),press:this._onFullScreen.bind(this)});this.setAggregation("_enterFullScreenButton",this._enterFullScreenButton);var b=new sap.m.Button({icon:"sap-icon://exit-full-screen",type:sap.m.ButtonType.Transparent,tooltip:sap.ui.vk.getResourceBundle().getText("VIEWER_FULLSCREENBUTTONTOOLTIP")});this.setAggregation("_exitFullScreenButton",b);t.push(new sap.m.ToolbarSeparator(),this._enterFullScreenButton);}this._toolbar=new sap.m.Toolbar({design:sap.m.ToolbarDesign.Solid,content:t});this.setAggregation("_toolbar",this._toolbar,true);};
a.prototype.exit=function(){this.oViewer=sap.ui.getCore().byId(this.getViewer());if(this.oViewer){this.oViewer.detachFullScreen(this._fullScreenHandler.bind(this));}};
a.prototype.onBeforeRendering=function(){this._toolbar.setVisible(true);this._toolbarTitle.setText(this.getTitle());};
a.prototype.refresh=function(){this.oViewer=sap.ui.getCore().byId(this.getViewer());this._stepNavigationButton.setPressed(this.oViewer.getShowStepNavigation());this._stepNavigationButton.setEnabled(this.oViewer.getEnableStepNavigation());this._sceneTreeButton.setPressed(this.oViewer.getShowSceneTree());this._sceneTreeButton.setEnabled(this.oViewer.getEnableSceneTree());this.oViewer.attachFullScreen(this._fullScreenHandler.bind(this));return true;};
a.prototype.onAfterRendering=function(){this.refresh();};
return a;},true);
sap.ui.predefine('sap/ui/vk/ToolbarRenderer',["jquery.sap.global"],function(q){"use strict";var T={};
T.render=function(r,c){r.write("<div");r.writeControlData(c);r.addClass("sapVizKitToolbar");r.writeClasses();r.write(">");r.renderControl(c.getAggregation("_toolbar"));r.write("</div>");};
return T;},true);
sap.ui.predefine('sap/ui/vk/TransformationMatrix',["jquery.sap.global","sap/ui/base/DataType"],function(q,D){"use strict";var T=D.getType("float[]");
T.parseValue=function(v){var c=T.getComponentType();return v.split(/\s*,\s*|\s+/).map(c.parseValue.bind(c));};
T.convertTo4x4=function(a){var m=a;return[m[0],m[1],m[2],0,m[3],m[4],m[5],0,m[6],m[7],m[8],0,m[9],m[10],m[11],1];};
T.convertTo4x3=function(a){var m=a;return[m[0],m[1],m[2],m[4],m[5],m[6],m[8],m[9],m[10],m[12],m[13],m[14]];};
q.sap.setObject("sap.ui.vk.TransformationMatrix",T);return T;});
sap.ui.predefine('sap/ui/vk/View',["jquery.sap.global","sap/ui/base/ManagedObject"],function(q,M){"use strict";
var V=M.extend("sap.ui.vk.View",{metadata:{library:"sap.ui.vk",properties:{name:{type:"string"},cameraInfo:{type:"object"},nodeInfos:{type:"object[]"}}}});
return V;});
sap.ui.predefine('sap/ui/vk/ViewStateManager',["jquery.sap.global","sap/ui/core/Element","./ContentConnector","./Scene","./ViewStateManagerBase","./Core"],function(q,E,C,S,V,a){"use strict";
var b=V.extend("sap.ui.vk.ViewStateManager",{metadata:{}});
var c=b.getMetadata().getParent().getClass().prototype;
b.prototype.init=function(){if(c.init){c.init.call(this);}this._implementation=null;};
b.prototype.exit=function(){this._destroyImplementation();if(c.exit){c.exit.call(this);}};
b.prototype._destroyImplementation=function(){if(this._implementation){this._implementation.destroy();this._implementation=null;}return this;};
b.prototype.getImplementation=function(){return this._implementation;};
b.prototype._setContent=function(d){var s=null;if(d&&d instanceof sap.ui.vk.Scene){s=d;}this._setScene(s);};
b.prototype._onAfterUpdateContentConnector=function(){this._setContent(this._contentConnector.getContent());};
b.prototype._onBeforeClearContentConnector=function(){this._setScene(null);};
b.prototype._handleContentReplaced=function(e){this._setContent(e.getParameter("newContent"));};
b.prototype._setScene=function(s){if(s&&s instanceof S){var d=s.getMetadata().getName(),i=this._implementation&&this._implementation.getMetadata().getName(),r=d==="sap.ui.vk.dvl.Scene"&&i==="sap.ui.vk.dvl.ViewStateManager"||d==="sap.ui.vk.threejs.Scene"&&i==="sap.ui.vk.threejs.ViewStateManager";if(!r){this._destroyImplementation();var n;if(d==="sap.ui.vk.dvl.Scene"){n="sap.ui.vk.dvl.ViewStateManager";}else if(d==="sap.ui.vk.threejs.Scene"){n="sap.ui.vk.threejs.ViewStateManager";}if(n){var t=this;q.sap.require(n);this._implementation=new(q.sap.getObject(n))({shouldTrackVisibilityChanges:this.getShouldTrackVisibilityChanges(),recursiveSelection:this.getRecursiveSelection(),contentConnector:this.getContentConnector(),visibilityChanged:function(e){t.fireVisibilityChanged({visible:e.getParameter("visible"),hidden:e.getParameter("hidden")});},selectionChanged:function(e){t.fireSelectionChanged({selected:e.getParameter("selected"),unselected:e.getParameter("unselected")});},opacityChanged:function(e){t.fireOpacityChanged({changed:e.getParameter("changed"),opacity:e.getParameter("opacity")});},tintColorChanged:function(e){t.fireTintColorChanged({changed:e.getParameter("changed"),tintColor:e.getParameter("tintColor"),tintColorABGR:e.getParameter("tintColorABGR")});},nodeHierarchyReplaced:function(e){t.fireNodeHierarchyReplaced({oldNodeHierarchy:e.getParameter("oldNodeHierarchy"),newNodeHierarchy:e.getParameter("newNodeHierarchy")});}});}}}else{this._destroyImplementation();}return this;};
b.prototype.getNodeHierarchy=function(){return this._implementation&&this._implementation.getNodeHierarchy();};
b.prototype.getVisibilityChanges=function(){return this._implementation&&this._implementation.getVisibilityChanges();};
b.prototype.getVisibilityComplete=function(){return this._implementation&&this._implementation.getVisibilityComplete();};
b.prototype.getVisibilityState=function(n){return this._implementation&&this._implementation.getVisibilityState(n);};
b.prototype.setVisibilityState=function(n,v,r){if(this._implementation){this._implementation.setVisibilityState(n,v,r);}return this;};
b.prototype.enumerateSelection=function(d){if(this._implementation){this._implementation.enumerateSelection(d);}return this;};
b.prototype.setShowSelectionBoundingBox=function(v){if(this._implementation){this._implementation.setShowSelectionBoundingBox(v);}};
b.prototype.getShowSelectionBoundingBox=function(){if(this._implementation){return this._implementation.getShowSelectionBoundingBox();}};
b.prototype.getSelectionState=function(n){return this._implementation&&this._implementation.getSelectionState(n);};
b.prototype.setSelectionState=function(n,s,r){if(this._implementation){this._implementation.setSelectionState(n,s,r);}return this;};
b.prototype.setSelectionStates=function(s,u,r){if(this._implementation){this._implementation.setSelectionStates(s,u,r);}return this;};
b.prototype.getOpacity=function(n){return this._implementation&&this._implementation.getOpacity(n);};
b.prototype.setOpacity=function(n,o,r){if(this._implementation){this._implementation.setOpacity(n,o,r);}return this;};
b.prototype.getTintColor=function(n,i){return this._implementation&&this._implementation.getTintColor(n,i);};
b.prototype.setTintColor=function(n,t,r){if(this._implementation){this._implementation.setTintColor(n,t,r);}return this;};
b.prototype.setHighlightColor=function(d){if(this._implementation&&this._implementation.setHighlightColor){this._implementation.setHighlightColor(d);}return this;};
b.prototype.getHighlightColor=function(i){if(this._implementation&&this._implementation.getHighlightColor){return this._implementation.getHighlightColor(i);}};
b.prototype.setRecursiveSelection=function(p){this.setProperty("recursiveSelection",p,true);if(this._implementation){this._implementation.setRecursiveSelection(p);}return this;};
var f=b.getMetadata().getName();var m={init:function(){this._viewStateManager=null;sap.ui.vk.getCore().attachEvent(f+"-created",this._handleViewStateManagerCreated,this).attachEvent(f+"-destroying",this._handleViewStateManagerDestroying,this);},exit:function(){this.setViewStateManager(null);sap.ui.vk.getCore().detachEvent(f+"-destroying",this._handleViewStateManagerDestroying,this).detachEvent(f+"-created",this._handleViewStateManagerCreated,this);},setViewStateManager:function(v){this.setAssociation("viewStateManager",v,true);this._updateViewStateManager();return this;},_updateViewStateManager:function(){var n=this.getViewStateManager(),d=n&&sap.ui.getCore().byId(n)||null;if(this._viewStateManager!==d){this._clearViewStateManager();if(d){if(this._handleNodeHierarchyReplaced){d.attachNodeHierarchyReplaced(this._handleNodeHierarchyReplaced,this);}if(this._handleVisibilityChanged){d.attachVisibilityChanged(this._handleVisibilityChanged,this);}if(this._handleSelectionChanged){d.attachSelectionChanged(this._handleSelectionChanged,this);}if(this._handleOpacityChanged){d.attachOpacityChanged(this._handleOpacityChanged,this);}if(this._handleTintColorChanged){d.attachTintColorChanged(this._handleTintColorChanged,this);}this._viewStateManager=d;if(this._onAfterUpdateViewStateManager){this._onAfterUpdateViewStateManager();}}}return this;},_clearViewStateManager:function(){if(this._viewStateManager){if(this._onBeforeClearViewStateManager){this._onBeforeClearViewStateManager();}if(this._handleTintColorChanged){this._viewStateManager.detachTintColorChanged(this._handleTintColorChanged,this);}if(this._handleOpacityChanged){this._viewStateManager.detachOpacityChanged(this._handleOpacityChanged,this);}if(this._handleSelectionChanged){this._viewStateManager.detachSelectionChanged(this._handleSelectionChanged,this);}if(this._handleVisibilityChanged){this._viewStateManager.detachVisibilityChanged(this._handleVisibilityChanged,this);}if(this._handleNodeHierarchyReplaced){this._viewStateManager.detachNodeHierarchyReplaced(this._handleNodeHierarchyReplaced,this);}this._viewStateManager=null;}return this;},_handleViewStateManagerCreated:function(e){if(this.getViewStateManager()===e.getParameter("object").getId()){this._updateViewStateManager();}},_handleViewStateManagerDestroying:function(e){if(this.getViewStateManager()===e.getParameter("object").getId()){this._clearViewStateManager();}}};
b.injectMethodsIntoClass=function(d){var p=d.prototype,i=p.init,e=p.exit;p.init=function(){if(i){i.call(this);}m.init.call(this);};p.exit=function(){m.exit.call(this);if(e){e.call(this);}};p.setViewStateManager=m.setViewStateManager;p._updateViewStateManager=m._updateViewStateManager;p._clearViewStateManager=m._clearViewStateManager;p._handleViewStateManagerCreated=m._handleViewStateManagerCreated;p._handleViewStateManagerDestroying=m._handleViewStateManagerDestroying;};
sap.ui.vk.getCore().registerClass(b);C.injectMethodsIntoClass(b);return b;});
sap.ui.predefine('sap/ui/vk/ViewStateManagerBase',["jquery.sap.global","sap/ui/core/Element","./ContentConnector","./Scene"],function(q,E,C,S){"use strict";
var V=E.extend("sap.ui.vk.ViewStateManagerBase",{metadata:{"abstract":true,properties:{shouldTrackVisibilityChanges:{type:"boolean",defaultValue:false},recursiveSelection:{type:"boolean",defaultValue:false}},associations:{contentConnector:{type:"sap.ui.vk.ContentConnector"}},events:{visibilityChanged:{parameters:{visible:{type:"any[]"},hidden:{type:"any[]"}},enableEventBubbling:true},selectionChanged:{parameters:{selected:{type:"any[]"},unselected:{type:"any[]"}},enableEventBubbling:true},opacityChanged:{parameters:{changed:{type:"any[]"},opacity:{type:"float"}},enableEventBubbling:true},tintColorChanged:{parameters:{changed:{type:"any[]"},tintColor:{type:"sap.ui.core.CSSColor"},tintColorABGR:{type:"int"}},enableEventBubbling:true},nodeHierarchyReplaced:{parameters:{oldNodeHierarchy:{type:"sap.ui.vk.NodeHierarchy"},newNodeHierarchy:{type:"sap.ui.vk.NodeHierarchy"}}},highlightColorChanged:{parameters:{highlightColor:{type:"sap.ui.core.CSSColor"},highlightColorABGR:{type:"int"}},enableEventBubbling:true}}}});
return V;});
sap.ui.predefine('sap/ui/vk/ViewerRenderer',["jquery.sap.global"],function(q){"use strict";var V={};
V.render=function(r,c){r.write("<div");r.writeControlData(c);r.addClass("sapVizKitViewer");r.writeClasses();if(c.getWidth()){r.addStyle("width",c.getWidth());}if(c.getHeight()){r.addStyle("height",c.getHeight());}r.writeStyles();r.write(">");r.renderControl(c._layout);r.renderControl(c._progressIndicator);r.write("</div>");};
return V;},true);
sap.ui.predefine('sap/ui/vk/Viewport',["jquery.sap.global","./ViewportBase","./ContentConnector","./ViewStateManager","./ViewportRenderer"],function(q,V,C,a,b){"use strict";
var c=V.extend("sap.ui.vk.Viewport",{metadata:{library:"sap.ui.vk"}});
var d=c.getMetadata().getParent().getClass().prototype;
c.prototype.init=function(){if(d.init){d.init.call(this);}this._implementation=null;this._deferred={};};
c.prototype.exit=function(){this._deferred=null;this._destroyImplementation();if(d.exit){d.exit.call(this);}};
c.prototype.getImplementation=function(){return this._implementation;};
c.prototype._destroyImplementation=function(){if(this._implementation){this._implementation.destroy();this._implementation=null;}return this;};
c.prototype.getShowDebugInfo=function(){if(this._implementation){return this._implementation.getShowDebugInfo();}return d.getShowDebugInfo.call(this);};
c.prototype.setShowDebugInfo=function(v){d.setShowDebugInfo.call(this,v);if(this._implementation){this._implementation.setShowDebugInfo(v);}return this;};
c.prototype.getBackgroundColorTop=function(){if(this._implementation){return this._implementation.getBackgroundColorTop();}return d.getBackgroundColorTop.call(this);};
c.prototype.setBackgroundColorTop=function(v){d.setBackgroundColorTop.call(this,v);if(this._implementation){this._implementation.setBackgroundColorTop(v);}return this;};
c.prototype.getBackgroundColorBottom=function(){if(this._implementation){return this._implementation.getBackgroundColorBottom();}return d.getBackgroundColorBottom.call(this);};
c.prototype.setBackgroundColorBottom=function(v){d.setBackgroundColorBottom.call(this,v);if(this._implementation){this._implementation.setBackgroundColorBottom(v);}return this;};
c.prototype.setWidth=function(v){d.setWidth.call(this,v);if(this._implementation){this._implementation.setWidth(v);}return this;};
c.prototype.setHeight=function(v){d.setHeight.call(this,v);if(this._implementation){this._implementation.setHeight(v);}return this;};
c.prototype.setSelectionMode=function(v){d.setSelectionMode.call(this,v);if(this._implementation){this._implementation.setSelectionMode(v);}return this;};
c.prototype.getSelectionMode=function(){if(this._implementation){return this._implementation.getSelectionMode();}return d.getSelectionMode.call(this);};
c.prototype.setCamera=function(v){d.setCamera.call(this,v);if(this._implementation){this._implementation.setCamera(v);return this;}return this;};
c.prototype.getCamera=function(){if(this._implementation){return this._implementation.getCamera();}return d.getCamera.call(this);};
c.prototype.setShouldRenderFrame=function(){if(this._implementation){this._implementation.setShouldRenderFrame();}return this;};
c.prototype.shouldRenderFrame=function(){if(this._implementation){this._implementation.shouldRenderFrame();}};
c.prototype.setFreezeCamera=function(v){d.setFreezeCamera.call(this,v);if(this._implementation){this._implementation.setFreezeCamera(v);}return this;};
c.prototype._setContent=function(j){var k=null;var l=null;if(j){k=j;if(!(k instanceof sap.ui.vk.Scene)){k=null;}l=j.camera;if(!(l instanceof sap.ui.vk.Camera)){l=null;}}this._setScene(k);if(l){this.setCamera(l);}};
c.prototype._onAfterUpdateContentConnector=function(){this._setContent(this._contentConnector.getContent());};
c.prototype._onBeforeClearContentConnector=function(){if(d._onBeforeClearContentConnector){d._onBeforeClearContentConnector.call(this);}this._setScene(null);};
c.prototype._handleContentReplaced=function(j){var k=j.getParameter("newContent");this._setContent(k);};
c.prototype._setScene=function(j){if(j instanceof sap.ui.vk.Scene){var k=j.getMetadata().getName(),l=this._implementation&&this._implementation.getMetadata().getName(),r=k==="sap.ui.vk.dvl.Scene"&&l==="sap.ui.vk.dvl.Viewport"||k==="sap.ui.vk.threejs.Scene"&&l==="sap.ui.vk.threejs.Viewport";if(!r){this._destroyImplementation();var n;var t=this;var m=this.getCamera();if(k==="sap.ui.vk.dvl.Scene"){n="sap.ui.vk.dvl.Viewport";}else if(k==="sap.ui.vk.threejs.Scene"){n="sap.ui.vk.threejs.Viewport";}if(n){q.sap.require(n);this._implementation=new(q.sap.getObject(n))({viewStateManager:this.getViewStateManager(),urlClicked:function(o){t.fireUrlClicked({nodeRef:o.getParameter("nodeRef"),url:o.getParameter("url")});},nodeClicked:function(o){t.fireNodeClicked({nodeRef:o.getParameter("nodeRef"),x:o.getParameter("x"),y:o.getParameter("y")});},resize:function(o){t.fireResize({size:o.getParameter("size")});},showDebugInfo:this.getShowDebugInfo(),width:this.getWidth(),height:this.getHeight(),backgroundColorTop:this.getBackgroundColorTop(),backgroundColorBottom:this.getBackgroundColorBottom(),selectionMode:this.getSelectionMode(),contentConnector:this.getContentConnector(),freezeCamera:this.getFreezeCamera()});if(m){this._camera=null;this._implementation.setCamera(m);}if("graphicsCore"in this._deferred&&this._implementation.setGraphicsCore){this._implementation.setGraphicsCore(this._deferred.graphicsCore);}delete this._deferred.graphicsCore;if("scene"in this._deferred&&this._implementation.setScene){this._implementation.setScene(this._deferred.scene);}delete this._deferred.scene;this._implementation.attachNodesPicked(function(o){this.fireNodesPicked({picked:o.getParameter("picked")});},this);this._implementation.attachNodeZoomed(function(o){this.fireNodeZoomed({zoomed:o.getParameter("zoomed"),isZoomIn:o.getParameter("isZoomIn")});},this);}this.invalidate();}}else{this._destroyImplementation();this.invalidate();}return this;};
c.prototype._onAfterUpdateViewStateManager=function(){if(this._implementation){this._implementation.setViewStateManager(this._viewStateManager);}};
c.prototype._onBeforeClearViewStateManager=function(){if(this._implementation){this._implementation.setViewStateManager(null);}};
c.prototype.activateView=function(v){if(this._implementation){this._implementation.activateView(v);return this;}else{q.sap.log.error("no implementation");return this;}};
c.prototype.zoomTo=function(w,n,j,m){if(this._implementation){this._implementation.zoomTo(w,n,j,m);return this;}else{q.sap.log.error("no implementation");return this;}};
c.prototype.tap=function(x,y,j){if(this._implementation){this._implementation.tap(x,y,j);}return this;};
var s=function(j){j.camera={};};var e=function(j){if(typeof j.camera==="object"&&j.camera!==null){j.camera.matrices=false;}};var f=function(j){if(typeof j.camera==="object"&&j.camera!==null){j.camera.useTransitionCamera=false;}};var g=function(j){j.animation=true;};var h=function(j){j.visibility=false;};var i=function(j){if(typeof j.visibility==="object"&&j.visibility!==null){j.visibility.mode=sap.ui.vk.VisibilityMode.Complete;}};
c.prototype.getViewInfo=function(j){if(!this._implementation){q.sap.log.error("no implementation");return null;}var k={};if(typeof j!=="object"||j===null){s(k);e(k);f(k);g(k);h(k);i(k);}else{if(typeof j.camera==="object"&&j.camera!==null){k.camera={};if(typeof j.camera.matrices==="boolean"){k.camera.matrices=j.camera.matrices;}else if("matrices"in j.camera){k.camera.matrices=false;}else{e(k);}if(typeof j.camera.useTransitionCamera==="boolean"){k.camera.useTransitionCamera=j.camera.useTransitionCamera;}else if("useTransitionCamera"in j.camera){k.camera.useTransitionCamera=false;}else{f(k);}}else if(typeof j.camera==="boolean"){if(j.camera===true){k.camera={};e(k);f(k);}else{k.camera=false;}}else if("camera"in j){k.camera=false;}else{s(k);e(k);f(k);}if(typeof j.animation==="boolean"){k.animation=j.animation;}else if("animation"in j){k.animation=false;}else{g(k);}if(typeof j.visibility==="object"&&j.visibility!==null){k.visibility={};if(j.visibility.mode===sap.ui.vk.VisibilityMode.Complete||j.visibility.mode===sap.ui.vk.VisibilityMode.Differences){k.visibility.mode=j.visibility.mode;}else{i(k);}}else if(typeof j.visibility==="boolean"){if(j.visibility===true){k.visibility={};i(k);}else{k.visibility=false;}}else if("visibility"in j){k.visibility=false;}else{h(k);i(k);}}return this._implementation.getViewInfo(k);};
c.prototype.setViewInfo=function(v,j){if(this._implementation){this._implementation.setViewInfo(v,j);}else{q.sap.log.error("no implementation");}return this;};
c.prototype.getImage=function(w,j,t,k,l){if(this._implementation&&this._implementation.getImage){return this._implementation.getImage(w,j,t,k,l);}return null;};
C.injectMethodsIntoClass(c);a.injectMethodsIntoClass(c);return c;});
sap.ui.predefine('sap/ui/vk/ViewportBase',["sap/ui/core/Control"],function(C){"use strict";
var V=C.extend("sap.ui.vk.ViewportBase",{metadata:{library:"sap.ui.vk","abstract":true,properties:{showDebugInfo:{type:"boolean",defaultValue:false},backgroundColorTop:{type:"sap.ui.core.CSSColor",defaultValue:"rgba(50, 50, 50, 1)"},backgroundColorBottom:{type:"sap.ui.core.CSSColor",defaultValue:"rgba(255, 255, 255, 1)"},width:{type:"sap.ui.core.CSSSize",defaultValue:"100%"},height:{type:"sap.ui.core.CSSSize",defaultValue:"100%"},selectionMode:{type:"sap.ui.vk.SelectionMode",defaultValue:sap.ui.vk.SelectionMode.Sticky},freezeCamera:{type:"boolean",defaultValue:false}},associations:{contentConnector:{type:"sap.ui.vk.ContentConnector",multiple:false},viewStateManager:{type:"sap.ui.vk.ViewStateManager",multiple:false},tools:{type:"sap.ui.vk.tools.Tool",multiple:true}},events:{urlClicked:{parameters:{nodeRef:"any",url:"string"},enableEventBubbling:true},nodeClicked:{parameters:{nodeRef:"any",x:"int",y:"int"},enableEventBubbling:true},resize:{parameters:{size:"object"}},nodesPicked:{parameters:{picked:{type:"any[]"}},enableEventBubbling:true},nodeZoomed:{parameters:{zoomed:{type:"any"},isZoomIn:{type:"boolean"}},enableEventBubbling:true}}}});
var b=V.getMetadata().getParent().getClass().prototype;
V.prototype.init=function(){if(b.init){b.init.call(this);}this._camera=null;};
V.prototype.exit=function(){if(this._camera){if(this._contentConnector){var c=this._contentConnector.getContentManager();if(c){c.destroyCamera(this._camera);}this._camera=null;}}if(b.exit){b.exit.call(this);}};
V.prototype.getImage=function(w,h){return null;};
V.prototype.stickySelectionHandler=function(n){if(this._viewStateManager==null){return;}if(n.length===0){var c=[];this._viewStateManager.enumerateSelection(function(e){c.push(e);});if(c.length>0){this._viewStateManager.setSelectionStates([],c);}}else{var s=[];var d=[];var i=this._viewStateManager.getSelectionState(n);for(var a=0;a<i.length;a++){if(i[a]){d.push(n[a]);}else{s.push(n[a]);}}this._viewStateManager.setSelectionStates(s,d);}};
V.prototype.exclusiveSelectionHandler=function(n){if(this._viewStateManager==null){return;}var a=true;if(n.length===1){a=!this._viewStateManager.getSelectionState(n[0]);}else if(n.length>1){var i=this._viewStateManager.getSelectionState(n);for(var c=0;c<i.length;c++){if(i[c]){a=false;break;}}}var u=[];if(n.length===0||a){this._viewStateManager.enumerateSelection(function(s){u.push(s);});}this._viewStateManager.setSelectionStates(n,u);};
V.prototype.setCamera=function(c){if(c!==this._camera){if(this._camera&&this._contentConnector){var a=this._contentConnector.getContentManager();if(a){a.destroyCamera(this._camera);}}}this._camera=c;return this;};
V.prototype.getCamera=function(){return this._camera;};
V.prototype._onBeforeClearContentConnector=function(){this.setCamera(null);};
V.prototype.activateView=function(v){return this;};
return V;});
sap.ui.predefine('sap/ui/vk/ViewportHandler',["jquery.sap.global","sap/ui/base/EventProvider"],function(q,E){"use strict";
var V=E.extend("sap.ui.vk.ViewportHandler",{
metadata:{publicMethods:["beginGesture","move","endGesture","click","doubleClick","contextMenu","getViewport"]},
constructor:function(a){this._viewport=a;this._rect=null;this._evt={x:0,y:0,z:0,d:0,tdx:0,tdy:0,tdd:0,initd:0};this._gesture=false;this._viewport.attachEvent("resize",this,this._onresize);this._nomenu=false;}
});
V.prototype.destroy=function(){this._viewport=null;this._rect=null;this._evt=null;this._gesture=false;};
V.prototype._getOffset=function(o){var r=o.getBoundingClientRect();var p={x:r.left+window.pageXOffset,y:r.top+window.pageYOffset};return p;};
V.prototype._inside=function(e){if(this._rect==null||true){var i=this._viewport.getIdForLabel();var d=document.getElementById(i);if(d==null){return false;}var o=this._getOffset(d);this._rect={x:o.x,y:o.y,w:d.offsetWidth,h:d.offsetHeight};}return(e.x>=this._rect.x&&e.x<=this._rect.x+this._rect.w&&e.y>=this._rect.y&&e.y<=this._rect.y+this._rect.h);};
V.prototype._onresize=function(e){this._gesture=false;this._rect=null;};
V.prototype.beginGesture=function(a){if(this._inside(a)&&!this._gesture){this._gesture=true;var x=a.x-this._rect.x,y=a.y-this._rect.y;this._evt.tdx=0;this._evt.tdy=0;this._evt.tdd=0;this._evt.x=x;this._evt.y=y;this._evt.d=a.d;this._evt.initd=a.d;this._evt.avgd=a.d;this._evt.avgx=0;this._evt.avgy=0;q.sap.log.debug("Loco: beginGesture: "+x+", "+y);this._viewport.queueCommand(function(){this._viewport.beginGesture(x,y);}.bind(this));a.handled=true;if(document.activeElement){try{document.activeElement.blur();}catch(e){}}var d=document.getElementById(this._viewport.getIdForLabel());d.focus();}this._nomenu=false;};
V.prototype.move=function(e){if(this._gesture){var x=e.x-this._rect.x,y=e.y-this._rect.y;var d=x-this._evt.x;var a=y-this._evt.y;var b=e.d-this._evt.d;this._evt.tdx=this._evt.tdx+d;this._evt.tdy=this._evt.tdy+a;this._evt.tdd=this._evt.tdd+b;this._evt.x=x;this._evt.y=y;this._evt.d=e.d;this._evt.avgx=this._evt.avgx*0.99+d*0.01;this._evt.avgy=this._evt.avgy*0.99+a*0.01;var z=1.0;if(this._evt.initd>0){z=1.0+b*(1.0/this._evt.initd);}else if(e.n==2){if(e.points[0].y>e.points[1].y){z=1.0-b*0.005;if(z<0.333){z=0.333;}}else{z=1.0+b*0.005;if(z>3){z=3;}}}if(this._evt.initd>0){var c=Math.sqrt(this._evt.avgx*this._evt.avgx+this._evt.avgy*this._evt.avgy);q.sap.log.debug("AvgDist: "+c);if((Math.abs(e.d-this._evt.avgd)/this._evt.avgd)<(c/10)){z=1.0;}}this._evt.avgd=this._evt.avgd*0.97+e.d*0.03;this._evt.n=e.n;switch(e.n){case 1:q.sap.log.debug("Loco: Rotate: "+(d)+", "+(a));this._viewport.queueCommand(function(){this._viewport.rotate(d,a);}.bind(this));break;case 2:q.sap.log.debug("Loco: Pan: "+(d)+", "+(a));if(z!=0&&z!=1.0){q.sap.log.debug("Loco: Zoom: "+(z));}this._viewport.queueCommand(function(){if(this._evt.tdx!==0&&this._evt.tdy!==0){this._viewport.pan(d,a);}if((d<10&&a<10&&z!=0&&z!=1.0)&&this._evt.tdd!==0){this._viewport.zoom(z);}}.bind(this));break;default:break;}this._nomenu=true;e.handled=true;}};
V.prototype.endGesture=function(e){if(this._gesture){var x=e.x-this._rect.x,y=e.y-this._rect.y;q.sap.log.debug("Loco: endGesture: "+x+", "+y);this._viewport.queueCommand(function(){this._viewport.endGesture();}.bind(this));this._gesture=false;e.handled=true;}};
V.prototype.click=function(e){if(this._inside(e)&&e.buttons<=1){var x=e.x-this._rect.x,y=e.y-this._rect.y;q.sap.log.debug("Loco: click: "+(x)+", "+(y));this._viewport.queueCommand(function(){this._viewport.tap(x,y,false);}.bind(this));e.handled=true;}};
V.prototype.doubleClick=function(e){if(this._inside(e)&&e.buttons<=1){var x=e.x-this._rect.x,y=e.y-this._rect.y;q.sap.log.debug("Loco: doubleClick: "+(x)+", "+(y));this._viewport.queueCommand(function(){this._viewport.tap(x,y,true);}.bind(this));e.handled=true;}};
V.prototype.contextMenu=function(e){if(this._inside(e)||this._nomenu||e.buttons==5){this._nomenu=false;e.handled=true;}};
V.prototype.keyEventHandler=function(e){};
V.prototype.getViewport=function(){return this._viewport;};
return V;},true);
sap.ui.predefine('sap/ui/vk/ViewportRenderer',["jquery.sap.global"],function(q){"use strict";var V={};
V.render=function(r,c){if(c._implementation){r.renderControl(c._implementation);}else{r.write("<div");r.writeControlData(c);r.addClass("sapVizKitViewport");r.writeClasses();r.writeAttribute("tabindex",0);var a=false;var w=c.getWidth();if(w){r.addStyle("width",w);a=true;}var h=c.getHeight();if(h){r.addStyle("height",h);a=true;}if(a){r.writeStyles();}r.write(">");r.write("</div>");}};
return V;},true);
sap.ui.predefine('sap/ui/vk/dvl/BaseNodeProxy',["jquery.sap.global","../library","../BaseNodeProxy"],function(q,l,B){"use strict";var g=sap.ui.vk.dvl.getJSONObject;
var a=B.extend("sap.ui.vk.dvl.BaseNodeProxy",{metadata:{}});
a.prototype.init=function(n,b){this._dvl=n?n.getGraphicsCore()._getDvl():null;this._dvlSceneRef=n?n.getSceneRef():null;this._dvlNodeRef=b;};
a.prototype.reset=function(){this._dvlNodeRef=null;this._dvlSceneRef=null;this._dvl=null;};
a.prototype.getNodeRef=function(){return this._dvlNodeRef;};
a.prototype.getNodeId=function(){return this._dvlNodeRef;};
a.prototype.getName=function(){return g(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneRef,this._dvlNodeRef,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_NAME)).NodeName;};
a.prototype.getNodeMetadata=function(){return g(this._dvl.Scene.RetrieveMetadata(this._dvlSceneRef,this._dvlNodeRef)).metadata;};
a.prototype.getHasChildren=function(){return(g(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneRef,this._dvlNodeRef,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_FLAGS)).Flags&(sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_MAPPED_HASCHILDREN|sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_CLOSED))===sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_MAPPED_HASCHILDREN;};
a.prototype.getSceneRef=function(){return this._dvlNodeRef;};
return a;});
sap.ui.predefine('sap/ui/vk/dvl/ContentManager',["jquery.sap.global","../DvlException","../Messages","../ContentManager"],function(q,D,M,C){"use strict";
var a=C.extend("sap.ui.vk.dvl.ContentManager",{metadata:{library:"sap.ui.vk"}});
var b=a.getMetadata().getParent().getClass().prototype;
a.prototype.init=function(){if(b.init){b.init.call(this);}this._handleDownloadingProgressProxy=this._handleDownloadingProgress.bind(this);this._graphicsCore=null;this._failedSources=[];};
a.prototype.exit=function(){if(this._graphicsCore){this._graphicsCore.destroy();this._graphicsCore=null;}if(b.exit){b.exit.call(this);}};
var r={},w={antialias:true,alpha:true,premultipliedAlpha:true};
a.getRuntimeSettings=function(){return r;};
a.setRuntimeSettings=function(s){r=s;};
a.getWebGLContextAttributes=function(){return w;};
a.setWebGLContextAttributes=function(c){w=q.extend(w,c);};
a.prototype._getGraphicsCore=function(){var t=this;return new Promise(function(c,d){if(t._graphicsCore){c(t._graphicsCore);}else{sap.ui.require(["sap/ui/vk/dvl/GraphicsCore"],function(G){t._graphicsCore=new G(r,w);t._graphicsCore.attachSceneLoadingStarted(t._handleDvlSceneLoadingStarted,t);t._graphicsCore.attachSceneLoadingFinished(t._handleDvlSceneLoadingFinished,t);t._graphicsCore.attachSceneLoadingProgress(t._handleDvlSceneLoadingProgress,t);c(t._graphicsCore);});}});};
a.prototype._handleDownloadingProgress=function(e){var s=e.getParameter("source"),l=e.getParameter("loaded"),t=e.getParameter("total"),v=t?l/t*50:0;this.fireContentChangesProgress({phase:"downloading",source:s,percentage:v});};
a.prototype._handleDvlSceneLoadingProgress=function(e){this.fireContentChangesProgress({phase:"building",source:e.getParameter("source"),percentage:50+e.getParameter("percentage")*50});};
a.prototype._handleDvlSceneLoadingStarted=function(e){};
a.prototype._handleDvlSceneLoadingFinished=function(e){};
a.prototype.loadContent=function(c,d){this.fireContentChangesStarted();var t=this;this._getGraphicsCore().then(function(g){g.setDecryptionHandler(t._decryptionHandler);g.loadContentResourcesAsync(d,function(s){var f=[];if(s){s.forEach(function(i){f.push({error:i,errorMessage:"Failed to download source '"+i.source+"'."});});}var l=c?c:undefined;g.updateSceneTreeAsync(l,d).then(function(e){var h={content:e.scene};if(e.failureReason){f=f.concat(e.failureReason);}if(f.length>0){h.failureReason=f;}t.fireContentChangesFinished(h);}).catch(function(e){if(typeof e==="string"){f.push({error:e,errorMessage:e});}else{f.push({error:e,errorMessage:e.message?e.message:e.errorMessage});}t.fireContentChangesFinished({content:null,failureReason:f});});},t._handleDownloadingProgressProxy);},function(e){t.fireContentChangesFinished({content:null,failureReason:{error:e,errorMessage:"Failed to create DVL graphics core object."}});});return this;};
a.prototype.destroyContent=function(c){if(c){this._graphicsCore.destroyScene(c);}return this;};
a.prototype.collectGarbage=function(){this._graphicsCore.collectGarbage();return this;};
return a;});
sap.ui.predefine('sap/ui/vk/dvl/GraphicsCore',["jquery.sap.global","../library","sap/ui/base/EventProvider","../ve/thirdparty/html2canvas","../ve/dvl","./Scene","./NodeHierarchy","../ContentResource","../DownloadManager","./ViewStateManager","../DvlException","../Messages","sap/ui/thirdparty/URI"],function(q,l,E,H,D,S,N,C,a,V,b,M,U){"use strict";var c=q.sap.log;
function g(e){return e instanceof File?"local":"remote";}
function d(e){return e instanceof File?e.name:e;}
var f=function(e){Object.defineProperties(this,{source:{value:e,writable:false,enumerable:true},_refCount:{value:0,writable:true,enumerable:false}});};
f.prototype.isInUse=function(){return this._refCount>0;};
f.prototype.addRef=function(){++this._refCount;return this;};
f.prototype.release=function(){--this._refCount;return this;};
f.prototype.destroy=function(){};
var h=function(e,v,i){f.call(this,e);Object.defineProperties(this,{content:{value:i,writable:false,enumerable:true},vdsSourceDatum:{value:v,writable:false,enumerable:true}});};h.prototype=Object.create(f.prototype);h.prototype.constructor=h;
h.prototype.destroy=function(){if(this.vdsSourceDatum){this.vdsSourceDatum.release();}f.prototype.destroy.call(this);};
var j=function(e,i,m){Object.defineProperties(this,{dvlSceneId:{value:e,writable:false,enumerable:true},sourceDatum:{value:i,writable:false,enumerable:true},root:{value:!!m,writable:false,enumerable:true},_refCount:{value:0,writable:true,enumerable:false}});};
j.prototype.isInUse=function(){return this._refCount>0;};
j.prototype.addRef=function(){++this._refCount;return this;};
j.prototype.release=function(){--this._refCount;return this;};
j.prototype.destroy=function(){if(this.sourceDatum){this.sourceDatum.release();}};
var k=function(e,i){Object.defineProperties(this,{source:{value:e.getSource()},sourceType:{value:e.getSourceType()},sourceId:{value:e.getSourceId(),writable:true},name:{value:e.getName()},localMatrix:{value:e.getLocalMatrix(),writable:true},password:{value:e.getPassword()},children:{value:e.getContentResources().map(function(e){return new k(e);})},dvlSceneDatum:{value:null,writable:true},nodeProxy:{value:null,writable:true},fake:{value:!!i},sourceProperties:{value:null,writable:true}});e._shadowContentResource=this;};
k.prototype.destroy=function(){if(this.dvlSceneDatum){this.dvlSceneDatum.release();}};
var n=function(v,e){Object.defineProperties(this,{vkScene:{value:v},shadowContentResource:{value:e}});};
var G=E.extend("sap.ui.vk.dvl.GraphicsCore",{
metadata:{publicMethods:["attachSceneLoadingFinished","attachSceneLoadingProgress","attachSceneLoadingStarted","buildSceneTree","buildSceneTreeAsync","createViewStateManager","destroyScene","destroyViewStateManager","detachSceneLoadingFinished","detachSceneLoadingProgress","detachSceneLoadingStarted","getApi","loadContentResourcesAsync","showDebugInfo","updateSceneTree","updateSceneTreeAsync"]},
constructor:function(e,w){E.apply(this);var i=q.extend({},e,{filePackagePrefixURL:q.sap.getResourcePath("sap/ve")+"/"});this._dvlClientId=q.sap.uid();this._dvl=sap.ve.dvl.createRuntime(i);this._dvl.CreateCoreInstance(this._dvlClientId);sap.ui.vk.dvl.checkResult(this._dvl.Core.Init(this._DVLMajorVersion,this._DVLMinorVersion));var u=sap.ui.getCore();u.attachLocalizationChanged(this._onlocalizationChanged,this);sap.ui.vk.dvl.checkResult(this._dvl.Core.SetLocale(u.getConfiguration().getLanguageTag()));this._canvas=this._createRenderingCanvasAndContext(w);this._rendererId=sap.ui.vk.dvl.getPointer(this._dvl.Core.CreateRenderer());this._dvl.Renderer.SetOptionF(sap.ve.dvl.DVLRENDEROPTIONF.DVLRENDEROPTIONF_DPI,96*window.devicePixelRatio,this._rendererId);this._sourceData=[];this._dvlSceneData=[];this._vkSceneData=[];this._viewports=[];this._renderLoopRequestId=null;this._renderLoopFunction=this._renderLoop.bind(this);this._viewStateManagers=[];},
_DVLMajorVersion:7,
_DVLMinorVersion:2
});
G.prototype.destroy=function(){sap.ui.getCore().detachLocalizationChanged(this._onlocalizationChanged,this);var v=this._viewports.slice();v.reverse();v.forEach(function(e){e.control.setGraphicsCore(null);});this._viewports=null;this._cleanupVkSceneData();this._vkSceneData=null;this._cleanupDvlSceneData();this._dvlSceneData=null;this._cleanupSourceData();this._sourceData=null;this._viewStateManagers.slice().forEach(this.destroyViewStateManager.bind(this));this._viewStateManagers=null;this._webGLContext=null;this._canvas=null;this._dvl.Core.DeleteRenderer(this._rendererId);this._rendererId=null;this._dvl.Core.Release();this._dvl=null;E.prototype.destroy.apply(this);};
G.prototype._createRenderingCanvasAndContext=function(w){var e=document.createElement("canvas");e.id=q.sap.uid();this._webGLContext=this._dvl.Core.CreateWebGLContext(e,w);return e;};
G.prototype._getCanvas=function(){return this._canvas;};
G.prototype._getWebGLContext=function(){return this._webGLContext;};
G.prototype._getDvl=function(){return this._dvl;};
G.prototype._getDvlClientId=function(){return this._dvlClientId;};
G.prototype._findSourceData=function(e){var i=Object.getOwnPropertyNames(e);return this._sourceData.filter(function(m){return i.every(function(t){return e[t]===m[t];});});};
G.prototype._destroySourceDatum=function(e){if(!(e instanceof h)){this._dvl.Core.DeleteFileByUrl(d(e.source),g(e.source));}e.destroy();return this;};
G.prototype._cleanupSourceData=function(){var e=false;for(var i=this._sourceData.length-1;i>=0;--i){var m=this._sourceData[i];if(!m.isInUse()){var t=m instanceof h?m.vdsSourceDatum:null;this._sourceData.splice(i,1);this._destroySourceDatum(m);if(t&&!t.isInUse()){e=true;}}}if(e){this._cleanupSourceData();}return this;};
G.prototype._findDvlSceneData=function(e){var i=Object.getOwnPropertyNames(e);return this._dvlSceneData.filter(function(m){return i.every(function(t){return e[t]===m[t];});});};
G.prototype._destroyDvlSceneDatum=function(e){this._dvl.Scene.Release(e.dvlSceneId);e.destroy();return this;};
G.prototype._cleanupDvlSceneData=function(){for(var i=this._dvlSceneData.length-1;i>=0;--i){var e=this._dvlSceneData[i];if(!e.isInUse()){this._dvlSceneData.splice(i,1);this._destroyDvlSceneDatum(e);}}};
G.prototype._findVkSceneData=function(e){var i=Object.getOwnPropertyNames(e);return this._vkSceneData.filter(function(m){return i.every(function(t){return e[t]===m[t];});});};
G.prototype._cleanupVkSceneData=function(){for(var i=this._vkSceneData.length-1;i>=0;--i){this.destroyScene(this._vkSceneData[i].vkScene);}};
G.prototype._destroyShadowContentResource=function(v,i){if(i.children){i.children.forEach(this._destroyShadowContentResource.bind(this,v));}if(i.nodeProxy){var m=v.getDefaultNodeHierarchy();try{m.removeNode(i.nodeProxy.getNodeRef());}catch(e){var t="Failed to delete node with ID = "+i.nodeProxy.getNodeRef()+".";if(e instanceof b){t+=" Error code: "+e.code+". Message: "+e.message+".";}c.error(t);}m.destroyNodeProxy(i.nodeProxy);}i.destroy();};
G.prototype._filterContentResources=function(e,i){var m=[];e.forEach(function enumerate(t){if(i(t)){m.push(t);}t.getContentResources().forEach(enumerate);});return m;};
G.prototype._getContentResourcesWithMissingPasswords=function(i){var l=this._dvl.Library;return this._filterContentResources(i,function(m){var t=m.getSource();try{return t&&(sap.ui.vk.dvl.getJSONObject(l.RetrieveInfo(d(t),g(t))).flags&sap.ve.dvl.DVLFILEFLAG.ENCRYPTED)&&!m.getPassword();}catch(e){c.warning("Failed to get information from Emscripten virtual file system about file '"+d(t)+"'");return false;}});};
G.prototype._getContentResourcesWithEncryptedVds3=function(i){var l=this._dvl.Library;return this._filterContentResources(i,function(m){var t=m.getSource();if(t){try{var u=sap.ui.vk.dvl.getJSONObject(l.RetrieveInfo(d(t),g(t)));return u.major<=3&&(u.flags&sap.ve.dvl.DVLFILEFLAG.ENCRYPTED);}catch(e){c.warning("Failed to get information from Emscripten virtual file system about file '"+d(t)+"'");return false;}}else{return false;}});};
G.prototype._collectAndCheckSourceProperties=function(i){var m=i.dvlSceneDatum.sourceDatum;if(!m){return this;}try{if(m instanceof h){m=m.vdsSourceDatum;}var t=sap.ui.vk.dvl.getJSONObject(this._dvl.Library.RetrieveInfo(d(m.source),g(m.source)));i.sourceProperties={version:{major:t.major,minor:t.minor}};if(t.flags&(sap.ve.dvl.DVLFILEFLAG.PAGESCOMPRESSED|sap.ve.dvl.DVLFILEFLAG.WHOLEFILECOMPRESSED)){i.sourceProperties.compressed=true;}if(t.flags&sap.ve.dvl.DVLFILEFLAG.ENCRYPTED){i.sourceProperties.encrypted=true;}}catch(e){c.warning("Failed to get information from Emscripten virtual file system about file '"+d(i.source)+"'");}return this;};
G.prototype.loadContentResourcesAsync=function(e,i,t){var u=this,v=[],w=new Map();e.forEach(function enumerate(m){var A=m.getSource();if(A&&v.indexOf(A)<0&&u._findSourceData({source:A}).length===0){v.push(A);var B=m.getSource();var F;if(B instanceof Object){F=B.name;}else{F=B;}if(m.getSourceType()==="vdsl"||m.getSourceType()==="vds"&&F.split(".").pop()==="vdsl"){w.set(A,{});}}m.getContentResources().forEach(enumerate);});var x=[];if(v.length>0){var y;var z=new a(v).attachItemSucceeded(function(A){var B=A.getParameter("source");var F=A.getParameter("response");if(w.has(B)){var I=sap.ui.vk.utf8ArrayBufferToString(F);if(I.trim().length===0){y=y||[];y.push({source:B,status:M.VIT22.code,statusText:sap.ui.vk.getResourceBundle().getText(M.VIT22.summary)});c.error(sap.ui.vk.getResourceBundle().getText(M.VIT22.summary),M.VIT22.code,"sap.ui.vk.dvl.GraphicsCore");return;}else{var J=I.split(/\n|\r\n/);var m=J[0].match(/^file=(.+)$/);if(!m){y=y||[];y.push({source:B,status:M.VIT23.code,statusText:sap.ui.vk.getResourceBundle().getText(M.VIT23.summary)});c.error(sap.ui.vk.getResourceBundle().getText(M.VIT23.summary),M.VIT23.code,"sap.ui.vk.dvl.GraphicsCore");return;}else{var K=w.get(B);K.content=J;var L=m[1];var O=L;var P=new U(O);if(P.is("relative")){if(B instanceof File){y=y||[];y.push({source:B,status:M.VIT24.code,statusText:sap.ui.vk.getResourceBundle().getText(M.VIT24.summary)});c.error(sap.ui.vk.getResourceBundle().getText(M.VIT24.summary),M.VIT24.code,"sap.ui.vk.dvl.GraphicsCore");return;}else{var Q=new U(B);L=P.absoluteTo(Q).href();}}K.referencedSource=L;K.content[0]=K.content[0].replace(O,this._dvl.Core.GetFilename(K.referencedSource,"remote"));if(v.indexOf(K.referencedSource)<0&&this._findSourceData({source:K.referencedSource}).length===0){v.push(K.referencedSource);z.queue(K.referencedSource);}}}}else{var R=B instanceof File;var T=R?B.name:B;var W=g(B);this._dvl.Core.CreateFileFromArrayBuffer(F,T,W);x.push(new f(B));}},this).attachAllItemsCompleted(function(m){Array.prototype.push.apply(this._sourceData,x);w.forEach(function(A,B){var F=this._findSourceData({source:A.referencedSource})[0];var I=new h(B,F,A.content.join("\n"));this._sourceData.push(I);F.addRef();}.bind(this));if(i){i(y);}},this).attachItemFailed(function(m){y=y||[];y.push({source:m.getParameter("source"),status:m.getParameter("status"),statusText:m.getParameter("statusText")});},this);if(t){z.attachItemProgress(t,this);}z.start();}else if(i){i();}return this;};
G.prototype._buildPlaceholders=function(e,i,m,t){var u=[];t.forEach(function build(i,m,v){var w=e.createNode(i,v.name,m);v.nodeProxy=e.createNodeProxy(w);if(v.localMatrix){v.nodeProxy.setLocalMatrix(v.localMatrix);}if(v.source){u.push(v);}v.children.forEach(build.bind(this,w,null));}.bind(this,i,m));return u;};
G.prototype._updatePlaceholders=function(v,e,m){var t=this,u=v.getDefaultNodeHierarchy(),w=[];(function update(x,m,y){function z(F,I){if(!F&&!I){return true;}else if(!!F^!!I){return false;}else{return F.source===I.getSource()&&F.sourceType===I.getSourceType()&&F.name===I.getName()&&F.password===I.getPassword();}}function A(F,I){I._shadowContentResource=F;F.sourceId=I.getSourceId();F.localMatrix=I.getLocalMatrix();if(F.nodeProxy){F.nodeProxy.setLocalMatrix(F.localMatrix);}}var i=0;var B=q.sap.arrayDiff(x,m,z,true);B.forEach(function(F){for(;i<F.index;++i){update(x[i].children,m[i].getContentResources(),x[i].nodeProxy.getNodeRef());A(x[i],m[i]);}if(F.type==="delete"){t._destroyShadowContentResource(v,x[F.index]);x.splice(F.index,1);}else if(F.type==="insert"){var I;if(i<x.length&&x[i].nodeProxy){I=x[i].nodeProxy.getNodeRef();}var J=new k(m[F.index]);w=w.concat(t._buildPlaceholders(u,y,I,[J]));x.splice(F.index,0,J);++i;}});for(;i<x.length;++i){update(x[i].children,m[i].getContentResources(),x[i].nodeProxy&&x[i].nodeProxy.getNodeRef());A(x[i],m[i]);}})(e.fake?e.children:[e],m,null);return w;};
G.prototype._loadAndMergeContentResource=function(i,m){if(m.source){var t=this._findSourceData({source:m.source})[0];if(!t){c.warning("Failed to load content resource with sourceId '"+m.sourceId+"' due to failed downloading from URL '"+d(m.source)+"'.");}else{var u=m.nodeProxy.getNodeRef();var v=this._findDvlSceneData({sourceDatum:t,root:false})[0];if(!v){try{v=new j(sap.ui.vk.dvl.getPointer(t instanceof h?this._dvl.Core.LoadSceneFromVDSL(t.content,m.password):this._dvl.Core.LoadSceneByUrl(d(m.source),m.password,g(m.source))),t,false);}catch(e){c.error(sap.ui.vk.getResourceBundle().getText(M.VIT34.summary)+": "+d(m.source),M.VIT34.code,"sap.ui.vk.dvl.GraphicsCore");return;}this._dvlSceneData.push(v);t.addRef();}m.dvlSceneDatum=v;v.addRef();this._collectAndCheckSourceProperties(m);this._dvl.Renderer.ResetView(sap.ve.dvl.DVLRESETVIEWFLAG.CAMERA,this._rendererId);this._dvl.Scene.Merge(i._dvlSceneRef,v.dvlSceneId,u);}}};
G.prototype.buildSceneTree=function(i){if(i.length===0){return null;}var m;var t;var u=i.map(function(y){return new k(y);});if(u.length===1&&u[0].name==null){t=u[0];if(t.source){var v=this._findSourceData({source:t.source})[0];try{m=new j(sap.ui.vk.dvl.getPointer(v instanceof h?this._dvl.Core.LoadSceneFromVDSL(v.content,t.password):this._dvl.Core.LoadSceneByUrl(d(t.source),t.password,g(t.source))),v,true);}catch(e){c.error(sap.ui.vk.getResourceBundle().getText(M.VIT34.summary)+": "+d(t.source),M.VIT34.code,"sap.ui.vk.dvl.GraphicsCore");return null;}v.addRef();}else{m=new j(this._dvl.Core.CreateEmptyScene(),null,true);}}else{var w=new C({sourceType:"vds",sourceId:q.sap.uid()});t=new k(w,true);w.destroy();w=null;Array.prototype.push.apply(t.children,u);u=[t];m=new j(this._dvl.Core.CreateEmptyScene(),null,true);}this._dvlSceneData.push(m);t.dvlSceneDatum=m;m.addRef();this._collectAndCheckSourceProperties(t);var x=new S(this,m.dvlSceneId);this._vkSceneData.push(new n(x,t));this._buildPlaceholders(x.getDefaultNodeHierarchy(),null,null,t.children).forEach(this._loadAndMergeContentResource.bind(this,x.getDefaultNodeHierarchy()));return x;};
G.prototype.updateSceneTree=function(v,e,i){if(e.length===0){return null;}var m;var t=this._getContentResourcesWithEncryptedVds3(e);if(t.length>0){c.error(sap.ui.vk.getResourceBundle().getText(M.VIT25.summary),M.VIT25.code,"sap.ui.vk.dvl.GraphicsCore");m=m||{};m.contentResourcesWithEncryptedVds3=t;}var u=this._getContentResourcesWithMissingPasswords(e);if(u.length>0){c.error(sap.ui.vk.getResourceBundle().getText(M.VIT21.summary),M.VIT21.code,"sap.ui.vk.dvl.GraphicsCore");m=m||{};m.contentResourcesWithMissingPasswords=u;}if(m&&i){i(m);}if(!v){return this.buildSceneTree(e);}var w=this._findVkSceneData({vkScene:v})[0].shadowContentResource;var x=!!w.source;var y=e.length===1&&!!e[0].getSource();if(!(x&&y&&w.source===e[0].getSource()||!x&&!y&&w.fake===e.length>1)||!w.fake&&e.length===1&&w.name!==e[0].getName()){return this.buildSceneTree(e);}this._updatePlaceholders(v,w,e).forEach(this._loadAndMergeContentResource.bind(this,v.getDefaultNodeHierarchy()));v.getDefaultNodeHierarchy().fireChanged();return v;};
G.prototype._loadDvlSceneAsync=function(i,m){return new Promise(function(t,u){var v;var w=function(z){v();this.fireSceneLoadingFinished({source:i.source,sceneId:z.sceneId});t(z.sceneId);};var x=function(z){v();var A=z.errorMessage;if(A==null){A=sap.ve.dvl.DVLRESULT.getDescription?sap.ve.dvl.DVLRESULT.getDescription(z.errorCode):"";}var B={source:i.source,errorCode:z.errorCode,errorMessage:A};this.fireSceneLoadingFinished(B);u(B);};var y=function(z,A){this.fireSceneLoadingProgress({source:d(i.source),percentage:A});return true;}.bind(this);v=function(){this._dvl.Client.NotifyFileLoadProgress=null;this._dvl.Client.detachSceneFailed(x,this);this._dvl.Client.detachSceneLoaded(w,this);}.bind(this);this._dvl.Client.attachSceneLoaded(w,this);this._dvl.Client.attachSceneFailed(x,this);this._dvl.Client.NotifyFileLoadProgress=y;this.fireSceneLoadingStarted({source:d(i.source)});try{sap.ui.vk.dvl.checkResult(i instanceof h?this._dvl.Core.LoadSceneFromVDSLAsync(i.content,m):this._dvl.Core.LoadSceneByUrlAsync(d(i.source),m,g(i.source)));}catch(e){v();x.call(this,{errorCode:e instanceof b?e.code:sap.ve.dvl.DVLRESULT.FAIL,errorMessage:e instanceof b?null:e});}}.bind(this));};
var o=function(e,i){return new Promise(function(m){(function step(t){if(t>=e.length){m();}else{i(e[t]).catch(function(){}).then(function(){step(t+1);});}})(0);});};
G.prototype._loadAndMergeContentResourcesAsync=function(e,i){var m,t=this;return o(i,function(u){if(u.source){var v=t._findSourceData({source:u.source})[0];if(!v){var w="Failed to load content resource with sourceId '"+u.sourceId+"' due to failed downloading from URL '"+d(u.source)+"'.";c.warning(w);m=m||[];m.push({errorMessage:w,source:u.source});return Promise.reject();}return(function(){var x=t._findDvlSceneData({sourceDatum:v,root:false})[0];if(x){return Promise.resolve(x);}else{return t._loadDvlSceneAsync(v,u.password).then(function(y){x=new j(y,v,false);t._dvlSceneData.push(x);v.addRef();return Promise.resolve(x);},function(y){m=m||[];m.push(y);return Promise.reject();});}})().then(function(x){u.dvlSceneDatum=x;x.addRef();t._collectAndCheckSourceProperties(u);var y=u.nodeProxy.getNodeRef();t._dvl.Renderer.ResetView(sap.ve.dvl.DVLRESETVIEWFLAG.CAMERA,t._rendererId);t._dvl.Scene.Merge(e._dvlSceneRef,x.dvlSceneId,y);return Promise.resolve();});}return Promise.resolve();}).then(function(){return Promise.resolve(m);});};
G.prototype.buildSceneTreeAsync=function(e){if(e.length===0){return Promise.resolve(null);}var i=e.map(function(m){return new k(m);});return function(){var m;if(i.length===1&&i[0].name==null){m=i[0];if(m.source){var t=this._findSourceData({source:m.source})[0];if(t){return this._loadDvlSceneAsync(t,m.password).then(function(v){var w=new j(v,t,true);t.addRef();return Promise.resolve({shadowContentResource:m,dvlSceneDatum:w});});}else{return Promise.reject({errorMessage:"Failed to download the root content resource.",source:m.source});}}return Promise.resolve({shadowContentResource:m,dvlSceneDatum:new j(this._dvl.Core.CreateEmptyScene(),null,true)});}else{var u=new C({sourceType:"vds",sourceId:q.sap.uid()});m=new k(u,true);u.destroy();u=null;Array.prototype.push.apply(m.children,i);i=[m];return Promise.resolve({shadowContentResource:m,dvlSceneDatum:new j(this._dvl.Core.CreateEmptyScene(),null,true)});}}.call(this).then(function(m){this._dvlSceneData.push(m.dvlSceneDatum);m.shadowContentResource.dvlSceneDatum=m.dvlSceneDatum;m.dvlSceneDatum.addRef();this._collectAndCheckSourceProperties(m.shadowContentResource);var v=new S(this,m.dvlSceneDatum.dvlSceneId);this._vkSceneData.push(new n(v,m.shadowContentResource));var t=v.getDefaultNodeHierarchy();return this._loadAndMergeContentResourcesAsync(t,this._buildPlaceholders(v.getDefaultNodeHierarchy(),null,null,m.shadowContentResource.children)).then(function(u){return Promise.resolve({scene:v,failureReason:u});});}.bind(this));};
G.prototype.updateSceneTreeAsync=function(v,e){if(e.length===0){return Promise.resolve(null);}var i=this._getContentResourcesWithEncryptedVds3(e);if(i.length>0){c.error(sap.ui.vk.getResourceBundle().getText(M.VIT25.summary),M.VIT25.code,"sap.ui.vk.dvl.GraphicsCore");}var m=this._getContentResourcesWithMissingPasswords(e);if(m.length>0){c.error(sap.ui.vk.getResourceBundle().getText(M.VIT21.summary),M.VIT21.code,"sap.ui.vk.dvl.GraphicsCore");}if(!v){return this.buildSceneTreeAsync(e);}var t=this._findVkSceneData({vkScene:v})[0].shadowContentResource;var u=!!t.source;var w=e.length===1&&!!e[0].getSource();if(!(u&&w&&t.source===e[0].getSource()||!u&&!w&&t.fake===e.length>1)||!t.fake&&e.length===1&&t.name!==e[0].getName()){return this.buildSceneTreeAsync(e);}return new Promise(function(x,y){var z=v.getDefaultNodeHierarchy();this._loadAndMergeContentResourcesAsync(z,this._updatePlaceholders(v,t,e)).then(function(A){x({scene:v,failureReason:A});z.fireChanged();});}.bind(this));};
G.prototype.destroyScene=function(v){var e;for(e=0;e<this._vkSceneData.length;++e){if(this._vkSceneData[e].vkScene===v){break;}}if(e===this._vkSceneData.length){c.warning("Scene with id '"+v.getId()+"' is not created by this GraphicsCore.");return this;}var i=this._vkSceneData.splice(e,1)[0];this._destroyShadowContentResource(v,i.shadowContentResource);v.destroy();return this;};
var p=function(e,m,t){for(var i=0,u=e.length;i<u;++i){if(m.call(t,e[i],i,e)){return i;}}return-1;};var r=function(v,e){return p(v,function(i){return i.control===e;});};var s=function(v,e){return p(v,function(i){return i.rendererId===e;});};
G.prototype._registerViewport=function(v){if(r(this._viewports,v)>=0){return false;}var e={control:v,canvas:null,rendererId:null};if(this._viewports.length===0){e.canvas=this._canvas;e.rendererId=this._rendererId;this._startRenderLoop();}else{if(this._viewports.length===1){var i=this._viewports[0];i.control._setCanvas(i.canvas=document.createElement("canvas"));this._dvl.Client.attachFrameFinished(this._handleFrameFinished,this);}e.canvas=document.createElement("canvas");e.rendererId=this._dvl.Core.CreateRenderer();}v._setCanvas(e.canvas);v._setRenderer(e.rendererId);v.attachResize(this._handleViewportResize,this);this._viewports.push(e);return true;};
G.prototype._deregisterViewport=function(v){var i=r(this._viewports,v);if(i<0){return false;}var e=this._viewports.splice(i,1)[0];if(this._viewports.length===0){this._stopRenderLoop();}else{if(this._viewports.length===1){this._dvl.Client.detachFrameFinished(this._handleFrameFinished,this);var m=this._viewports[1-i];m.control._setCanvas(m.canvas=this._canvas);}this._dvl.Core.DeleteRenderer(e.rendererId);}v.detachResize(this._handleViewportResize,this);v._setRenderer(null);v._setCanvas(null);return true;};
G.prototype._getViewportCount=function(){return this._viewports.length;};
G.prototype._handleViewportResize=function(e){if(this._viewports.length>1){this._canvas.width=Math.max.apply(null,this._viewports.map(function(v){return v.canvas.width;}));this._canvas.height=Math.max.apply(null,this._viewports.map(function(v){return v.canvas.height;}));}};
G.prototype._startRenderLoop=function(){if(!this._renderLoopRequestId){this._renderLoopRequestId=window.requestAnimationFrame(this._renderLoopFunction);}return this;};
G.prototype._stopRenderLoop=function(){if(this._renderLoopRequestId){window.cancelAnimationFrame(this._renderLoopRequestId);this._renderLoopRequestId=null;}return this;};
G.prototype._renderLoop=(function(){var e;return function(){var m=this._viewports.length>1;this._viewports.forEach(function(v){var i=v.canvas,t=v.rendererId;this._dvl.Renderer._processCommandQueue(t);if(i.width>0&&i.height>0&&this._dvl.Renderer.ShouldRenderFrame(t)){if(m&&e!==t){this._dvl.Renderer.SetDimensions(i.width,i.height,t);}v.control.renderFrame();e=t;}},this);this._renderLoopRequestId=window.requestAnimationFrame(this._renderLoopFunction);};})();
G.prototype._handleFrameFinished=function(e){if(this._viewports.length>1){var i=s(this._viewports,e.rendererId);if(i>=0){var t=this._viewports[i].canvas,m=t.getContext("2d"),u=t.width,v=t.height;m.drawImage(this._canvas,0,this._canvas.height-v,u,v,0,0,u,v);}}};
G.prototype.createViewStateManager=function(e,i){var v=new sap.ui.vk.dvl.ViewStateManager();v._setNodeHierarchy(e).setShouldTrackVisibilityChanges(i);this._viewStateManagers.push(v);return v;};
G.prototype.destroyViewStateManager=function(v){var i=this._viewStateManagers.indexOf(v);if(i>=0){this._viewStateManagers.splice(i,1)[0].destroy();}return this;};
G.prototype.showDebugInfo=function(e){this._viewports.forEach(function(v){v.control.setShowDebugInfo(e);});return this;};
G.prototype.getApi=function(e){switch(e){case sap.ui.vk.dvl.GraphicsCoreApi.LegacyDvl:return this._dvl;default:return null;}};
G.prototype.collectGarbage=function(){this._cleanupDvlSceneData();this._cleanupSourceData();return this;};
G.prototype._onlocalizationChanged=function(e){if(e.getParameter("changes").language){sap.ui.vk.dvl.checkResult(this._dvl.Core.SetLocale(sap.ui.getCore().getConfiguration().getLanguageTag()));}};
G.prototype.setDecryptionHandler=function(e){this._dvl.Client.setDecryptionHandler(e);return this;};
G.prototype.getDecryptionHandler=function(){return this._dvl.Client.getDecryptionHandler();};
G.prototype.attachSceneLoadingFinished=function(e,i,m){return this.attachEvent("sceneLoadingFinished",e,i,m);};
G.prototype.detachSceneLoadingFinished=function(e,i){return this.detachEvent("sceneLoadingFinished",e,i);};
G.prototype.fireSceneLoadingFinished=function(e,i,m){return this.fireEvent("sceneLoadingFinished",e,i,m);};
G.prototype.attachSceneLoadingProgress=function(e,i,m){return this.attachEvent("sceneLoadingProgress",e,i,m);};
G.prototype.detachSceneLoadingProgress=function(e,i){return this.detachEvent("sceneLoadingProgress",e,i);};
G.prototype.fireSceneLoadingProgress=function(e,i,m){return this.fireEvent("sceneLoadingProgress",e,i,m);};
G.prototype.attachSceneLoadingStarted=function(e,i,m){return this.attachEvent("sceneLoadingStarted",e,i,m);};
G.prototype.detachSceneLoadingStarted=function(e,i){return this.detachEvent("sceneLoadingStarted",e,i);};
G.prototype.fireSceneLoadingStarted=function(e,i,m){return this.fireEvent("sceneLoadingStarted",e,i,m);};
return G;});
sap.ui.predefine('sap/ui/vk/dvl/LayerProxy',["jquery.sap.global","../library","../LayerProxy"],function(q,l,L){"use strict";var g=sap.ui.vk.dvl.getJSONObject;
var a=L.extend("sap.ui.vk.dvl.LayerProxy",{
metadata:{publicMethods:["getDescription","getLayerId","getLayerMetadata","getName","getNodes","getVeIds"]},
constructor:function(n,b){L.call(this);this._dvl=n?n.getGraphicsCore()._getDvl():null;this._dvlSceneRef=n?n.getSceneRef():null;this._dvlLayerId=b;}
});
a.prototype.destroy=function(){this._dvlLayerId=null;this._dvlSceneRef=null;this._dvl=null;L.prototype.destroy.call(this);};
a.prototype.getLayerId=function(){return this._dvlLayerId;};
a.prototype.getVeIds=function(){return g(this._dvl.Scene.RetrieveVEIDs(this._dvlSceneRef,this._dvlLayerId));};
a.prototype.getName=function(){return g(this._dvl.Scene.RetrieveLayerInfo(this._dvlSceneRef,this._dvlLayerId)).name;};
a.prototype.getDescription=function(){return g(this._dvl.Scene.RetrieveLayerInfo(this._dvlSceneRef,this._dvlLayerId)).description;};
a.prototype.getLayerMetadata=function(){return g(this._dvl.Scene.RetrieveMetadata(this._dvlSceneRef,this._dvlLayerId)).metadata;};
a.prototype.getNodes=function(){return g(this._dvl.Scene.RetrieveLayerInfo(this._dvlSceneRef,this._dvlLayerId)).nodes;};
return a;});
sap.ui.predefine('sap/ui/vk/dvl/NodeHierarchy',["jquery.sap.global","../library","../NodeHierarchy","sap/ui/base/ObjectPool","./BaseNodeProxy","./NodeProxy","./LayerProxy","../Messages","../DvlException"],function(q,l,N,O,B,a,L,M,D){"use strict";var g=sap.ui.vk.dvl.getJSONObject;var b=q.sap.log;var s={modeDictionary:{equals:function(i){return i?sap.ve.dvl.DVLFINDNODEMODE.DVLFINDNODEMODE_EQUAL:sap.ve.dvl.DVLFINDNODEMODE.DVLFINDNODEMODE_EQUAL_CASE_INSENSITIVE;},contains:function(i){return i?sap.ve.dvl.DVLFINDNODEMODE.DVLFINDNODEMODE_SUBSTRING:sap.ve.dvl.DVLFINDNODEMODE.DVLFINDNODEMODE_SUBSTRING_CASE_INSENSITIVE;},startsWith:function(i){return i?sap.ve.dvl.DVLFINDNODEMODE.DVLFINDNODEMODE_STARTS_WITH:sap.ve.dvl.DVLFINDNODEMODE.DVLFINDNODEMODE_STARTS_WITH_CASE_INSENSITIVE;}}};
var c=N.extend("sap.ui.vk.dvl.NodeHierarchy",{
metadata:{},
_baseNodeProxyPool:new O(B),
constructor:function(d){N.call(this);this._graphicsCore=d.getGraphicsCore();this._scene=d;this._dvlSceneRef=this._scene.getSceneRef();this._dvl=this._graphicsCore._getDvl();this._nodeProxies=[];this._layerProxies=[];}
});
c.prototype.destroy=function(){this._layerProxies.slice().forEach(this.destroyLayerProxy,this);this._nodeProxies.slice().forEach(this.destroyNodeProxy,this);this._dvl=null;this._dvlSceneRef=null;this._scene=null;this._graphicsCore=null;N.prototype.destroy.call(this);};
c.prototype.getGraphicsCore=function(){return this._graphicsCore;};
c.prototype.getScene=function(){return this._scene;};
c.prototype.getSceneRef=function(){return this._dvlSceneRef;};
c.prototype.enumerateChildren=function(n,d,e,p){if(typeof n==="function"){p=e;e=d;d=n;n=undefined;}var f;if(n){if(e||(g(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneRef,n,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_FLAGS)).Flags&sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_CLOSED)===0){f=g(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneRef,n,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_CHILDREN)).ChildNodes;}else{f=[];}}else{f=g(this._dvl.Scene.RetrieveSceneInfo(this._dvlSceneRef,sap.ve.dvl.DVLSCENEINFO.DVLSCENEINFO_CHILDREN)).ChildNodes;}if(p){f.forEach(d);}else{var h=this._baseNodeProxyPool.borrowObject();try{f.forEach(function(n){h.init(this,n);d(h);h.reset();}.bind(this));}finally{this._baseNodeProxyPool.returnObject(h);}}return this;};
c.prototype.enumerateAncestors=function(n,d,p){var e=g(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneRef,n,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_PARENTS)).ParentNodes;if(p){e.forEach(d);}else{var f=this._baseNodeProxyPool.borrowObject();try{e.forEach(function(n){f.init(this,n);d(f);f.reset();}.bind(this));}finally{this._baseNodeProxyPool.returnObject(f);}}return this;};
c.prototype.createNodeProxy=function(n){var d=new a(this,n);this._nodeProxies.push(d);return d;};
c.prototype.destroyNodeProxy=function(n){var i=this._nodeProxies.indexOf(n);if(i>=0){this._nodeProxies.splice(i,1)[0].destroy();}return this;};
c.prototype.getChildren=function(n,d){if(typeof n==="boolean"){d=n;n=undefined;}if(n){if(d||(g(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneRef,n,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_FLAGS)).Flags&sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_CLOSED)===0){return g(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneRef,n,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_CHILDREN)).ChildNodes;}else{return[];}}else{return g(this._dvl.Scene.RetrieveSceneInfo(this._dvlSceneRef,sap.ve.dvl.DVLSCENEINFO.DVLSCENEINFO_CHILDREN)).ChildNodes;}};
c.prototype.getAncestors=function(n){return g(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneRef,n,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_PARENTS)).ParentNodes;};
c.prototype.findNodesByName=function(d){var e=sap.ve.dvl.DVLFINDNODETYPE.DVLFINDNODETYPE_NODE_NAME,f=[],h,j;if(d===undefined||d===null||q.isEmptyObject(d)){h=s.modeDictionary.contains(false);j=[""];}else{if(d.value===undefined||d.value===null||d.value===""){q.sap.log.error(sap.ui.vk.getResourceBundle().getText(M.VIT6.summary),M.VIT6.code,"sap.ui.vk.dvl.NodeHierarchy");return[];}var p=d.hasOwnProperty("predicate")?d.predicate:"equals";if(p===undefined||p===null||p===""){q.sap.log.error(sap.ui.vk.getResourceBundle().getText(M.VIT7.summary),M.VIT7.code,"sap.ui.vk.dvl.NodeHierarchy");return[];}else if(["equals","contains","startsWith"].indexOf(p)===-1){q.sap.log.error(sap.ui.vk.getResourceBundle().getText(M.VIT8.summary),M.VIT8.code,"sap.ui.vk.dvl.NodeHierarchy");return[];}h=s.modeDictionary[p](d.caseSensitive);j=(typeof d.value==="string")?[d.value]:d.value;}for(var i=0;i<j.length;i++){f=f.concat(g(this._dvl.Scene.FindNodes(this._dvlSceneRef,e,h,j[i])).nodes);}return q.sap.unique(f);};
c.prototype.createLayerProxy=function(d){var e=new L(this,d);this._layerProxies.push(e);return e;};
c.prototype.destroyLayerProxy=function(d){var i=this._layerProxies.indexOf(d);if(i>=0){this._layerProxies.splice(i,1)[0].destroy();}return this;};
c.prototype.getLayers=function(){return g(this._dvl.Scene.RetrieveSceneInfo(this._dvlSceneRef,sap.ve.dvl.DVLSCENEINFO.DVLSCENEINFO_LAYERS)).Layers;};
c.prototype.getHotspotNodeIds=function(){var h=g(this._dvl.Scene.RetrieveSceneInfo(this._dvlSceneRef,sap.ve.dvl.DVLSCENEINFO.DVLSCENEINFO_HOTSPOTS).ChildNodes);return h.length>0?h:this._getLegacyHotspotNodeIds();};
c.prototype._getLegacyHotspotNodeIds=function(){var d=this.getLayers(),h=[];for(var i=0;i<d.length;i++){var e=this.createLayerProxy(d[i]),f=e.getName();if(f.toLowerCase()==="hotspots"){h=e.getNodes();this.destroyLayerProxy(e);break;}this.destroyLayerProxy(e);}return h;};
c.prototype.createNode=function(p,n,i){var d=this._dvl.Scene.CreateNode(this._dvlSceneRef,p,n,i);this.fireNodeCreated({nodeRef:d,nodeId:d});this.fireChanged();return d;};
c.prototype.createNodeCopy=function(n,p,d,i){var e=this._dvl.Scene.CreateNodeCopy(this._dvlSceneRef,n,p,sap.ve.dvl.DVLCREATENODECOPYFLAG.COPY_CHILDREN,d,i);this.fireNodeCreated({nodeRef:e,nodeId:e});this.fireChanged();return e;};
c.prototype.removeNode=function(n){var d=[].concat(n);d.forEach(function(n){this.fireNodeRemoving({nodeRef:n,nodeId:n});try{sap.ui.vk.dvl.checkResult(this._dvl.Scene.DeleteNode(this._dvlSceneRef,n));}catch(e){var m="Failed to delete node with ID = "+n+".";if(e instanceof D){m+=" Error code: "+e.code+". Message: "+e.message+".";}b.error(m);}}.bind(this));this.fireChanged();return this;};
return c;});
sap.ui.predefine('sap/ui/vk/dvl/NodeProxy',["jquery.sap.global","../library","../NodeProxy"],function(q,l,N){"use strict";var g=sap.ui.vk.dvl.getJSONObject;
var a=N.extend("sap.ui.vk.dvl.NodeProxy",{
metadata:{},
constructor:function(n,b){N.call(this);this._dvl=n?n.getGraphicsCore()._getDvl():null;this._dvlSceneRef=n?n.getSceneRef():null;this._dvlNodeRef=b;}
});
a.prototype.destroy=function(){this._dvlNodeRef=null;this._dvlSceneRef=null;this._dvl=null;N.prototype.destroy.call(this);};
a.prototype.getNodeRef=function(){return this._dvlNodeRef;};
a.prototype.getNodeId=function(){return this._dvlNodeRef;};
a.prototype.getVeIds=function(){return g(this._dvl.Scene.RetrieveVEIDs(this._dvlSceneRef,this._dvlNodeRef));};
a.prototype.getName=function(){return g(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneRef,this._dvlNodeRef,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_NAME)).NodeName;};
a.prototype.getLocalMatrix=function(){return sap.ui.vk.TransformationMatrix.convertTo4x3(g(this._dvl.Scene.GetNodeLocalMatrix(this._dvlSceneRef,this._dvlNodeRef)).matrix);};
a.prototype.setLocalMatrix=function(v){this._dvl.Scene.SetNodeLocalMatrix(this._dvlSceneRef,this._dvlNodeRef,v&&sap.ui.vk.TransformationMatrix.convertTo4x4(v));this.setProperty("localMatrix",v,true);return this;};
a.prototype.getWorldMatrix=function(){return sap.ui.vk.TransformationMatrix.convertTo4x3(g(this._dvl.Scene.GetNodeWorldMatrix(this._dvlSceneRef,this._dvlNodeRef)).matrix);};
a.prototype.setWorldMatrix=function(v){this._dvl.Scene.SetNodeWorldMatrix(this._dvlSceneRef,this._dvlNodeRef,v&&sap.ui.vk.TransformationMatrix.convertTo4x4(v));this.setProperty("worldMatrix",v,true);return this;};
a.prototype.getOpacity=function(){return g(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneRef,this._dvlNodeRef,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_OPACITY)).Opacity;};
a.prototype.setOpacity=function(v){this._dvl.Scene.SetNodeOpacity(this._dvlSceneRef,this._dvlNodeRef,v);this.setProperty("opacity",v,true);return this;};
a.prototype.getTintColorABGR=function(){return g(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneRef,this._dvlNodeRef,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_HIGHLIGHT_COLOR)).HighlightColor;};
a.prototype.setTintColorABGR=function(v){this._dvl.Scene.SetNodeHighlightColor(this._dvlSceneRef,this._dvlNodeRef,v);this.setProperty("tintColorABGR",v,true);this.setProperty("tintColor",sap.ui.vk.colorToCSSColor(sap.ui.vk.abgrToColor(v)),true);return this;};
a.prototype.getTintColor=function(){return sap.ui.vk.colorToCSSColor(sap.ui.vk.abgrToColor(this.getTintColorABGR()));};
a.prototype.setTintColor=function(v){var b=sap.ui.vk.colorToABGR(sap.ui.vk.cssColorToColor(v));this._dvl.Scene.SetNodeHighlightColor(this._dvlSceneRef,this._dvlNodeRef,b);this.setProperty("tintColorABGR",b,true);this.setProperty("tintColor",v,true);return this;};
a.prototype.getNodeMetadata=function(){return g(this._dvl.Scene.RetrieveMetadata(this._dvlSceneRef,this._dvlNodeRef)).metadata;};
a.prototype.getHasChildren=function(){return(g(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneRef,this._dvlNodeRef,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_FLAGS)).Flags&(sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_MAPPED_HASCHILDREN|sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_CLOSED))===sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_MAPPED_HASCHILDREN;};
a.prototype.getClosed=function(){return(g(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneRef,this._dvlNodeRef,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_FLAGS)).Flags&sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_CLOSED)!==0;};
return a;});
sap.ui.predefine('sap/ui/vk/dvl/Scene',["jquery.sap.global","../library","../Scene","./NodeHierarchy"],function(q,l,S,N){"use strict";
var a=S.extend("sap.ui.vk.dvl.Scene",{
metadata:{},
constructor:function(g,d){S.call(this);this._id=q.sap.uid();this._graphicsCore=g;this._dvlSceneRef=d;this._defaultNodeHierarchy=null;}
});
a.prototype.destroy=function(){if(this._defaultNodeHierarchy){this._defaultNodeHierarchy.destroy();this._defaultNodeHierarchy=null;}this._dvlSceneRef=null;this._graphicsCore=null;S.prototype.destroy.call(this);};
a.prototype.getId=function(){return this._id;};
a.prototype.getGraphicsCore=function(){return this._graphicsCore;};
a.prototype.getDefaultNodeHierarchy=function(){if(!this._defaultNodeHierarchy){this._defaultNodeHierarchy=new N(this);}return this._defaultNodeHierarchy;};
a.prototype.getSceneRef=function(){return this._dvlSceneRef;};
a.prototype.setDoubleSided=function(v){this.setProperty("doubleSided",v,true);this._graphicsCore._dvl.Renderer.SetOption(sap.ve.dvl.DVLRENDEROPTION.DVLRENDEROPTION_SHOW_BACKFACING,v);return this;};
return a;});
sap.ui.predefine('sap/ui/vk/dvl/ViewStateManager',["jquery.sap.global","sap/ui/core/Element","../ContentConnector","../ViewStateManagerBase"],function(q,E,C,V){"use strict";var a;
var b=V.extend("sap.ui.vk.dvl.ViewStateManager",{metadata:{}});
var c=b.getMetadata().getParent().getClass().prototype;
b.prototype.init=function(){if(c.init){c.init.call(this);}this._nodeHierarchy=null;this._dvl=null;this._nodeStates=new Map();this._selectedNodes=new Set();this._visibilityTracker=new a();this._closedNodeProcessed=false;};
b.prototype._setContent=function(d){var e=null;if(d&&d instanceof sap.ui.vk.dvl.Scene){e=d;}this._setScene(e);};
b.prototype._onAfterUpdateContentConnector=function(){this._setContent(this._contentConnector.getContent());};
b.prototype._onBeforeClearContentConnector=function(){this._setScene(null);};
b.prototype._handleContentReplaced=function(e){var d=e.getParameter("newContent");this._setContent(d);};
b.prototype._setScene=function(d){if(d){this._setNodeHierarchy(d.getDefaultNodeHierarchy());}else{this._setNodeHierarchy(null);}return this;};
b.prototype._setNodeHierarchy=function(n){var o=this._nodeHierarchy;if(this._nodeHierarchy){this._nodeHierarchy.detachNodeCreated(this._handleNodeCreated,this);this._nodeHierarchy.detachNodeRemoving(this._handleNodeRemoving,this);this._dvl.Client.detachStepEvent(this._handleStepEvent,this);this._nodeHierarchy=null;this._dvl=null;this._nodeStates.clear();this._selectedNodes.clear();this._visibilityTracker.clear();}if(n){var d=n.getScene(),e=d.getSceneRef();this._nodeHierarchy=n;this._dvl=d.getGraphicsCore().getApi(sap.ui.vk.dvl.GraphicsCoreApi.LegacyDvl);this._dvl.Client.attachStepEvent(this._handleStepEvent,this);this._nodeHierarchy.attachNodeCreated(this._handleNodeCreated,this);this._nodeHierarchy.attachNodeRemoving(this._handleNodeRemoving,this);this._populateNodeStates(this._dvl.Scene.RetrieveSceneInfo(e,sap.ve.dvl.DVLSCENEINFO.DVLSCENEINFO_CHILDREN|sap.ve.dvl.DVLSCENEINFO.DVLSCENEINFO_HOTSPOTS).ChildNodes);}if(n!==o){this.fireNodeHierarchyReplaced({oldNodeHierarchy:o,newNodeHierarchy:n});}return this;};
b.prototype._populateNodeStates=function(n){var t=this,v=[],h=[],d=[],u=[],e=this._nodeHierarchy.getScene(),f=e.getSceneRef();n.forEach(function addNodeRecursive(i){var j=t._dvl.Scene.RetrieveNodeInfo(f,i,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_FLAGS|sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_CHILDREN);t._nodeStates.set(i,{flags:j.Flags});if(j.Flags&sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_SELECTED){t._selectedNodes.add(i);}(j.Flags&sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_VISIBLE?v:h).push(i);(j.Flags&sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_SELECTED?d:u).push(i);j.ChildNodes.forEach(addNodeRecursive);});this.fireSelectionChanged({selected:d,unselected:u});this.fireVisibilityChanged({visible:v,hidden:h});return this;};
b.prototype._handleNodeCreated=function(e){this._populateNodeStates([e.getParameter("nodeRef")]);};
b.prototype._handleNodeRemoving=function(e){var n=e.getParameter("nodeRef"),t=this;var r=function(n){t._nodeHierarchy.enumerateChildren(n,r,true,true);t._nodeStates.delete(n);};r(n);};
b.prototype.getNodeHierarchy=function(){return this._nodeHierarchy;};
b.prototype.getVisibilityChanges=function(){return this.getShouldTrackVisibilityChanges()?this._visibilityTracker.getInfo(this.getNodeHierarchy()):null;};
b.prototype.getVisibilityComplete=function(){var n=this.getNodeHierarchy(),d=n.findNodesByName(),v=[],h=[];d.forEach(function(e){var f=n.createNodeProxy(e),i=q.grep(f.getVeIds(),function(i){return i.type==="VE_LOCATOR";});i=Array.isArray(i)&&i.length>0?i[0].fields[0].value:null;n.destroyNodeProxy(f);if(i){if(this.getVisibilityState(e)){v.push(i);}else{h.push(i);}}},this);return{visible:v,hidden:h};};
var g=function(n,f,d){return n.has(d)&&(n.get(d).flags&f)!==0;};
b.prototype._getVisibilityFlagState=function(n){return g(this._nodeStates,sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_VISIBLE,n);};
b.prototype._getSelectionFlagState=function(n){return g(this._nodeStates,sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_SELECTED,n);};
var s=function(n,f,d,e){if(n.has(e)){var i=n.get(e);i.flags=i.flags&~d|f&d;}else{n.set(e,{flags:f&d});}};
b.prototype._setFlags=function(n,f,d){if(d&sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_VISIBLE){this.setVisibilityState(n,(f&sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_VISIBLE)!==0,false);}if(d&sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_SELECTED){this.setSelectionState(n,(f&sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_SELECTED)!==0,false);}s(this._nodeStates,f,d&~(sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_VISIBLE|sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_SELECTED),n);return this;};
b.prototype._getFlags=function(n,f){var d=this._nodeStates.get(n),e=d&&d.flags;return e!==undefined?e&f:null;};
b.prototype.getVisibilityState=function(n){return Array.isArray(n)?n.map(this._getVisibilityFlagState,this):this._getVisibilityFlagState(n);};
b.prototype.setVisibilityState=function(n,v,r){if(!Array.isArray(n)){n=[n];}var d=q.sap.unique(r?this._collectNodesRecursively(n,true):n).filter(function(e){return e&&this._getVisibilityFlagState(e)!==v;},this);if(d.length>0){d.forEach(function(e){var f=this._nodeStates.get(e);if(f){if(f.flags===undefined){f.flags=0;}if(v){f.flags|=sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_VISIBLE|sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_TEMPORARY_PREVIOUS_VISIBILITY;}else{f.flags&=~(sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_VISIBLE|sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_TEMPORARY_PREVIOUS_VISIBILITY);}}else{this._nodeStates.set(e,{flags:v?sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_VISIBLE:0});}},this);if(this.getShouldTrackVisibilityChanges()){d.forEach(this._visibilityTracker.trackNodeRef,this._visibilityTracker);}this.fireVisibilityChanged({visible:v?d:[],hidden:v?[]:d});}return this;};
b.prototype.enumerateSelection=function(d){this._selectedNodes.forEach(d);return this;};
b.prototype.getSelectionState=function(n){return Array.isArray(n)?n.map(this._getSelectionFlagState,this):this._getSelectionFlagState(n);};
b.prototype.setSelectionState=function(n,d,r){if(!Array.isArray(n)){n=[n];}var e=q.sap.unique(r||this.getRecursiveSelection()?this._collectNodesRecursively(n):n);if(this.getRecursiveSelection()&&!d){e=this._nodeHierarchy._appendAncestors(e);}e=e.filter(function(f){return f&&this._getSelectionFlagState(f)!==d;},this);if(e.length>0){e.forEach(function(f){var h=this._nodeStates.get(f);if(h){if(h.flags===undefined){h.flags=this._dvl.Scene.RetrieveNodeInfo(this._nodeHierarchy.getScene().getSceneRef(),f,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_FLAGS).Flags;}if(d){h.flags|=sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_SELECTED;}else{h.flags&=~sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_SELECTED;}}else{var i=this._dvl.Scene.RetrieveNodeInfo(this._nodeHierarchy.getScene().getSceneRef(),f,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_FLAGS).Flags;this._nodeStates.set(f,{flags:i|(d?sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_SELECTED:0)});}this._selectedNodes[d?"add":"delete"](f);},this);this.fireSelectionChanged({selected:d?e:[],unselected:d?[]:e});}return this;};
b.prototype.setSelectionStates=function(d,u,r){if(!Array.isArray(d)){d=[d];}if(!Array.isArray(u)){u=[u];}var e=q.sap.unique(r||this.getRecursiveSelection()?this._collectNodesRecursively(d):d);var f=q.sap.unique(r||this.getRecursiveSelection()?this._collectNodesRecursively(u):u);if(this.getRecursiveSelection()){f=this._nodeHierarchy._appendAncestors(f,e);}e=e.filter(function(n){return n&&this._getSelectionFlagState(n)===false;},this);f=f.filter(function(n){return n&&this._getSelectionFlagState(n)===true;},this);if(e.length>0){e.forEach(function(n){var h=this._nodeStates.get(n);if(h){if(h.flags===undefined){h.flags=this._dvl.Scene.RetrieveNodeInfo(this._nodeHierarchy.getScene().getSceneRef(),n,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_FLAGS).Flags;}h.flags|=sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_SELECTED;}else{var i=this._dvl.Scene.RetrieveNodeInfo(this._nodeHierarchy.getScene().getSceneRef(),n,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_FLAGS).Flags;this._nodeStates.set(n,{flags:i|sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_SELECTED});}this._selectedNodes["add"](n);},this);}if(f.length>0){f.forEach(function(n){var h=this._nodeStates.get(n);if(h){if(h.flags===undefined){h.flags=this._dvl.Scene.RetrieveNodeInfo(this._nodeHierarchy.getScene().getSceneRef(),n,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_FLAGS).Flags;}h.flags&=~sap.ve.dvl.DVLNODEFLAG.DVLNODEFLAG_SELECTED;}else{var i=this._dvl.Scene.RetrieveNodeInfo(this._nodeHierarchy.getScene().getSceneRef(),n,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_FLAGS).Flags;this._nodeStates.set(n,{flags:i});}this._selectedNodes["delete"](n);},this);}if(e.length>0||f.length>0){this.fireSelectionChanged({selected:e,unselected:f});}return this;};
b.prototype._handleStepEvent=function(e){if(e.type===sap.ve.dvl.DVLSTEPEVENT.DVLSTEPEVENT_STARTED){this._visibilityTracker.clear();}};
b.prototype._collectNodesRecursively=function(n,i){var r=[],t=this;if(i===undefined){i=false;}n.forEach(function collectChildNodes(d){r.push(d);t._nodeHierarchy.enumerateChildren(d,collectChildNodes,i,true);});return r;};
b.prototype._getOpacity=function(n){if(this._nodeStates.has(n)){var o=this._nodeStates.get(n).opacity;return o===undefined?null:o;}else{return null;}};
b.prototype.getOpacity=function(n){if(Array.isArray(n)){return n.map(this._getOpacity,this);}else{return this._getOpacity(n);}};
b.prototype.setOpacity=function(n,o,r){if(!Array.isArray(n)){n=[n];}var d=q.sap.unique(r?this._collectNodesRecursively(n,true):n).filter(function(e){return e&&this._getOpacity(e)!==o;},this);if(d.length>0){d.forEach(function(e){var f=this._nodeStates.get(e);if(f){if(o===null){delete f.opacity;}else{f.opacity=o;}}else if(o!==null){this._nodeStates.set(e,{opacity:o});}},this);this.fireOpacityChanged({changed:d,opacity:o});}return this;};
b.prototype._getTintColorABGR=function(n){if(this._nodeStates.has(n)){var t=this._nodeStates.get(n).tintColorABGR;return t===undefined?null:t;}else{return null;}};
b.prototype._getTintColor=function(n){if(this._nodeStates.has(n)){var t=this._nodeStates.get(n).tintColorABGR;return t===undefined?null:sap.ui.vk.colorToCSSColor(sap.ui.vk.abgrToColor(t));}else{return null;}};
b.prototype.getTintColor=function(n,i){var d=i?"_getTintColorABGR":"_getTintColor";if(Array.isArray(n)){return n.map(this[d],this);}else{return this[d](n);}};
b.prototype.setTintColor=function(n,t,r){if(!Array.isArray(n)){n=[n];}var d=null;switch(typeof t){case"number":d=t;break;case"string":if(sap.ui.core.CSSColor.isValid(t)){d=sap.ui.vk.colorToABGR(sap.ui.vk.cssColorToColor(t));}break;default:t=null;break;}var e=q.sap.unique(r?this._collectNodesRecursively(n,true):n).filter(function(f){return f&&this._getTintColorABGR(f)!==d;},this);if(e.length>0){e.forEach(function(f){var h=this._nodeStates.get(f);if(h){if(d===null){delete h.tintColorABGR;}else{h.tintColorABGR=d;}}else if(d!==null){this._nodeStates.set(f,{tintColorABGR:d});}},this);this.fireTintColorChanged({changed:e,tintColor:t,tintColorABGR:d});}return this;};
a=function(){this._visibilityChanges=new Set();};
a.prototype.getInfo=function(n){var f=function(v){return v.type==="VE_LOCATOR";};var d=[];this._visibilityChanges.forEach(function(e){var h=n.createNodeProxy(e),v=q.grep(h.getVeIds(),f);v=Array.isArray(v)&&v.length>0?v[0].fields[0].value:null;n.destroyNodeProxy(h);if(v){d.push(v);}});return d;};
a.prototype.clear=function(){this._visibilityChanges.clear();};
a.prototype.trackNodeRef=function(n){if(this._visibilityChanges.has(n)){this._visibilityChanges.delete(n);}else{this._visibilityChanges.add(n);}};
C.injectMethodsIntoClass(b);return b;});
sap.ui.predefine('sap/ui/vk/dvl/Viewport',["jquery.sap.global","../library","../ViewportBase","sap/ui/core/ResizeHandler","../Loco","../ViewportHandler","../Smart2DHandler","../Messages","../ContentConnector","../ViewStateManager","./GraphicsCore","./ViewportRenderer"],function(q,l,V,R,L,a,S,M,C,b,G,c){"use strict";var d={encodedProjectionType:{},decodedProjectionType:{},encodedBindingType:{},decodedBindingType:{},decodedZoomTo:{}};d.decodedProjectionType[sap.ui.vk.CameraProjectionType.Perspective]=sap.ve.dvl.DVLCAMERAPROJECTION.PERSPECTIVE;d.decodedProjectionType[sap.ui.vk.CameraProjectionType.Orthographic]=sap.ve.dvl.DVLCAMERAPROJECTION.ORTHOGRAPHIC;d.encodedProjectionType[sap.ve.dvl.DVLCAMERAPROJECTION.PERSPECTIVE]=sap.ui.vk.CameraProjectionType.Perspective;d.encodedProjectionType[sap.ve.dvl.DVLCAMERAPROJECTION.ORTHOGRAPHIC]=sap.ui.vk.CameraProjectionType.Orthographic;d.decodedBindingType[sap.ui.vk.CameraFOVBindingType.Minimum]=sap.ve.dvl.DVLCAMERAFOVBINDING.MIN;d.decodedBindingType[sap.ui.vk.CameraFOVBindingType.Maximum]=sap.ve.dvl.DVLCAMERAFOVBINDING.Max;d.decodedBindingType[sap.ui.vk.CameraFOVBindingType.Horizontal]=sap.ve.dvl.DVLCAMERAFOVBINDING.HORZ;d.decodedBindingType[sap.ui.vk.CameraFOVBindingType.Vertical]=sap.ve.dvl.DVLCAMERAFOVBINDING.VERT;d.encodedBindingType[sap.ve.dvl.DVLCAMERAFOVBINDING.MIN]=sap.ui.vk.CameraFOVBindingType.Minimum;d.encodedBindingType[sap.ve.dvl.DVLCAMERAFOVBINDING.MAX]=sap.ui.vk.CameraFOVBindingType.Maximum;d.encodedBindingType[sap.ve.dvl.DVLCAMERAFOVBINDING.HORZ]=sap.ui.vk.CameraFOVBindingType.Horizontal;d.encodedBindingType[sap.ve.dvl.DVLCAMERAFOVBINDING.VERT]=sap.ui.vk.CameraFOVBindingType.Vertical;d.decodedZoomTo[sap.ui.vk.ZoomTo.All]=sap.ve.dvl.DVLZOOMTO.DVLZOOMTO_ALL;d.decodedZoomTo[sap.ui.vk.ZoomTo.Visible]=sap.ve.dvl.DVLZOOMTO.DVLZOOMTO_VISIBLE;d.decodedZoomTo[sap.ui.vk.ZoomTo.Selected]=sap.ve.dvl.DVLZOOMTO.DVLZOOMTO_SELECTED;d.decodedZoomTo[sap.ui.vk.ZoomTo.Node]=sap.ve.dvl.DVLZOOMTO.DVLZOOMTO_NODE;d.decodedZoomTo[sap.ui.vk.ZoomTo.NodeSetIsolation]=sap.ve.dvl.DVLZOOMTO.DVLZOOMTO_NODE_SETISOLATION;d.decodedZoomTo[sap.ui.vk.ZoomTo.Restore]=sap.ve.dvl.DVLZOOMTO.DVLZOOMTO_RESTORE;d.decodedZoomTo[sap.ui.vk.ZoomTo.RestoreRemoveIsolation]=sap.ve.dvl.DVLZOOMTO.DVLZOOMTO_RESTORE_REMOVEISOLATION;d.decodedZoomTo[sap.ui.vk.ZoomTo.ViewLeft]=sap.ve.dvl.DVLZOOMTO.VIEW_LEFT;d.decodedZoomTo[sap.ui.vk.ZoomTo.ViewRight]=sap.ve.dvl.DVLZOOMTO.VIEW_RIGHT;d.decodedZoomTo[sap.ui.vk.ZoomTo.ViewTop]=sap.ve.dvl.DVLZOOMTO.VIEW_TOP;d.decodedZoomTo[sap.ui.vk.ZoomTo.ViewBottom]=sap.ve.dvl.DVLZOOMTO.VIEW_BOTTOM;d.decodedZoomTo[sap.ui.vk.ZoomTo.ViewBack]=sap.ve.dvl.DVLZOOMTO.VIEW_BACK;d.decodedZoomTo[sap.ui.vk.ZoomTo.ViewFront]=sap.ve.dvl.DVLZOOMTO.VIEW_FRONT;
var e=V.extend("sap.ui.vk.dvl.Viewport",{metadata:{library:"sap.ui.vk",properties:{showAllHotspots:{type:"boolean",defaultValue:false},hotspotColorABGR:{type:"int",defaultValue:0xc00000ff},hotspotColor:{type:"sap.ui.core.CSSColor",defaultValue:"rgba(255, 0, 0, 0.7529411764705882)"},backgroundColorTopABGR:{type:"int",defaultValue:0xff000000},backgroundColorBottomABGR:{type:"int",defaultValue:0xffffffff}},events:{pan:{parameters:{dx:"int",dy:"int"}},zoom:{parameters:{zoomFactor:"float"}},rotate:{parameters:{dx:"int",dy:"int"}},viewActivated:{parameters:{type:{type:"string"}}},frameRenderingFinished:{}}}});
var g=e.getMetadata().getParent().getClass().prototype;
e.prototype.init=function(){if(g.init){g.init.call(this);}this._graphicsCore=null;this._dvl=null;this._dvlRendererId=null;this._viewStateManager=null;this._canvas=null;this._resizeListenerId=null;this._is2D=false;this._viewportHandler=new a(this);this._loco=new L();this._loco.addHandler(this._viewportHandler);this._smart2DHandler=null;this._lastPlayedStep=null;this._contentConnector=null;};
e.prototype.exit=function(){this._loco.removeHandler(this._viewportHandler);this._viewportHandler.destroy();if(this._resizeListenerId){R.deregister(this._resizeListenerId);this._resizeListenerId=null;}this._clearContentConnector();this.setViewStateManager(null);this.setScene(null);this.setGraphicsCore(null);if(g.exit){g.exit.call(this);}};
e.prototype.setGraphicsCore=function(f){if(f!=this._graphicsCore){if(this._graphicsCore){this._dvl.Client.detachFrameFinished(this._handleFrameFinished,this);this._dvl.Client.detachStepEvent(this._updateLastPlayedStep,this);this._dvl.Renderer.SetViewStateManager(null,this._dvlRendererId);this._graphicsCore._deregisterViewport(this);this._dvl=null;}this._graphicsCore=f;if(this._graphicsCore){this._dvl=this._graphicsCore._getDvl();this._graphicsCore._registerViewport(this);this.setShowDebugInfo(this.getShowDebugInfo());this._dvl.Client.attachStepEvent(this._updateLastPlayedStep,this);this._dvl.Client.attachFrameFinished(this._handleFrameFinished,this);this._dvl.Renderer.SetViewStateManager(this._viewStateManager,this._dvlRendererId);}}return this;};
e.prototype.getGraphicsCore=function(){return this._graphicsCore;};
e.prototype._setCanvas=function(f){var i=this.getDomRef()&&this._canvas!==f;this._canvas=f;if(i){this.invalidate();}return this;};
e.prototype._setRenderer=function(f){this._dvlRendererId=f;return this;};
e.prototype._updateLastPlayedStep=function(f){if(f.type===sap.ve.dvl.DVLSTEPEVENT.DVLSTEPEVENT_STARTED){this._lastPlayedStep=f.stepId;}};
e.prototype.setScene=function(f){if(this._dvlRendererId){this._dvl.Renderer.AttachScene(f&&f.getSceneRef()||null,this._dvlRendererId);this._dvlSceneRef=f?f.getSceneRef():null;if(f){this._dvl.Client.attachUrlClicked(this._fireUrlClicked,this);var i=this._isSmart2DContent()||this._isSmart2DContentLegacy();if(i){this._dvl.Renderer.SetBackgroundColor(1,1,1,1,1,1,1,1,this._dvlRendererId);}else{var j=this._getDecomposedABGR(this.getBackgroundColorTopABGR());var m=this._getDecomposedABGR(this.getBackgroundColorBottomABGR());this._dvl.Renderer.SetBackgroundColor(j.red,j.green,j.blue,j.alpha,m.red,m.green,m.blue,m.alpha,this._dvlRendererId);}this.fireViewActivated({type:i?"2D":"3D"});}else{this._dvl.Client.detachUrlClicked(this._fireUrlClicked,this);if(this._smart2DHandler){var x=new L();x.removeHandler(this._smart2DHandler);}this.invalidate();}}return this;};
e.prototype._isSmart2DContent=function(){var f=sap.ui.vk.dvl.getJSONObject(this._dvl.Scene.RetrieveSceneInfo(this._dvlSceneRef,sap.ve.dvl.DVLSCENEINFO.DVLSCENEINFO_HOTSPOTS).ChildNodes);return f&&f.length>0;};
e.prototype._isSmart2DContentLegacy=function(){var f=this._dvl.Scene.GetCurrentCamera(this._dvlSceneRef),i=this._dvl.Camera.GetRotation(f),j=this._dvl.Camera.GetProjection(f);return i[0]===90&&i[1]===-90&&i[2]===0&&j===sap.ve.dvl.DVLCAMERAPROJECTION.ORTHOGRAPHIC;};
e.prototype._initializeSmart2DHandler=function(){if(this._viewStateManager){if(this._smart2DHandler){this._loco.removeHandler(this._smart2DHandler);}this._smart2DHandler=new S(this,this._viewStateManager);this._loco.addHandler(this._smart2DHandler);}if(this.getShowAllHotspots()){var f=this._viewStateManager.getNodeHierarchy(),i=f.getHotspotNodeIds();this.showHotspots(i,true);}};
e.prototype._fireUrlClicked=function(f){this.fireUrlClicked({url:f.url,nodeRef:f.nodeId});};
e.prototype.setHotspotColorABGR=function(f){this.setProperty("hotspotColorABGR",f,true);this.setProperty("hotspotColor",sap.ui.vk.colorToCSSColor(sap.ui.vk.abgrToColor(this.getProperty("hotspotColorABGR"))),true);return this;};
e.prototype.setHotspotColor=function(f){this.setProperty("hotspotColor",f,true);this.setProperty("hotspotColorABGR",sap.ui.vk.colorToABGR(sap.ui.vk.cssColorToColor(this.getProperty("hotspotColor"))),true);return this;};
e.prototype._getStepAndProcedureIndexes=function(f,m){var x=-1,y=-1,z=false;for(var i=0;i<f.length;i++){if(!z){for(var j=0;j<f[i].steps.length;j++){if(f[i].steps[j].id===m){y=j;x=i;z=true;break;}}}else{break;}}return{stepIndex:y,procedureIndex:x};};
e.prototype._getStepVeIdById=function(f){if(f){var i=this._dvl.Scene.RetrieveVEIDs(this._dvlSceneRef,f);if(Array.isArray(i)){for(var j=0,m=i.length;j<m;++j){var x=i[j];if(x.source==="SAP"&&x.type==="VE_VIEWPORT"&&Array.isArray(x.fields)){for(var y=0,z=x.fields.length;y<z;++y){var A=x.fields[y];if(A.name==="ID"){return A.value;}}}}}}return null;};
e.prototype._getStepIdByVeId=function(f,i){for(var j=0,m=f.length;j<m;++j){var x=f[j].steps;for(var y=0,z=x.length;y<z;++y){var A=x[y].id;if(this._getStepVeIdById(A)===i){return A;}}}return null;};
var s=function(f){f.camera={};};var h=function(f){if(typeof f.camera==="object"&&f.camera!==null){f.camera.matrices=false;}};var k=function(f){if(typeof f.camera==="object"&&f.camera!==null){f.camera.useTransitionCamera=false;}};var n=function(f){f.animation=true;};var o=function(f){f.visibility=false;};var p=function(f){if(typeof f.visibility==="object"&&f.visibility!==null){f.visibility.mode=sap.ui.vk.VisibilityMode.Complete;}};
e.prototype.getViewInfo=function(f){if(!this._dvlSceneRef){return null;}var i={};if(typeof f!=="object"||f===null){s(i);h(i);k(i);n(i);o(i);p(i);}else{if(typeof f.camera==="object"&&f.camera!==null){i.camera={};if(typeof f.camera.matrices==="boolean"){i.camera.matrices=f.camera.matrices;}else if("matrices"in f.camera){i.camera.matrices=false;}else{h(i);}if(typeof f.camera.useTransitionCamera==="boolean"){i.camera.useTransitionCamera=f.camera.useTransitionCamera;}else if("useTransitionCamera"in f.camera){i.camera.useTransitionCamera=false;}else{k(i);}}else if(typeof f.camera==="boolean"){if(f.camera===true){i.camera={};h(i);k(i);}else{i.camera=false;}}else if("camera"in f){i.camera=false;}else{s(i);h(i);k(i);}if(typeof f.animation==="boolean"){i.animation=f.animation;}else if("animation"in f){i.animation=false;}else{n(i);}if(typeof f.visibility==="object"&&f.visibility!==null){i.visibility={};if(f.visibility.mode===sap.ui.vk.VisibilityMode.Complete||f.visibility.mode===sap.ui.vk.VisibilityMode.Differences){i.visibility.mode=f.visibility.mode;}else{p(i);}}else if(typeof f.visibility==="boolean"){if(f.visibility===true){i.visibility={};p(i);}else{i.visibility=false;}}else if("visibility"in f){i.visibility=false;}else{o(i);p(i);}}var j={};if(i.camera){var m=null;if(i.camera.useTransitionCamera){m=this._dvl.Renderer.GetTransitionCamera(this._dvlRendererId);if(m===sap.ve.dvl.DVLID_INVALID){m=null;}}if(m===null){m=this._dvl.Renderer.GetCurrentCamera(this._dvlRendererId);}var x=this._dvl.Camera.GetRotation(m),y=this._dvl.Camera.GetOrigin(m);j.camera={rotation:{yaw:x[0],pitch:x[1],roll:x[2]},position:{x:y[0],y:y[1],z:y[2]},projectionType:d.encodedProjectionType[this._dvl.Camera.GetProjection(m)],bindingType:d.encodedBindingType[this._dvl.Camera.GetFOVBinding(m)]};if(this._matView){j.viewMatrix=this._matView.slice();}if(this._matProj){j.projectionMatrix=this._matProj.slice();}if(j.camera.projectionType===sap.ui.vk.CameraProjectionType.Perspective){j.camera.fieldOfView=this._dvl.Camera.GetFOV(m);}else if(j.camera.projectionType===sap.ui.vk.CameraProjectionType.Orthographic){j.camera.zoomFactor=this._dvl.Camera.GetOrthoZoomFactor(m);}if(i.camera.matrices){var z=this._dvl.Renderer.GetCameraMatrices(this._dvlRendererId);j.camera.matrices={view:z.view,projection:z.projection};}}if(i.animation){var A=this._dvl.Scene.RetrieveSceneInfo(this._dvlSceneRef,sap.ve.dvl.DVLSCENEINFO.DVLSCENEINFO_STEP_INFO),B=A.StepId!==sap.ve.dvl.DVLID_INVALID;var D=B?A.StepId:this._lastPlayedStep,E=B?A.StepTime:0,F=this._dvl.Scene.RetrieveProcedures(this._dvlSceneRef),H=this._getStepAndProcedureIndexes(F.procedures,D),I=this._getStepVeIdById(D);j.animation={animationTime:E,stepIndex:H.stepIndex,procedureIndex:H.procedureIndex};if(I){j.animation.stepVeId=I;}}if(i.visibility&&this._viewStateManager){j.visibility={mode:i.visibility.mode};if(i.visibility.mode===sap.ui.vk.VisibilityMode.Complete){var J=this._viewStateManager.getVisibilityComplete();j.visibility.visible=J.visible;j.visibility.hidden=J.hidden;}else if(this._viewStateManager.getShouldTrackVisibilityChanges()){j.visibility.changes=this._viewStateManager.getVisibilityChanges();}else{q.sap.log.warning(sap.ui.vk.getResourceBundle().getText(M.VIT32.summary),M.VIT32.code,"sap.ui.vk.dvl.Viewport");}}return j;};
e.prototype.setViewInfo=function(f,i){var j=false;if(f.animation){var m=this._dvl.Scene.RetrieveProcedures(this._dvlSceneRef),x=f.animation.procedureIndex,y=f.animation.stepIndex,z=f.animation.stepVeId,A,B=f.animation.animationTime||0;if(z||y>=0&&x>=0){if(z){A=this._getStepIdByVeId(m.procedures,f.animation.stepVeId);}else if(x>=0&&x<m.procedures.length){if(y>=0&&y<m.procedures[x].steps.length){A=m.procedures[x].steps[y].id;}else{q.sap.log.error(sap.ui.vk.getResourceBundle().getText(M.VIT26.summary),M.VIT26.code,"sap.ui.vk.dvl.Viewport");}}else{q.sap.log.error(sap.ui.vk.getResourceBundle().getText(M.VIT27.summary),M.VIT27.code,"sap.ui.vk.dvl.Viewport");}if(A){this._dvl.Renderer.ActivateStep(this._dvlRendererId,A,false,false,B);this._dvl.Renderer.PauseCurrentStep(this._dvlRendererId);}}else{j=true;}}if(f.camera){var D;if(f.camera.projectionType===sap.ui.vk.CameraProjectionType.Perspective||f.camera.projectionType===sap.ui.vk.CameraProjectionType.Orthographic){D=d.decodedProjectionType[f.camera.projectionType];}else{q.sap.log.error(sap.ui.vk.getResourceBundle().getText(M.VIT19.summary),M.VIT19.code,"sap.ui.vk.dvl.Viewport");D=sap.ve.dvl.DVLCAMERAPROJECTION.PERSPECTIVE;}var E=this._dvl.Scene.CreateCamera(this._dvlSceneRef,D,sap.ve.dvl.DVLID_INVALID);if(D===sap.ve.dvl.DVLCAMERAPROJECTION.PERSPECTIVE){this._dvl.Camera.SetFOV(E,f.camera.fieldOfView);}else if(D===sap.ve.dvl.DVLCAMERAPROJECTION.ORTHOGRAPHIC){this._dvl.Camera.SetOrthoZoomFactor(E,f.camera.zoomFactor);}if(f.camera.position){this._dvl.Camera.SetOrigin(E,f.camera.position.x,f.camera.position.y,f.camera.position.z);}if(f.camera.rotation){this._dvl.Camera.SetRotation(E,f.camera.rotation.yaw,f.camera.rotation.pitch,f.camera.rotation.roll);}if(f.camera.bindingType){var F=d.decodedBindingType[f.camera.bindingType]||sap.ve.dvl.DVLCAMERAFOVBINDING.MIN;this._dvl.Camera.SetFOVBinding(E,F);}i=i||0;this._dvl.Renderer.ActivateCamera(this._dvlRendererId,E,i);this._dvl.Scene.DeleteNode(this._dvlSceneRef,E);}if(f.viewMatrix){this._matView=f.viewMatrix.slice();}if(f.projectionMatrix){this._matProj=f.projectionMatrix.slice();}if(f.visibility){var H=this._viewStateManager.getNodeHierarchy(),I=new Map(),J=H.findNodesByName();J.forEach(function(O){var P=H.createNodeProxy(O),Q=q.grep(P.getVeIds(),function(Q){return Q.type==="VE_LOCATOR";});Q=Array.isArray(Q)&&Q.length>0?Q[0].fields[0].value:null;H.destroyNodeProxy(P);if(Q){I.set(Q,O);}});switch(f.visibility.mode){case sap.ui.vk.VisibilityMode.Complete:var K=f.visibility.visible,N=f.visibility.hidden;K.forEach(function(O){this._viewStateManager.setVisibilityState(I.get(O),true,false);},this);N.forEach(function(O){this._viewStateManager.setVisibilityState(I.get(O),false,false);},this);break;case sap.ui.vk.VisibilityMode.Differences:if(j){this.resetView({camera:false,visibility:true,transition:false});}f.visibility.changes.forEach(function(O){var P=I.get(O);if(P){this._viewStateManager.setVisibilityState(P,!this._viewStateManager.getVisibilityState(P),false);}},this);break;default:q.sap.log.error(sap.ui.vk.getResourceBundle().getText(M.VIT28.summary),M.VIT28.code,"sap.ui.vk.dvl.Viewport");break;}}return this;};
e.prototype.setSelectionRect=function(f){if(!f){this._dvl.Renderer.DrawSelectionRect(0,0,0,0,this._dvlRendererId);}else{this._dvl.Renderer.DrawSelectionRect(f.x1,f.y1,f.x2,f.y2,this._dvlRendererId);}};
e.prototype.getOutputSize=function(){var f=this.getViewInfo().camera.bindingType,i=this.getDomRef().getBoundingClientRect(),j=i.width,m=i.height,x;switch(d.decodedBindingType[f]){case sap.ve.dvl.DVLCAMERAFOVBINDING.MIN:x=Math.min(j,m);break;case sap.ve.dvl.DVLCAMERAFOVBINDING.MAX:x=Math.max(j,m);break;case sap.ve.dvl.DVLCAMERAFOVBINDING.HORZ:x=j;break;case sap.ve.dvl.DVLCAMERAFOVBINDING.VERT:x=m;break;default:break;}return{left:(j-x)/2,top:(m-x)/2,sideLength:x};};
e.prototype.onBeforeRendering=function(){if(this._resizeListenerId){R.deregister(this._resizeListenerId);this._resizeListenerId=null;}};
e.prototype.onAfterRendering=function(){var f=this.getDomRef();if(this._canvas){f.appendChild(this._canvas);}this._resizeListenerId=R.register(this,this._handleResize.bind(this));this._handleResize({size:{width:f.clientWidth,height:f.clientHeight}});};
e.prototype._handleResize=function(f){if(this._dvlRendererId&&this._canvas){var i=f.size.width*window.devicePixelRatio;var j=f.size.height*window.devicePixelRatio;if(this._matProj){var m=this._matProj[0];var x=this._matProj[5];var y=Math.max(m,x);if(i>j){m=y*j/i;x=y;}else{m=y;x=y*i/j;}this._matProj[8]*=m/this._matProj[0];this._matProj[9]*=x/this._matProj[5];this._matProj[0]=m;this._matProj[5]=x;}this._dvl.Renderer.SetDimensions(i,j,this._dvlRendererId);this._dvl.Renderer.SetOptionF(sap.ve.dvl.DVLRENDEROPTIONF.DVLRENDEROPTIONF_DPI,96*window.devicePixelRatio,this._dvlRendererId);this._canvas.width=i;this._canvas.height=j;this._canvas.style.width=f.size.width+"px";this._canvas.style.height=f.size.height+"px";this.fireResize({size:{width:f.size.width,height:f.size.height}});return true;}};
e.prototype._handleVisibilityChanged=e.prototype._handleSelectionChanged=e.prototype._handleOpacityChanged=e.prototype._handleTintColorChanged=function(f){if(this._dvlRendererId){this._dvl.Renderer.ForceRenderFrame(this._dvlRendererId);}};
e.prototype.showHotspots=function(f,i,j){var m=sap.ui.vk.dvl.NodeProxy.prototype[typeof j==="string"?"setTintColor":"setTintColorABGR"];var x=function(z,j,E){var F=z.createNodeProxy(E);m.call(F,j);z.destroyNodeProxy(F);};if(!Array.isArray(f)){f=[f];}var y=j===undefined?this.getHotspotColorABGR():j;if(!i){y=0;}var z=this._viewStateManager.getNodeHierarchy();if(this._isSmart2DContent()){var A=[];f.forEach(function(E){var F=sap.ui.vk.dvl.getJSONObject(this._dvl.Scene.RetrieveNodeInfo(this._dvlSceneRef,E,sap.ve.dvl.DVLNODEINFO.DVLNODEINFO_CHILDREN).ChildNodes);Array.prototype.push.apply(A,F);}.bind(this));Array.prototype.push.apply(A,f);A.forEach(x.bind(null,z,y));}else{var B=[];var D=function(E){var A=z.getChildren(E);Array.prototype.push.apply(B,A);A.forEach(D);};f.forEach(D);Array.prototype.push.apply(B,f);B.forEach(x.bind(null,z,y));}return this;};
e.prototype._getDecomposedABGR=function(i){return{red:(i>>>0&0xff)/255,green:(i>>>8&0xff)/255,blue:(i>>>16&0xff)/255,alpha:(i>>>24&0xff)/255};};
e.prototype._setBackgroundColor=function(){if(this._dvl){var f=this._getDecomposedABGR(this.getBackgroundColorTopABGR()),i=this._getDecomposedABGR(this.getBackgroundColorBottomABGR());this._dvl.Renderer.SetBackgroundColor(f.red,f.green,f.blue,f.alpha,i.red,i.green,i.blue,i.alpha,this._dvlRendererId);}};
e.prototype.setBackgroundColorTopABGR=function(i){this.setProperty("backgroundColorTopABGR",i,true);this._setBackgroundColor();return this;};
e.prototype.setBackgroundColorTop=function(f){this.setProperty("backgroundColorTop",f,true);return this.setBackgroundColorTopABGR(sap.ui.vk.colorToABGR(sap.ui.vk.cssColorToColor(f)));};
e.prototype.setBackgroundColorBottomABGR=function(i){this.setProperty("backgroundColorBottomABGR",i,true);this._setBackgroundColor();return this;};
e.prototype.setBackgroundColorBottom=function(f){this.setProperty("backgroundColorBottom",f,true);return this.setBackgroundColorBottomABGR(sap.ui.vk.colorToABGR(sap.ui.vk.cssColorToColor(f)));};
e.prototype.setShouldRenderFrame=function(){if(this._dvlRendererId){this._dvl.Renderer.ForceRenderFrame(this._dvlRendererId);}return this;};
e.prototype.shouldRenderFrame=function(){return this._dvlRendererId&&this._dvl.Renderer.ShouldRenderFrame(this._dvlRendererId);};
e.prototype.renderFrame=function(){if(this._dvlRendererId){if(this._matView&&this._matProj){this.renderFrameEx(this._matView,this._matProj,this._dvlRendererId);}else{this._dvl.Renderer.RenderFrame(this._dvlRendererId);}}return this;};
e.prototype.renderFrameEx=function(f,i){if(this._dvlRendererId){this._dvl.Renderer.RenderFrameEx.apply(this,[].concat(f,i),this._dvlRendererId);}return this;};
e.prototype.resetView=function(f){if(f!==undefined&&!q.isPlainObject(f)){q.sap.log.error(sap.ui.vk.getResourceBundle().getText(M.VIT31.summary),M.VIT31.code,"sap.ui.vk.dvl.Viewport");}var i={camera:true,transition:true,visibility:false};q.extend(i,f);if(i.camera||i.visibility){var j=(i.camera?sap.ve.dvl.DVLRESETVIEWFLAG.CAMERA:0)|(i.transition?sap.ve.dvl.DVLRESETVIEWFLAG.SMOOTHTRANSITION:0)|(i.visibility?sap.ve.dvl.DVLRESETVIEWFLAG.VISIBILITY:0);if(this._dvlRendererId){this._dvl.Renderer.ResetView(j,this._dvlRendererId);this._lastPlayedStep=null;}}return this;};
e.prototype.canIsolateNode=function(f){if(this._dvlRendererId){return this._dvl.Renderer.CanIsolateNode(f,this._dvlRendererId);}else{return false;}};
e.prototype.setIsolatedNode=function(f){if(this._dvlRendererId){this._dvl.Renderer.SetIsolatedNode(f,this._dvlRendererId);}return this;};
e.prototype.getIsolatedNode=function(){if(this._dvlRendererId){return this._dvl.Renderer.GetIsolatedNode(this._dvlRendererId);}else{return sap.ve.dvl.DVLID_INVALID;}};
e.prototype.hitTest=function(x,y){if(this._dvlRendererId){var f=this._dvl.Renderer.HitTest(x*window.devicePixelRatio,y*window.devicePixelRatio,this._dvlRendererId).id;this.setShouldRenderFrame();return f;}else{return null;}};
e.prototype.setShowDebugInfo=function(f){this.setProperty("showDebugInfo",f,true);if(this._dvlRendererId){this._dvl.Renderer.SetOption(sap.ve.dvl.DVLRENDEROPTION.DVLRENDEROPTION_SHOW_DEBUG_INFO,f,this._dvlRendererId);}return this;};
e.prototype._handleFrameFinished=function(f){if(f.rendererId===this._dvlRendererId){this.fireFrameRenderingFinished();}};
e.prototype.beginGesture=function(x,y){if(this._dvlRendererId){this._gesturePoint={x:x,y:y};this._dvl.Renderer.BeginGesture(x*window.devicePixelRatio,y*window.devicePixelRatio,this._dvlRendererId);}return this;};
e.prototype.endGesture=function(){if(this._dvlRendererId){this._dvl.Renderer.EndGesture(this._dvlRendererId);}return this;};
e.prototype._activateRedline=function(){this.renderFrame();var m=this._dvl.Renderer.GetCameraMatrices();this._matView=m.view;this._matProj=m.projection;};
e.prototype._deactivateRedline=function(){this._matView=null;this._matProj=null;};
e.prototype.pan=function(f,i){if(this._dvlRendererId&&!this.getFreezeCamera()){if(this._matProj){var j=this.getDomRef();this._matProj[8]-=f*2/j.clientWidth;this._matProj[9]+=i*2/j.clientHeight;this.setShouldRenderFrame();}else{this._dvl.Renderer.Pan(f*window.devicePixelRatio,i*window.devicePixelRatio,this._dvlRendererId);}this.firePan({dx:f,dy:i});}return this;};
e.prototype.rotate=function(f,i){if(this._dvlRendererId&&!this.getFreezeCamera()){this._dvl.Renderer.Rotate(f*window.devicePixelRatio,i*window.devicePixelRatio,this._dvlRendererId);this.fireRotate({dx:f,dy:i});}return this;};
function r(f){var m=f;var i=m[15]===1;var j=2/m[0];var x=2/m[5];var y,z;if(i){y=-m[12]*j;z=-m[13]*x;}else{y=m[8]*j;z=m[9]*x;}var A=(j+y)*0.5;var B=y-A;var D=(x+z)*0.5;var E=z-D;return{left:B,top:D,right:A,bottom:E};}
function t(f,i){var m=f;var j=m[15]===1;m[0]=2/(i.right-i.left);m[5]=2/(i.top-i.bottom);if(j){m[12]=-(i.right+i.left)/(i.right-i.left);m[13]=-(i.top+i.bottom)/(i.top-i.bottom);}else{m[8]=(i.right+i.left)/(i.right-i.left);m[9]=(i.top+i.bottom)/(i.top-i.bottom);}}
e.prototype.zoom=function(i){if(this._dvlRendererId&&!this.getFreezeCamera()){if(this._matProj){var j=this.getDomRef();var m=r(this._matProj);var x=m.left+(m.right-m.left)*this._gesturePoint.x/j.clientWidth;var y=m.top+(m.bottom-m.top)*this._gesturePoint.y/j.clientHeight;var f=1/i;m.left=x+(m.left-x)*f;m.right=x+(m.right-x)*f;m.top=y+(m.top-y)*f;m.bottom=y+(m.bottom-y)*f;t(this._matProj,m);this.setShouldRenderFrame();}else{this._dvl.Renderer.Zoom(i,this._dvlRendererId);}this.fireZoom({zoomFactor:i});}return this;};
e.prototype.zoomTo=function(f,j,m,x){if(this._dvlRendererId){var y=0;if(Array.isArray(f)){for(var i in f){y|=d.decodedZoomTo[f[i]];}}else{y=d.decodedZoomTo[f];}this._dvl.Renderer.ZoomTo(y,j,m,x,this._dvlRendererId);}return this;};
e.prototype.tap=function(x,y,i){if(this._dvlRendererId){var f=x*window.devicePixelRatio,j=y*window.devicePixelRatio;if(!i){var m=this.hitTest(x,y);var z={picked:m===sap.ve.dvl.DVLID_INVALID||m==null?[]:[m]};this.fireNodesPicked(z);if(this.getSelectionMode()===sap.ui.vk.SelectionMode.Exclusive){this.exclusiveSelectionHandler(z.picked);}else if(this.getSelectionMode()===sap.ui.vk.SelectionMode.Sticky){this.stickySelectionHandler(z.picked);}if(m!==sap.ve.dvl.DVLID_INVALID){this.fireNodeClicked({nodeRef:m,nodeId:m,x:x,y:y},true,true);}this._dvl.Renderer.Tap(f,j,false,false,this._dvlRendererId);}else if(!this.getFreezeCamera()){this._dvl.Renderer.Tap(f,j,true,false,this._dvlRendererId);}}return this;};
e.prototype.rectSelect=function(x,y,f,i){var j=[];if(this._dvlRendererId){var m=sap.ui.vk.dvl.getJSONObject(this._dvl.Renderer.RectSelect(x,y,f,i,this._dvlRendererId));if(m.SelectedNodes){j=m.SelectedNodes;}}return j;};
e.prototype.queueCommand=function(f){if(this._dvlRendererId){this._dvl.Renderer._queueCommand(f,this._dvlRendererId);}return this;};
e.prototype._setContent=function(f){var i=null;if(f&&f instanceof sap.ui.vk.dvl.Scene){i=f;}this._setScene(i);};
e.prototype._onAfterUpdateContentConnector=function(){this._setContent(this._contentConnector.getContent());};
e.prototype._onBeforeClearContentConnector=function(){this._setScene(null);};
e.prototype._handleContentReplaced=function(f){var i=f.getParameter("newContent");this._setContent(i);};
e.prototype._setScene=function(f){var i=f&&f.getGraphicsCore();this.setGraphicsCore(i);this.setScene(f);if(f&&(this._isSmart2DContent()||this._isSmart2DContentLegacy())){this._initializeSmart2DHandler();}};
e.prototype._handleContentChangesFinished=function(f){if(f.getSource().getContentResources().length>1){this.zoomTo(sap.ui.vk.ZoomTo.Visible,sap.ve.dvl.DVLID_INVALID,0,0);}this.setShouldRenderFrame();};
e.prototype._onAfterUpdateViewStateManager=function(){if(this._dvl){this._dvl.Renderer.SetViewStateManager(this._viewStateManager,this._dvlRendererId);}};
e.prototype._onBeforeClearViewStateManager=function(){if(this._dvl){this._dvl.Renderer.SetViewStateManager(null,this._dvlRendererId);}};
var u={x:-2,y:-2};var v=2;var w=5;[{key:"left",dx:-v,dy:0},{key:"right",dx:+v,dy:0},{key:"up",dx:0,dy:-v},{key:"down",dx:0,dy:+v}].forEach(function(i){e.prototype["onsap"+i.key]=function(f){this.beginGesture(u.x,u.y);this.rotate(i.dx,i.dy);this.endGesture();this.setShouldRenderFrame();f.preventDefault();f.stopPropagation();};});[{key:"left",dx:-w,dy:0},{key:"right",dx:+w,dy:0},{key:"up",dx:0,dy:-w},{key:"down",dx:0,dy:+w}].forEach(function(i){e.prototype["onsap"+i.key+"modifiers"]=function(f){if(f.shiftKey&&!(f.ctrlKey||f.altKey||f.metaKey)){this.beginGesture(u.x,u.y);this.pan(i.dx,i.dy);this.endGesture();this.setShouldRenderFrame();f.preventDefault();f.stopPropagation();}};});[{key:"minus",d:0.98},{key:"plus",d:1.02}].forEach(function(i){e.prototype["onsap"+i.key]=function(f){this.beginGesture(this.$().width()/2,this.$().height()/2);this.zoom(i.d);this.endGesture();this.setShouldRenderFrame();f.preventDefault();f.stopPropagation();};});C.injectMethodsIntoClass(e);b.injectMethodsIntoClass(e);return e;});
sap.ui.predefine('sap/ui/vk/dvl/ViewportRenderer',["jquery.sap.global"],function(q){"use strict";var V={};
V.render=function(r,c){r.write("<div");r.writeControlData(c);r.addClass("sapVizKitViewport");r.writeClasses();r.writeAttribute("tabindex",0);var a=false;var w=c.getWidth();if(w){r.addStyle("width",w);a=true;}var h=c.getHeight();if(h){r.addStyle("height",h);a=true;}if(a){r.writeStyles();}r.write(">");var t=c.getTools();for(var i=0;i<t.length;i++){var _=sap.ui.getCore().byId(t[i]);var b=_.getGizmoForContainer(c);if(b&&b.render===undefined){r.renderControl(b);}}r.write("</div>");};
return V;},true);
sap.ui.predefine('sap/ui/vk/helpers/RotateOrbitHelperDvl',["jquery.sap.global","sap/ui/base/EventProvider"],function(q,E){"use strict";
var R=E.extend("sap.ui.vk.helpers.RotateOrbitHelperDvl",{
metadata:{publicMethods:["rotate"]},
constructor:function(a,D){this._tool=a;this._dvl=D;this._dvlRendererId=this._tool._viewport._dvlRendererId;}
});
R.prototype.destroy=function(){this._rotateOrbitTool=null;};
R.prototype.activateOrbitMode=function(){if(this._dvlRendererId){this._dvl.Renderer.SetOption(sap.ve.dvl.DVLRENDEROPTION.DVLRENDEROPTION_CAMERA_ROTATION_MODE_ORBIT,true);}return this;};
R.prototype.deactivateOrbitMode=function(){if(this._dvlRendererId){this._dvl.Renderer.SetOption(sap.ve.dvl.DVLRENDEROPTION.DVLRENDEROPTION_CAMERA_ROTATION_MODE_ORBIT,false);}return this;};
R.prototype.rotate=function(d,a){if(this._dvlRendererId){this._dvl.Renderer.Rotate(d*window.devicePixelRatio,a*window.devicePixelRatio,this._dvlRendererId);this._tool.fireRotate({dx:d,dy:a});}return this;};
return R;},true);
sap.ui.predefine('sap/ui/vk/helpers/RotateOrbitHelperThree',["jquery.sap.global","sap/ui/base/EventProvider"],function(q,E){"use strict";
var R=E.extend("sap.ui.vk.helpers.RotateOrbitHelperThree",{
metadata:{publicMethods:["rotate"]},
constructor:function(r){this._tool=r;}
});
R.prototype.destroy=function(){this._tool=null;};
R.prototype.activateOrbitMode=function(){this._tool._viewport._viewportGestureHandler._cameraController.isTurnTableMode=false;return this;};
R.prototype.deactivateOrbitMode=function(){this._tool._viewport._viewportGestureHandler._cameraController.isTurnTableMode=true;return this;};
R.prototype.rotate=function(d,a){this._tool._viewport._viewportGestureHandler._cameraController.rotate(d,a,false);return this;};
return R;},true);
sap.ui.predefine('sap/ui/vk/helpers/RotateTurntableHelperDvl',["jquery.sap.global","sap/ui/base/EventProvider"],function(q,E){"use strict";
var R=E.extend("sap.ui.vk.helpers.RotateTurntableHelperDvl",{
metadata:{publicMethods:["rotate"]},
constructor:function(a,D){this._tool=a;this._dvl=D;this._dvlRendererId=this._tool._viewport._dvlRendererId;}
});
R.prototype.destroy=function(){this._rotateOrbitTool=null;};
R.prototype.activateTurntableMode=function(){if(this._dvlRendererId){this._dvl.Renderer.SetOption(sap.ve.dvl.DVLRENDEROPTION.DVLRENDEROPTION_CAMERA_ROTATION_MODE_ORBIT,false);}return this;};
R.prototype.deactivateTurntableMode=function(){if(this._dvlRendererId){this._dvl.Renderer.SetOption(sap.ve.dvl.DVLRENDEROPTION.DVLRENDEROPTION_CAMERA_ROTATION_MODE_ORBIT,true);}return this;};
R.prototype.rotate=function(d,a){if(this._dvlRendererId){this._dvl.Renderer.Rotate(d*window.devicePixelRatio,a*window.devicePixelRatio,this._dvlRendererId);this._tool.fireRotate({dx:d,dy:a});}return this;};
return R;},true);
sap.ui.predefine('sap/ui/vk/helpers/RotateTurntableHelperThree',["jquery.sap.global","sap/ui/base/EventProvider"],function(q,E){"use strict";
var R=E.extend("sap.ui.vk.helpers.RotateTurntableHelperThree",{
metadata:{publicMethods:["rotate"]},
constructor:function(r){this._tool=r;}
});
R.prototype.destroy=function(){this._tool=null;};
R.prototype.activateTurntableMode=function(){this._tool._viewport._viewportGestureHandler._cameraController.isTurnTableMode=true;return this;};
R.prototype.deactivateTurntableMode=function(){this._tool._viewport._viewportGestureHandler._cameraController.isTurnTableMode=false;return this;};
R.prototype.rotate=function(d,a){this._tool._viewport._viewportGestureHandler._cameraController.rotate(d,a,true);this._tool.fireRotate({dx:d,dy:a});return this;};
return R;},true);
sap.ui.predefine('sap/ui/vk/threejs/BaseNodeProxy',["jquery.sap.global","../library","../BaseNodeProxy"],function(q,l,B){"use strict";
var a=B.extend("sap.ui.vk.threejs.BaseNodeProxy",{metadata:{}});
a.prototype.init=function(n,b){this._object3D=b;};
a.prototype.reset=function(){this._object3D=null;};
a.prototype.getNodeRef=function(){return this._object3D;};
a.prototype.getNodeId=function(){return this._object3D;};
a.prototype.getName=function(){return this._object3D.name||("<"+this._object3D.type+">");};
a.prototype.getNodeMetadata=function(){return this._object3D.userData.metadata;};
a.prototype.getHasChildren=function(){return this._object3D.children.length>0;};
a.prototype.getSceneRef=function(){return this._object3D;};
return a;});
sap.ui.predefine('sap/ui/vk/threejs/Billboard',["jquery.sap.global","../library","./thirdparty/three","sap/ui/base/ManagedObject","../ve/thirdparty/html2canvas"],function(q,l,t,B,h){"use strict";
var b=B.extend("sap.ui.vk.threejs.Billboard",{
metadata:{properties:{text:{type:"string",defaultValue:"Annotation"},font:{type:"string",defaultValue:""},fontSize:{type:"float",defaultValue:20},fontWeight:{type:"string",defaultValue:"normal"},fontItalic:{type:"boolean",defaultValue:false},textColor:{type:"sap.ui.core.CSSColor",defaultValue:"#fff"},borderColor:{type:"sap.ui.core.CSSColor",defaultValue:"#fff"},borderOpacity:{type:"float",defaultValue:1},backgroundColor:{type:"sap.ui.core.CSSColor",defaultValue:"#fff"},backgroundOpacity:{type:"float",defaultValue:0.5},encoding:{type:"sap.ui.vk.BillboardTextEncoding",defaultValue:sap.ui.vk.BillboardTextEncoding.PlainText},width:{type:"float",defaultValue:100},height:{type:"float",defaultValue:100},style:{type:"sap.ui.vk.BillboardStyle",defaultValue:sap.ui.vk.BillboardStyle.None},borderLineStyle:{type:"sap.ui.vk.BillboardBorderLineStyle",defaultValue:sap.ui.vk.BillboardBorderLineStyle.Solid},borderWidth:{type:"float",defaultValue:2},horizontalAlignment:{type:"sap.ui.vk.BillboardHorizontalAlignment",defaultValue:sap.ui.vk.BillboardHorizontalAlignment.Left},texture:{type:"any",defaultValue:null},link:{type:"string",defaultValue:""},coordinateSpace:{type:"sap.ui.vk.BillboardCoordinateSpace",defaultValue:sap.ui.vk.BillboardCoordinateSpace.Screen},position:{type:"any",defaultValue:new THREE.Vector3(0,0,0)},renderOrder:{type:"int",defaultValue:0}}},
constructor:function(i,s,S){B.apply(this,arguments);var g=new THREE.BufferGeometry();g.setIndex([0,1,2,2,1,3]);g.addAttribute("position",new THREE.Float32BufferAttribute([-0.5,-0.5,0,0.5,-0.5,0,-0.5,0.5,0,0.5,0.5,0],3));g.addAttribute("normal",new THREE.Float32BufferAttribute([0,0,1,0,0,1,0,0,1,0,0,1],3));g.addAttribute("uv",new THREE.Float32BufferAttribute([0,0,1,0,0,1,1,1],2));g.boundingBox=new THREE.Box3();var m=new THREE.MeshBasicMaterial({map:this.getTexture(),depthTest:false,depthWrite:false,transparent:true,alphaTest:0.05,premultipliedAlpha:true,side:THREE.DoubleSide});this._billboard=new THREE.Mesh(g,m);this._billboard.renderOrder=this.getRenderOrder();this._updateTexture();this._node=new THREE.Group();this._node.add(this._billboard);this._node.matrixAutoUpdate=false;this._node.matrixWorldNeedsUpdate=false;}
});
b.prototype.setEncoding=function(v){this.setProperty("encoding",v,true);this._updateTexture();return this;};
b.prototype.setText=function(v){this.setProperty("text",v,true);this._updateTexture();return this;};
b.prototype.setFont=function(v){this.setProperty("font",v,true);this._updateTexture();return this;};
b.prototype.setFontSize=function(v){this.setProperty("fontSize",v,true);this._updateTexture();return this;};
b.prototype.setFontWeight=function(v){this.setProperty("fontWeight",v,true);this._updateTexture();return this;};
b.prototype.setFontItalic=function(v){this.setProperty("fontItalic",v,true);this._updateTexture();return this;};
b.prototype.setStyle=function(v){this.setProperty("style",v,true);this._updateTexture();return this;};
b.prototype.setWidth=function(v){this.setProperty("width",v,true);this._updateTexture();return this;};
b.prototype.setHeight=function(v){this.setProperty("height",v,true);this._updateTexture();return this;};
b.prototype.setTextColor=function(v){this.setProperty("textColor",v,true);this._updateTexture();return this;};
b.prototype.setBackgroundColor=function(v){this.setProperty("backgroundColor",v,true);this._updateTexture();return this;};
b.prototype.setBackgroundOpacity=function(v){this.setProperty("backgroundOpacity",v,true);this._updateTexture();return this;};
b.prototype.setBorderWidth=function(v){this.setProperty("borderWidth",v,true);this._updateTexture();return this;};
b.prototype.setBorderLineStyle=function(v){this.setProperty("borderLineStyle",v,true);this._updateTexture();return this;};
b.prototype.setBorderColor=function(v){this.setProperty("borderColor",v,true);this._updateTexture();return this;};
b.prototype.setBorderOpacity=function(v){this.setProperty("borderOpacity",v,true);this._updateTexture();return this;};
b.prototype.setHorizontalAlignment=function(v){this.setProperty("horizontalAlignment",v,true);this._updateTexture();return this;};
b.prototype.setLink=function(v){this.setProperty("link",v,true);this._updateTexture();return this;};
b.prototype.setTexture=function(v){this.setProperty("texture",v,true);if(this._billboard){this._billboard.material.map=v;}return this;};
b.prototype.setRenderOrder=function(v){this.setProperty("renderOrder",v,true);if(this._billboard){this._billboard.renderOrder=v;}return this;};
b.prototype._renderBackground=function(a,w,e,f){a.fillStyle=this.getBackgroundColor();a.strokeStyle=this.getBorderColor();a.lineWidth=f;switch(this.getBorderLineStyle()){default:a.setLineDash([]);break;case sap.ui.vk.BillboardBorderLineStyle.Dash:a.setLineDash([f*5,f]);break;case sap.ui.vk.BillboardBorderLineStyle.Dot:a.setLineDash([f*2,f]);break;case sap.ui.vk.BillboardBorderLineStyle.DashDot:a.setLineDash([f*5,f,f*2,f]);break;case sap.ui.vk.BillboardBorderLineStyle.DashDotDot:a.setLineDash([f*5,f,f*2,f,f*2,f]);break;}var g=f/2;if(this.getStyle()===sap.ui.vk.BillboardStyle.RectangularShape){a.globalAlpha=this.getBackgroundOpacity();if(a.globalAlpha>0){a.fillRect(0,0,w,e);}a.globalAlpha=f>0?this.getBorderOpacity():0;if(a.globalAlpha>0){a.strokeRect(g,g,w-f,e-f);}}else if(this.getStyle()===sap.ui.vk.BillboardStyle.CircularShape){var x=w/2;var y=e/2;var r=w/2;a.beginPath();a.arc(x,y,r-g,0,2*Math.PI);a.closePath();a.globalAlpha=this.getBackgroundOpacity();if(a.globalAlpha>0){a.fill();}a.globalAlpha=f>0?this.getBorderOpacity():0;if(a.globalAlpha>0){a.stroke();}}a.globalAlpha=1;a.setLineDash([]);};
b.prototype._getFont=function(a){return(this.getFontItalic()?"italic ":"")+this.getFontWeight()+" "+(this.getFontSize()*a)+"px "+(this.getFont()||"Arial");};
b.prototype._renderPlainText=function(e){var f=document.createElement("canvas");var g=f.getContext("2d");var j=this.getFontSize()*e;var k=this._getFont(e);g.font=k;var m=Math.ceil(j);var n=this.getBorderLineStyle()!==sap.ui.vk.BillboardBorderLineStyle.None?this.getBorderWidth()*e:0;var o=Math.ceil(j*0.2+n);var r=this.getText().split("\n");var s=0;r.forEach(function(C){s=Math.max(s,g.measureText(C).width);});var u=this.getLink();if(u.length>0){s=Math.max(s,g.measureText(u).width);}s=Math.ceil(s*0.5)*2;var v=r.length+(u.length>0?1:0);var w=Math.ceil(m*v*0.5)*2;var z=s+o*2;var A=w+o*2;if(this.getStyle()===sap.ui.vk.BillboardStyle.CircularShape){z=A=Math.max(z,A);}this._width=z/e;this._height=A/e;f.width=Math.pow(2,Math.ceil(Math.log2(z)));f.height=Math.pow(2,Math.ceil(Math.log2(A)));this._renderBackground(g,z,A,n);g.font=k;g.textAlign=this.getHorizontalAlignment();g.textBaseline="middle";var a=["left","center","right"].indexOf(g.textAlign);var x=(z+s*(a-1))>>1;var y=(A-(v-1)*m)>>1;g.fillStyle=this.getTextColor();g.filter="blur(0px)";for(var i in r){g.fillText(r[i],x,y+m*i);}if(u.length>0){g.fillStyle="#00f";g.textAlign="right";g.textBaseline="bottom";g.fillText(u,z-o,A-o);}this._setBillboardTexture(f,z,A);};
b.prototype._renderHtmlText=function(a){var e=document.createElement("canvas");var f=e.getContext("2d");var g=this.getBorderLineStyle()!==sap.ui.vk.BillboardBorderLineStyle.None?this.getBorderWidth()*a:0;var m=Math.ceil(g);var w=Math.ceil(this.getWidth()*a)+m*2;var i=Math.ceil(this.getHeight()*a)+m*2;if(this.getStyle()===sap.ui.vk.BillboardStyle.CircularShape){w=i=Math.max(w,i);}this._width=w/a;this._height=i/a;e.width=Math.pow(2,Math.ceil(Math.log2(w)));e.height=Math.pow(2,Math.ceil(Math.log2(i)));this._renderBackground(f,w,i,g);var j=this.getLink();if(j.length>0){f.font=this._getFont(a);f.fillStyle="#00f";f.textAlign="right";f.textBaseline="bottom";f.fillText(j,w-m,i-m);}var k=document.createElement("iframe");k.style.visibility="hidden";k.width=(w-m*2)/a;k.height=(i-m*2)/a;document.body.appendChild(k);var n=k.contentDocument||k.contentWindow.document;n.open();n.close();n.body.innerHTML=this.getText();var o=document.createElement("canvas");o.width=k.width*a;o.height=k.height*a;o.style.width=k.width+"px";o.style.height=k.height+"px";var r=o.getContext("2d");r.scale(a,a);this._billboard.material.visible=false;h(n.body,{canvas:o}).then(function(o){if(o.width>0&&o.height>0){e.getContext("2d").drawImage(o,m,m);}setTimeout(this._setBillboardTexture.bind(this,e,w,i),0);document.body.removeChild(k);}.bind(this));};
b.prototype._setBillboardTexture=function(a,w,e){var u=w/a.width,v=e/a.height;this._billboard.geometry.addAttribute("uv",new THREE.Float32BufferAttribute([0,1-v,u,1-v,0,1,u,1],2));var f=new THREE.Texture(a);f.magFilter=THREE.NearestFilter;f.needsUpdate=true;this._billboard.material.map=f;this._billboard.material.needsUpdate=true;this._billboard.material.visible=true;};
b.prototype._updateTexture=function(){if(!this._billboard||this.getTexture()){this._width=this.getWidth();this._height=this.getHeight();return;}switch(this.getEncoding()){default:case sap.ui.vk.BillboardTextEncoding.PlainText:this._renderPlainText(window.devicePixelRatio);break;case sap.ui.vk.BillboardTextEncoding.HtmlText:this._renderHtmlText(window.devicePixelRatio);break;}};
var p=new THREE.Vector4(),c=new THREE.Vector3(),d=new THREE.Vector3();
b.prototype._update=function(r,a){this._node.matrix.getInverse(this._node.parent.matrixWorld);this._node.matrix.decompose(this._node.position,this._node.rotation,this._node.scale);this._node.matrixWorld.identity();this._billboard.rotation.copy(a.rotation);var v=r.getSize(),s=this.getPosition(),e=this._billboard.position,f=1;if(s){e.copy(s);}else{e.setScalar(0);}var g=this.getCoordinateSpace();if(g===sap.ui.vk.BillboardCoordinateSpace.Viewport){e.multiplyScalar(2/a.projectionMatrix.elements[5]);e.z=-1;f=(a.near+a.far)*0.5;e.multiplyScalar(f).applyMatrix4(a.matrixWorld);}else if(g===sap.ui.vk.BillboardCoordinateSpace.Screen){if(v.width>v.height){e.x*=v.height/v.width;}else{e.y*=v.width/v.height;}e.unproject(a);p.copy(e).applyMatrix4(a.matrixWorldInverse).applyMatrix4(a.projectionMatrix);var i=(p.x/p.w)*0.5*v.width,j=(p.y/p.w)*0.5*v.height;f=p.w*2/(v.width*a.projectionMatrix.elements[0]);c.setFromMatrixColumn(a.matrixWorld,0).multiplyScalar(f*(Math.round(i)-i));d.setFromMatrixColumn(a.matrixWorld,1).multiplyScalar(f*(Math.round(j)-j));e.add(c).add(d);}this._billboard.scale.set(this._width*f,this._height*f,1);this._billboard.updateMatrixWorld();};
return b;});
sap.ui.predefine('sap/ui/vk/threejs/Callout',["jquery.sap.global","../library","./thirdparty/three","sap/ui/base/ManagedObject","./Billboard","../ve/thirdparty/html2canvas"],function(q,l,t,B,a,h){"use strict";
var C=a.extend("sap.ui.vk.threejs.Callout",{
metadata:{properties:{anchorNode:{type:"any",defaultValue:null},depthTest:{type:"boolean",defaultValue:true}}},
constructor:function(i,s,S){a.apply(this,arguments);this._billboard.material.depthTest=this.getDepthTest();var f=this._billboard.geometry.boundingBox;f.min.setScalar(0);f.max.setScalar(0);this._lines=[];}
});
C.prototype.setRenderOrder=function(v){a.prototype.setRenderOrder.call(this,v);if(this._lines){this._lines.forEach(function(f){f.renderOrder=v;});}return this;};
C.prototype.setDepthTest=function(v){this.setProperty("depthTest",v,true);if(this._billboard){this._billboard.material.depthTest=v;this._lines.forEach(function(f){f.material.depthTest=v;});}return this;};
var b=new THREE.Vector4(),m=new THREE.Matrix4(),d=new THREE.Vector2(),c=new THREE.Vector3(),e=new THREE.Vector3();
C.prototype._update=function(r,f){this._node.matrix.getInverse(this._node.parent.matrixWorld);this._node.matrix.decompose(this._node.position,this._node.rotation,this._node.scale);this._node.matrixWorld.identity();var v=r.getSize(),s=this.getPosition(),g=this._billboard.position;if(s){g.copy(s);}else{g.setScalar(0);}var i=this.getAnchorNode();if(i){g.applyMatrix4(i.matrixWorld);}this._billboard.rotation.copy(f.rotation);b.copy(g).applyMatrix4(f.matrixWorldInverse).applyMatrix4(f.projectionMatrix);var j=(b.x/b.w)*v.width,k=(b.y/b.w)*v.height;var n=b.w*2/(v.width*f.projectionMatrix.elements[0]);this._billboard.scale.set(n*this._width,n*this._height,1);c.setFromMatrixColumn(f.matrixWorld,0).multiplyScalar(n*(Math.round(j*0.5)-j*0.5));e.setFromMatrixColumn(f.matrixWorld,1).multiplyScalar(n*(Math.round(k*0.5)-k*0.5));g.add(c).add(e);this._billboard.updateMatrixWorld();c.setFromMatrixColumn(this._billboard.matrixWorld,0);e.setFromMatrixColumn(this._billboard.matrixWorld,1);var o=this.getStyle()===sap.ui.vk.BillboardStyle.CircularShape;function u(p,w,x){if(p<w){return p-w;}else if(p>x){return p-x;}return 0;}this._lines.forEach(function(p){if(p.userData.targetNode){p.matrix.copy(p.userData.targetNode.matrixWorld);p.matrixWorld.copy(p.matrix);}var w=p.geometry.vertices,x=w[w.length-2],y=w[w.length-1],z=false;b.copy(x).applyMatrix4(p.matrixWorld).applyMatrix4(f.matrixWorldInverse).applyMatrix4(f.projectionMatrix);var A=(b.x/b.w)*v.width,D=(b.y/b.w)*v.height;if(o){var E=d.set(A-j,D-k).length();z=E<this._width;d.multiplyScalar(0.5/E);y.copy(c.multiplyScalar(d.x)).add(e.multiplyScalar(d.y));}else{var F=u(A,j-this._width,j+this._width),G=u(D,k-this._height,k+this._height);z=(F===0&&G===0);if(Math.abs(F)>Math.abs(G)){y.copy(c).multiplyScalar(Math.sign(F)*0.5);}else{y.copy(e).multiplyScalar(Math.sign(G)*0.5);}}if(z){y.copy(x);}else{y.add(g).applyMatrix4(m.getInverse(p.matrixWorld));}p.geometry.verticesNeedUpdate=true;}.bind(this));};
C.prototype.addLeaderLine=function(v,f,g,s,i){var j=new THREE.Geometry();j.vertices=v;var k=new THREE.Line(j,g.clone());k.userData.targetNode=f;k.matrixAutoUpdate=false;k.matrixWorldNeedsUpdate=false;k.renderOrder=this.getRenderOrder();k.material.transparent=true;k.material.depthTest=this.getDepthTest();this._node.add(k);this._lines.push(k);return k;};
return C;});
sap.ui.predefine('sap/ui/vk/threejs/ContentDeliveryService',["jquery.sap.global","sap/ui/base/ManagedObject","./thirdparty/three","sap/ui/vk/totara/TotaraLoader","./PerspectiveCamera","./OrthographicCamera","sap/ui/vk/View","./Material"],function(q,M,t,T,P,O,V,a){"use strict";
var C=M.extend("sap.ui.vk.threejs.ContentDeliveryService",{metadata:{properties:{authorizationHandler:"any"},events:{cameraChanged:{parameters:{sceneId:{type:"string"},camera:{type:"any"}},enableEventBubbling:true},sceneUpdated:{parameters:{},enableEventBubbling:true},errorReported:{parameters:{error:{type:"any"}}}}}});
var b=C.getMetadata().getParent().getClass().prototype;
C.prototype.init=function(){if(b.init){b.init.call(this);}this._loader=null;this._transientSceneMap=new Map();this._currentNodeHierarchy=null;};
C.prototype.initUrl=function(u,k){var d=this;function n(){d.fireSceneUpdated({});}if(!d._loader){this._loader=new T();var s=this._loader.getState();s.onErrorCallbacks.attach(this._reportError.bind(d));s.onMaterialFinishedCallbacks.attach(n);s.onImageFinishedCallbacks.attach(n);s.onSetGeometryCallbacks.attach(n);return this._loader.init(u);}else if(!k){var e=this._loader.getState();if(e){e.cleanup();}}return Promise.resolve("Loader is ready");};
function c(d){if(!d){return null;}var e;if(d.isOrthographicCamera){e=new sap.ui.vk.threejs.OrthographicCamera();}else if(d.isPerspectiveCamera){e=new sap.ui.vk.threejs.PerspectiveCamera();}e.setCameraRef(d);e.setUsingDefaultClipPlanes(true);if(d.cameraInfo&&d.cameraInfo.zoom===-1){e.setZoomNeedRecalculate(true);}return e;}
C.prototype._reportError=function(e){this.fireErrorReported(e);};
C.prototype._createLoadParam=function(r,d,p,e){var f=this;var i;var s=false;var g={root:p,includeHidden:e.getIncludeHidden(),pushPMI:e.getPushPMI(),metadataFilter:e.getMetadataFilter(),useSecureConnection:e.getUseSecureConnection(),activateView:e.getActivateView(),enableLogger:e.getEnableLogger()===true,onActiveCamera:function(n){var j=false;var k=f._loader.getState();if(k){var l=k.contextMap.get(e.getVeid());if(l&&l.phase<2){i=c(n);j=true;}}if(!j){f.fireCameraChanged({sceneId:e.getVeid(),camera:c(n)});}},onInitialSceneFinished:function(){s=true;r({node:p,camera:i,contentResource:e,loader:f});}};var h=function(j){var k;if(j.getParameter("errorText")){k=j.getParameter("errorText");}else if(j.getParameter("error")){k=j.getParameter("error");}else if(j.getParameter("reason")){k=j.getParameter("reason");}else{k="failed to load: unknown reason";}if(s){var l=j.getParameter("error");if(l&&l===4){this.initUrl(this._loader.getUrl(),true);}}else{f.detachErrorReported(h);if(j.getParameter("events")){k=k+"\n"+JSON.stringify(j.getParameter("events"));}d(k);}};f.attachErrorReported(h);return g;};
C.prototype.load=function(p,d,e){var f=this;var n=d.getNodeProxy();if(n){this._currentNodeHierarchy=n.getNodeHierarchy();}return new Promise(function(r,g){if(!d.getSource()||!d.getVeid()){g("url or veid not specified");return;}f.initUrl(d.getSource());var h=f._createLoadParam(r,g,p,d);if(f._loader){f._loader.request(d.getVeid(),h,e);}});};
C.prototype.getState=function(){if(this._loader){return this._loader.getState();}return null;};
C.prototype.decrementResourceCountersForDeletedTreeNode=function(s){var d=this.getState();if(d){var e=this;d.contextMap.forEach(function(v,k){e._loader.decrementResourceCountersForDeletedTreeNode(d,v,s);});}};
C.prototype.loadTransientScene=function(s,p,u){var d=this;return new Promise(function(r,e){if(!s||!p){e("invalid arguments");return;}if(d._transientSceneMap.has(s)){var f=d._transientSceneMap.get(s).clone();p.add(f);r({nodeRef:f});return;}if(!d._loader){e("ContentDeliveryService is not initialised");return;}var g=new THREE.Object3D();g.name="transient";var o=function(){var i=d._loader.getState().getContext(s);i.onSceneCompletedCallbacks.detach(o);d._transientSceneMap.set(s,g);var f=g.clone();p.add(f);r({nodeRef:f});};var h={root:g,onSceneCompleted:o,useSecureConnection:u};d._loader.request(s,h);});};
C.prototype.update=function(s,d,v){var e=this;return new Promise(function(r,f){if(!e._loader){f("ContentDeliveryService is not initialised");return;}e._loader.update(s,d,v).then(function(g){if(e._currentNodeHierarchy){for(var i=0;i<g.replacedNodeRefs.length;i++){e._currentNodeHierarchy.fireNodeReplaced({ReplacedNodeRef:g.replacedNodeRefs[i],ReplacementNodeRef:g.replacementNodeRefs[i],ReplacedNodeId:g.replacedNodeRefs[i],ReplacementNodeId:g.replacementNodeRefs[i]});}}r({sceneVeId:g.sceneVeId,sids:g.sidArray});}).catch(function(g){return f(g);});});};
C.prototype.exit=function(){if(b.exit){b.exit.call(this);}if(this._loader){this._loader.dispose();this._loader=null;}this._transientSceneMap=null;};
C.prototype.loadView=function(s,v,d){if(typeof d==="undefined"){d="static";}var e=this;return this._loader.requestView(s,d,v).then(function(f){var m=new sap.ui.vk.View({name:f.name,nodeInfos:f.viewNodes});if(f.camera){var g=true;var r=false;if(f.camera.cameraInfo&&f.camera.cameraInfo.zoom===-1){r=true;}if(f.camera.type==="PerspectiveCamera"){m.setCameraInfo({type:f.camera.type,fov:f.camera.cameraInfo.fov*180/Math.PI,position:f.camera.position.toArray(),nearClipPlane:f.camera.near,farClipPlane:f.camera.far,upDirection:f.camera.up.toArray(),targetDirection:f.camera.getWorldDirection().toArray(),usingDefaultClipPlanes:g});}if(f.camera.type==="OrthographicCamera"){m.setCameraInfo({type:f.camera.type,zoomFactor:f.camera.zoom,position:f.camera.position.toArray(),nearClipPlane:f.camera.near,farClipPlane:f.camera.far,upDirection:f.camera.up.toArray(),targetDirection:f.camera.getWorldDirection().toArray(),usingDefaultClipPlanes:g,zoomNeedRecalculate:r});}}if(e._currentNodeHierarchy){for(var i=0;i<f.updatedNodes.length;i++){e._currentNodeHierarchy.fireNodeUpdated({nodeRef:f.updatedNodes[i]});}}e.fireSceneUpdated({});return m;}).catch(function(f){q.sap.log.error(f);return null;});};
C.prototype.assignMaterialToNodes=function(s,m,n,d){var e=this;return this._loader.requestMaterial(m).then(function(f){function g(f,l,r){if(!l){return;}if(l.userData.markedForNotAssigningMaterial){delete l.userData.markedForNotAssigningMaterial;return;}if(e._currentNodeHierarchy){var o=e._currentNodeHierarchy.createNodeProxy(l);var p=new a();p.setMaterialRef(f);o.assignMaterial(p);}if(r){l.children.forEach(function(u){if(!u){return;}g(f,u,r);});}}if(!d){for(var i=0;i<n.length;i++){g(f,n[i]);}}else{for(var j=0;j<n.length;j++){n[j].userData.markedForNotAssigningMaterial=true;}var h=e._loader.getState().contextMap.get(s);var k=h.root;g(f,k,true);}e.fireSceneUpdated({});return true;}).catch(function(f){q.sap.log.error(f);return false;});};
C.prototype.printLogTokens=function(){if(this._loader){this._loader.printLogTokens();return true;}else{return false;}};
return C;});
sap.ui.predefine('sap/ui/vk/threejs/ContentManager',["jquery.sap.global","./thirdparty/three","../ContentManager","./Scene","../TransformationMatrix","./PerspectiveCamera","./OrthographicCamera","../Messages"],function(q,t,C,S,T,P,O,M){"use strict";
var a=C.extend("sap.ui.vk.threejs.ContentManager",{metadata:{library:"sap.ui.vk"}});
var b=a.getMetadata().getParent().getClass().prototype;
a.prototype.init=function(){if(b.init){b.init.call(this);}};
a.prototype.exit=function(){if(b.exit){b.exit.call(this);}};
function s(o){if(o&&o.isMesh){o.castShadow=true;o.receiveShadow=false;}if(o&&o.children){for(var n=0;n<o.children.length;n++){s(o.children[n]);}}}
function c(n,e){if(n){var f=new THREE.Group();n.add(f);f.name="DefaultLights";f.private=true;var g=new THREE.Box3().setFromObject(n);var m=g.getSize().length();var p=new THREE.PointLight();p.color.copy(new THREE.Color(0.72,0.72,0.81));p.position.copy(g.getCenter());p.visible=true;p.private=true;f.add(p);var h=[new THREE.Color(0.2,0.2,0.2),new THREE.Color(0.32,0.32,0.36),new THREE.Color(0.36,0.36,0.36)];var i=[new THREE.Vector3(2.0,1.5,0.5),new THREE.Vector3(-2.0,-1.1,2.5),new THREE.Vector3(-0.04,-0.01,-2.0)];for(var l=0,j=h.length;l<j;l++){var k=new THREE.DirectionalLight();k.color.copy(h[l]);k.position.copy(i[l]);k.private=true;f.add(k);}if(e){s(n);var o=new THREE.DirectionalLight();o.color.copy(new THREE.Color(0.5,0.5,0.5));o.position.copy(new THREE.Vector3(0,1.0,0));o.castShadow=true;o.shadow.mapSize.width=512;o.shadow.mapSize.height=512;var d=2000;o.shadow.camera.left=-d;o.shadow.camera.right=d;o.shadow.camera.top=d;o.shadow.camera.bottom=-d;o.shadow.camera.far=3500;o.shadow.bias=-0.0001;o.private=true;f.add(o);var r=new THREE.PlaneBufferGeometry(g.getSize().x,g.getSize().z);var u=new THREE.ShadowMaterial();u.opacity=0.2;var v=new THREE.Mesh(r,u);v.rotation.x=-Math.PI/2;v.position.x=g.getCenter().x;v.position.y=g.min.y-m*0.1;v.position.z=g.getCenter().z;n.add(v);v.receiveShadow=true;}}}
a.prototype.loadContent=function(d,e){var f=this;var l=function(){f.fireContentChangesStarted();var n=new THREE.Scene(),g=new S(n);f._loadContentResources(g,e).then(function(v){var d=g;if(v[0].camera){d.camera=v[0].camera;}var h=[];for(var i=0;i<v.length;i++){if(v[i].loader){h.push(v[i].loader);}}if(h.length>0){d.loaders=h;}f._initSceneWithCDSLoaderIfExists(g,h);c(g.getSceneRef(),false);f.fireContentChangesFinished({content:d});},function(r){q.sap.log.error("Failed to load content resources.",r);f.fireContentChangesFinished({content:null,failureReason:[{error:r,errorMessage:typeof r==="string"?r:sap.ui.vk.getResourceBundle().getText(M.VIT37.summary)}]});});};l();return this;};
a.prototype._findLoader=function(d){if(d._contentManagerResolver&&d._contentManagerResolver.settings&&d._contentManagerResolver.settings.loader){return d._contentManagerResolver.settings.loader;}if(d.getSource()){var e=d.getSourceType();if(e==="stream"){if(this.defaultCdsLoader==null){q.sap.require("sap.ui.vk.threejs.ContentDeliveryService");this.defaultCdsLoader=new sap.ui.vk.threejs.ContentDeliveryService({authorizationHandler:this._authorizationHandler});}return this.defaultCdsLoader;}}return null;};
a.prototype._loadContentResources=function(d,e){var p=[];e.forEach(function loadContentResource(f,g){var n=new THREE.Group();n.name=g.getName();n.sourceId=g.getSourceId();g._shadowContentResource={nodeProxy:d.getDefaultNodeHierarchy().createNodeProxy(n)};var l=g.getLocalMatrix();if(l){n.applyMatrix(new THREE.Matrix4().fromArray(T.convertTo4x4(l)));}f.add(n);var h=this._findLoader(g);if(typeof h==="function"){p.push(h(n,g,this._authorizationHandler));}else if(h&&h.load){p.push(h.load(n,g,this._authorizationHandler));}else{p.push(Promise.resolve({node:n,contentResource:g}));}g.getContentResources().forEach(loadContentResource.bind(this,n));}.bind(this,d.getSceneRef()));return Promise.all(p);};
a.prototype._initSceneWithCDSLoaderIfExists=function(d,l){var e;if(l){for(var i=0;i<l.length;i++){if(l[i]instanceof sap.ui.vk.threejs.ContentDeliveryService){e=l[i];break;}}if(e){d._setState(e.getState());d.getDefaultNodeHierarchy().attachNodeRemoving(function(f){var r=f.getParameter("nodeRef");if(r.userData&&r.userData.treeNode&&r.userData.treeNode.sid){e.decrementResourceCountersForDeletedTreeNode(r.userData.treeNode.sid);}});return true;}}return false;};
a.prototype.createOrthographicCamera=function(){return new O();};
a.prototype.createPerspectiveCamera=function(){return new P();};
return a;});
sap.ui.predefine('sap/ui/vk/threejs/DetailView',["jquery.sap.global","../library","./thirdparty/three","sap/ui/base/ManagedObject","../ve/thirdparty/html2canvas"],function(q,c,t,B,d){"use strict";
var D=B.extend("sap.ui.vk.threejs.DetailView",{
metadata:{properties:{name:{type:"string",defaultValue:""},camera:{type:"any",defaultValue:null},type:{type:"sap.ui.vk.DetailViewType",defaultValue:sap.ui.vk.DetailViewType.DetailView},shape:{type:"sap.ui.vk.DetailViewShape",defaultValue:sap.ui.vk.DetailViewShape.Box},borderWidth:{type:"float",defaultValue:2},backgroundColor:{type:"sap.ui.core.CSSColor",defaultValue:"#fff"},borderColor:{type:"sap.ui.core.CSSColor",defaultValue:"#000"},renderOrder:{type:"int",defaultValue:0},origin:{type:"any",defaultValue:new THREE.Vector3(0,0)},size:{type:"any",defaultValue:new THREE.Vector3(0.5,0.5)},attachmentPoint:{type:"any",defaultValue:null},metadata:{type:"any",defaultValue:{}},veId:{type:"any",defaultValue:{}}}},
constructor:function(i,S,a){this._backgroundColor=new THREE.Color();B.apply(this,arguments);var m=new THREE.MeshBasicMaterial({depthTest:false,depthWrite:false,transparent:true});this._billboard=new THREE.Mesh(new THREE.BufferGeometry(),m);var b=new THREE.MeshBasicMaterial({depthTest:false,depthWrite:false,transparent:true});this._border=new THREE.Mesh(new THREE.BufferGeometry(),b);this._line=new THREE.Mesh(new THREE.BufferGeometry(),b);var f=new THREE.BufferGeometry();f.setIndex([0,1,2]);var h=new THREE.MeshBasicMaterial({color:this._backgroundColor,depthTest:false,depthWrite:false,transparent:true});this._triangle=new THREE.Mesh(f,h);this._node=new THREE.Group();this._node.add(this._billboard);this._node.add(this._border);this._node.add(this._line);this._node.add(this._triangle);this._node.matrixWorldNeedsUpdate=false;this._node.traverse(function(l){if(l.geometry!==undefined){l.geometry.boundingBox=new THREE.Box3();}l.matrixAutoUpdate=false;});this.setRenderOrder(this.getRenderOrder());}
});
D.prototype.setCamera=function(a){if(a instanceof sap.ui.vk.threejs.PerspectiveCamera||a instanceof sap.ui.vk.threejs.OrthographicCamera){this.setProperty("camera",a,true);}return this;};
D.prototype.setShape=function(a){this.setProperty("shape",a,true);return this;};
D.prototype.setBackgroundColor=function(a){this.setProperty("backgroundColor",a,true);this._backgroundColor.setStyle(a);if(this._triangle){this._triangle.material.color.copy(this._backgroundColor);}return this;};
D.prototype.setBorderColor=function(a){this.setProperty("borderColor",a,true);if(this._border){this._border.material.map=null;}return this;};
D.prototype.setBorderWidth=function(a){this.setProperty("borderWidth",a,true);if(this._border){this._border.material.map=null;}return this;};
D.prototype.setOrigin=function(a){if(a instanceof THREE.Vector2){this.setProperty("origin",a,true);}return this;};
D.prototype.setSize=function(a){if(a instanceof THREE.Vector2){this.setProperty("size",a,true);}return this;};
D.prototype.setRenderOrder=function(a){this.setProperty("renderOrder",a,true);if(this._billboard){this._billboard.renderOrder=a;this._border.renderOrder=a+0.1;this._triangle.renderOrder=a-0.1;this._line.renderOrder=a-0.1;}return this;};
var e=-0.5,g=1.5,p=new THREE.Vector4(),j=new THREE.Vector3(),k=new THREE.Vector3(),P=new THREE.Vector3(),n=new THREE.Vector2(),s=new THREE.Vector2(),o=new THREE.Vector2(),r=new THREE.Matrix4();
function v(a,b){return Math.PI*(3*(a+b)-Math.sqrt((3*a+b)*(a+3*b)));}
function z(a,b,h,i,l,m){var u=a[b],w=a[b+1],x=a[l],y=a[l+1],H=a[m],I=a[m+1],J=i-w,K=u-h;var f=((x-u)*J+(y-w)*K)/((x-H)*J+(y-I)*K);a[l]=x+(H-x)*f;a[l+1]=y+(I-y)*f;}
function A(f,a,b,h){n.set(f[b+1]-f[a+1],f[a]-f[b]).normalize().multiplyScalar(h);f[a]+=n.x;f[a+1]+=n.y;f[b]+=n.x;f[b+1]+=n.y;}
function C(a,b){var f=a.length;for(var h=0;h<6;h+=3){var l=h===0?b*e:b*g;var m=a[h],u=a[h+1];for(var i=h;i<f-6;i+=6){var w=a[i],x=a[i+1];a[i]=m;a[i+1]=u;m=a[i+6];u=a[i+7];A(a,i,i+6,l);if(i>h){z(a,i-6,w,x,i,i+6);}}}}
D.prototype._createBoxViewport=function(a,b,f,h){var l=[-a,-b,0,a,-b,0,a,b,0,-a,b,0];var m=this._billboard.geometry;m.setIndex([0,1,2,0,2,3]);m.addAttribute("position",new THREE.Float32BufferAttribute(l,3));m.addAttribute("uv",new THREE.Float32BufferAttribute([0,0,1,0,1,1,0,1],2));if(this._border.visible){var u=[],i;for(i=0;i<l.length;i+=3){var x=l[i],y=l[i+1];u.push(x,y,0,x,y,0);}u.push(u[0],u[1],0,u[0],u[1],0);C(u,this._borderWidth);i=u.length-6;u[0]=u[i];u[i+1]=u[1];u[3]=u[i+3];u[i+4]=u[4];this._createBorderGeometry(this._border.geometry,u);}};
D.prototype._createCircleViewport=function(b,f,h,l){var m=[0,0,0],u=[0.5,0.5],w=[];var x=THREE.Math.clamp(Math.round(v(b,f)/24),32,256);var y=2*Math.PI/x;for(var i=0;i<x;i++){var a=i*y,H=Math.cos(a),I=Math.sin(a);m.push(H*b,I*f,0);u.push(H*0.5+0.5,I*0.5+0.5);w.push(0,i+1,i+1<x?i+2:1);}var J=this._billboard.geometry;J.setIndex(w);J.addAttribute("position",new THREE.Float32BufferAttribute(m,3));J.addAttribute("uv",new THREE.Float32BufferAttribute(u,2));var K=this._borderWidth*g;this._createCircleBorder(m,b,f,h&&n.set(h.x/(b+K),h.y/(f+K)).length()>1?h:null,l);};
D.prototype._createCircleBorder=function(b,f,h,m,u){var w=this._borderWidth,H=[],i,x,y;if(m&&(u!==sap.ui.vk.DetailViewShape.Circle&&u!==sap.ui.vk.DetailViewShape.CircleLine)){H.push(m.x,m.y,0,m.x,m.y,0);var I=Math.PI*0.05;var J=Math.atan2(m.y*f,m.x*h)+I;var K=(b.length/3)-3;I=2*(Math.PI-I)/K;for(i=0;i<=K;i++){var a=J+i*I;x=Math.cos(a)*f;y=Math.sin(a)*h;H.push(x,y,0,x,y,0);}var L=[m.x,m.y,0,H[6],H[7],0,H[H.length-3],H[H.length-2],0];H.push(m.x,m.y,0,m.x,m.y,0);C(H,w);i=H.length-6;var M=n.set(H[9],H[10]).sub(m).length();var N=n.set(H[9]-H[i-3],H[10]-H[i-2]).length()*0.5;var l=m.length();l=1-w*2*M/(N*l);H[i+0]=H[0]=m.x*l;H[i+1]=H[1]=m.y*l;H[i+3]=H[3]=m.x;H[i+4]=H[4]=m.y;var O=this._triangle.geometry;l=(1+l)*0.5;L[0]*=l;L[1]*=l;O.addAttribute("position",new THREE.Float32BufferAttribute(L,3));this._triangle.visible=true;this._triangle.material.color.set(u===sap.ui.vk.DetailViewShape.SolidPointer||u===sap.ui.vk.DetailViewShape.SolidArrow?this.getBorderColor():this._backgroundColor);}else{this._line.visible=this._line.visible&&m!==null;for(i=3;i<b.length;i+=3){x=b[i];y=b[i+1];H.push(x,y,0,x,y,0);}H.push(H[0],H[1],0,H[0],H[1],0);C(H,w);i=H.length-6;H[i]=H[0]=b[3]+w*e;H[i+3]=H[3]=b[3]+w*g;H[i+1]=H[1]=b[4];H[i+4]=H[4]=b[4];}this._createBorderGeometry(this._border.geometry,H);};
D.prototype._createBorderGeometry=function(a,b){var i,f=b.length/3;var h=[];for(i=2;i<f;i+=2){h.push(i-2,i,i-1,i-1,i,i+1);}var l=[];var u=this._borderU;for(i=0;i<f;i+=2){l.push(0,0.5,u,0.5);}a.setIndex(h);a.addAttribute("position",new THREE.Float32BufferAttribute(b,3));a.addAttribute("uv",new THREE.Float32BufferAttribute(l,2));};
D.prototype._createLine=function(a){var b=[0,0,0,0,0,0,a.x,a.y,0,a.x,a.y,0];A(b,0,6,-this._borderWidth);A(b,3,9,this._borderWidth);this._createBorderGeometry(this._line.geometry,b);};
D.prototype._updateGeometry=function(s,a,b){var f=this.getShape(),h=this.getAttachmentPoint(),i=this.getOrigin();this._border.visible=f!==sap.ui.vk.DetailViewShape.BoxNoOutline;this._line.visible=f===sap.ui.vk.DetailViewShape.BoxLine||f===sap.ui.vk.DetailViewShape.CircleLine;this._triangle.visible=false;if(h){p.copy(h).applyMatrix4(b.matrixWorldInverse).applyMatrix4(b.projectionMatrix);h=p.w>0?h:null;var l=(p.x/p.w)*a.width/a.height,m=p.y/p.w;P.set(l-i.x,m-i.y,0).multiplyScalar(a.height);}switch(f){default:case sap.ui.vk.DetailViewShape.Box:case sap.ui.vk.DetailViewShape.BoxLine:case sap.ui.vk.DetailViewShape.BoxNoOutline:this._createBoxViewport(s.x,s.y,h?P:null,f);break;case sap.ui.vk.DetailViewShape.Circle:case sap.ui.vk.DetailViewShape.CircleLine:case sap.ui.vk.DetailViewShape.CirclePointer:case sap.ui.vk.DetailViewShape.CircleArrow:case sap.ui.vk.DetailViewShape.CircleBubbles:case sap.ui.vk.DetailViewShape.SolidPointer:case sap.ui.vk.DetailViewShape.SolidArrow:this._createCircleViewport(s.x,s.y,h?P:null,f);break;}if(this._line.visible){this._createLine(P);}};
D.prototype._updateBorderTexture=function(a){var b=Math.round(this.getBorderWidth()*a);this._borderWidth=b+2;var f=1<<Math.ceil(Math.log2(this._borderWidth));this._borderU=this._borderWidth/f;this._borderWidth/=a;var h=new ArrayBuffer(f*4);var l=new Uint32Array(h);var m=new THREE.Color(this.getBorderColor());m=(m.r*255)|((m.g*255)<<8)|((m.b*255)<<16)|0xFF000000;l.fill(m&0xFFFFFF);for(var i=1;i<=b;i++){l[i]=m;}var u=new THREE.DataTexture(new Uint8Array(h),f,1,THREE.RGBAFormat,THREE.UnsignedByteType,THREE.UVMapping,THREE.ClampToEdgeWrapping,THREE.ClampToEdgeWrapping,THREE.LinearFilter,THREE.LinearFilter);u.needsUpdate=true;this._border.material.map=u;this._border.material.needsUpdate=true;this._line.material=this._border.material;};
function E(a){var m=a.elements;var i=m[15]===1;var b=2/m[0];var f=2/m[5];var h,l;if(i){h=-m[12]*b;l=-m[13]*f;}else{h=m[8]*b;l=m[9]*f;}var u=(b+h)*0.5;var w=h-u;var x=(f+l)*0.5;var y=l-x;return{left:w,top:x,right:u,bottom:y};}
function F(a,b){var m=a.elements;var i=m[15]===1;m[0]=2/(b.right-b.left);m[5]=2/(b.top-b.bottom);if(i){m[12]=-(b.right+b.left)/(b.right-b.left);m[13]=-(b.top+b.bottom)/(b.top-b.bottom);}else{m[8]=(b.right+b.left)/(b.right-b.left);m[9]=(b.top+b.bottom)/(b.top-b.bottom);}}
function G(a,b,s,f){var w=s.x/f.width;var h=s.y/f.height;p.copy(b).applyMatrix4(a.matrixWorldInverse).applyMatrix4(a.projectionMatrix);var x=((p.x/p.w)-w)*0.5+0.5;var y=((p.y/p.w)-h)*0.5+0.5;var i=E(a.projectionMatrix);var l={};l.left=THREE.Math.lerp(i.left,i.right,x);l.right=THREE.Math.lerp(i.left,i.right,x+w);l.top=THREE.Math.lerp(i.top,i.bottom,1-y-h);l.bottom=THREE.Math.lerp(i.top,i.bottom,1-y);F(a.projectionMatrix,l);}
D.prototype._update=function(a,b,f,h){var i=a.getSize(),l=a.getPixelRatio(),m=this.getOrigin(),u=this._node,w=u.position;if(!this._border.material.map){this._updateBorderTexture(l);}s.copy(this.getSize()).multiplyScalar(i.height*0.5);s.set(Math.round(s.x)<<1,Math.round(s.y)<<1);w.set(m.x*i.height/i.width,m.y,0).unproject(b);p.copy(w).applyMatrix4(b.matrixWorldInverse).applyMatrix4(b.projectionMatrix);var x=((p.x/p.w)*0.5+0.5)*i.width,y=((p.y/p.w)*0.5+0.5)*i.height;var H=p.w/(i.width*b.projectionMatrix.elements[0]);u.scale.setScalar(H);j.setFromMatrixColumn(b.matrixWorld,0).multiplyScalar(H*2*(Math.round(x)-x));k.setFromMatrixColumn(b.matrixWorld,1).multiplyScalar(H*2*(Math.round(y)-y));w.add(j).add(k);u.matrixWorld.compose(u.position,b.quaternion,u.scale);u.matrix.getInverse(u.parent.matrixWorld).multiply(u.matrixWorld);u.matrix.decompose(u.position,u.rotation,u.scale);this._updateGeometry(s,i,b);o.copy(s).multiplyScalar(l);if(!this._renderTarget||this._renderTarget.width!==o.x||this._renderTarget.height!==o.y){this._renderTarget=new THREE.WebGLRenderTarget(o.x,o.y,{minFilter:THREE.LinearFilter,magFilter:THREE.NearestFilter,format:THREE.RGBFormat});this._billboard.material.map=this._renderTarget.texture;this._billboard.material.needsUpdate=true;}if(this.getType()===sap.ui.vk.DetailViewType.Cutaway){r.copy(b.projectionMatrix);G(b,w,s,i);}else{b=this.getCamera();b.adjustClipPlanes(h);b.update(s.x,s.y);b=b.getCameraRef();}f.children.forEach(function(I){if(I.userData._vkCallouts){I.userData._vkCallouts.forEach(function(J){J._update(a,b);});}});a.setClearColor(this._backgroundColor,1);a.render(f,b,this._renderTarget,true);if(this.getType()===sap.ui.vk.DetailViewType.Cutaway){b.projectionMatrix.copy(r);}};
return D;});
sap.ui.predefine('sap/ui/vk/threejs/MataiLoader',["sap/base/Log"],function(L){"use strict";var S=function(b,e,r,i){this._id=S._nextId++;S.add(this);this._parentNode=b;this._contentResource=e;this._resolve=r;this._reject=i;this._nodes=new Map();this._meshes=new Map();this._callouts=new Map();this._cameras=new Map();this._detailViews=new Map();this._materials=new Map();this._images=new Map();};S._nextId=1;S._map=new Map();
S.add=function(s){this._map.set(s.getId(),s);return this;};
S.getById=function(i){return this._map.get(i);};
S.prototype.getId=function(){return this._id;};
S.prototype.setScene=function(i){if(i.result!==1){this._reject(i.result);}else{var b=this._cameras.get(i.cameraRef);this._resolve({node:this._parentNode,camera:b,contentResource:this._contentResource});}};
S.prototype.createNode=function(i){var b=this._nodes.get(i.parentRef)||null;var e=new THREE.Group();e.name=i.name;e.visible=i.visible;e.matrix.set(i.matrix[0],i.matrix[4],i.matrix[8],i.matrix[12],i.matrix[1],i.matrix[5],i.matrix[9],i.matrix[13],i.matrix[2],i.matrix[6],i.matrix[10],i.matrix[14],i.matrix[3],i.matrix[7],i.matrix[11],i.matrix[15]);e.matrix.decompose(e.position,e.quaternion,e.scale);e.userData.metadata=i.metadata;e.userData.veids=i.veids;(b||this._parentNode).add(e);this._nodes.set(i.nodeRef,e);};
var n=new Float32Array([0.0,0.0,1.0,0.0,0.0,1.0,0.0,0.0,1.0,0.0,0.0,1.0,0.0,0.0,-1.0,0.0,0.0,-1.0,0.0,0.0,-1.0,0.0,0.0,-1.0,0.0,1.0,0.0,0.0,1.0,0.0,0.0,1.0,0.0,0.0,1.0,0.0,0.0,-1.0,0.0,0.0,-1.0,0.0,0.0,-1.0,0.0,0.0,-1.0,0.0,1.0,0.0,0.0,1.0,0.0,0.0,1.0,0.0,0.0,1.0,0.0,0.0,-1.0,0.0,0.0,-1.0,0.0,0.0,-1.0,0.0,0.0,-1.0,0.0,0.0]);var a=new Uint16Array([0,1,2,2,1,3,4,6,5,5,6,7,8+0,8+1,8+2,8+2,8+1,8+3,8+4,8+6,8+5,8+5,8+6,8+7,16+0,16+1,16+2,16+2,16+1,16+3,16+4,16+6,16+5,16+5,16+6,16+7]);
S.prototype.createMesh=function(i){var b=i.boundingBox;var v=new Float32Array([b[0],b[1],b[5],b[3],b[1],b[5],b[0],b[4],b[5],b[3],b[4],b[5],b[0],b[1],b[2],b[3],b[1],b[2],b[0],b[4],b[2],b[3],b[4],b[2],b[0],b[4],b[5],b[3],b[4],b[5],b[0],b[4],b[2],b[3],b[4],b[2],b[0],b[1],b[5],b[3],b[1],b[5],b[0],b[1],b[2],b[3],b[1],b[2],b[3],b[1],b[5],b[3],b[1],b[2],b[3],b[4],b[5],b[3],b[4],b[2],b[0],b[1],b[5],b[0],b[1],b[2],b[0],b[4],b[5],b[0],b[4],b[2]]);var e=new THREE.BufferGeometry();e.setIndex(new THREE.BufferAttribute(a,1));e.addAttribute("position",new THREE.BufferAttribute(v,3));e.addAttribute("normal",new THREE.BufferAttribute(n,3));var r=new THREE.Mesh(e,this._materials.get(i.materialRef));this._meshes.set(i.meshRef,r);if(i.matrix){r.matrix.set(i.matrix[0],i.matrix[4],i.matrix[8],i.matrix[12],i.matrix[1],i.matrix[5],i.matrix[9],i.matrix[13],i.matrix[2],i.matrix[6],i.matrix[10],i.matrix[14],i.matrix[3],i.matrix[7],i.matrix[11],i.matrix[15]);r.matrix.decompose(r.position,r.quaternion,r.scale);}};
S.prototype.setMeshGeometry=function(i){var b=this._meshes.get(i.meshRef);var e=i.data;var r=new THREE.BufferGeometry();r.setIndex(new THREE.BufferAttribute(e.index,1));r.addAttribute("position",new THREE.BufferAttribute(e.position,3));if(e.normal){r.addAttribute("normal",new THREE.BufferAttribute(e.normal,3));}if(e.uv){r.addAttribute("uv",new THREE.BufferAttribute(e.uv,2));}b.geometry.copy(r);};
S.prototype.insertMesh=function(b,e){var i=this._nodes.get(b);var r=this._meshes.get(e);i.add(r.parent?r.clone():r);};
var c=[sap.ui.vk.BillboardTextEncoding.PlainText,sap.ui.vk.BillboardTextEncoding.HtmlText];var d=[sap.ui.vk.BillboardStyle.RectangularShape,sap.ui.vk.BillboardStyle.CircularShape,sap.ui.vk.BillboardStyle.None,sap.ui.vk.BillboardStyle.TextGlow];var f=[sap.ui.vk.BillboardBorderLineStyle.None,sap.ui.vk.BillboardBorderLineStyle.Solid,sap.ui.vk.BillboardBorderLineStyle.Dash,sap.ui.vk.BillboardBorderLineStyle.Dot,sap.ui.vk.BillboardBorderLineStyle.DashDot,sap.ui.vk.BillboardBorderLineStyle.DashDotDot];var g=[sap.ui.vk.BillboardHorizontalAlignment.Left,sap.ui.vk.BillboardHorizontalAlignment.Center,sap.ui.vk.BillboardHorizontalAlignment.Right];var l=[sap.ui.vk.LeaderLineMarkStyle.None,sap.ui.vk.LeaderLineMarkStyle.Point,sap.ui.vk.LeaderLineMarkStyle.Arrow];
function h(b){var e=b.toString(16);return"#"+"000000".substring(e.length)+e;}
S.prototype.createTextAnnotation=function(i){var b=new sap.ui.vk.threejs.Billboard({coordinateSpace:sap.ui.vk.BillboardCoordinateSpace.Screen,renderOrder:3,position:new THREE.Vector3().fromArray(i.position),encoding:c[i.encoding],text:i.text,font:i.font,fontSize:i.fontSize,fontWeight:Math.min(i.fontWeight,900),fontItalic:i.fontItalic,style:d[i.style],width:i.width,height:i.height,textColor:h(i.textColor),backgroundColor:h(i.backgroundColor),backgroundOpacity:i.backgroundOpacity,borderColor:h(i.borderColor),borderOpacity:i.borderOpacity,borderWidth:i.borderWidth,borderLineStyle:f[i.borderLineStyle],horizontalAlignment:g[i.horizontalAlignment],link:i.link});var e=this._nodes.get(i.nodeRef);(e||this._parentNode).add(b._node);if(!this._parentNode.userData._vkBillboards){this._parentNode.userData._vkBillboards=[];}this._parentNode.userData._vkBillboards.push(b);};
S.prototype.createImageNote=function(i){var b=this._materials.get(i.materialRef);var e=new sap.ui.vk.threejs.Billboard({coordinateSpace:sap.ui.vk.BillboardCoordinateSpace.Viewport,renderOrder:2,position:new THREE.Vector3().fromArray(i.position),width:i.width,height:i.height,texture:b?b.emissiveMap:null});var r=this._nodes.get(i.nodeRef);(r||this._parentNode).add(e._node);if(!this._parentNode.userData._vkBillboards){this._parentNode.userData._vkBillboards=[];}this._parentNode.userData._vkBillboards.push(e);};
S.prototype.createTextNote=function(i){var b=new sap.ui.vk.threejs.Callout({anchorNode:this._nodes.get(i.targetNodeRef)||this._parentNode,coordinateSpace:sap.ui.vk.BillboardCoordinateSpace.World,position:new THREE.Vector3().fromArray(i.position),renderOrder:i.alwaysOnTop?1:0,depthTest:!i.alwaysOnTop,encoding:c[i.encoding],text:i.text,font:i.font,fontSize:i.fontSize,fontWeight:Math.min(i.fontWeight,900),fontItalic:i.fontItalic,style:d[i.style],width:i.width,height:i.height,textColor:h(i.textColor),backgroundColor:h(i.backgroundColor),backgroundOpacity:i.backgroundOpacity,borderColor:h(i.borderColor),borderOpacity:i.borderOpacity,borderWidth:i.borderWidth,borderLineStyle:f[i.borderLineStyle],horizontalAlignment:g[i.horizontalAlignment],link:i.link});var e=this._nodes.get(i.nodeRef);this._callouts.set(e,b);(e||this._parentNode).add(b._node);if(!this._parentNode.userData._vkCallouts){this._parentNode.userData._vkCallouts=[];}this._parentNode.userData._vkCallouts.push(b);};
S.prototype.insertLeaderLine=function(b){var e=this._nodes.get(b.nodeRef);var t=this._nodes.get(b.targetNodeRef)||this._parentNode;var r=this._materials.get(b.materialRef);var s=this._callouts.get(e);if(s){var v=[];for(var i=0;i<b.points.length;i+=3){v.push(new THREE.Vector3().fromArray(b.points,i));}s.addLeaderLine(v,t,r,l[b.startPointStyle],l[b.endPointStyle]);}};
S.prototype.createCamera=function(i){var b=null;if(i.projection==="perspective"){b=new sap.ui.vk.threejs.PerspectiveCamera();b.setFov(i.fov);}else if(i.projection==="orthographic"){b=new sap.ui.vk.threejs.OrthographicCamera();b.setZoomFactor(i.orthoZoomFactor);}if(b){b.setNearClipPlane(i.nearClip);b.setFarClipPlane(i.farClip);b.setUsingDefaultClipPlanes(i.autoEvaluateClipPlanes);var e=new THREE.Vector3().fromArray(i.origin);var t=new THREE.Vector3().fromArray(i.target).sub(e);var u=new THREE.Vector3().fromArray(i.up).sub(e);b.setUpDirection(u.toArray());b.setPosition(e.toArray());b.setTargetDirection(t.toArray());}this._parentNode.userData.camera=b;this._cameras.set(i.cameraRef,b);};
S.prototype.insertCamera=function(b,e){var i=this._nodes.get(b);var r=this._cameras.get(e);r=r?r.getCameraRef():null;if(i&&r){(i||this._parentNode).add(r.parent?r.clone():r);}};
var j=[sap.ui.vk.DetailViewType.DetailView,sap.ui.vk.DetailViewType.Cutaway];var k=[sap.ui.vk.DetailViewShape.Box,sap.ui.vk.DetailViewShape.Circle,sap.ui.vk.DetailViewShape.CircleLine,sap.ui.vk.DetailViewShape.CirclePointer,sap.ui.vk.DetailViewShape.CircleArrow,sap.ui.vk.DetailViewShape.CircleBubbles,sap.ui.vk.DetailViewShape.BoxLine,sap.ui.vk.DetailViewShape.BoxNoOutline,sap.ui.vk.DetailViewShape.SolidPointer,sap.ui.vk.DetailViewShape.SolidArrow];
S.prototype.createDetailView=function(i){var b=new sap.ui.vk.threejs.DetailView({name:i.name,camera:this._cameras.get(i.cameraRef),type:j[i.type],shape:k[i.shape],borderWidth:i.borderWidth,backgroundColor:h(i.backgroundColor),borderColor:h(i.borderColor),renderOrder:i.renderOrder||0,origin:new THREE.Vector2().fromArray(i.origin),size:new THREE.Vector2().fromArray(i.size),attachmentPoint:new THREE.Vector3().fromArray(i.attachmentPoint),metadata:i.metadata,veId:i.veid});this._detailViews.set(i.detailViewRef,b);var e=this._nodes.get(i.nodeRef);(e||this._parentNode).add(b._node);if(!this._parentNode.userData._vkDetailViews){this._parentNode.userData._vkDetailViews=[];}this._parentNode.userData._vkDetailViews.push(b);};
S.prototype.createMaterial=function(i){var b;var e=i.linestyle;if(e.width>0){b=new THREE.LineBasicMaterial({color:new THREE.Color(e.color[0],e.color[1],e.color[2]),depthTest:false,linewidth:e.width});}else{if(i.textures){i.textures.forEach(function(t){var r=t.filterMode===1?THREE.NearestFilter:THREE.LinearFilter;var s=new THREE.Texture(this._images.get(t.imageRef),t.type==="reflection"?THREE.SphericalReflectionMapping:THREE.UVMapping,t.repeatX?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,t.repeatY?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,r,r);s.offset.set(t.offsetX,t.offsetX);s.repeat.set(t.scaleX,t.scaleY);i[t.type+"Texture"]=s;s.needsUpdate=true;s.influence=t.amount;},this);}b=new THREE.MeshPhongMaterial({opacity:i.opacity,color:new THREE.Color(i.diffuse[0],i.diffuse[1],i.diffuse[2]),shininess:i.glossiness*2+i.specularLevel*3,emissive:new THREE.Color(i.emissive[0]+i.ambient[0]*0.2,i.emissive[1]+i.ambient[1]*0.2,i.emissive[2]+i.ambient[2]*0.2),specular:new THREE.Color(i.specular[0],i.specular[1],i.specular[2]),map:i.diffuseTexture?i.diffuseTexture:null,specularMap:i.specularTexture?i.specularTexture:null,emissiveMap:i.emissiveTexture?i.emissiveTexture:null,envMap:i.reflectionTexture?i.reflectionTexture:null,alphaMap:i.opacityTexture?i.opacityTexture:null,bumpMap:i.bumpTexture?i.bumpTexture:null,transparent:i.opacity<1||!!i.opacityTexture});if(b.map){b.color.lerp(new THREE.Color(1,1,1),b.map.influence?b.map.influence:0);}if(b.bumpMap){b.bumpScale=b.bumpMap.influence?b.bumpMap.influence:0;}if(b.envMap){b.mapping=THREE.SphericalReflectionMapping;b.combine=THREE.AddOperation;b.reflectivity=b.envMap.influence?b.envMap.influence:0;}}this._materials.set(i.materialRef,b);};
S.prototype.createImage=function(i){var b=window.btoa(String.fromCharCode.apply(null,i.data));var e=new THREE.ImageLoader().load("data:image/"+i.format+";base64,"+b);this._images.set(i.imageRef,e);};
S.prototype.progress=function(b){L.log("reading progress:",b);};
var o=function(e){var b=e.data;if(b.ready){o.resolve();}else{var s=S.getById(b.sceneBuilderId);s[b.method].apply(s,b.args);}};var m=function(e){L.error("Error in WebWorker",e);};var p=(function(){var b;return function(){return b||(b=new Promise(function(r){var w=new Worker(sap.ui.require.toUrl("sap/ui/vk/threejs/MataiLoaderWorker.js"));o.resolve=r.bind(null,w);w.onmessage=o;w.onerror=m;}));};})();var q=function(b,u,e,i,r,s){p().then(function(w){var t=new S(e,i,r,s);w.postMessage({method:"loadSceneFromArrayBuffer",sceneBuilderId:t.getId(),buffer:b,fileName:u,sourceLocation:"remote"},[b]);});};return function(b,i){return new Promise(function(r,s){if(typeof i.getSource()==="string"){var u=i.getSource();fetch(u).then(function(e){if(e.ok){return e.arrayBuffer();}throw(new Error(e.statusText));}).then(function(e){q(e,u,b,i,r,s);}).catch(function(e){s(e);});}else if(i.getSource()instanceof File){var t=new FileReader();t.onload=function(e){q(e.target.result,i.getSource().name,b,i,r,s);};t.onerror=function(e){s(e);};t.readAsArrayBuffer(i.getSource());}});};});
sap.ui.predefine('sap/ui/vk/threejs/Material',["jquery.sap.global","../library","../Material","./thirdparty/three","./Texture"],function(q,l,M,t,T){"use strict";
var a=M.extend("sap.ui.vk.threejs.Material",{
metadata:{},
constructor:function(i){if(i){this._nativeMaterial=new THREE.LineBasicMaterial({color:0xaaaaaa});}else{this._nativeMaterial=new THREE.MeshPhongMaterial({color:0xaaaaaa});}}
});
var b=a.getMetadata().getParent().getClass().prototype;
a.prototype.init=function(){if(b.init){b.init.call(this);}};
a.prototype.getMaterialRef=function(){return this._nativeMaterial;};
a.prototype.setMaterialRef=function(m){this._nativeMaterial=m;return this;};
a.prototype.getId=function(){if(this._nativeMaterial.userData&&this._nativeMaterial.userData.materialId){return this._nativeMaterial.userData.materialId;}};
a.prototype.setId=function(v){this._nativeMaterial.userData.materialId=v;return this;};
a.prototype.getName=function(){if(this._nativeMaterial.userData&&this._nativeMaterial.userData.name){return this._nativeMaterial.userData.name;}};
a.prototype.setName=function(v){this._nativeMaterial.userData.name=v;return this;};
a.prototype.getAmbientColour=function(){};
a.prototype.setAmbientColour=function(v){return this;};
a.prototype.getDiffuseColour=function(){if(this._nativeMaterial.isMeshPhongMaterial&&this._nativeMaterial.color){var c={red:Math.round(this._nativeMaterial.color.r*255),green:Math.round(this._nativeMaterial.color.g*255),blue:Math.round(this._nativeMaterial.color.b*255),alpha:1.0};return sap.ui.vk.colorToCSSColor(c);}};
a.prototype.setDiffuseColour=function(v){if(this._nativeMaterial.isMeshPhongMaterial){var c=sap.ui.vk.cssColorToColor(v);this._nativeMaterial.color=new THREE.Color(c.red/255.0,c.green/255.0,c.blue/255.0);}return this;};
a.prototype.getEmissiveColour=function(){if(this._nativeMaterial.isMeshPhongMaterial&&this._nativeMaterial.emissive){var c={red:Math.round(this._nativeMaterial.emissive.r*255),green:Math.round(this._nativeMaterial.emissive.g*255),blue:Math.round(this._nativeMaterial.emissive.b*255),alpha:1.0};return sap.ui.vk.colorToCSSColor(c);}};
a.prototype.setEmissiveColour=function(v){if(this._nativeMaterial.isMeshPhongMaterial){var c=sap.ui.vk.cssColorToColor(v);this._nativeMaterial.emissive=new THREE.Color(c.red/255.0,c.green/255.0,c.blue/255.0);}return this;};
a.prototype.getSpecularColour=function(){if(this._nativeMaterial.isMeshPhongMaterial&&this._nativeMaterial.specular){var c={red:Math.round(this._nativeMaterial.specular.r*255),green:Math.round(this._nativeMaterial.specular.g*255),blue:Math.round(this._nativeMaterial.specular.b*255),alpha:1.0};return sap.ui.vk.colorToCSSColor(c);}};
a.prototype.setSpecularColour=function(v){if(this._nativeMaterial.isMeshPhongMaterial){var c=sap.ui.vk.cssColorToColor(v);this._nativeMaterial.specular=new THREE.Color(c.red/255.0,c.green/255.0,c.blue/255.0);}return this;};
a.prototype.getOpacity=function(){if(this._nativeMaterial.opacity){return this._nativeMaterial.opacity;}};
a.prototype.setOpacity=function(v){if(v>=0.0&&v<=1.0){this._nativeMaterial.opacity=v;this._nativeMaterial.transparent=this._nativeMaterial.opacity<1;}return this;};
a.prototype.getGlossness=function(){if(this._nativeMaterial.isMeshPhongMaterial&&this._nativeMaterial.shininess){return this._nativeMaterial.shininess/100.0;}};
a.prototype.setGlossness=function(v){if(this._nativeMaterial.isMeshPhongMaterial){this._nativeMaterial.shininess=v*100.0;}return this;};
a.prototype.getLineColour=function(){if(this._nativeMaterial.isLineBasicMaterial&&this._nativeMaterial.color){var c={red:Math.round(this._nativeMaterial.color.r*255),green:Math.round(this._nativeMaterial.color.g*255),blue:Math.round(this._nativeMaterial.color.b*255),alpha:1.0};return sap.ui.vk.colorToCSSColor(c);}};
a.prototype.setLineColour=function(v){if(this._nativeMaterial.isLineBasicMaterial){var c=sap.ui.vk.cssColorToColor(v);this._nativeMaterial.color=new THREE.Color(c.red/255.0,c.green/255.0,c.blue/255.0);}return this;};
a.prototype.getLineWidth=function(){if(this._nativeMaterial.isLineBasicMaterial&&this._nativeMaterial.linewidth!==undefined){return this._nativeMaterial.linewidth;}};
a.prototype.setLineWidth=function(v){if(this._nativeMaterial.isLineBasicMaterial){this._nativeMaterial.linewidth=v;}return this;};
a.prototype.getTextureDiffuse=function(){if(this._nativeMaterial.map){var c=new T();c.setTextureRef(this._nativeMaterial.map);return c;}};
a.prototype.setTextureDiffuse=function(v){if(this._nativeMaterial.isMeshPhongMaterial&&v){this._nativeMaterial.map=v.getTextureRef();}return this;};
a.prototype.getTextureBump=function(){if(this._nativeMaterial.bumpMap){var c=new T();c.setTextureRef(this._nativeMaterial.bumpMap);return c;}};
a.prototype.setTextureBump=function(v){if(this._nativeMaterial.isMeshPhongMaterial&&v){this._nativeMaterial.bumpMap=v.getTextureRef();}return this;};
a.prototype.getTextureOpacity=function(){if(this._nativeMaterial.alphaMap){var c=new T();c.setTextureRef(this._nativeMaterial.alphaMap);return c;}};
a.prototype.setTextureOpacity=function(v){if(this._nativeMaterial.isMeshPhongMaterial&&v){this._nativeMaterial.alphaMap=v.getTextureRef();}return this;};
a.prototype.getTextureReflection=function(){if(this._nativeMaterial.envMap){var c=new sap.ui.vk.threejs.Texture();c.setTextureRef(this._nativeMaterial.envMap);return c;}};
a.prototype.setTextureReflection=function(v){if(this._nativeMaterial.isMeshPhongMaterial&&v){this._nativeMaterial.envMap=v.getTextureRef();if(this._nativeMaterial.envMap){this._nativeMaterial.envMap.mapping=THREE.SphericalReflectionMapping;this._nativeMaterial.combine=THREE.AddOperation;}}return this;};
a.prototype.getTextureEmissive=function(){if(this._nativeMaterial.emissiveMap){var c=new T();c.setTextureRef(this._nativeMaterial.emissiveMap);return c;}};
a.prototype.setTextureEmissive=function(v){if(this._nativeMaterial.isMeshPhongMaterial&&v){this._nativeMaterial.emissiveMap=v.getTextureRef();}return this;};
a.prototype.getTextureAmbientOcclusion=function(){if(this._nativeMaterial.aoMap){var c=new T();c.setTextureRef(this._nativeMaterial.aoMap);return c;}};
a.prototype.setTextureAmbientOcclusion=function(v){if(this._nativeMaterial.isMeshPhongMaterial&&v){this._nativeMaterial.aoMap=v.getTextureRef();}return this;};
return a;});
sap.ui.predefine('sap/ui/vk/threejs/NodeHierarchy',["jquery.sap.global","../NodeHierarchy","sap/ui/base/ObjectPool","./BaseNodeProxy","./NodeProxy","../Messages"],function(q,N,O,B,a,M){"use strict";var s={equals:function(c,d){return c===d;},contains:function(c,d){return c.indexOf(d)!==-1;},startsWith:function(c,d){return c.indexOf(d)===0;}};
var b=N.extend("sap.ui.vk.threejs.NodeHierarchy",{
metadata:{},
_baseNodeProxyPool:new O(B),
constructor:function(c){N.call(this);this._scene=c;this._nodeProxies=[];}
});
b.prototype.destroy=function(){this._nodeProxies.slice().forEach(this.destroyNodeProxy,this);this._scene=null;N.prototype.destroy.call(this);};
b.prototype.getScene=function(){return this._scene;};
b.prototype.getSceneRef=function(){return this._scene.getSceneRef();};
b.prototype.enumerateChildren=function(n,c,d,p){if(typeof n==="function"){p=d;d=c;c=n;n=undefined;}var e=this.getChildren(n,d);if(p){e.forEach(c);}else{var f=this._baseNodeProxyPool.borrowObject();try{e.forEach(function(n){f.init(this,n);c(f);f.reset();}.bind(this));}finally{this._baseNodeProxyPool.returnObject(f);}}return this;};
b.prototype.enumerateAncestors=function(n,c,p){var d=this.getAncestors(n);if(p){d.forEach(c);}else{var e=this._baseNodeProxyPool.borrowObject();try{d.forEach(function(n){e.init(this,n);c(e);e.reset();}.bind(this));}finally{this._baseNodeProxyPool.returnObject(e);}}return this;};
b.prototype.createNodeProxy=function(n){var c=new a(this,n);this._nodeProxies.push(c);return c;};
b.prototype.destroyNodeProxy=function(n){var i=this._nodeProxies.indexOf(n);if(i>=0){this._nodeProxies.splice(i,1)[0].destroy();}return this;};
b.prototype.getChildren=function(n,c){if(typeof n==="boolean"){c=n;n=undefined;}if(!n){n=this._scene.getSceneRef();}var d=[];if(c||!n.userData.closed){n.children.forEach(function(e){if(!e.private&&(e.geometry===undefined||e.name||e.children.length>0)){d.push(e);}});}return d;};
b.prototype.getAncestors=function(n){var c=[];n.traverseAncestors(function(p){c.unshift(p);});if(c.length>0&&c[0]===this._scene.getSceneRef()){c.shift();}return c;};
b.prototype.findNodesByName=function(c){var r=[];if(c===undefined||c===null||q.isEmptyObject(c)){this._scene.getSceneRef().children.forEach(function(f){f.traverse(function(o){if(!o.private&&(o.geometry===undefined||o.name||o.children.length>0)){r.push(o);}});});}else{var d=s[c.predicate||"equals"];if(d===undefined){q.sap.log.error(sap.ui.vk.getResourceBundle().getText(M.VIT8.summary),M.VIT8.code,"sap.ui.vk.threejs.NodeHierarchy");}else if(!Array.isArray(c.value)&&typeof c.value!=="string"){q.sap.log.error(sap.ui.vk.getResourceBundle().getText(M.VIT6.summary),M.VIT6.code,"sap.ui.vk.threejs.NodeHierarchy");}else{var e=Array.isArray(c.value)?c.value:[c.value];if(!c.caseSensitive){for(var i in e){e[i]=e[i].toLowerCase();}}this._scene.getSceneRef().children.forEach(function(f){f.traverse(function(o){if(!o.private&&(o.geometry===undefined||o.name||o.children.length>0)){var n=o.name||"";if(!c.caseSensitive){n=n.toLowerCase();}for(var i in e){if(d(n,e[i])){r.push(o);break;}}}});});}}return r;};
b.prototype.createLayerProxy=function(l){return null;};
b.prototype.destroyLayerProxy=function(l){return this;};
b.prototype.getLayers=function(){return[];};
b.prototype.getHotspotNodeIds=function(){return null;};
b.prototype.attachChanged=function(d,f,l){return this.attachEvent("changed",d,f,l);};
b.prototype.detachChanged=function(d,f,l){return this.detachEvent("changed",d,f,l);};
b.prototype.fireChanged=function(p,c,e){return this.fireEvent("changed",p,c,e);};
b.prototype.attachNodeCreated=function(d,f,l){return this.attachEvent("nodeCreated",d,f,l);};
b.prototype.detachNodeCreated=function(d,f,l){return this.detachEvent("nodeCreated",d,f,l);};
b.prototype.fireNodeCreated=function(p,c,e){return this.fireEvent("nodeCreated",p,c,e);};
b.prototype.attachNodeRemoving=function(d,f,l){return this.attachEvent("nodeRemoving",d,f,l);};
b.prototype.detachNodeRemoving=function(d,f,l){return this.detachEvent("nodeRemoving",d,f,l);};
b.prototype.fireNodeRemoving=function(p,c,e){return this.fireEvent("nodeRemoving",p,c,e);};
b.prototype.attachNodeReplaced=function(d,f,l){return this.attachEvent("nodeReplaced",d,f,l);};
b.prototype.detachNodeReplaced=function(d,f,l){return this.detachEvent("nodeReplaced",d,f,l);};
b.prototype.fireNodeReplaced=function(p,c,e){return this.fireEvent("nodeReplaced",p,c,e);};
b.prototype.attachNodeUpdated=function(d,f,l){return this.attachEvent("nodeUpdated",d,f,l);};
b.prototype.detachNodeUpdated=function(d,f,l){return this.detachEvent("nodeUpdated",d,f,l);};
b.prototype.fireNodeUpdated=function(p,c,e){return this.fireEvent("nodeUpdated",p,c,e);};
b.prototype.createNode=function(p,n,i){if(!p){p=this._scene.getSceneRef();}var c=p.children.indexOf(i);var o=new THREE.Group();o.name=n;p.add(o);if(c>=0){p.children.splice(c,0,p.children.pop());}this.fireNodeCreated({nodeRef:o,nodeId:o});this.fireChanged();return o;};
b.prototype.createNodeCopy=function(n,p,c,i){if(!p){p=this._scene.getSceneRef();}var d=p.children.indexOf(i);var e=n.clone(true);e.name=c;p.add(e);if(d>=0){p.children.splice(d,0,p.children.pop());}this.fireNodeCreated({nodeRef:e,nodeId:e});this.fireChanged();return e;};
b.prototype.removeNode=function(n){var c=[].concat(n);c.forEach(function(n){if(n&&n.parent){this.fireNodeRemoving({nodeRef:n,nodeId:n});n.parent.remove(n);}}.bind(this));this.fireChanged();return this;};
return b;});
sap.ui.predefine('sap/ui/vk/threejs/NodeProxy',["../NodeProxy","./Material"],function(N,M){"use strict";
var a=N.extend("sap.ui.vk.threejs.NodeProxy",{
metadata:{},
constructor:function(n,o){N.call(this);this._object3D=o;this._nodeHierarchy=n;}
});
a.prototype.destroy=function(){this._object3D=null;N.prototype.destroy.call(this);};
a.prototype.getNodeHierarchy=function(){return this._nodeHierarchy;};
a.prototype.getNodeRef=function(){return this._object3D;};
a.prototype.getNodeId=function(){return this._object3D;};
a.prototype.getVeId=function(){if(this._object3D.userData.treeNode){return this._object3D.userData.treeNode.sid;}else{return null;}};
a.prototype.getMaterialId=function(){var r=this._object3D;if(this._object3D&&!this._object3D.geometry){if(this._object3D.children.length===1&&this._object3D.children[0].geometry&&(this._object3D.children[0].name===""||this._object3D.children[0].name===undefined)){r=this._object3D.children[0];}}if(r.material!==undefined&&r.material.userData!==undefined&&r.material.userData.materialId!==undefined){return r.material.userData.materialId;}else if(r.userData.originalMaterial!==undefined&&r.userData.originalMaterial.userData!==undefined&&r.userData.originalMaterial.userData.materialId!==undefined){return r.userData.originalMaterial.userData.materialId;}return undefined;};
a.prototype.getName=function(){return this._object3D.name||("<"+this._object3D.type+">");};
a.prototype._updateAncestorsBoundingBox=function(){var p=this._object3D.parent;while(p){if(p.userData.boundingBox!==undefined){p._vkCalculateObjectOrientedBoundingBox();}p=p.parent;}};
a.prototype.getLocalMatrix=function(){return sap.ui.vk.TransformationMatrix.convertTo4x3(this._object3D.matrix.elements);};
a.prototype.setLocalMatrix=function(v){if(v){var o=this._object3D;o.matrix.fromArray(sap.ui.vk.TransformationMatrix.convertTo4x4(v));o.matrix.decompose(o.position,o.quaternion,o.scale);o.updateMatrixWorld(true);this._updateAncestorsBoundingBox();}this.setProperty("localMatrix",v,true);return this;};
a.prototype.setLocalMatrixNotUpdatingBBox=function(v){if(v){var o=this._object3D;o.matrix.fromArray(sap.ui.vk.TransformationMatrix.convertTo4x4(v));o.matrix.decompose(o.position,o.quaternion,o.scale);o.updateMatrixWorld(true);}this.setProperty("localMatrix",v,true);return this;};
a.prototype.getWorldMatrix=function(){return sap.ui.vk.TransformationMatrix.convertTo4x3(this._object3D.matrixWorld.elements);};
a.prototype.setWorldMatrix=function(v){if(v){var o=this._object3D;o.matrixWorld.fromArray(sap.ui.vk.TransformationMatrix.convertTo4x4(v));if(o.parent){o.matrix.multiplyMatrices(new THREE.Matrix4().getInverse(o.parent.matrixWorld),o.matrixWorld);}else{o.matrix.copy(o.matrixWorld);}o.matrix.decompose(o.position,o.quaternion,o.scale);o.updateMatrixWorld(true);this._updateAncestorsBoundingBox();}this.setProperty("worldMatrix",v,true);return this;};
a.prototype.getOpacity=function(){return this._object3D.userData.opacity;};
a.prototype.setOpacity=function(v){var b=this._nodeHierarchy.getScene().getViewStateManager();if(b){b.setOpacity(this._object3D,v);}else{this._object3D._vkSetOpacity(v);}this.setProperty("opacity",v,true);return this;};
a.prototype.getTintColorABGR=function(){return this._object3D.userData.tintColor;};
a.prototype.setTintColorABGR=function(v){var b=this._nodeHierarchy.getScene().getViewStateManager();if(b){b.setTintColor(this._object3D,v);}else{this._object3D._vkSetTintColor(v);}this.setProperty("tintColorABGR",v,true);this.setProperty("tintColor",sap.ui.vk.colorToCSSColor(sap.ui.vk.abgrToColor(v)),true);return this;};
a.prototype.getTintColor=function(){return sap.ui.vk.colorToCSSColor(sap.ui.vk.abgrToColor(this._object3D.userData.tintColor));};
a.prototype.setTintColor=function(v){var b=sap.ui.vk.colorToABGR(sap.ui.vk.cssColorToColor(v));var c=this._nodeHierarchy.getScene().getViewStateManager();if(c){c.setOpacity(this._object3D,b);}else{this._object3D._vkSetTintColor(b);}this.setProperty("tintColorABGR",b,true);this.setProperty("tintColor",v,true);return this;};
a.prototype.getNodeMetadata=function(){return this._object3D.userData.metadata;};
a.prototype.getHasChildren=function(){return this._object3D.children.length>0;};
a.prototype.getClosed=function(){return!!this._object3D.userData.closed;};
a.prototype.assignMaterial=function(v){var s=function(m,n){var b;if(m.userData){b=m.userData.materialId;n.userData.materialId=b;}if(n.material!==undefined){if(n.userData.highlightColor!==undefined){n.userData.originalMaterial=m;m.userData.materialUsed++;n.material=m.clone();var c=sap.ui.vk.abgrToColor(n.userData.highlightColor);n.material.color.lerp(new THREE.Color(c.red/255.0,c.green/255.0,c.blue/255.0),c.alpha);if(m.userData.defaultHighlightingEmissive){n.material.emissive.copy(m.userData.defaultHighlightingEmissive);}if(m.userData.defaultHighlightingSpecular){n.material.specular.copy(m.userData.defaultHighlightingSpecular);}}else{n.material=m;m.userData.materialUsed++;delete n.userData.originalMaterial;}if(n.userData.opacity){if(!n.userData.originalMaterial){n.userData.originalMaterial=m;n.material=m.clone();}n.material.opacity*=n.userData.opacity;n.material.transparent=n.material.opacity<0.99;}}};s(v.getMaterialRef(),this._object3D);if(!this._object3D.children){return this;}this._object3D.children.forEach(function(c){if(!c){return;}s(v.getMaterialRef(),c);});return this;};
a.prototype.enumerateMaterials=function(r){var c=function(n,f,r){if(n){if(n.userData.originalMaterial){f.add(n.userData.originalMaterial);}else if(n.material){f.add(n.material);}if(n.children){n.children.forEach(function(g){if(g){if(r){c(g,f,r);}else if(g.userData.originalMaterial){f.add(g.userData.originalMaterial);}else if(g.material){f.add(g.material);}}});}}};var m=new Set();c(this._object3D,m,r);var b=[];m.forEach(function(v){b.push(v);});var d=[];for(var i=0;i<b.length;i++){var e=new M();e.setMaterialRef(b[i]);d.push(e);}return d;};
a.prototype.replaceMaterials=function(m,b){var c=m.getMaterialRef();var d=b.getMaterialRef();if(this._object3D.userData.originalMaterial&&this._object3D.userData.originalMaterial===c){this._object3D.userData.originalMaterial=d;}else if(this._object3D.material&&this._object3D.material===c){this._object3D.material=d;}if(!this._object3D.children){return this;}this._object3D.children.forEach(function(e){if(e&&e.userData.originalMaterial&&e.userData.originalMaterial===c){e.userData.originalMaterial=d;}else if(e&&e.material&&e.material===c){e.material=d;}});return this;};
return a;});
sap.ui.predefine('sap/ui/vk/threejs/NodesTransitionHelper',["jquery.sap.global","sap/ui/core/Element"],function(q,E){"use strict";
var N=E.extend("sap.ui.vk.threejs.NodesTransitionHelper",{metadata:{properties:{},publicMethods:["setViewport","setNodeForDisplay","setDisappearingNode","setAppearingNode","clear","startDisplay","displayNodesMoving"],events:{displaying:{},displayed:{}}}});
N.prototype.init=function(){this._viewport=null;this._nodeLocalmMatrixMap=new Map();this._nodeLocalMatrixMapForVisibility=new Map();this._timeIntervalForDisplay=500;this._startTimeForDisplay=0;};
N.prototype.destroy=function(){this._viewport=null;this._nodeLocalmMatrixMap=null;this._nodeLocalMatrixMapForVisibility=new Map();};
N.prototype.setViewport=function(v){this._viewport=v;};
N.prototype.setNodeForDisplay=function(n){this._nodeLocalmMatrixMap.set(n,{oldMatrix:n.getLocalMatrix(),newMatrix:null});};
N.prototype.setDisappearingNode=function(n,v){var o=n.getLocalMatrix();var a=[o[0]*0.0001,o[1],o[2],o[3],o[4]*0.0001,o[5],o[6],o[7],o[8]*0.0001,o[9],o[10],o[11]];this._nodeLocalMatrixMapForVisibility.set(n,{oldMatrix:o,newMatrix:a,visible:false});var b=n.getNodeRef();b.visible=true;};
N.prototype.setAppearingNode=function(n){var o=n.getLocalMatrix();var a=[o[0]*0.0001,o[1],o[2],o[3],o[4]*0.0001,o[5],o[6],o[7],o[8]*0.0001,o[9],o[10],o[11]];this._nodeLocalMatrixMapForVisibility.set(n,{oldMatrix:a,newMatrix:o,visible:true});};
N.prototype._interpolateNodePositionForVisibility=function(n,d,i){this._interpolateNodePosition(n,d.oldMatrix,d.newMatrix,i);if(i>=1){var a=n.getNodeRef();a.visible=d.visible;if(!a.visible){n.setLocalMatrixNotUpdatingBBox(d.oldMatrix);}}};
N.prototype._interpolateNodePosition=function(n,o,a,i){var b=new THREE.Matrix4().fromArray(sap.ui.vk.TransformationMatrix.convertTo4x4(o));var c=new THREE.Vector3();var d=new THREE.Quaternion();var e=new THREE.Vector3();b.decompose(c,d,e);var f=new THREE.Matrix4().fromArray(sap.ui.vk.TransformationMatrix.convertTo4x4(a));var g=new THREE.Vector3();var h=new THREE.Quaternion();var j=new THREE.Vector3();f.decompose(g,h,j);var p=new THREE.Vector3().lerpVectors(c,g,i);var k=new THREE.Quaternion().copy(d).slerp(h,i);var s=new THREE.Vector3().lerpVectors(e,j,i);var t=new THREE.Matrix4().compose(p,k,s);n.setLocalMatrixNotUpdatingBBox(sap.ui.vk.TransformationMatrix.convertTo4x3(t.elements));};
N.prototype.startDisplay=function(t){if(this._nodeLocalmMatrixMap.size===0){return;}this._timeIntervalForDisplay=t!==undefined?t:500;this._startTimeForDisplay=Date.now();this._nodeLocalmMatrixMap.forEach(function(m,n){m.newMatrix=n.getLocalMatrix();});this.fireDisplaying();};
N.prototype.displayNodesMoving=function(){if(this._startTimeForDisplay===0||this._nodeLocalmMatrixMap===null||this._nodeLocalmMatrixMap.size===0){return;}var i=Math.min((Date.now()-this._startTimeForDisplay)/this._timeIntervalForDisplay,1);i=1-Math.pow(1-i,3);this._nodeLocalmMatrixMap.forEach(function(m,n){if(n&&m.oldMatrix&&m.newMatrix){this._interpolateNodePosition(n,m.oldMatrix,m.newMatrix,i);}}.bind(this));this._nodeLocalMatrixMapForVisibility.forEach(function(d,n){if(n&&d){this._interpolateNodePositionForVisibility(n,d,i);}}.bind(this));if(i===1){this.clear();this.fireDisplayed();}this._viewport.setShouldRenderFrame();};
N.prototype.clear=function(){this._nodeLocalmMatrixMap.clear();this._nodeLocalMatrixMapForVisibility.clear();this._startTimeForDisplay=0;};
return N;});
sap.ui.predefine('sap/ui/vk/threejs/OrthographicCamera',["jquery.sap.global","../OrthographicCamera","./thirdparty/three"],function(q,O,t){"use strict";
var T=O.extend("sap.ui.vk.threejs.OrthographicCamera",{metadata:{}});
var b=O.getMetadata().getParent().getClass().prototype;
T.prototype.init=function(){if(b.init){b.init.call(this);}var n=1;var f=200000;this._nativeCamera=new THREE.OrthographicCamera(-1,1,1,-1,n,f);this._nativeCamera.position.set(0,0,10000);this._nativeCamera.zoom=0.02;this.setUsingDefaultClipPlanes(true);};
T.prototype.update=function(w,h){var f=1/Math.max(w,h);this.setLeft(w*-f);this.setRight(w*f);this.setTop(h*f);this.setBottom(h*-f);this._nativeCamera.updateProjectionMatrix();};
T.prototype.exit=function(){if(b.exit){b.exit.call(this);}this._nativeCamera=null;};
T.prototype.getLeft=function(){return this._nativeCamera.left;};
T.prototype.setLeft=function(v){this._nativeCamera.left=v;return this;};
T.prototype.getRight=function(){return this._nativeCamera.right;};
T.prototype.setRight=function(v){this._nativeCamera.right=v;return this;};
T.prototype.getTop=function(){return this._nativeCamera.top;};
T.prototype.setTop=function(v){this._nativeCamera.top=v;return this;};
T.prototype.getBottom=function(){return this._nativeCamera.bottom;};
T.prototype.setBottom=function(v){this._nativeCamera.bottom=v;return this;};
T.prototype.getZoomFactor=function(){return this._nativeCamera.zoom;};
T.prototype.setZoomFactor=function(v){this._nativeCamera.zoom=v;return this;};
T.prototype.getCameraRef=function(){return this._nativeCamera;};
T.prototype.setCameraRef=function(c){this._nativeCamera=c;return this;};
T.prototype.getNearClipPlane=function(){return this._nativeCamera.near;};
T.prototype.setNearClipPlane=function(v){this._nativeCamera.near=v;this.setUsingDefaultClipPlanes(false);return this;};
T.prototype.getFarClipPlane=function(){return this._nativeCamera.far;};
T.prototype.setFarClipPlane=function(v){this._nativeCamera.far=v;this.setUsingDefaultClipPlanes(false);return this;};
T.prototype.getPosition=function(){return this._nativeCamera.position.toArray();};
T.prototype.setPosition=function(v){this._nativeCamera.position.fromArray(v);return this;};
T.prototype.getUpDirection=function(){return this._nativeCamera.up.toArray();};
T.prototype.setUpDirection=function(v){this._nativeCamera.up.fromArray(v);return this;};
T.prototype.getTargetDirection=function(){return this._nativeCamera.getWorldDirection().toArray();};
T.prototype.setTargetDirection=function(v){var a=new THREE.Vector3().fromArray(v);a.add(this._nativeCamera.position);this._nativeCamera.lookAt(a);return this;};
T.prototype.setUsingDefaultClipPlanes=function(v){this._nativeCamera.userData.usingDefaultClipPlanes=v;return this;};
T.prototype.getUsingDefaultClipPlanes=function(){return this._nativeCamera.userData.usingDefaultClipPlanes;};
T.prototype.adjustClipPlanes=function(a){var c=this._nativeCamera;c.updateMatrixWorld();a=a.clone().applyMatrix4(c.matrixWorldInverse);c.near=-a.max.z;c.far=-a.min.z;var e=Math.max((c.far-c.near)*0.0025,0.001);c.near-=e;c.far+=e;var p=1.0/(c.far-c.near);var z=(c.far+c.near)*p;c.projectionMatrix.elements[10]=-2*p;c.projectionMatrix.elements[14]=-z;return this;};
T.prototype.getZoomNeedRecalculate=function(){if(this._nativeCamera.userData){return this._nativeCamera.userData.zoomNeedRecalculate;}};
T.prototype.setZoomNeedRecalculate=function(v){this._nativeCamera.userData.zoomNeedRecalculate=v;};
T.prototype.adjustZoom=function(a){var c=this._nativeCamera;c.updateMatrixWorld();a=a.clone().applyMatrix4(c.matrixWorldInverse);c.zoom=1/Math.max(a.min.x/c.left,a.max.y/c.top,a.max.x/c.right,a.min.y/c.bottom);c.updateProjectionMatrix();this.setZoomNeedRecalculate(false);return this;};
return T;});
sap.ui.predefine('sap/ui/vk/threejs/PerspectiveCamera',["jquery.sap.global","../PerspectiveCamera","./thirdparty/three"],function(q,P,t){"use strict";
var T=P.extend("sap.ui.vk.threejs.PerspectiveCamera",{metadata:{}});
var b=P.getMetadata().getParent().getClass().prototype;
T.prototype.init=function(){if(b.init){b.init.call(this);}var n=1;var f=10000;this._nativeCamera=new THREE.PerspectiveCamera(30,1,n,f);this._nativeCamera.position.set(0,0,100);this.setUsingDefaultClipPlanes(true);};
T.prototype.update=function(w,h){this._nativeCamera.aspect=w/h;this._nativeCamera.updateProjectionMatrix();};
T.prototype.exit=function(){if(b.exit){b.exit.call(this);}this._nativeCamera=null;};
T.prototype.getFov=function(){return this._nativeCamera.fov;};
T.prototype.setFov=function(v){this._nativeCamera.fov=v;return this;};
T.prototype.getCameraRef=function(){return this._nativeCamera;};
T.prototype.setCameraRef=function(c){this._nativeCamera=c;return this;};
T.prototype.getNearClipPlane=function(){return this._nativeCamera.near;};
T.prototype.setNearClipPlane=function(v){this._nativeCamera.near=v;this.setUsingDefaultClipPlanes(false);return this;};
T.prototype.getFarClipPlane=function(){return this._nativeCamera.far;};
T.prototype.setFarClipPlane=function(v){this._nativeCamera.far=v;this.setUsingDefaultClipPlanes(false);return this;};
T.prototype.getPosition=function(){return this._nativeCamera.position.toArray();};
T.prototype.setPosition=function(v){this._nativeCamera.position.fromArray(v);return this;};
T.prototype.getUpDirection=function(){return this._nativeCamera.up.toArray();};
T.prototype.setUpDirection=function(v){this._nativeCamera.up.fromArray(v);return this;};
T.prototype.getTargetDirection=function(){return this._nativeCamera.getWorldDirection().toArray();};
T.prototype.setTargetDirection=function(v){var a=new THREE.Vector3().fromArray(v);a.add(this._nativeCamera.position);this._nativeCamera.lookAt(a);return this;};
T.prototype.setUsingDefaultClipPlanes=function(v){this._nativeCamera.userData.usingDefaultClipPlanes=v;return this;};
T.prototype.getUsingDefaultClipPlanes=function(){return this._nativeCamera.userData.usingDefaultClipPlanes;};
T.prototype.adjustClipPlanes=function(a){var e=this._nativeCamera;e.updateMatrixWorld();a=a.clone().applyMatrix4(e.matrixWorldInverse);e.near=-a.max.z;e.far=-a.min.z;var f=Math.max((e.far-e.near)*0.0025,0.001);e.far=Math.max(e.far,0.1);f=Math.max(f,e.far*0.0025);e.near-=f;e.far+=f;e.near=Math.max(e.near,e.far*0.0025);var c=-(e.far+e.near)/(e.far-e.near);var d=-2*e.far*e.near/(e.far-e.near);e.projectionMatrix.elements[10]=c;e.projectionMatrix.elements[14]=d;return this;};
return T;});
sap.ui.predefine('sap/ui/vk/threejs/Scene',["jquery.sap.global","../Scene","./NodeHierarchy"],function(q,S,N){"use strict";
var a=S.extend("sap.ui.vk.threejs.Scene",{
metadata:{},
constructor:function(s){S.call(this);this._id=q.sap.uid();this._scene=s;this._state=null;this._defaultNodeHierarchy=null;this._currentViewStateManager=null;}
});
a.prototype.destroy=function(){if(this._defaultNodeHierarchy){this._defaultNodeHierarchy.destroy();this._defaultNodeHierarchy=null;}this._state=null;this._scene=null;S.prototype.destroy.call(this);};
a.prototype.setDoubleSided=function(v){this.setProperty("doubleSided",v,true);this._scene.traverse(function(n){if(n.material!==undefined){var u=n.userData;var o=THREE.FrontSide;var m;if(u.originalMaterial){if(u.originalMaterial.userData===undefined){u.originalMaterial.userData={};}m=u.originalMaterial.userData;if(m.originalMaterialSide===undefined){m.originalMaterialSide=u.originalMaterial.side;}o=m.originalMaterialSide;}else{if(n.material.userData===undefined){n.material.userData={};}m=n.material.userData;if(m.originalMaterialSide===undefined){m.originalMaterialSide=n.material.side;}o=m.originalMaterialSide;}n.material.side=v?THREE.DoubleSide:o;}});return this;};
a.prototype.setViewStateManager=function(v){this._currentViewStateManager=v;return this;};
a.prototype.getViewStateManager=function(){return this._currentViewStateManager;};
a.prototype.getId=function(){return this._id;};
a.prototype.getDefaultNodeHierarchy=function(){if(!this._defaultNodeHierarchy){this._defaultNodeHierarchy=new N(this);}return this._defaultNodeHierarchy;};
function b(c,d){var e=c.min,f=c.max,m=d.elements,g=(e.x+f.x)*0.5,h=(e.y+f.y)*0.5,i=(e.z+f.z)*0.5,j=f.x-g,k=f.y-h,l=f.z-i;var t=m[0]*g+m[4]*h+m[8]*i+m[12];var n=m[1]*g+m[5]*h+m[9]*i+m[13];var o=m[2]*g+m[6]*h+m[10]*i+m[14];var p=Math.abs(m[0]*j)+Math.abs(m[4]*k)+Math.abs(m[8]*l);var r=Math.abs(m[1]*j)+Math.abs(m[5]*k)+Math.abs(m[9]*l);var s=Math.abs(m[2]*j)+Math.abs(m[6]*k)+Math.abs(m[10]*l);e.set(t-p,n-r,o-s);f.set(t+p,n+r,o+s);}
THREE.Object3D.prototype._expandBoundingBox=function(c,v){var n=new THREE.Box3();function e(d){var g=d.geometry;if(g!==undefined){if(!g.boundingBox){g.computeBoundingBox();}if(!g.boundingBox.isEmpty()){n.copy(g.boundingBox);b(n,d.matrixWorld);c.min.min(n.min);c.max.max(n.max);}}var s=d.userData.boundingBox;if(s!==undefined&&!s.isEmpty()&&!v){n.copy(s);b(n,d.matrixWorld);c.min.min(n.min);c.max.max(n.max);}}this.updateMatrixWorld();if(v){this.traverseVisible(e);}else{this.traverse(e);}return c;};
a.prototype._computeBoundingBox=function(v){var c=new THREE.Box3();if(this._scene){this._scene._expandBoundingBox(c,v);}return c;};
a.prototype.getSceneRef=function(){return this._scene;};
a.prototype._setState=function(s){this._state=s;};
a.prototype.nodeRefToPersistentId=function(n){var s=this._state;if(Array.isArray(n)){if(!s){return[];}var i=[];n.forEach(function(c){i.push(s.object3DToSid(c));});return i;}else{if(!s){return null;}return s.object3DToSid(n);}};
a.prototype.persistentIdToNodeRef=function(p){var s=this._state;if(Array.isArray(p)){if(!s){return[];}var n=[];p.forEach(function(c){n.push(s.sidToObject3D(c));});return n;}else{if(!s){return null;}return s.sidToObject3D(p);}};
a.prototype.enumerateMaterials=function(){if(!this._defaultNodeHierarchy){return[];}var t=this._defaultNodeHierarchy.createNodeProxy(this._scene);if(t){return t.enumerateMaterials(true);}else{return[];}};
return a;});
sap.ui.predefine('sap/ui/vk/threejs/SceneBuilder',["sap/base/Log","./thirdparty/three","./BBoxSubdivider","./UsageCounter"],function(L,t,B,U){"use strict";var S=function(r){this._id=S._nextId++;S._add(this);this._submeshes=new Map();this._callouts=new Map();this._cameras=new Map();this._materials=new Map();this._images=new Map();this._geometries=new Map();if(r){this._rootNode=r;this._nodes=new Map();this._NodeMeshIdSubmeshIdsMap=new Map();}else{this._rootNode=null;this._nodes=null;this._NodeMeshIdSubmeshIdsMap=null;}this._currentSceneId=null;this._sceneIdTreeNodesMap=new Map();this._sceneIdRootNodeMap=new Map();this._sceneIdNodMeshIdMap=new Map();};S._nextId=1;S._map=new Map();
S.prototype.getId=function(){return this._id;};
S._add=function(s){S._map.set(s.getId(),s);return this;};
S.prototype.setRootNode=function(r,n,s){this._rootNode=r;this._nodes=new Map();this._nodes.set(n,r);this._NodeMeshIdSubmeshIdsMap=new Map();if(!this._rootNode.userData){this._rootNode.userData={};}if(s){this._sceneIdTreeNodesMap.set(s,this._nodes);this._sceneIdRootNodeMap.set(s,r);this._sceneIdNodMeshIdMap.set(s,this._NodeMeshIdSubmeshIdsMap);this._currentSceneId=s;}return this;};
S.prototype._resetCurrentScene=function(s){if(s!==this._currentSceneId){var n=this._sceneIdTreeNodesMap.get(s);if(n){this._nodes=n;}var e=this._sceneIdRootNodeMap.get(s);if(e){this._rootNode=e;}var m=this._sceneIdNodMeshIdMap.get(s);if(m){this._NodeMeshIdSubmeshIdsMap=m;}this._currentSceneId=s;}};
S.prototype.getNode=function(n,s){this._resetCurrentScene(s);if(!this._nodes){return null;}return this._nodes.get(n);};
S.prototype.getObjectId=function(o){do{if(o.userData&&o.userData.treeNode&&o.userData.treeNode.sid){return o.userData.treeNode.sid;}o=o.parent;}while(o);return null;};
var a=function(e){var m=new THREE.Matrix4();if(e.length===3){m.setPosition(new THREE.Vector3().fromArray(e));}else if(e.length===12){m.set(e[0],e[3],e[6],e[9],e[1],e[4],e[7],e[10],e[2],e[5],e[8],e[11],0.0,0.0,0.0,1.0);}else if(e.length===16){m.set(e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15]);}else{throw"Invalid matrix format";}return m;};var D={r:0.0235,g:0.0235,b:0.0235};var b={r:0.0602,g:0.0602,b:0.0602};
S.prototype._createTemporaryMaterial=function(m){var e=new THREE.MeshPhongMaterial({color:0xaaaaaa});if(!e.userData){e.userData={};}e.userData.defaultHighlightingEmissive=D;e.userData.defaultHighlightingSpecular=b;e.userData.materialUsed=0;e.userData.materialId=m;e.userData.toBeUpdated=true;this._materials.set(m,e);return e;};
S.prototype.createNode=function(n,p,s){var r={needUpdateMaterial:false,needSetSubmesh:false,idOfGeometriesToUpdate:null,materialIds:[]};this._resetCurrentScene(s);var e=this._nodes.get(p)||null;var i=new THREE.Group();i.userData.treeNode=n;if(n.renderOrder){i.renderOrder=n.renderOrder;}i.visible=n.visible!==undefined?n.visible:true;if(n.name){i.name=n.name;}i.userData.opacity=n.opacity;if(n.transform){i.applyMatrix(a(n.transform));}(e||this._rootNode).add(i);this._nodes.set(n.sid,i);var j=this.attachSubMeshesToNode(n.sid,s);var m=this.applyNodeMaterialToSubmeshes(n.sid,s);var o=this.applyNodeOpacityToSubmeshes(n.sid,s);r.needUpdateMaterial=m.needUpdateMaterial;r.needSetSubmesh=j.needSetSubmesh;r.idOfGeometriesToUpdate=j.idOfGeometriesToUpdate;r.materialIds=o.materialIds;return r;};
S.prototype.applyNodeMaterialToSubmeshes=function(n,s){var r={needUpdateMaterial:false};this._resetCurrentScene(s);var e=this._nodes.get(n);if(!e){return r;}var j=e.userData.treeNode;e.userData.materialId=j.materialId;if(!j.meshId||!e.userData.materialId){return r;}var k=this._materials.get(e.userData.materialId);if(!k){k=this._createTemporaryMaterial(e.userData.materialId);r.needUpdateMaterial=true;}if(e&&e.children){for(var i=0;i<e.children.length;i++){var l=e.children[i];l.material=k;l.userData.materialId=e.userData.materialId;U.increaseMaterialUsed(k);if(j.renderOrder){l.material.depthTest=false;}}}return r;};
S.prototype.applyNodeOpacityToSubmeshes=function(n,s,m){var r={materialIds:[]};this._resetCurrentScene(s);var e=this._nodes.get(n);if(!e){return r;}var j=e.userData.treeNode;if(!j.meshId||!j.opacity){return r;}if(e&&e.children){var k=new Set();for(var i=0;i<e.children.length;i++){var l=e.children[i];if(l.material&&(!m||m===l.material.userData.materialId)){if(!l.material.userData.toBeUpdated){l.userData.opacity=j.opacity;l.userData.originalMaterial=l.material;l.material=l.material.clone();l.material.opacity*=l.userData.opacity;l.material.transparent=l.material.opacity<0.99;}else{k.add(l.material.userData.materialId);}}}k.forEach(function(v){r.materialIds.push(v);});}return r;};
S.prototype.attachSubMeshesToNode=function(n,s){var r={needSetSubmesh:false,idOfGeometriesToUpdate:new Set()};this._resetCurrentScene(s);var e=this._nodes.get(n);var j=e.userData.treeNode;if(!j.meshId){return r;}var k=this._NodeMeshIdSubmeshIdsMap.get(j.meshId);if(!k){r.needSetSubmesh=true;return r;}var l=[];k.forEach(function(v){l.push(v);});var i;var m;for(i=0;i<l.length;i++){m=l[i];this._insertSubmesh(j.sid,m,s);}for(i=0;i<l.length;i++){m=l[i];var o=this._submeshes.get(m);if(o&&o.userData&&o.userData.isBoundingBox&&o.userData.geometryId){r.idOfGeometriesToUpdate.add(o.userData.geometryId);}}return r;};
S.prototype.updateMaterialInNode=function(n,s){this._resetCurrentScene(s);var r={needUpdateMaterial:false,nodeUpdated:false};var e=this._nodes.get(n.sid);var o=e.userData.materialId;var j=e.userData.opacity;e.userData.treeNode=n;e.userData.materialId=n.materialId;e.userData.opacity=n.opacity;var k=false;if(o===undefined){if(e.userData.materialId!==undefined){k=true;}}else if(o!==e.userData.materialId){k=true;}var l=false;if(j===undefined){if(e.userData.opacity!==undefined){l=true;}}else if(j!==e.userData.opacity){l=true;}if(!k&&!l){return r;}r.nodeUpdated=true;var m=null;if(e.userData.materialId){m=this._materials.get(e.userData.materialId);if(m===undefined){m=this._createTemporaryMaterial(e.userData.materialId);r.needUpdateMaterial=true;}if(n.renderOrder){m.depthTest=false;}}if(e&&e.children){for(var i=0;i<e.children.length;i++){var p=e.children[i];if(m){p.material=m;p.userData.materialId=n.materialId;U.increaseMaterialUsed(m);}else{var q=this._materials.get(p.userData.initialMaterialId);p.material=q;p.userData.materialId=p.userData.initialMaterialId;U.increaseMaterialUsed(q);}delete p.userData.originalMaterial;if(e.userData.opacity!==undefined&&(p.material.userData&&!p.material.userData.toBeUpdated)){p.userData.opacity=e.userData.opacity;p.userData.originalMaterial=p.material;p.material=p.material.clone();p.material.opacity*=p.userData.opacity;p.material.transparent=p.material.opacity<0.99;}else{p.userData.opacity=undefined;}}}return r;};
S.prototype.updateGeometryInNode=function(n,e,s){this._resetCurrentScene(s);var j=this._nodes.get(n);if(j&&j.children){for(var i=0;i<j.children.length;i++){var k=j.children[i];if(!k.isMesh){continue;}if(k.userData.geometryId===e){var l=this._geometries.get(e);if(l){if(l.isPolyline&&!k.isLineSegment){var p=k.parent;var m=k.material;p.remove(k);var o=new THREE.LineBasicMaterial({color:0xff0000,linewidth:1,depthTest:false});o.color.copy(m.color);var q=new THREE.LineSegments(l,o);p.add(q);q.userData.meshId=k.userData.meshId;if(l.isPositionQuantized){q.position.copy(k.position);q.scale.copy(k.scale);}q.userData.initialMaterialId=k.userData.initialMaterialId;q.userData.isBoundingBox=false;q.userData.geometryId=k.userData.geometryId;q.userData.meshId=k.userData.meshId;q.userData.materialId=k.userData.materialId;q.userData.submeshInfo=k.userData.submeshInfo;q.userData.submeshId=k.userData.submeshId;var r=this._submeshes.get(q.userData.submeshId);if(r&&r.renderOrder){q.renderOrder=r.renderOrder;}this._submeshes.set(q.userData.submeshId,q);}else{k.geometry=l;k.userData.isBoundingBox=false;if(!l.isPositionQuantized){k.position.set(0,0,0);k.scale.set(1,1,1);}}U.increaseGeometryUsed(l);}}}}return this;};
S.prototype.getChildNodeIds=function(n,s,e){this._resetCurrentScene(s);var j=this._nodes.get(n);var k=[];if(!j){return k;}if(j&&j.children){for(var i=0;i<j.children.length;i++){var l=j.children[i];if(l.userData&&l.userData.treeNode&&l.userData.treeNode.sid){k.push(l.userData.treeNode.sid);}else if(e&&l.userData&&l.userData.submeshInfo&&l.userData.submeshInfo.id){k.push(l.userData.submeshInfo.id);}}}return k;};
function c(e){var j=atob(e);var l=j.length;var k=new Uint8Array(l);for(var i=0;i<l;i++){k[i]=j.charCodeAt(i);}return k;}
function f(l){if(l){for(var i=0;i<l.length;i++){if(l[i].type==="box"&&l[i].data){return l[i];}}}return null;}
function d(v){if(v===0){return Number.EPSILON;}return v;}
function u(m,p){m.position.set((p[3]+p[0])/2,(p[4]+p[1])/2,(p[5]+p[2])/2);m.scale.set(d(p[3]-p[0]),d(p[4]-p[1]),d(p[5]-p[2]));}
S.prototype.setSubmesh=function(m,s){var r={needUpdataMaterial:false,geometryIdToRequest:null,geometryPriority:0};var j=this._NodeMeshIdSubmeshIdsMap.get(m);if(!j){j=new Set();this._NodeMeshIdSubmeshIdsMap.set(m,j);}j.add(s.id);if(!s.lods){return false;}var l=null;for(var i=0;i<s.lods.length;i++){if(s.lods[i].type===undefined||s.lods[i].type==="mesh"||s.lods[i].type==="line"){l=s.lods[i];}}if(!l){return false;}var k=null;if(s.materialId){k=this._materials.get(s.materialId);if(!k){k=this._createTemporaryMaterial(s.materialId);r.needUpdataMaterial=true;}}var n=null;var o=this._geometries.get(l.id);if(o){if(k){n=new THREE.Mesh(o,k);}else{n=new THREE.Mesh(o);}n.userData.initialMaterialId=s.materialId;n.userData.isBoundingBox=false;n.userData.geometryId=l.id;n.userData.meshId=m;n.userData.submeshId=s.id;n.userData.materialId=s.materialId;if(o.isPositionQuantized){u(n,l.boundingBox);}U.increaseGeometryUsed(o);}else{r.geometryIdToRequest=l.id;var p;try{var q=f(s.lods);if(q&&q.data){var v=c(q.data);var w=B.unpackSubDividedBoundingBox(v);p=B.makeSubDividedBoundingBoxGeometry(w);}}catch(e){}var x=new THREE.BoxBufferGeometry(1,1,1);n=new THREE.Mesh(p?p:x,k);var y=l.boundingBox;if(Array.isArray(y)&&y.length===6){r.geometryPriority=new THREE.Vector3(y[3]-y[0],y[4]-y[1],y[5]-y[2]).length();}else{y=[0,0,0,1,1,1];}u(n,y);n.userData.initialMaterialId=s.materialId;n.userData.isBoundingBox=true;n.userData.geometryId=l.id;n.userData.meshId=m;n.userData.materialId=s.materialId;n.userData.submeshId=s.id;}n.userData.submeshInfo=s;this._submeshes.set(s.id,n);return r;};
S.prototype.getSubmesh=function(s){return this._submeshes.get(s);};
S.prototype.setGeometry=function(e){var i=new THREE.BufferGeometry();var j=new THREE.BufferAttribute(new Uint16Array(e.data.indices),1);var p=new THREE.BufferAttribute(new Float32Array(e.data.points),3);i.setIndex(j);i.addAttribute("position",p);if(!e.isPolyline){if(e.data.normals.length===e.data.points.length){var n=new THREE.BufferAttribute(new Float32Array(e.data.normals),3);i.addAttribute("normal",n);}if(e.data.uvs&&e.data.uvs.length*3===e.data.points.length*2){i.addAttribute("uv",new THREE.BufferAttribute(new Float32Array(e.data.uvs),2));}}else{i.isPolyline=true;}i.computeBoundingSphere();i.isPositionQuantized=e.isPositionQuantized;if(!i.userData){i.userData={};}i.userData.geometryId=e.id;i.userData.geometryUsed=0;this._geometries.set(e.id,i);return this;};
S.prototype.getGeometry=function(e){return this._geometries.get(e);};
S.prototype._insertSubmesh=function(n,s,e){this._resetCurrentScene(e);var i=this._nodes.get(n);var j=this._submeshes.get(s);if(!i||!j){return false;}if(j.parent){j=j.clone();if(j.userData){if(j.userData.submeshInfo&&j.userData.initialMaterialId){var m=this._materials.get(j.userData.initialMaterialId);if(m){j.material=m;U.increaseMaterialUsed(m);}}if(j.userData&&j.userData.opacity){delete j.userData.opacity;}}}i.add(j);if(i.renderOrder){j.renderOrder=i.renderOrder;var M=this._materials.get(j.userData.initialMaterialId);if(M){M.depthTest=false;}}return true;};
S.prototype._decrementResourceCounters=function(e){e.traverse(function(i){if(i.isMesh){U.decreaseMaterialUsed(i.material);U.decreaseGeometryUsed(i.geometry);}});};
S.prototype.decrementResourceCountersForDeletedTreeNode=function(n,s){this._resetCurrentScene(s);var e=this;n=[].concat(n);n.forEach(function(i){var j=e._nodes.get(i);if(j){e._decrementResourceCounters(j);e._nodes.delete(i);}});return this;};
S.prototype.remove=function(n,s){this._resetCurrentScene(s);var e=this;n=[].concat(n);n.forEach(function(i){var j=e._nodes.get(i);if(j){e._decrementResourceCounters(j);if(j.parent){j.parent.remove(j);}e._nodes.delete(i);}});return this;};
S.prototype.resourcesCleanUp=function(){var e=this._geometries;e.forEach(function(i){var j=i.userData.geometryUsed;if(j<=0){i.dispose();}});var m=this._materials;if(m){m.forEach(function(i){var j=i.userData.materialUsed;if(j<=0){i.dispose();}});}return this;};
S.prototype.createCamera=function(e,s){this._resetCurrentScene(s);var i=null;var j=e.id;i=this._cameras.get(j);if(!i||(!i.isOrthographicCamera&&e.ortho)){if(e.ortho){i=new THREE.OrthographicCamera(-1,1,1,-1,e.near,e.far);}else{i=new THREE.PerspectiveCamera(e.fov*180/Math.PI,1,e.near,e.far);}}i.cameraInfo=e;if(e.origin){var o=new THREE.Vector3().fromArray(e.origin);i.position.copy(o);}if(e.up){var k=new THREE.Vector3().fromArray(e.up).normalize();i.up.copy(k);}if(e.target){i.lookAt((new THREE.Vector3().fromArray(e.target)).add(i.position));}if(e.ortho){i.zoom=e.zoom||0.02;}this._rootNode.userData.camera=i;if(j){this._cameras.set(j,i);}return i;};
S.prototype.insertCamera=function(n,e,s){this._resetCurrentScene(s);var i=this._nodes.get(n);var j=this._cameras.get(e);if(i&&j){i.add(j.parent?j.clone():j);}return this;};
S.prototype.getCamera=function(e){return this._cameras.get(e);};
S.prototype.updateMaterialForGeometryWithoutNormal=function(m){var e=this._materials.get(m);if(e){e.emissive.copy(e.color);e.side=THREE.DoubleSide;}return this;};
S.prototype.createMaterial=function(m){var r=[];var e=this._materials.get(m.id);if(m.lineWidth>0){if(!e||!e.isLineBasicMaterial){e=new THREE.LineBasicMaterial();this._materials.set(m.id,e);}e.color=new THREE.Color(m.lineColor[0],m.lineColor[1],m.lineColor[2]);e.depthTest=false;e.linewidth=m.lineWidth;e.userData.mateialInfo=m;e.userData.materialId=m.id;return r;}if(!e){e=this._createTemporaryMaterial(m.id);}if(e.userData&&e.userData.toBeUpdated){delete e.userData.toBeUpdated;}e.userData.materialInfo=m;if(m.diffuseColour){e.color.fromArray(m.diffuseColour);}if(m.specularColour){e.specular.fromArray(m.specularColour);}var i=true;if(m.emissiveColour){e.emissive.fromArray(m.emissiveColour);if(e.emissive.r!==0||e.emissive.g!==0||e.emissive.b!==0){i=false;}}if(i&&m.ambientColour){e.emissive.fromArray(m.ambientColour);e.emissive.multiplyScalar(0.2);}if(e.opacity!==undefined){e.opacity=m.opacity;e.transparent=m.opacity<1;if(e.transparent){e.side=THREE.DoubleSide;}}var j=e.glossiness?e.glossiness:0;var s=e.specularLevel?e.specularLevel:0;e.shininess=j*2+s*3;e.userData.defaultHighlightingEmissive=D;e.userData.defaultHighlightingSpecular=b;r=this.updateTextureMaps(m.id);return r;};
S.prototype.getMaterial=function(m){return this._materials.get(m);};
var g=function(i){var j="";try{var C=0x8000;var k=0;var l=i.length;var s;while(k<l){s=i.slice(k,Math.min(k+C,l));j+=String.fromCharCode.apply(null,s);k+=C;}}catch(e){j="";}return j;};
S.prototype.createImage=function(i){var e=new DataView(i.binaryData.buffer);var j=true;if(e.getUint8(0,true)===parseInt("0xFF",16)&&e.getUint8(1,true)===parseInt("0xD8",16)){j=false;}var k=g(i.binaryData);var l="data:image/"+(j?"png":"jpeg")+";base64,"+btoa(k);this._images.set(i.id,l);return this;};
var h=new THREE.TextureLoader();S.TextureType={Diffuse:0,Bump:1,Opacity:2,Reflection:3,Refraction:4,Specular:5,Ambient:6,Emissive:7,SpecularLevel:8,Glosiness:9,AmbientOcclusion:10,Decal:11};
S.prototype.updateTextureMaps=function(m){var r=[];var e=this._materials.get(m);if(!e){return r;}var i=e.userData.materialInfo;if(!i){return r;}if(i.textureDiffuse){var j=this.updateTextureMap(i.id,S.TextureType.Diffuse);if(j.imageId){r.push(j);}}if(i.textureBump){var k=this.updateTextureMap(i.id,S.TextureType.Bump);if(k.imageId){r.push(k);}}if(i.textureOpacity){var o=this.updateTextureMap(i.id,S.TextureType.Opacity);if(o.imageId){r.push(o);}}if(i.textureEmissive){var l=this.updateTextureMap(i.id,S.TextureType.Emissive);if(l.imageId){r.push(l);}}if(i.textureAmbientOcclusion){var n=this.updateTextureMap(i.id,S.TextureType.AmbientOcclusion);if(n.imageId){r.push(n);}}if(i.textureReflection){var p=this.updateTextureMap(i.id,S.TextureType.Reflection);if(p.imageId){r.push(p);}}return r;};
S.prototype.updateTextureMap=function(m,e){var r={textureType:e,imageId:null};var i=this._materials.get(m);if(!i){return r;}var j=i.userData.materialInfo;if(!j){return r;}var k=null;switch(e){case S.TextureType.Diffuse:k=j.textureDiffuse;break;case S.TextureType.Bump:k=j.textureBump;break;case S.TextureType.Opacity:k=j.textureOpacity;break;case S.TextureType.Reflection:k=j.textureReflection;break;case S.TextureType.Emissive:k=j.textureEmissive;break;case S.TextureType.AmbientOcclusion:k=j.textureAmbientOcclusion;break;default:break;}if(!k){return r;}var l=k[0];var n=this._images.get(l.imageId);if(!n){r.imageId=l.imageId;return r;}var o=h.load(n);o.wrapS=l.uvHorizontalTilingEnabled?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping;o.wrapT=l.uvVerticalTilingEnabled?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping;o.magFilter=l.filterMode===1?THREE.NearestFilter:THREE.LinearFilter;o.minFilter=l.filterMode===1?THREE.NearestFilter:THREE.LinearFilter;var p=l.influence!==undefined?l.influence:0;var q=l.uvHorizontalScale!==undefined?l.uvHorizontalScale:1;var s=l.uvVerticalScale!==undefined?l.uvVerticalScale:1;var v=l.uvHorizontalOffset!==undefined?l.uvHorizontalOffset:0;var w=l.uvVerticalOffset!==undefined?l.uvVerticalOffset:0;o.repeat.set(q,s);o.center.set(-v,-w);o.offset.set(v,w);o.rotation=-l.uvRotationAngle;switch(e){case S.TextureType.Diffuse:i.color.lerp(new THREE.Color(1,1,1),p);i.map=o;i.transparent|=n.startsWith("data:image/png");break;case S.TextureType.Bump:i.bumpMap=o;i.bumpScale=p;break;case S.TextureType.Opacity:i.alphaMap=o;break;case S.TextureType.Reflection:o.mapping=THREE.SphericalReflectionMapping;i.envMap=o;i.combine=THREE.AddOperation;i.reflectivity=p;break;case S.TextureType.Emissive:i.emissiveMap=o;break;case S.TextureType.AmbientOcclusion:i.aoMap=o;break;default:}i.userData.textureAdded=true;return r;};
S.prototype.cleanup=function(){this._rootNode=null;if(this._nodes){this._nodes.clear();}if(this._NodeMeshIdSubmeshIdsMap){this._NodeMeshIdSubmeshIdsMap.clear();}this._submeshes.clear();this._callouts.clear();this._cameras.clear();this._materials.clear();this._images.clear();this._geometries.clear();this._currentSceneId=null;this._sceneIdTreeNodesMap.clear();this._sceneIdRootNodeMap.clear();this._sceneIdNodMeshIdMap.clear();S._map.delete(this._id);};
return S;});
sap.ui.predefine('sap/ui/vk/threejs/Texture',["jquery.sap.global","../Texture","./thirdparty/three"],function(q,T,t){"use strict";
var a=T.extend("sap.ui.vk.threejs.Texture",{
metadata:{},
constructor:function(i){if(i){var c=new THREE.TextureLoader();this._nativeTexture=c.load(i);if(!this._nativeTexture.userData){this._nativeTexture.userData={};}}}
});
var b=a.getMetadata().getParent().getClass().prototype;
a.prototype.init=function(){if(b.init){b.init.call(this);}};
a.prototype.load=function(i){var c=new THREE.TextureLoader();this._nativeTexture=c.load(i);if(!this._nativeTexture.userData){this._nativeTexture.userData={};}return this;};
a.prototype.getTextureRef=function(){return this._nativeTexture;};
a.prototype.setTextureRef=function(c){this._nativeTexture=c;if(!this._nativeTexture.userData){this._nativeTexture.userData={};}return this;};
a.prototype.getId=function(){if(this._nativeTexture&&this._nativeTexture.userData&&this._nativeTexture.userData.id){return this._nativeTexture.userData.id;}};
a.prototype.setId=function(v){if(this._nativeTexture){if(!this._nativeTexture.userData){this._nativeTexture.userData={};}this._nativeTexture.userData.id=v;}return this;};
a.prototype.getFilterMode=function(){if(this._nativeTexture){return this._nativeTexture.magFilter===THREE.NearestFilter?1:0;}};
a.prototype.setFilterMode=function(v){if(this._nativeTexture){this._nativeTexture.magFilter=v===1?THREE.NearestFilter:THREE.LinearFilter;}};
a.prototype.getUvRotationAngle=function(){if(this._nativeTexture){return this._nativeTexture.rotation;}};
a.prototype.setUvRotationAngle=function(v){if(this._nativeTexture){this._nativeTexture.rotation=v;}};
a.prototype.getUvHorizontalOffset=function(){if(this._nativeTexture){return this._nativeTexture.offset.x;}};
a.prototype.setUvHorizontalOffset=function(v){if(this._nativeTexture){this._nativeTexture.offset.x=v;}};
a.prototype.getUvVerticalOffset=function(){if(this._nativeTexture){return this._nativeTexture.offset.y;}};
a.prototype.setUvVerticalOffset=function(v){if(this._nativeTexture){this._nativeTexture.offset.y=v;}};
a.prototype.getUvHorizontalScale=function(){if(this._nativeTexture){return this._nativeTexture.repeat.x;}};
a.prototype.setUvHorizontalScale=function(v){if(this._nativeTexture){this._nativeTexture.repeat.x=v;}};
a.prototype.getUvVerticalScale=function(){if(this._nativeTexture){return this._nativeTexture.repeat.y;}};
a.prototype.setUvVerticalScale=function(v){if(this._nativeTexture){this._nativeTexture.repeat.y=v;}};
a.prototype.getUvHorizontalTilingEnabled=function(){if(this._nativeTexture){return this._nativeTexture.wrapS===THREE.RepeatWrapping;}};
a.prototype.setUvHorizontalTilingEnabled=function(v){if(this._nativeTexture){this._nativeTexture.wrapS=v?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping;}};
a.prototype.getUvVerticalTilingEnabled=function(){if(this._nativeTexture){return this._nativeTexture.wrapT===THREE.RepeatWrapping;}};
a.prototype.setUvVerticalTilingEnabled=function(v){if(this._nativeTexture){this._nativeTexture.wrapT=v?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping;}};
return a;});
sap.ui.predefine('sap/ui/vk/threejs/ViewStateManager',["jquery.sap.global","sap/ui/core/Element","../ContentConnector","../ViewStateManagerBase","./thirdparty/three"],function(q,E,C,V,t){"use strict";var a;
var b=V.extend("sap.ui.vk.threejs.ViewStateManager",{metadata:{}});
var d=b.getMetadata().getParent().getClass().prototype;
b.prototype.init=function(){if(d.init){d.init.call(this);}this._nodeHierarchy=null;this._nodeStates=new Map();this._selectedNodes=new Set();this._visibilityTracker=new a();this._showSelectionBoundingBox=true;this._boundingBoxesScene=new THREE.Scene();this.setHighlightColor("rgba(255, 0, 0, 1.0)");};
b.prototype._setContent=function(c){var s=null;if(c&&c instanceof sap.ui.vk.threejs.Scene){s=c;}this._setScene(s);};
b.prototype._onAfterUpdateContentConnector=function(){this._setContent(this._contentConnector.getContent());};
b.prototype._onBeforeClearContentConnector=function(){this._setScene(null);};
b.prototype._handleContentReplaced=function(e){var c=e.getParameter("newContent");this._setContent(c);};
b.prototype._setScene=function(s){this._boundingBoxesScene=new THREE.Scene();this._setNodeHierarchy(s?s.getDefaultNodeHierarchy():null);if(s){s.setViewStateManager(this);}return this;};
b.prototype._setNodeHierarchy=function(n){var o=this._nodeHierarchy;if(this._nodeHierarchy){this._nodeHierarchy=null;this._nodeStates.clear();this._selectedNodes.clear();this._visibilityTracker.clear();}if(n){this._nodeHierarchy=n;this._nodeHierarchy.attachNodeReplaced(this._handleNodeReplaced,this);this._nodeHierarchy.attachNodeUpdated(this._handleNodeUpdated,this);var v=[],h=[];var c=n.findNodesByName();c.forEach(function(e){(e.visible?v:h).push(e);});this.fireVisibilityChanged({visible:v,hidden:h});}if(n!==o){this.fireNodeHierarchyReplaced({oldNodeHierarchy:o,newNodeHierarchy:n});}return this;};
b.prototype._handleNodeReplaced=function(e){var r=e.getParameter("ReplacedNodeRef");var c=e.getParameter("ReplacementNodeRef");if(this.getSelectionState(r)){this.setSelectionState(c,true);this.setSelectionState(r,false);}};
b.prototype._handleNodeUpdated=function(e){var n=e.getParameter("nodeRef");if(this.getSelectionState(n)){this.setSelectionState(n,false);this.setSelectionState(n,true);}};
b.prototype.getNodeHierarchy=function(){return this._nodeHierarchy;};
b.prototype.getVisibilityChanges=function(){return this.getShouldTrackVisibilityChanges()?this._visibilityTracker.getInfo(this.getNodeHierarchy()):null;};
b.prototype.getVisibilityComplete=function(){var n=this.getNodeHierarchy(),c=n.findNodesByName(),v=[],h=[];c.forEach(function(e){var f=n.createNodeProxy(e);var g=f.getVeId();n.destroyNodeProxy(f);if(g){if(this.getVisibilityState(e)){v.push(g);}else{h.push(g);}}},this);return{visible:v,hidden:h};};
b.prototype.getVisibilityState=function(n){return Array.isArray(n)?n.map(function(c){return c.visible;}):n.visible;};
b.prototype.setVisibilityState=function(n,v,r){if(!Array.isArray(n)){n=[n];}n=(r?this._collectNodesRecursively(n):n).filter(function(e,i,s){return s.indexOf(e)===i;});var c=n.filter(function(e){return e.visible!=v;},this);if(c.length>0){c.forEach(function(e){e.visible=v;},this);if(this.getShouldTrackVisibilityChanges()){c.forEach(this._visibilityTracker.trackNodeRef,this._visibilityTracker);}this.fireVisibilityChanged({visible:v?c:[],hidden:v?[]:c});}return this;};
b.prototype.enumerateSelection=function(c){this._selectedNodes.forEach(c);return this;};
b.prototype.getSelectionState=function(n){var s=this._selectedNodes;function i(c){return s.has(c);}return Array.isArray(n)?n.map(i):i(n);};
b.prototype._isAChild=function(c,n){var e=c.parent;while(e){if(n.has(e)){return true;}e=e.parent;}return false;};
THREE.Object3D.prototype._vkCalculateObjectOrientedBoundingBox=function(){var p=this.parent,m=this.matrix.clone(),c=this.matrixAutoUpdate;this.parent=null;this.matrix.identity();this.matrixAutoUpdate=false;this.userData.boundingBox.setFromObject(this);this.matrixAutoUpdate=c;this.matrix.copy(m);this.parent=p;this.updateMatrixWorld(true);};
b.prototype._AddBoundingBox=function(n){if(n.userData.boundingBox===undefined){n.userData.boundingBox=new THREE.Box3();n._vkCalculateObjectOrientedBoundingBox();}if(this._boundingBoxesScene&&n.userData.boxHelper===undefined){var c=new THREE.Box3Helper(n.userData.boundingBox,0xffff00);this._boundingBoxesScene.add(c);c.parent=n;n.userData.boxHelper=c;}};
b.prototype._RemoveBoundingBox=function(n){if(n.userData.boundingBox!==undefined){delete n.userData.boundingBox;}if(n.userData.boxHelper!==undefined){this._boundingBoxesScene.remove(n.userData.boxHelper);delete n.userData.boxHelper;}};
b.prototype._updateBoundingBoxesIfNeeded=function(){var u=new Set();this._selectedNodes.forEach(function(n){var p=n.parent;while(p){if(this._selectedNodes.has(p)){u.add(p);}p=p.parent;}}.bind(this));u.forEach(function(n){n._vkCalculateObjectOrientedBoundingBox();});};
b.prototype.setShowSelectionBoundingBox=function(v){this._showSelectionBoundingBox=v;if(this._showSelectionBoundingBox){this._selectedNodes.forEach(function(n){this._AddBoundingBox(n);}.bind(this));}else{this._selectedNodes.forEach(function(n){this._RemoveBoundingBox(n);}.bind(this));}this.fireSelectionChanged({selected:this._selectedNodes,unselected:[]});};
b.prototype.getShowSelectionBoundingBox=function(){return this._showSelectionBoundingBox;};
THREE.Object3D.prototype.defaultEmissive={r:0.0235,g:0.0235,b:0.0235};THREE.Object3D.prototype.defaultSpecular={r:0.0602,g:0.0602,b:0.0602};
THREE.Object3D.prototype._vkTraverseNodeGeometry=function(c){c(this);for(var i=0,l=this.children.length;i<l;i++){var e=this.children[i];if(e.geometry!==undefined&&!e.name&&e.children.length===0){c(e);}}};
THREE.Object3D.prototype._vkSetTintColor=function(c){this._vkTraverseNodeGeometry(function(n){n.userData.tintColor=c;n._vkUpdateMaterialColor();});};
THREE.Object3D.prototype._vkSetOpacity=function(o){this._vkTraverseNodeGeometry(function(n){n.userData.opacity=o;n._vkUpdateMaterialOpacity();});};
THREE.Object3D.prototype._vkUpdateMaterialColor=function(){if(!this.material||!this.material.color){return;}var u=this.userData;if(u.originalMaterial){if(u.originalMaterial.color.r===undefined){u.originalMaterial=null;}else if(u.originalMaterial.userData&&u.originalMaterial.userData.textureAdded){this.material=u.originalMaterial.clone();delete u.originalMaterial.userData.textureAdded;}else{this.material.color.copy(u.originalMaterial.color);if(this.material.emissive!==undefined){this.material.emissive.copy(u.originalMaterial.emissive);}if(this.material.specular!==undefined){this.material.specular.copy(u.originalMaterial.specular);}}}if(u.highlightColor!==undefined||u.tintColor!==undefined){if(!u.originalMaterial){u.originalMaterial=this.material;this.material=this.material.clone();}var c;if(u.tintColor!==undefined){c=sap.ui.vk.abgrToColor(u.tintColor);this.material.color.lerp(new THREE.Color(c.red/255.0,c.green/255.0,c.blue/255.0),c.alpha);if(this.material.emissive!==undefined){if(this.material.userData.defaultHighlightingEmissive){this.material.emissive.copy(this.material.userData.defaultHighlightingEmissive);}else{this.material.emissive.copy(THREE.Object3D.prototype.defaultEmissive);}}if(this.material.specular!==undefined){if(this.material.userData.defaultHighlightingSpecular){this.material.specular.copy(this.material.userData.defaultHighlightingSpecular);}else{this.material.specular.copy(THREE.Object3D.prototype.defaultSpecular);}}}if(u.highlightColor!==undefined){c=sap.ui.vk.abgrToColor(u.highlightColor);this.material.color.lerp(new THREE.Color(c.red/255.0,c.green/255.0,c.blue/255.0),c.alpha);if(this.material.emissive!==undefined){if(this.material.userData.defaultHighlightingEmissive){this.material.emissive.copy(this.material.userData.defaultHighlightingEmissive);}else{this.material.emissive.copy(THREE.Object3D.prototype.defaultEmissive);}}if(this.material.specular!==undefined){if(this.material.userData.defaultHighlightingSpecular){this.material.specular.copy(this.material.userData.defaultHighlightingSpecular);}else{this.material.specular.copy(THREE.Object3D.prototype.defaultSpecular);}}}}};
THREE.Object3D.prototype._vkUpdateMaterialOpacity=function(){if(!this.material){return;}var u=this.userData;if(u.originalMaterial){this.material.opacity=u.originalMaterial.opacity;this.material.transparent=u.originalMaterial.transparent;}if(u.opacity!==undefined){if(!u.originalMaterial){u.originalMaterial=this.material;this.material=this.material.clone();}if(this.material.opacity){this.material.opacity*=u.opacity;this.material.transparent=this.material.transparent||this.material.opacity<0.99;}}};
b.prototype._isAncestorSelected=function(n){n=n.parent;while(n){if(this._selectedNodes.has(n)){return true;}n=n.parent;}return false;};
b.prototype._updateHighlightColor=function(n,p){var s=p||this._selectedNodes.has(n);n.userData.highlightColor=s?this._highlightColorABGR:undefined;n._vkUpdateMaterialColor();var c=n.children;for(var i=0,l=c.length;i<l;i++){this._updateHighlightColor(c[i],s);}};
b.prototype.setSelectionState=function(n,s,r){if(!Array.isArray(n)){n=[n];}n=(r||this.getRecursiveSelection()?this._collectNodesRecursively(n):n).filter(function(v,i,e){return e.indexOf(v)===i;});if(this.getRecursiveSelection()&&!s){n=this._nodeHierarchy._appendAncestors(n);}var c=n.filter(function(e){return this._selectedNodes.has(e)!==s;},this);if(c.length>0){c.forEach(function(e){this._selectedNodes[s?"add":"delete"](e);if(this._showSelectionBoundingBox){this[s?"_AddBoundingBox":"_RemoveBoundingBox"](e);}},this);c.forEach(function(e){this._updateHighlightColor(e,s||this._isAncestorSelected(e));},this);this.fireSelectionChanged({selected:s?c:[],unselected:s?[]:c});}return this;};
b.prototype.setSelectionStates=function(s,u,r){if(!Array.isArray(s)){s=[s];}if(!Array.isArray(u)){u=[u];}s=(r||this.getRecursiveSelection()?this._collectNodesRecursively(s):s);u=(r||this.getRecursiveSelection()?this._collectNodesRecursively(u):u);if(this.getRecursiveSelection()){u=this._nodeHierarchy._appendAncestors(u,s);}var c=s.filter(function(n){return this._selectedNodes.has(n)===false;},this);var e=u.filter(function(n){return this._selectedNodes.has(n)===true;},this);if(c.length>0||e.length>0){c.forEach(function(n){this._selectedNodes.add(n);this._updateHighlightColor(n,true);if(this._showSelectionBoundingBox){this._AddBoundingBox(n);}},this);e.forEach(function(n){this._selectedNodes.delete(n);if(this._showSelectionBoundingBox){this._RemoveBoundingBox(n);}},this);e.forEach(function(n){this._updateHighlightColor(n,this._isAncestorSelected(n));},this);this.fireSelectionChanged({selected:c,unselected:e});}return this;};
b.prototype._collectNodesRecursively=function(n){var r=[],c=this;n.forEach(function collectChildNodes(e){r.push(e);c._nodeHierarchy.enumerateChildren(e,collectChildNodes,false,true);});return r;};
b.prototype._getOpacity=function(n){return n.userData.opacity!==undefined?n.userData.opacity:null;};
b.prototype.getOpacity=function(n){if(Array.isArray(n)){return n.map(this._getOpacity,this);}else{return this._getOpacity(n);}};
b.prototype.setOpacity=function(n,o,r){if(!Array.isArray(n)){n=[n];}n=(r?this._collectNodesRecursively(n):n).filter(function(v,i,s){return s.indexOf(v)===i;});if(o===null){o=undefined;}var c=n.filter(function(e){return e.userData.opacity!==o;},this);if(c.length>0){c.forEach(function(e){e._vkSetOpacity(o);},this);this.fireOpacityChanged({changed:c,opacity:o});}return this;};
b.prototype._getTintColorABGR=function(n){return n.userData.tintColor!==undefined?n.userData.tintColor:null;};
b.prototype._getTintColor=function(n){return n.userData.tintColor!==undefined?sap.ui.vk.colorToCSSColor(sap.ui.vk.abgrToColor(n.userData.tintColor)):null;};
b.prototype.getTintColor=function(n,i){var g=i?"_getTintColorABGR":"_getTintColor";if(Array.isArray(n)){return n.map(this[g],this);}else{return this[g](n);}};
b.prototype.setTintColor=function(n,c,r){if(!Array.isArray(n)){n=[n];}var e=null;switch(typeof c){case"number":e=c;break;case"string":if(sap.ui.core.CSSColor.isValid(c)){e=sap.ui.vk.colorToABGR(sap.ui.vk.cssColorToColor(c));}break;default:c=null;break;}n=(r?this._collectNodesRecursively(n):n).filter(function(v,i,s){return s.indexOf(v)===i;});var f=n.filter(function(g){return g.userData.tintColor!==e;},this);if(f.length>0){f.forEach(function(g){g._vkSetTintColor(e);},this);this.fireTintColorChanged({changed:f,tintColor:c,tintColorABGR:e});}return this;};
b.prototype.setHighlightColor=function(c){switch(typeof c){case"number":this._highlightColorABGR=c;break;case"string":if(sap.ui.core.CSSColor.isValid(c)){this._highlightColorABGR=sap.ui.vk.colorToABGR(sap.ui.vk.cssColorToColor(c));}break;default:return this;}if(this._selectedNodes.size>0){this._selectedNodes.forEach(function(n){this._updateHighlightColor(n,true);},this);}this.fireHighlightColorChanged({highlightColor:sap.ui.vk.colorToCSSColor(sap.ui.vk.abgrToColor(this._highlightColorABGR)),highlightColorABGR:this._highlightColorABGR});return this;};
b.prototype.getHighlightColor=function(i){return i?this._highlightColorABGR:sap.ui.vk.colorToCSSColor(sap.ui.vk.abgrToColor(this._highlightColorABGR));};
a=function(){this._visibilityChanges=new Set();};
a.prototype.getInfo=function(n){var c=[];this._visibilityChanges.forEach(function(e){var f=n.createNodeProxy(e);var v=f.getVeId();n.destroyNodeProxy(f);if(v){c.push(v);}else{c.push(n.getScene().nodeRefToPersistentId(e));}});return c;};
a.prototype.clear=function(){this._visibilityChanges.clear();};
a.prototype.trackNodeRef=function(n){if(this._visibilityChanges.has(n)){this._visibilityChanges.delete(n);}else{this._visibilityChanges.add(n);}};
C.injectMethodsIntoClass(b);return b;});
sap.ui.predefine('sap/ui/vk/threejs/Viewport',["jquery.sap.global","../library","../ViewportBase","sap/ui/core/ResizeHandler","../Loco","./thirdparty/three","../ContentConnector","../ViewStateManager","./ViewportGestureHandler","./OrthographicCamera","./PerspectiveCamera","./NodesTransitionHelper","../Messages","sap/ui/base/ManagedObjectObserver","./ViewportRenderer"],function(q,l,V,R,L,a,C,b,c,O,P,N,M,d,e){"use strict";
var f=V.extend("sap.ui.vk.threejs.Viewport",{metadata:{library:"sap.ui.vk",properties:{renderMode:{type:"sap.ui.vk.RenderMode",defaultValue:sap.ui.vk.RenderMode.Default}},events:{cameraChanged:{parameters:{position:"float[]",quaternion:"float[]",zoom:"float"},enableEventBubbling:true}}}});
var g=f.getMetadata().getParent().getClass().prototype;
f.prototype.init=function(){if(g.init){g.init.call(this);}this._resizeListenerId=null;this._renderLoopRequestId=0;this._renderLoopFunction=this._renderLoop.bind(this);this._shouldRenderFrame=true;this._clippingPlanes=[];this._renderer=new THREE.WebGLRenderer({antialias:true,alpha:true});this._renderer.setPixelRatio(window.devicePixelRatio);this._renderer.setSize(1,1);this._renderer.shadowMap.enabled=true;this._camera=new sap.ui.vk.threejs.PerspectiveCamera();var h=["varying float vPos;","void main() {","	gl_Position = vec4(position, 1.0);","	vPos = position.y * -0.5 + 0.5;","}"].join("\n");var i=["uniform vec4 topColor;","uniform vec4 bottomColor;","varying float vPos;","void main() {","	gl_FragColor = mix(topColor, bottomColor, vPos);","}"].join("\n");var j=new THREE.Vector4();var k=new THREE.Vector4();this._updateColor(j,this.getBackgroundColorTop());this._updateColor(k,this.getBackgroundColorBottom());this._checkBackgroundColor();this._backgroundMaterial=new THREE.ShaderMaterial({uniforms:{topColor:{value:j},bottomColor:{value:k}},vertexShader:h,fragmentShader:i,side:THREE.DoubleSide,depthTest:false,depthWrite:false,blending:THREE.NoBlending});var m=new THREE.Geometry();m.vertices.push(new THREE.Vector3(-1,1,0),new THREE.Vector3(1,1,0),new THREE.Vector3(-1,-1,0),new THREE.Vector3(1,-1,0));m.faces.push(new THREE.Face3(0,2,1),new THREE.Face3(1,2,3));this._backgroundCamera=new THREE.Camera();this._backgroundScene=new THREE.Scene();this._backgroundScene.add(new THREE.Mesh(m,this._backgroundMaterial));var x=["#include <clipping_planes_pars_vertex>","varying vec3 vNormal;","void main() {","#include <begin_vertex>","#include <project_vertex>","#include <clipping_planes_vertex>","#include <beginnormal_vertex>","#include <defaultnormal_vertex>","	vNormal = normalize( transformedNormal );","}"].join("\n");var n=["#include <clipping_planes_pars_fragment>","uniform vec4 color1;","uniform vec4 color2;","varying vec3 vNormal;","void main() {","#include <clipping_planes_fragment>","	gl_FragColor = mix(color1, color2, abs(normalize(vNormal).z));","}"].join("\n");this._xrayColor1=new THREE.Vector4(0,0.75,1,0.45);this._xrayColor2=new THREE.Vector4(0,0,1,0);this._xrayMaterial=new THREE.ShaderMaterial({uniforms:{color1:{value:this._xrayColor1},color2:{value:this._xrayColor2}},vertexShader:x,fragmentShader:n,side:THREE.DoubleSide,depthWrite:false,depthFunc:THREE.LessDepth,blending:THREE.NormalBlending,clipping:true,transparent:true});this._viewportGestureHandler=new c(this);this._loco=new L();this._loco.addHandler(this._viewportGestureHandler);this._zoomedObject=null;this._nodesTransitionHelper=new N();this._nodesTransitionHelper.setViewport(this);this._cdsLoader=null;this.attachCameraChanged(function(s){this.setShouldRenderFrame();});this._sceneObserver=new d(this.setShouldRenderFrame.bind(this));};
f.prototype.exit=function(){this._loco.removeHandler(this._viewportGestureHandler);this._viewportGestureHandler.destroy();if(this._resizeListenerId){R.deregister(this._resizeListenerId);this._resizeListenerId=null;}this._stopRenderLoop();this.setScene(null);this.setCamera(null);this._renderer=null;this._backgroundCamera=null;this._backgroundMaterial=null;this._backgroundScene=null;this._loco=null;this._viewportGestureHandler=null;if(this._cdsLoader){this._cdsLoader.detachSceneUpdated(this._handleCdsSceneUpdate,this);}if(g.exit){g.exit.call(this);}};
f.prototype._startRenderLoop=function(){if(!this._renderLoopRequestId){this._renderLoopRequestId=window.requestAnimationFrame(this._renderLoopFunction);}return this;};
f.prototype._stopRenderLoop=function(){if(this._renderLoopRequestId){window.cancelAnimationFrame(this._renderLoopRequestId);this._renderLoopRequestId=0;}return this;};
f.prototype.setBackgroundColorTop=function(v){g.setBackgroundColorTop.call(this,v);if(this._backgroundMaterial!==null){this._updateColor(this._backgroundMaterial.uniforms.topColor.value,v);this._checkBackgroundColor();}return this;};
f.prototype.setBackgroundColorBottom=function(v){g.setBackgroundColorBottom.call(this,v);if(this._backgroundMaterial!==null){this._updateColor(this._backgroundMaterial.uniforms.bottomColor.value,v);this._checkBackgroundColor();}return this;};
f.prototype.setClippingPlanes=function(h){this._clippingPlanes=h;return this;};
f.prototype.onBeforeRendering=function(){if(this._resizeListenerId){R.deregister(this._resizeListenerId);this._resizeListenerId=null;}this._stopRenderLoop();};
f.prototype.onAfterRendering=function(){var h=this.getDomRef();h.appendChild(this._renderer.domElement);this._resizeListenerId=R.register(this,this._handleResize.bind(this));this._handleResize({size:{width:h.clientWidth,height:h.clientHeight}});this._startRenderLoop();};
f.prototype._handleResize=function(h){if(!this._camera||!this._renderer){return false;}var w=h.size.width;var i=h.size.height;if(this._camera){this._camera.update(w,i);}this._renderer.setSize(w,i);this.fireResize({size:{width:w,height:i}});this.setShouldRenderFrame();return true;};
f.prototype.setScene=function(s){this._scene=s;this._homeCamera=null;this._sceneObserver.disconnect();var n=this._scene?this._scene.getSceneRef():undefined;if(n){this._sceneObserver.observe(this._scene,{properties:["doubleSided"]});var h;for(var i=0;i<n.children.length;i++){h=n.children[i];if(h.private&&h.name==="DefaultLights"&&h.children.length){if(h.children[0]instanceof THREE.PointLight){this._eyePointLight=h.children[0];}}}}this.setShouldRenderFrame();return this;};
f.prototype.getScene=function(){return this._scene;};
f.prototype.setCamera=function(h){if(g.setCamera){g.setCamera.call(this,h);}var i=this.getCamera();if(i&&this._renderer){var s=this._renderer.getSize();i.update(s.width,s.height);if(!this._homeCamera&&i.getCameraRef()){this._homeCamera=i.getCameraRef().clone();}}this.setShouldRenderFrame();return this;};
f.prototype.getRenderer=function(){return this._renderer;};
f.prototype._getViewStateManagerThreeJS=function(){if(this._viewStateManager){if(this._viewStateManager.constructor===sap.ui.vk.threejs.ViewStateManager){return this._viewStateManager;}if(this._viewStateManager.constructor===sap.ui.vk.ViewStateManager&&this._viewStateManager._implementation.constructor===sap.ui.vk.threejs.ViewStateManager){return this._viewStateManager._implementation;}}return null;};
f.prototype._updateBoundingBoxesIfNeeded=function(){var v=this._getViewStateManagerThreeJS();if(v){v._updateBoundingBoxesIfNeeded();}};
f.prototype._updateColor=function(h,i){var j=sap.ui.vk.cssColorToColor(i);h.color=new THREE.Color(j.red/255,j.green/255,j.blue/255);h.alpha=j.alpha;h.x=h.color.r*h.alpha;h.y=h.color.g*h.alpha;h.z=h.color.b*h.alpha;h.w=h.alpha;};
f.prototype._checkBackgroundColor=function(){var h=this.getBackgroundColorTop();if(h===this.getBackgroundColorBottom()){if(this._backgroundColor===null){this._backgroundColor=new THREE.Vector4();}this._updateColor(this._backgroundColor,h);}else{this._backgroundColor=null;}this.setShouldRenderFrame();};
f.prototype._handleCdsSceneUpdate=function(){this.setShouldRenderFrame();};
f.prototype.setShouldRenderFrame=function(){this._shouldRenderFrame=true;return this;};
f.prototype.shouldRenderFrame=function(){return this._shouldRenderFrame;};
f.prototype.setRenderMode=function(h){this.setProperty("renderMode",h,true);this.setShouldRenderFrame();};
f.prototype.hitTest=function(x,y){var n=this._scene?this._scene.getSceneRef():undefined;var h=this._camera?this._camera.getCameraRef():undefined;if(!h||!n){return null;}var j=this._renderer.domElement;var m=new THREE.Vector2((x-j.clientLeft)/j.clientWidth*2-1,(j.clientTop-y)/j.clientHeight*2+1);var k=new THREE.Raycaster();k.setFromCamera(m,h);if(this._clippingPlanes){for(var i in this._clippingPlanes){var s=this._clippingPlanes[i];var u=s.distanceToPoint(k.ray.origin),t=-u/s.normal.dot(k.ray.direction);if(t>0){if(u<0){k.near=Math.max(k.near,t);}else{k.far=Math.min(k.far,t);}}else if(u<0){return null;}}}var v=k.intersectObjects(n.children,true);if(v&&v.length){var w=v[0];if(!w.object.name&&w.object.children.length===0){w.object=w.object.parent;}return w;}return null;};
f.prototype.tap=function(x,y,i){if(!i){if(this._viewStateManager){var h=this.hitTest(x,y);var n=h&&h.object;var j={picked:n?[n]:[]};this.fireNodesPicked(j);if(this.getSelectionMode()===sap.ui.vk.SelectionMode.Exclusive){this.exclusiveSelectionHandler(j.picked);}else if(this.getSelectionMode()===sap.ui.vk.SelectionMode.Sticky){this.stickySelectionHandler(j.picked);}if(n!==null){this.fireNodeClicked({nodeRef:n,x:x,y:y},true,true);}}}else if(!this.getFreezeCamera()){var k=this.hitTest(x,y);if(k&&(this._zoomedObject===null||this._zoomedObject!==k.object)){this._zoomedObject=k.object;this._viewportGestureHandler.zoomObject(this._zoomedObject,true);}else{this._viewportGestureHandler.zoomObject(this._zoomedObject,false);this._zoomedObject=null;}}return this;};
var o={x:-2,y:-2};var r=2;var p=5;[{key:"left",dx:-r,dy:0},{key:"right",dx:+r,dy:0},{key:"up",dx:0,dy:-r},{key:"down",dx:0,dy:+r}].forEach(function(i){f.prototype["onsap"+i.key]=function(h){var j=this._viewportGestureHandler._cameraController;j.beginGesture(o.x,o.y);j.rotate(i.dx,i.dy,true);j.endGesture();this.setShouldRenderFrame();h.preventDefault();h.stopPropagation();};});[{key:"left",dx:-p,dy:0},{key:"right",dx:+p,dy:0},{key:"up",dx:0,dy:-p},{key:"down",dx:0,dy:+p}].forEach(function(i){f.prototype["onsap"+i.key+"modifiers"]=function(h){if(h.shiftKey&&!(h.ctrlKey||h.altKey||h.metaKey)){var j=this._viewportGestureHandler._cameraController;j.beginGesture(o.x,o.y);j.pan(i.dx,i.dy);j.endGesture();this.setShouldRenderFrame();h.preventDefault();h.stopPropagation();}};});[{key:"minus",d:0.98},{key:"plus",d:1.02}].forEach(function(i){f.prototype["onsap"+i.key]=function(h){var j=this._viewportGestureHandler._cameraController;j.beginGesture(this.$().width()/2,this.$().height()/2);j.zoom(i.d);j.endGesture();this.setShouldRenderFrame();h.preventDefault();h.stopPropagation();};});f.prototype._handleVisibilityChanged=f.prototype._handleOpacityChanged=f.prototype._handleTintColorChanged=f.prototype._handleHighlightColorChanged=function(h){this.setShouldRenderFrame();};
f.prototype._handleSelectionChanged=function(h){var t=this.getTools();for(var i=0;i<t.length;i++){var j=sap.ui.getCore().byId(t[i]);var k=j.getGizmoForContainer(this);if(k&&k.handleSelectionChanged){k.handleSelectionChanged(h);}}this.setShouldRenderFrame();};
f.prototype.setSelectionRect=function(h){this.setShouldRenderFrame();if(!h){this._selectionRect=null;return;}var s=this._renderer.getSize();var x=(h.x1/s.width)*2-1,y=(h.y1/s.height)*-2+1,i=(h.x2/s.width)*2-1,j=(h.y2/s.height)*-2+1;if(!this._selectionRect){var k=new THREE.Geometry();k.vertices.push(new THREE.Vector3(x,j,-1),new THREE.Vector3(i,j,-1),new THREE.Vector3(i,y,-1),new THREE.Vector3(x,y,-1));this._selectionRect=new THREE.LineLoop(k,new THREE.LineBasicMaterial({color:0xFFFF00,linewidth:window.devicePixelRatio}));}else{var v=this._selectionRect.geometry.vertices;v[0].set(x,j,-1);v[1].set(i,j,-1);v[2].set(i,y,-1);v[3].set(x,y,-1);this._selectionRect.geometry.verticesNeedUpdate=true;}};
f.prototype._renderLoop=function(){if(!this._renderer||!this.getDomRef()){this._renderLoopRequestId=0;return;}if(this._viewportGestureHandler){this._viewportGestureHandler.animateCameraUpdate();}if(this._nodesTransitionHelper){this._nodesTransitionHelper.displayNodesMoving();}var n=this.getCamera()?this.getCamera().getCameraRef():undefined;if(this._eyePointLight&&n){this._eyePointLight.position.copy(n.position);}if(this._shouldRenderFrame){this._shouldRenderFrame=false;this.render();}this._renderLoopRequestId=window.requestAnimationFrame(this._renderLoopFunction);};
f.prototype._updateDynamicObjects=function(h,n,i,j){var k=false;i.children.forEach(function(m){if(m.userData._vkDetailViews&&m.userData._vkDetailViews.length>0){k=true;}});function s(v){i.children.forEach(function(m){if(m.userData._vkBillboards){m.userData._vkBillboards.forEach(function(t){t._node.visible=v;});}if(m.userData._vkDetailViews){m.userData._vkDetailViews.forEach(function(t){t._node.visible=v;});}});}if(k){j=j||this._scene._computeBoundingBox();s(false);i.children.forEach(function(m){if(m.userData._vkDetailViews){m.userData._vkDetailViews.forEach(function(t){t._update(h,n,i,j);});}});s(true);}i.children.forEach(function(m){if(m.userData._vkCallouts){m.userData._vkCallouts.forEach(function(t){t._update(h,n);});}if(m.userData._vkBillboards){m.userData._vkBillboards.forEach(function(t){t._update(h,n);});}});};
f.prototype.render=function(){var h=this._renderer;if(!h){return;}var n=this._scene?this._scene.getSceneRef():null;var j=this._camera?this._camera.getCameraRef():null;if(!n||!j){return;}var t=this.getTools();var i,k,m,s;if(this._camera.getUsingDefaultClipPlanes()||(j.isOrthographicCamera&&this._camera.getZoomNeedRecalculate())){s=this._scene._computeBoundingBox();if(!s.isEmpty()){if(j.isOrthographicCamera&&this._camera.getZoomNeedRecalculate()){this._camera.adjustZoom(s);}if(this._camera.getUsingDefaultClipPlanes()){for(i=0;i<t.length;i++){k=sap.ui.getCore().byId(t[i]);m=k.getGizmoForContainer(this);if(m&&m.expandBoundingBox){m.expandBoundingBox(s);}}this._camera.adjustClipPlanes(s);}}}this._updateDynamicObjects(h,j,n,s);h.autoClear=this._backgroundColor!=null;if(h.autoClear){h.setClearColor(this._backgroundColor.color,this._backgroundColor.alpha);}else{h.render(this._backgroundScene,this._backgroundCamera);}var v=this._getViewStateManagerThreeJS();h.clippingPlanes=this._clippingPlanes;if(this.getRenderMode()===sap.ui.vk.RenderMode.XRay){if(v){var u=n.children[n.children.length-1].clone();v._selectedNodes.forEach(function(x){if(x.visible){x.add(u);h.render(x,j);h.autoClear=false;x.remove(u);}});}this._xrayColor1.w=0.45;n.overrideMaterial=this._xrayMaterial;}h.render(n,j);h.autoClear=false;h.clippingPlanes=[];n.overrideMaterial=null;if(v){var w=v._boundingBoxesScene;if(w){h.render(w,j);}}for(i=0;i<t.length;i++){k=sap.ui.getCore().byId(t[i]);m=k.getGizmoForContainer(this);if(m&&m.render){m.render(this);}}if(this._selectionRect){h.render(this._selectionRect,this._backgroundCamera);}};
f.prototype.getImage=function(i,j,t,k,m){if(this._scene===null){return null;}i=i||16;j=j||16;if(i>2048){i=2048;}if(j>2048){j=2048;}var n=new THREE.WebGLRenderer({preserveDrawingBuffer:true});n.setSize(i,j);var s=this.getBackgroundColorTop();var u=this.getBackgroundColorBottom();if(t&&!k){n.setClearColor(t,1);}else if(!t&&k){n.setClearColor(k,1);}else{if(t&&k){this.setBackgroundColorTop(t);this.setBackgroundColorBottom(k);}n.render(this._backgroundScene,this._backgroundCamera);n.autoClear=false;}document.body.appendChild(n.domElement);var v=this.getCamera().getCameraRef().clone();var x=i/j;if(v.isOrthographicCamera){var w=v.right-v.left;var h=v.top-v.bottom;if(w>h){v.top=w/x/2;v.bottom=-w/x/2;}else{v.left=-h*x/2;v.right=h*x/2;}}else{var y=2*Math.atan(v.aspect*Math.tan(v.fov*Math.PI/360));if(v.fov<y*180/Math.PI){v.fov=360*Math.atan(Math.tan(y*0.5)/x)/Math.PI;}v.aspect=x;}v.updateProjectionMatrix();var z=[];var A=this._getViewStateManagerThreeJS();if(!m){if(A!==null){A.enumerateSelection(function(D){z.push(D);});A.setSelectionState(z,false,false);}}n.render(this._scene.getSceneRef(),v);var B=n.getContext().canvas.toDataURL();if(A!==null&&z.length>0){A.setSelectionState(z,true,false);}n.forceContextLoss();document.body.removeChild(n.domElement);if(u&&t){this.setBackgroundColorBottom(u);}if(s&&k){this.setBackgroundColorTop(s);}return B;};
f.prototype._setContent=function(h){var s;var j;if(h){s=h;if(!(s instanceof sap.ui.vk.threejs.Scene)){s=null;}j=h.camera;if(!(j instanceof sap.ui.vk.threejs.OrthographicCamera||j instanceof sap.ui.vk.threejs.PerspectiveCamera)){j=null;}if(j instanceof sap.ui.vk.threejs.OrthographicCamera){var k=new THREE.Box3().setFromObject(s.getSceneRef());var m=k.getCenter();var n=j.getTargetDirection();var t=j.getPosition();var u=[m.x-t[0],m.y-t[1],m.z-t[2]];var v=u[0]*n[0]+u[1]*n[1]+u[2]*n[2];if(v<0){var w=k.getSize().length()/2;w-=v;t[0]-=n[0]*w;t[1]-=n[1]*w;t[2]-=n[2]*w;j.setPosition(t);}}if(h.loaders){for(var i=0;i<h.loaders.length;i++){if(h.loaders[i]instanceof sap.ui.vk.threejs.ContentDeliveryService){this._cdsLoader=h.loaders[i];this._cdsLoader.attachSceneUpdated(this._handleCdsSceneUpdate,this);break;}}}}this.setScene(s);if(j){this.setCamera(j);}};
f.prototype._onAfterUpdateContentConnector=function(){this._setContent(this._contentConnector.getContent());};
f.prototype._onBeforeClearContentConnector=function(){if(g._onBeforeClearContentConnector){g._onBeforeClearContentConnector.call(this);}this.setScene(null);};
f.prototype._handleContentReplaced=function(h){var i=h.getParameter("newContent");this._setContent(i);};
f.prototype._onAfterUpdateViewStateManager=function(){};
f.prototype._onBeforeClearViewStateManager=function(){};
C.injectMethodsIntoClass(f);b.injectMethodsIntoClass(f);
f.prototype.activateView=function(v){var h=v.getCameraInfo();var n;if(h){if(h.type==="PerspectiveCamera"){n=new sap.ui.vk.threejs.PerspectiveCamera();n.setFov(h.fov);n.setPosition(h.position);}if(h.type==="OrthographicCamera"){n=new sap.ui.vk.threejs.OrthographicCamera();n.setZoomFactor(h.zoomFactor);if(h.zoomNeedRecalculate){n.setZoomNeedRecalculate(true);}var i=h.position;var s=this.getScene();if(s){var j=new THREE.Box3().setFromObject(this.getScene().getSceneRef());var k=j.getCenter();var m=h.targetDirection;var t=[k.x-i[0],k.y-i[1],k.z-i[2]];var u=t[0]*m[0]+t[1]*m[1]+t[2]*m[2];if(u<0){var w=j.getSize().length()/2;w-=u;i[0]-=m[0]*w;i[1]-=m[1]*w;i[2]-=m[2]*w;}}n.setPosition(i);}n.setNearClipPlane(h.nearClipPlane);n.setFarClipPlane(h.farClipPlane);n.setUpDirection(h.upDirection);n.setTargetDirection(h.targetDirection);n.setUsingDefaultClipPlanes(h.usingDefaultClipPlanes);this._viewportGestureHandler.prepareForCameraUpdateAnimation(h.type);this.setCamera(n);this._viewportGestureHandler.startAnimatingCameraUpdate(500);}function x(T){return new THREE.Matrix4().set(T[0],T[1],T[2],T[3],T[4],T[5],T[6],T[7],T[8],T[9],T[10],T[11],0,0,0,1);}var y=this._viewStateManager.getNodeHierarchy();var z=v.getNodeInfos();if(z){this._nodesTransitionHelper.clear();z.forEach(function(S){if(S.target===null){return;}function T(X,Y,Z){for(var $=0;$<X.elements.length;$++){if(Math.abs(X.elements[$]-Y.elements[$])>Z){return false;}}return true;}if(S.transform){var U=x(S.transform);if(!T(U,S.target.matrix,1e-6)){var W=y.createNodeProxy(S.target);this._nodesTransitionHelper.setNodeForDisplay(W);U.decompose(S.target.position,S.target.quaternion,S.target.scale);S.target.updateMatrix();}}}.bind(this));var A=[];var B=[];for(var D=0;D<z.length;D++){if(z[D].visible){A.push(z[D].target);}else{B.push(z[D].target);}}this._viewStateManager.setVisibilityState(A,true,false);this._viewStateManager.setVisibilityState(B,false,false);var E=new Set(A);var F=[];var G=y.getSceneRef();var H=this;G.traverse(function collectChildNodes(S){if(S.parent&&H._viewStateManager.getVisibilityState(S.parent)===false){return;}if(H._viewStateManager.getVisibilityState(S)){if(S.userData&&S.userData.treeNode){F.push(S);}}});var I=[];for(var J=0;J<F.length;J++){if(!E.has(F[J])){var K=true;var Q=0;var S=F[J];while(S&&Q<4){if(S.parent&&S.parent.userData&&S.parent.userData.treeNode){K=false;break;}else{S=S.parent;Q++;}}if(!K){I.push(F[J]);}}}this._viewStateManager.setVisibilityState(I,false,false);this._nodesTransitionHelper.startDisplay(500);}return this;};
f.prototype.zoomTo=function(w,n,h,m){var i=this._scene?this._scene.getSceneRef():null;var j=this._camera?this._camera.getCameraRef():null;if(!j||!i){return this;}m=m||0;var k=new THREE.Box3();var s=null;var t=null;(Array.isArray(w)?w:[w]).forEach(function(w){switch(w){case sap.ui.vk.ZoomTo.All:i._expandBoundingBox(k,false);break;case sap.ui.vk.ZoomTo.Visible:i._expandBoundingBox(k,true);break;case sap.ui.vk.ZoomTo.Selected:var v=this._getViewStateManagerThreeJS();if(v){v.enumerateSelection(function(n){n._expandBoundingBox(k,false);});}break;case sap.ui.vk.ZoomTo.Node:if(!n){return this;}t=n;if(Array.isArray(n)){n.forEach(function(n){n._expandBoundingBox(k,false);});}else{n._expandBoundingBox(k,false);}break;case sap.ui.vk.ZoomTo.Restore:q.sap.log.error("sap.ui.vk.ZoomTo.Restore is not implemented");return this;case sap.ui.vk.ZoomTo.NodeSetIsolation:q.sap.log.error("sap.ui.vk.ZoomTo.NodeSetIsolation is not implemented");return this;case sap.ui.vk.ZoomTo.RestoreRemoveIsolation:q.sap.log.error("sap.ui.vk.ZoomTo.RestoreRemoveIsolation is not implemented");return this;case sap.ui.vk.ZoomTo.ViewLeft:s=new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(0,1,0),-Math.PI/2);break;case sap.ui.vk.ZoomTo.ViewRight:s=new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(0,1,0),Math.PI/2);break;case sap.ui.vk.ZoomTo.ViewTop:s=new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(1,0,0),-Math.PI/2);break;case sap.ui.vk.ZoomTo.ViewBottom:s=new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(1,0,0),Math.PI/2);break;case sap.ui.vk.ZoomTo.ViewBack:s=new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(0,1,0),Math.PI);break;case sap.ui.vk.ZoomTo.ViewFront:s=new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(0,1,0),0);break;default:break;}}.bind(this));if(!k.isEmpty()){this._viewportGestureHandler.zoomTo(k,s,m,h*1000,t,t!==null);}return this;};
f.prototype.getViewInfo=function(h){var v={};if(h==null){h={};}if(h.camera==null){h.camera=true;}var n=this._camera?this._camera.getCameraRef():null;if(h.camera&&n){var i=n.rotation.clone();i.reorder("YXZ");v.camera={rotation:{yaw:THREE.Math.radToDeg(i.y),pitch:THREE.Math.radToDeg(i.x),roll:THREE.Math.radToDeg(i.z)},position:{x:n.position.x,y:n.position.y,z:n.position.z},projectionType:n.isOrthographicCamera?sap.ui.vk.CameraProjectionType.Orthographic:sap.ui.vk.CameraProjectionType.Perspective,bindingType:sap.ui.vk.CameraFOVBindingType.Vertical};if(v.camera.projectionType===sap.ui.vk.CameraProjectionType.Perspective){v.camera.fieldOfView=n.fov;}else if(v.camera.projectionType===sap.ui.vk.CameraProjectionType.Orthographic){v.camera.zoomFactor=n.zoom;}if(h.camera.matrices){v.camera.matrices={view:n.matrixWorldInverse.elements.slice(),projection:n.projectionMatrix.elements.slice()};}}if(h.visibility&&this._viewStateManager){var j=h.visibility.mode==null?sap.ui.vk.VisibilityMode.Complete:h.visibility.mode;v.visibility={mode:j};if(j===sap.ui.vk.VisibilityMode.Complete){var k=this._viewStateManager.getVisibilityComplete();v.visibility.visible=k.visible;v.visibility.hidden=k.hidden;}else if(this._viewStateManager.getShouldTrackVisibilityChanges()){v.visibility.changes=this._viewStateManager.getVisibilityChanges();}else{v.visibility.changes=null;q.sap.log.warning(sap.ui.vk.getResourceBundle().getText(M.VIT32.summary),M.VIT32.code,"sap.ui.vk.dvl.Viewport");}}return v;};
f.prototype.setViewInfo=function(v,h){var n=this._camera?this._camera.getCameraRef():null;if(v.camera&&n){var i=v.camera;var j=i.projectionType===sap.ui.vk.CameraProjectionType.Orthographic?new THREE.OrthographicCamera():new THREE.PerspectiveCamera();j.userData=n.userData;j.aspect=n.aspect;j.position.copy(i.position);var k=i.rotation;j.quaternion.setFromEuler(new THREE.Euler(THREE.Math.degToRad(k.pitch),THREE.Math.degToRad(k.yaw),THREE.Math.degToRad(k.roll),"YXZ"));j.fov=i.fieldOfView||j.fov;j.zoom=i.zoomFactor||j.zoom;this._viewportGestureHandler._activateCamera(j,(h||0)*1000);}if(v.visibility){var m=this._viewStateManager.getNodeHierarchy(),s=new Map(),t=m.findNodesByName();t.forEach(function(x){var y=m.createNodeProxy(x);var z=y.getVeId();m.destroyNodeProxy(y);if(z){s.set(z,x);}});switch(v.visibility.mode){case sap.ui.vk.VisibilityMode.Complete:var u=v.visibility.visible,w=v.visibility.hidden;u.forEach(function(x){this._viewStateManager.setVisibilityState(s.get(x),true,false);},this);w.forEach(function(x){this._viewStateManager.setVisibilityState(s.get(x),false,false);},this);break;case sap.ui.vk.VisibilityMode.Differences:v.visibility.changes.forEach(function(x){var y=s.get(x);if(y){this._viewStateManager.setVisibilityState(y,!this._viewStateManager.getVisibilityState(y),false);}},this);break;default:q.sap.log.error(sap.ui.vk.getResourceBundle().getText(M.VIT28.summary),M.VIT28.code,"sap.ui.vk.dvl.Viewport");break;}}return this;};
f.prototype.queueCommand=function(h){if(this instanceof sap.ui.vk.threejs.Viewport){h();}return this;};
f.prototype.getOutputSize=function(){var h=this.getDomRef().getBoundingClientRect();var v=h.width;var i=h.height;var j;j=Math.min(v,i);return{left:(v-j)/2,top:(i-j)/2,sideLength:j};};
return f;});
sap.ui.predefine('sap/ui/vk/threejs/ViewportGestureHandler',["jquery.sap.global","sap/ui/base/EventProvider","sap/ui/core/ResizeHandler","./thirdparty/three"],function(q,E,R,t){"use strict";
var V=E.extend("sap.ui.vk.threejs.ViewportGestureHandler",{
metadata:{},
constructor:function(v){this._matProj=null;this._viewport=v;this._rect=null;this._evt={x:0,y:0,z:0,d:0,initd:0};this._gesture=false;this._viewport.attachEvent("resize",this,this._onresize);this._nomenu=false;var T=function(a){var v=a;var b=new THREE.Vector3();var z=new THREE.Vector2();var A=0.001;var M=-Math.PI/2+A;var c=Math.PI/2-A;this.isTurnTableMode=true;this._timeIntervalForCameraAnimation=500;this._startTimeForCameraAnimation=0;this._newCamera=null;this._oldCamera=null;this._animationType=null;this._zoomedNodeRef=null;this._isZoomIn=true;this.beginGesture=function(x,y){var d=v.getScene();if(d==null){return;}var e=d.getSceneRef();var f=v.getCamera().getCameraRef();var h=v.getRenderer().getSize();z.x=x/h.width*2-1;z.y=y/h.height*-2+1;v._gesturePoint={x:x,y:y};var i=v.hitTest(x,y,e,f);if(i){b.copy(i.point);}else{var j=new THREE.Box3();e._expandBoundingBox(j,true);if(!j.isEmpty()){b=j.getCenter();}else{b.setScalar(0);}}};this.endGesture=function(){};this.pan=function(d,e){if(v.getFreezeCamera()){return;}if(d===0&&e===0){return;}var f=v.getCamera().getCameraRef();var h=v.getRenderer().getSize();if(v._viewportGestureHandler._matProj){var m=v._viewportGestureHandler._matProj;m[8]-=d*2/h.width;m[9]+=e*2/h.height;}else{var o=b.clone().project(f);o.x-=d*2/h.width;o.y+=e*2/h.height;o.unproject(f).sub(b);f.position.add(o);}f.updateMatrixWorld();v.fireCameraChanged({position:f.position.toArray()});};this.rotate=function(d,e,i){if(v.getFreezeCamera()){return;}if(i!==undefined){this.isTurnTableMode=i;}if(d===0&&e===0){return;}var f=v.getCamera().getCameraRef(),h=d*-0.01,j=e*-0.01;var o=f.position.clone().sub(b);var l=f.getWorldDirection().normalize(),u=new THREE.Vector3().setFromMatrixColumn(f.matrixWorld,1).normalize(),r=new THREE.Vector3().setFromMatrixColumn(f.matrixWorld,0).normalize();var k=new THREE.Quaternion(),m=new THREE.Quaternion();if(this.isTurnTableMode){var n=new THREE.Vector3(0,1,0);r.crossVectors(l,n).normalize();u.crossVectors(r,l);var p=Math.atan2(l.y,Math.sqrt(l.x*l.x+l.z*l.z));k.setFromAxisAngle(n,h);m.setFromAxisAngle(r,THREE.Math.clamp(j,M-p,c-p));}else{k.setFromAxisAngle(u,h);m.setFromAxisAngle(r,j);}k.multiply(m);o.applyQuaternion(k);l.applyQuaternion(k);u.applyQuaternion(k);o.add(b);f.position.copy(o);f.up.copy(u);f.lookAt(o.add(l));f.updateMatrixWorld();v.fireCameraChanged({position:f.position.toArray(),quaternion:f.quaternion.toArray()});};this.zoom=function(d){if(v.getFreezeCamera()){return;}if(d===0||d===1){return;}var e=v.getCamera().getCameraRef();var h=new THREE.Vector3();if(e.isPerspectiveCamera){if(v._viewportGestureHandler._matProj){this._matProj=v._viewportGestureHandler._matProj;var i=v.getDomRef();var r=g(this._matProj);var p=r.left+(r.right-r.left)*v._gesturePoint.x/i.clientWidth;var j=r.top+(r.bottom-r.top)*v._gesturePoint.y/i.clientHeight;var f=1/d;r.left=p+(r.left-p)*f;r.right=p+(r.right-p)*f;r.top=j+(r.top-j)*f;r.bottom=j+(r.bottom-j)*f;s(this._matProj,r);}else{h.set(z.x,z.y,1).unproject(e);h.sub(new THREE.Vector3(z.x,z.y,-1).unproject(e));var m=b.clone().sub(e.position).length()*(1-1/d);h.setLength(m);e.position.add(h);}}else if(e.isOrthographicCamera){h.set(z.x,z.y,1).unproject(e);h.sub(new THREE.Vector3(0,0,1).unproject(e));h.multiplyScalar(1-1/d);e.zoom*=d;e.updateProjectionMatrix();e.position.add(h);}else{q.sap.log.error("threejs.ViewportGestureHandler: unsupported camera type");}e.updateMatrixWorld();var k={position:e.position.toArray()};if(e.isOrthographicCamera){k.zoom=e.zoom;}v.fireCameraChanged(k);};this.animateCameraUpdate=function(){if(this._newCamera===null||this._oldCamera===null){return;}function d(f,h,x){x=THREE.Math.clamp((x-f)/(h-f),0.0,1.0);return x*x*x*(x*(x*6-15)+10);}var i=Math.min((Date.now()-this._startTimeForCameraAnimation)/this._timeIntervalForCameraAnimation,1);i=d(0,1,i);var e=v.getCamera().getCameraRef();if(e.isOrthographicCamera&&this._newCamera.isOrthographicCamera&&this._oldCamera.isOrthographicCamera){e.left=THREE.Math.lerp(this._oldCamera.left,this._newCamera.left,i);e.right=THREE.Math.lerp(this._oldCamera.right,this._newCamera.right,i);e.top=THREE.Math.lerp(this._oldCamera.top,this._newCamera.top,i);e.bottom=THREE.Math.lerp(this._oldCamera.bottom,this._newCamera.bottom,i);e.zoom=THREE.Math.lerp(this._oldCamera.zoom,this._newCamera.zoom,i);}if(e.isPerspectiveCamera&&this._newCamera.isPerspectiveCamera&&this._oldCamera.isPerspectiveCamera){e.fov=THREE.Math.lerp(this._oldCamera.fov,this._newCamera.fov,i);e.aspect=THREE.Math.lerp(this._oldCamera.aspect,this._newCamera.aspect,i);}e.far=THREE.Math.lerp(this._oldCamera.far,this._newCamera.far,i);e.near=THREE.Math.lerp(this._oldCamera.near,this._newCamera.near,i);e.updateProjectionMatrix();e.position.lerpVectors(this._oldCamera.position,this._newCamera.position,i);e.quaternion.copy(this._oldCamera.quaternion).slerp(this._newCamera.quaternion,i);e.scale.lerpVectors(this._oldCamera.scale,this._newCamera.scale,i);e.updateMatrixWorld();if(i===1){this._newCamera=null;this._oldCamera=null;if(this._animationType==="zooming"&&this._zoomedNodeRef){v.fireNodeZoomed({zoomed:this._zoomedNodeRef,isZoomIn:this._isZoomIn});}}v.fireCameraChanged({position:e.position.toArray(),quaternion:e.quaternion.toArray()});};this.zoomObject=function(n,i,d){if(v.getScene()==null){return;}var e=new THREE.Box3();(i&&n?n:v.getScene().getSceneRef())._expandBoundingBox(e);this.zoomBox(e,0,d,n,i);};this.zoomBox=function(d,m,e,n,f){this._zoomedNodeRef=n;this._isZoomIn=f;this._animationType="zooming";var h=v.getCamera().getCameraRef();var j=h.getWorldDirection().multiplyScalar(d.getSize().length());var k=d.getCenter();var l=[new THREE.Vector3(d.min.x,d.min.y,d.min.z),new THREE.Vector3(d.max.x,d.max.y,d.max.z),new THREE.Vector3(d.min.x,d.min.y,d.max.z),new THREE.Vector3(d.min.x,d.max.y,d.max.z),new THREE.Vector3(d.max.x,d.min.y,d.max.z),new THREE.Vector3(d.max.x,d.max.y,d.min.z),new THREE.Vector3(d.min.x,d.max.y,d.min.z),new THREE.Vector3(d.max.x,d.min.y,d.min.z)];var o=new THREE.Matrix4(),p=new THREE.Vector3();function r(h){o.multiplyMatrices(h.projectionMatrix,h.matrixWorldInverse);for(var i in l){p.copy(l[i]).applyMatrix4(o);if(p.x<-1.0||p.x>1.0||p.y<-1.0||p.y>1.0){return false;}}return true;}this._newCamera=h.clone();this._newCamera.position.copy(k).sub(j);this._newCamera.updateMatrixWorld(true);if(h.isPerspectiveCamera){while(!r(this._newCamera)){this._newCamera.position.sub(j);this._newCamera.updateMatrixWorld(true);}var u=10;var P=this._newCamera.position.clone();var w=k.clone();for(var x=0;x<u;x++){this._newCamera.position.copy(P).add(w).multiplyScalar(0.5);this._newCamera.updateMatrixWorld(true);if(r(this._newCamera)){P.copy(this._newCamera.position);}else{w.copy(this._newCamera.position);}}this._newCamera.position.copy(P).sub(k).multiplyScalar(m).add(P);this._newCamera.updateMatrixWorld(true);}if(h.isOrthographicCamera){var y=new THREE.Box2();l.forEach(function(i){p=i.project(this._newCamera);y.expandByPoint(new THREE.Vector2(p.x,p.y));}.bind(this));this._newCamera.zoom/=Math.max(y.getSize().x,y.getSize().y)*0.5*(1+m);this._newCamera.updateProjectionMatrix();}this._startTimeForCameraAnimation=Date.now();this._timeIntervalForCameraAnimation=e!==undefined?e:500;};this.prepareForCameraUpdateAnimation=function(){this._oldCamera=v.getCamera().getCameraRef().clone();};this.startAnimatingCameraUpdate=function(d){this._newCamera=v.getCamera().getCameraRef().clone();this._timeIntervalForCameraAnimation=d!==undefined?d:500;this._startTimeForCameraAnimation=Date.now();};};this._cameraController=new T(v);}
});
function g(a){var m=a;var i=m[15]===1;var r=2/m[0];var b=2/m[5];var c,d;if(i){c=-m[12]*r;d=-m[13]*b;}else{c=m[8]*r;d=m[9]*b;}var e=(r+c)*0.5;var l=c-e;var f=(b+d)*0.5;var h=d-f;return{left:l,top:f,right:e,bottom:h};}
function s(a,r){var m=a;var i=m[15]===1;m[0]=2/(r.right-r.left);m[5]=2/(r.top-r.bottom);if(i){m[12]=-(r.right+r.left)/(r.right-r.left);m[13]=-(r.top+r.bottom)/(r.top-r.bottom);}else{m[8]=(r.right+r.left)/(r.right-r.left);m[9]=(r.top+r.bottom)/(r.top-r.bottom);}}
V.prototype._activateRedline=function(){var c=this._viewport.getCamera().getCameraRef();this._matProj=c.projectionMatrix.elements;};
V.prototype._deactivateRedline=function(){this._matProj=null;};
V.prototype.destroy=function(){this._viewport=null;this._rect=null;this._evt=null;this._gesture=false;};
V.prototype._getOffset=function(o){var r=o.getBoundingClientRect();var p={x:r.left+window.pageXOffset,y:r.top+window.pageYOffset};return p;};
V.prototype._inside=function(e){if(this._rect===null||true){var i=this._viewport.getIdForLabel();var d=document.getElementById(i);if(!d){return false;}var o=this._getOffset(d);this._rect={x:o.x,y:o.y,w:d.offsetWidth,h:d.offsetHeight};}return(e.x>=this._rect.x&&e.x<=this._rect.x+this._rect.w&&e.y>=this._rect.y&&e.y<=this._rect.y+this._rect.h);};
V.prototype._onresize=function(e){this._gesture=false;this._rect=null;};
V.prototype.beginGesture=function(a){if(this._inside(a)&&!this._gesture){this._gesture=true;var x=a.x-this._rect.x,y=a.y-this._rect.y;this._evt.x=x;this._evt.y=y;this._evt.d=a.d;this._evt.initd=a.d;this._evt.avgd=a.d;this._evt.avgx=0;this._evt.avgy=0;q.sap.log.debug("Loco: beginGesture: "+x+", "+y);this._cameraController.beginGesture(x,y);a.handled=true;if(document.activeElement){try{document.activeElement.blur();}catch(e){}}var d=document.getElementById(this._viewport.getIdForLabel());d.focus();}this._nomenu=false;};
V.prototype.move=function(e){if(this._gesture){var x=e.x-this._rect.x,y=e.y-this._rect.y;var d=x-this._evt.x;var a=y-this._evt.y;var b=e.d-this._evt.d;this._evt.x=x;this._evt.y=y;this._evt.d=e.d;this._evt.avgx=this._evt.avgx*0.99+d*0.01;this._evt.avgy=this._evt.avgy*0.99+a*0.01;var z=1.0;if(this._evt.initd>0){z=1.0+b*(1.0/this._evt.initd);}else if(e.n===2){if(e.points[0].y>e.points[1].y){z=1.0-b*0.005;if(z<0.333){z=0.333;}}else{z=1.0+b*0.005;if(z>3){z=3;}}}if(this._evt.initd>0){var c=Math.sqrt(this._evt.avgx*this._evt.avgx+this._evt.avgy*this._evt.avgy);q.sap.log.debug("AvgDist: "+c);if((Math.abs(e.d-this._evt.avgd)/this._evt.avgd)<(c/10)){z=1.0;}}this._evt.avgd=this._evt.avgd*0.97+e.d*0.03;switch(e.n){case 1:q.sap.log.debug("Loco: Rotate: "+(d)+", "+(a));this._cameraController.rotate(d,a);break;case 2:q.sap.log.debug("Loco: Pan: "+(d)+", "+(a));if(z!=0&&z!=1.0){q.sap.log.debug("Loco: Zoom: "+(z));}this._cameraController.pan(d,a);if(d<10&&a<10&&z!=0&&z!=1.0){this._cameraController.zoom(z);}break;default:break;}this._nomenu=true;e.handled=true;}};
V.prototype.endGesture=function(e){if(this._gesture){var x=e.x-this._rect.x,y=e.y-this._rect.y;q.sap.log.debug("Loco: endGesture: "+x+", "+y);this._cameraController.endGesture();this._gesture=false;e.handled=true;}};
V.prototype.click=function(e){if(this._inside(e)&&e.buttons<=1){var x=e.x-this._rect.x,y=e.y-this._rect.y;q.sap.log.debug("Loco: click: "+(x)+", "+(y));if(this._viewport){this._viewport.tap(x,y,false);}e.handled=true;}};
V.prototype.doubleClick=function(e){if(this._inside(e)&&e.buttons<=1){var x=e.x-this._rect.x,y=e.y-this._rect.y;q.sap.log.debug("Loco: doubleClick: "+(x)+", "+(y));if(this._viewport){this._viewport.tap(x,y,true);}e.handled=true;}};
V.prototype.contextMenu=function(e){if(this._inside(e)||this._nomenu||e.buttons===5){this._nomenu=false;e.handled=true;}};
V.prototype.keyEventHandler=function(e){};
V.prototype.getViewport=function(){return this._viewport;};
V.prototype._activateCamera=function(c,a){this._cameraController.prepareForCameraUpdateAnimation();if(this._viewport.getCamera().getCameraRef().isPerspectiveCamera!=c.isPerspectiveCamera){this._viewport.setCamera(c.isPerspectiveCamera?new sap.ui.vk.threejs.PerspectiveCamera():new sap.ui.vk.threejs.OrthographicCamera());}this._viewport.getCamera().getCameraRef().copy(c);var b=this._viewport.getRenderer().getSize();this._viewport.getCamera().update(b.width,b.height);this._cameraController.startAnimatingCameraUpdate(a);return this;};
V.prototype.setView=function(a,b){this._cameraController.prepareForCameraUpdateAnimation();var c=this._viewport.getCamera().getCameraRef();if(a){c.quaternion.copy(a);c.updateMatrixWorld();c.up.setFromMatrixColumn(c.matrixWorld,1).normalize();this._cameraController.zoomObject(null,false,b);}else{c.copy(this._viewport._homeCamera?this._viewport._homeCamera:new sap.ui.vk.threejs.PerspectiveCamera().getCameraRef());var d=this._viewport.getRenderer().getSize();this._viewport.getCamera().update(d.width,d.height);this._cameraController.startAnimatingCameraUpdate(b);}return this;};
V.prototype.zoomTo=function(b,a,m,c,n,i){this._cameraController.prepareForCameraUpdateAnimation();if(a){var d=this._viewport.getCamera().getCameraRef();d.quaternion.copy(a);d.updateMatrixWorld();d.up.setFromMatrixColumn(d.matrixWorld,1).normalize();}this._cameraController.zoomBox(b,m,c,n,i);return this;};
V.prototype.zoomObject=function(n,i,a){this._cameraController.prepareForCameraUpdateAnimation();this._cameraController.zoomObject(n,i,a);return this;};
V.prototype.animateCameraUpdate=function(){this._cameraController.animateCameraUpdate();};
V.prototype.prepareForCameraUpdateAnimation=function(){this._cameraController.prepareForCameraUpdateAnimation();};
V.prototype.startAnimatingCameraUpdate=function(a){this._cameraController.startAnimatingCameraUpdate(a);};
return V;},true);
sap.ui.predefine('sap/ui/vk/threejs/ViewportRenderer',["jquery.sap.global"],function(q){"use strict";var V={};
V.render=function(r,c){r.write("<div");r.writeControlData(c);r.addClass("sapVizKitViewport");r.writeClasses();r.writeAttribute("tabindex",0);r.addStyle("width",c.getWidth());r.addStyle("height",c.getHeight());r.writeStyles();r.write(">");var t=c.getTools();for(var i=0;i<t.length;i++){var _=sap.ui.getCore().byId(t[i]);var a=_.getGizmoForContainer(c);if(a&&a.hasDomElement()){r.renderControl(a);}}r.write("</div>");};
return V;},true);
sap.ui.predefine('sap/ui/vk/tools/CrossSectionTool',["jquery.sap.global","./library","./Tool","./CrossSectionToolHandler","./CrossSectionToolGizmo"],function(q,l,T,C,a){"use strict";
var b=T.extend("sap.ui.vk.tools.CrossSectionTool",{
metadata:{},
constructor:function(i,s){if(b._instance){return b._instance;}T.apply(this,arguments);this._viewport=null;this._handler=null;this._gizmo=null;b._instance=this;}
});
b.prototype.init=function(){if(T.prototype.init){T.prototype.init.call(this);}this.setFootprint(["sap.ui.vk.threejs.Viewport"]);this.setAggregation("gizmo",new a());};
b.prototype.isViewportType=function(t){if(this._viewport&&this._viewport.getMetadata().getName()===t){return true;}return false;};
b.prototype.setActive=function(v,c,g){if(T.prototype.setActive){T.prototype.setActive.call(this,v,c,g);}if(v){this._activateTool(c);}else{this._deactivateTool();}if(c){c.setShouldRenderFrame();}return this;};
b.prototype._activateTool=function(c){this._viewport=c;this._handler=new C(this);this._gizmo=this.getGizmo();if(this._gizmo){this._gizmo.show(c,this);}this._prepare();};
b.prototype._deactivateTool=function(){if(this._handler){if(this._viewport._loco){this._viewport._loco.removeHandler(this._handler);}this._handler=null;}if(this._gizmo){this._gizmo.hide();this._gizmo=null;}};
b.prototype._prepare=function(){var o=false;if(this._viewport._loco){this._viewport._loco.addHandler(this._handler);o=true;}return o;};
b.prototype.setAxis=function(i){if(this._gizmo){this._gizmo.setAxis(i);}return this;};
b.prototype.setFlip=function(f){if(this._gizmo){this._gizmo.setFlip(f);}return this;};
b.prototype.queueCommand=function(c){if(this._prepare()){if(this.isViewportType("sap.ui.vk.threejs.Viewport")){c();}}return this;};
b.prototype.destroy=function(){T.prototype.destroy.call(this);this._viewport=null;this._handler=null;};
return b;});
sap.ui.predefine('sap/ui/vk/tools/CrossSectionToolGizmo',["jquery.sap.global","./library","./Gizmo"],function(q,l,G){"use strict";
var C=G.extend("sap.ui.vk.tools.CrossSectionToolGizmo",{metadata:{library:"sap.ui.vk.tools"}});
C.prototype.init=function(){if(G.prototype.init){G.prototype.init.apply(this);}this._viewport=null;this._tool=null;this._position=new THREE.Vector3(0,0,0);this._plane=new THREE.Plane(new THREE.Vector3(0,0,1),0);this._flip=false;this._matViewProj=new THREE.Matrix4();this._pos4=new THREE.Vector4();this._gizmoSize=144;this.setAxis(0);};
C.prototype.hasDomElement=function(){return false;};
C.prototype.show=function(v,t){this._viewport=v;this._tool=t;var b=v._scene?v._scene._computeBoundingBox():new THREE.Box3();this._position.copy(b.getCenter());this._plane.constant=-this._plane.normal.dot(this._position);v.setClippingPlanes([this._plane]);};
C.prototype.hide=function(){if(this._viewport){this._viewport.setClippingPlanes([]);this._viewport=null;}this._tool=null;};
C.prototype._getOffset=function(){return this._position.getComponent(this._axis);};
C.prototype.getAxis=function(){return this._axis;};
C.prototype.setAxis=function(i){this._axis=i;var d=new THREE.Vector3().setComponent(i,1);this._plane.normal.set(0,0,0).setComponent(i,this._flip?-1:1);this._plane.constant=-this._plane.normal.dot(this._position);var g=new THREE.BufferGeometry();var v=new Array(15);var a=new THREE.Vector3(d.y,d.z,d.x),b=new THREE.Vector3(d.z,d.x,d.y),p=new THREE.Vector3();p.sub(a).sub(b).multiplyScalar(0.5).toArray(v,0);p.toArray(v,12);p.add(a).toArray(v,3);p.add(b).toArray(v,6);p.sub(a).toArray(v,9);g.addAttribute("position",new THREE.Float32BufferAttribute(v,3));this._gizmoPlane=new THREE.Line(g,new THREE.LineBasicMaterial({color:0xFFFFFF,transparent:true,linewidth:window.devicePixelRatio}));var c=144,e=window.devicePixelRatio*0.5,f=32,h=6,t=48;d=this._plane.normal.clone().multiplyScalar(1/c);var j=0xFF<<(8*(2-i));var k=new THREE.CylinderBufferGeometry(e,e,c-f,4);var m=new THREE.Matrix4().makeBasis(new THREE.Vector3(d.y,d.z,d.x),d,new THREE.Vector3(d.z,d.x,d.y));m.setPosition(d.clone().multiplyScalar((c-f)*0.5));k.applyMatrix(m);this._gizmoArrow=new THREE.Mesh(k,new THREE.MeshBasicMaterial({color:j}));this._gizmoArrow.userData.color=j;var n=new THREE.CylinderBufferGeometry(0,h,f,12,1);m.setPosition(d.clone().multiplyScalar(c-f*0.5));n.applyMatrix(m);var o=new THREE.Mesh(n,new THREE.MeshBasicMaterial({color:j}));o.matrixAutoUpdate=false;this._gizmoArrow.add(o);var r=new THREE.CylinderGeometry(t*0.5,t*0.5,c,12,1);m.setPosition(d.clone().multiplyScalar(c*0.5));r.applyMatrix(m);this._touchMesh=new THREE.Mesh(r,new THREE.MeshBasicMaterial({visible:false,side:THREE.DoubleSide}));this._gizmoArrow.add(this._touchMesh);if(this._viewport){this._viewport.setShouldRenderFrame();}return this;};
C.prototype.setFlip=function(f){this._flip=!!f;this.setAxis(this._axis);return this;};
C.prototype.getTouchObject=function(){return this._touchMesh;};
C.prototype._setOffset=function(o){var b=this._viewport._scene._computeBoundingBox();o=THREE.Math.clamp(o,b.min.getComponent(this._axis),b.max.getComponent(this._axis));this._position.setComponent(this._axis,o);this._plane.constant=-this._plane.normal.dot(this._position);this._viewport.setShouldRenderFrame();};
C.prototype.highlightArrowHandle=function(h){var c=h?0xFFFF00:this._gizmoArrow.userData.color;this._gizmoArrow.material.color.setHex(c);this._gizmoArrow.children[0].material.color.setHex(c);};
C.prototype._adjustBoundingBox=function(b){var s=b.getSize();var d=Math.max(s.x,s.y,s.z)*0.2;b.expandByScalar(d);};
C.prototype._updateGizmo=function(b){var i=this._axis;var o=THREE.Math.clamp(this._position.getComponent(i),b.min.getComponent(i),b.max.getComponent(i));this._position.setComponent(i,o);this._plane.constant=-this._plane.normal.dot(this._position);this._adjustBoundingBox(b);this._gizmoPlane.position.copy(b.getCenter());this._gizmoPlane.position.setComponent(i,o);this._gizmoPlane.scale.copy(b.getSize());this._gizmoPlane.updateMatrixWorld(true);var r=this._viewport.getRenderer(),c=this._viewport.getCamera().getCameraRef();this._gizmoArrow.position.copy(this._gizmoPlane.position);this._matViewProj.multiplyMatrices(c.projectionMatrix,c.matrixWorldInverse);this._pos4.copy(this._gizmoArrow.position).applyMatrix4(this._matViewProj);var s=this._gizmoSize*this._pos4.w*r.getPixelRatio()/(r.getSize().width*c.projectionMatrix.elements[0]);this._gizmoArrow.scale.setScalar(s);this._gizmoArrow.updateMatrixWorld(true);};
C.prototype.expandBoundingBox=function(b){if(this._viewport){var s=this._viewport._scene._computeBoundingBox();this._updateGizmo(s);b.min.min(s.min);b.max.max(s.max);b.expandByPoint(this._plane.normal.clone().multiply(this._gizmoArrow.scale).add(this._gizmoArrow.position));}};
C.prototype.render=function(){var s=this._viewport._scene._computeBoundingBox();this._updateGizmo(s);var r=this._viewport.getRenderer(),c=this._viewport.getCamera().getCameraRef();r.render(this._gizmoPlane,c);r.clearDepth();r.render(this._gizmoArrow,c);};
C.prototype.onBeforeRendering=function(){};
C.prototype.onAfterRendering=function(){};
return C;},true);
sap.ui.predefine('sap/ui/vk/tools/CrossSectionToolHandler',["jquery.sap.global","sap/ui/base/EventProvider"],function(q,E){"use strict";
var C=E.extend("sap.ui.vk.tools.CrossSectionToolHandler",{
metadata:{},
constructor:function(t){this._tool=t;this._gizmo=t.getGizmo();this._rect=null;this._mouse=new THREE.Vector2();this._rayCaster=new THREE.Raycaster();this._rayCaster.linePrecision=0;this._gizmoOrigin=new THREE.Vector3();this._gizmoAxis=new THREE.Vector3();}
});
C.prototype.destroy=function(){this._tool=null;this._gizmo=null;this._rect=null;this._rayCaster=null;this._gizmoAxis=null;this._gizmoOrigin=null;this._mouse=null;};
C.prototype._updateRayCaster=function(e){var s=this.getViewport().getRenderer().getSize();this._mouse.x=((e.x-this._rect.x)/s.width)*2-1;this._mouse.y=((e.y-this._rect.y)/s.height)*-2+1;this._rayCaster.setFromCamera(this._mouse,this.getViewport().getCamera().getCameraRef());};
C.prototype._updateArrowHandle=function(e){var t=this._gizmo.getTouchObject();var i=this._rayCaster.intersectObject(t,true);var a=i.length>0?this._gizmo.getAxis():-1;if(a!==this._axisIndex){this._axisIndex=a;this._gizmo.highlightArrowHandle(a>=0);if(a>=0){this._gizmoOrigin.setFromMatrixPosition(t.matrixWorld);this._gizmoAxis.setScalar(0).setComponent(this._axisIndex,1);}this.getViewport().setShouldRenderFrame();}};
C.prototype._getAxisOffset=function(){var r=this._rayCaster.ray;var d=this._gizmoAxis.clone().cross(r.direction).cross(r.direction).normalize();var a=r.origin.clone().sub(this._gizmoOrigin);return d.dot(a)/d.dot(this._gizmoAxis);};
C.prototype.hover=function(e){if(this._inside(e)&&!this._gesture&&e.n===1){this._updateRayCaster(e);this._updateArrowHandle(e);}};
C.prototype.beginGesture=function(e){if(this._inside(e)&&!this._gesture&&e.n===1){this._updateRayCaster(e);this._updateArrowHandle(e);if(this._axisIndex>=0&&e.n===1){this._gesture=true;e.handled=true;this._dragOrigin=this._getAxisOffset()-this._gizmo._getOffset();}}};
C.prototype.move=function(e){if(this._gesture){e.handled=true;this._updateRayCaster(e);if(!isNaN(this._dragOrigin)){this._gizmo._setOffset(this._getAxisOffset()-this._dragOrigin);}}};
C.prototype.endGesture=function(e){if(this._gesture){this._gesture=false;e.handled=true;this._updateRayCaster(e);this._updateArrowHandle(e);}};
C.prototype.click=function(e){};
C.prototype.doubleClick=function(e){};
C.prototype.contextMenu=function(e){};
C.prototype.getViewport=function(){return this._tool._viewport;};
C.prototype._getOffset=function(o){var r=o.getBoundingClientRect();var p={x:r.left+window.pageXOffset,y:r.top+window.pageYOffset};return p;};
C.prototype._inside=function(e){if(this._rect===null||true){var i=this._tool._viewport.getIdForLabel();var d=document.getElementById(i);if(d===null){return false;}var o=this._getOffset(d);this._rect={x:o.x,y:o.y,w:d.offsetWidth,h:d.offsetHeight};}return(e.x>=this._rect.x&&e.x<=this._rect.x+this._rect.w&&e.y>=this._rect.y&&e.y<=this._rect.y+this._rect.h);};
return C;},true);
sap.ui.predefine('sap/ui/vk/tools/Gizmo',["jquery.sap.global","./library","sap/ui/core/Control"],function(q,a,C){"use strict";
var G=C.extend("sap.ui.vk.tools.Gizmo",{metadata:{library:"sap.ui.vk.tools"}});
G.prototype.hasDomElement=function(){return true;};
G.prototype._createAxisTitles=function(s,f,d){s=s||32;f=f||20;function c(t,b){var e=document.createElement("canvas");e.width=e.height=s*window.devicePixelRatio;var h=e.getContext("2d");var i=e.width*0.5;h.font="Bold "+f*window.devicePixelRatio+"px Arial";h.textAlign="center";h.textBaseline="middle";h.fillStyle="#000";h.globalAlpha=0.5;h.filter="blur(3px)";h.fillText(t,i+1,i+1);h.fillStyle="#fff";h.globalAlpha=1;h.filter="blur(0px)";h.fillText(t,i,i);if(d){h.beginPath();h.arc(i,i,i-window.devicePixelRatio,0,2*Math.PI,false);h.closePath();h.lineWidth=window.devicePixelRatio*2;h.strokeStyle="#fff";h.stroke();}var j=new THREE.Texture(e);j.needsUpdate=true;var m=new THREE.MeshBasicMaterial({map:j,color:b,transparent:true,alphaTest:0.05,premultipliedAlpha:true,side:THREE.DoubleSide});var k=new THREE.Mesh(new THREE.PlaneGeometry(s,s),m);k.userData.color=b;return k;}var g=new THREE.Group();g.add(c("X",0xFF0000));g.add(c("Y",0x00FF00));g.add(c("Z",0x0000FF));return g;};
G.prototype._extractBasis=function(m){var b=[new THREE.Vector3(),new THREE.Vector3(),new THREE.Vector3()];m.extractBasis(b[0],b[1],b[2]);b[0].normalize();b[1].normalize();b[2].normalize();return b;};
G.prototype._updateAxisTitles=function(o,g,c,d,s){var b=this._extractBasis(g.matrixWorld);o.children.forEach(function(e,i){e.position.copy(b[i]).multiplyScalar(d.constructor===THREE.Vector3?d.getComponent(i):d);e.quaternion.copy(c.quaternion);});o.position.copy(g.position);o.scale.setScalar(s);};
G.prototype._updateSelection=function(b){var n=[];b.enumerateSelection(function(c){n.push({node:c});});if(this._nodes.length===n.length&&this._nodes.every(function(v,i){return n[i].node===v.node;})){return false;}this._nodes=n;n.forEach(function(c){c.ignore=false;var p=c.node.parent;while(p&&!c.ignore){for(var i=0,l=n.length;i<l;i++){if(n[i].node===p){c.ignore=true;break;}}p=p.parent;}});return true;};
G.prototype._updateGizmoObjectTransformation=function(o,i){var r=this._viewport.getRenderer(),c=this._viewport.getCamera().getCameraRef();var p,s;if(this._coordinateSystem===sap.ui.vk.tools.CoordinateSystem.Local){var n=this._nodes[i].node;o.matrixAutoUpdate=false;n.matrixWorld.decompose(o.position,o.quaternion,o.scale);p=new THREE.Vector4().copy(o.position).applyMatrix4(this._matViewProj);s=p.w*r.getPixelRatio()/(r.getSize().width*c.projectionMatrix.elements[0]);var b=this._extractBasis(n.matrixWorld);o.matrix.makeBasis(b[0],b[1],b[2]);o.matrix.scale(new THREE.Vector3().setScalar(this._gizmoSize*s));o.matrix.copyPosition(n.matrixWorld);}else if(this._nodes.length>0){o.matrixAutoUpdate=true;if(this._nodes.length===1){o.position.setFromMatrixPosition(this._nodes[0].node.matrixWorld);}else{o.position.setScalar(0);this._nodes.forEach(function(d){var n=d.node;if(n.userData.boundingBox){o.position.add(n.userData.boundingBox.getCenter().applyMatrix4(n.matrixWorld));}else{o.position.add(new THREE.Vector3().setFromMatrixPosition(n.matrixWorld));}});o.position.multiplyScalar(1/this._nodes.length);}if(this._coordinateSystem===sap.ui.vk.tools.CoordinateSystem.Screen){o.quaternion.copy(c.quaternion);}else if(this._coordinateSystem===sap.ui.vk.tools.CoordinateSystem.World){o.quaternion.set(0,0,0,1);}p=new THREE.Vector4().copy(o.position).applyMatrix4(this._matViewProj);s=p.w*r.getPixelRatio()/(r.getSize().width*c.projectionMatrix.elements[0]);o.scale.setScalar(this._gizmoSize*s);}o.updateMatrixWorld(true);return s;};
G.prototype._expandBoundingBox=function(b,c){var g=this.getGizmoCount();if(g>0){this._matViewProj.multiplyMatrices(c.projectionMatrix,c.matrixWorldInverse);for(var i=0;i<g;i++){this._updateGizmoTransformation(i,c);this._sceneGizmo._expandBoundingBox(b,true);}}};
return G;},true);
sap.ui.predefine('sap/ui/vk/tools/HitTestTool',["jquery.sap.global","./Tool","./HitTestToolHandler"],function(q,T,H){"use strict";
var a=T.extend("sap.ui.vk.tools.HitTestTool",{
metadata:{properties:{IdMode:{type:"sap.ui.vk.tools.HitTestIdMode",defaultValue:sap.ui.vk.tools.HitTestIdMode.ThreeJS}},events:{hit:{parameters:{id:"any",object:"any",point:"any",clickType:"sap.ui.vk.tools.HitTestClickType"}}}},
constructor:function(i,s){if(a._instance){return a._instance;}T.apply(this,arguments);this.setToolid("63150593-75f6-c330-2a7a-c1f85d36b2b9");this._viewport=null;this._handler=null;this._loco=null;a._instance=this;}
});
a.prototype.init=function(){if(T.prototype.init){T.prototype.init.call(this);}this.setFootprint(["sap.ui.vk.threejs.Viewport"]);};
a.prototype.setActive=function(v,b,g){if(T.prototype.setActive){T.prototype.setActive.call(this,v,b,g);}if(v){this._activateTool(b);}else{this._deactivateTool();}return this;};
a.prototype._activateTool=function(b){this._viewport=b;this._handler=new H(this);this._prepare();};
a.prototype._deactivateTool=function(){if(this._handler){this._viewport._loco.removeHandler(this._handler);}this._handler=null;};
a.prototype._prepare=function(){var o=false;if(this._viewport._loco){this._viewport._loco.addHandler(this._handler);o=true;}if(o){if(this.isViewportType("sap.ui.vk.dvl.Viewport")&&this._viewport._dvl){this._dvlRendererId=this._viewport._dvlRendererId;this._dvl=this._viewport._dvl;o=true;}else if(this.isViewportType("sap.ui.vk.threejs.Viewport")&&(this._viewport._scene&&this._viewport._scene.getSceneRef())){o=true;}}return o;};
a.prototype.queueCommand=function(c){if(this._prepare()){if(this._dvlRendererId){this._dvl.Renderer._queueCommand(c,this._dvlRendererId);}}return this;};
a.prototype.hitTest=function(x,y,s,c,b){if(this._prepare()){var h=null;if(this.isViewportType("sap.ui.vk.dvl.Viewport")&&this._viewport._dvl){return null;}else if(this.isViewportType("sap.ui.vk.threejs.Viewport")){if(!s||!c){h=null;}else if(this._viewport._renderer){var e=this._viewport._renderer.domElement;var m=new THREE.Vector2((x-e.offsetLeft)/e.clientWidth*2-1,(e.offsetTop-y)/e.clientHeight*2+1);var r=new THREE.Raycaster();r.setFromCamera(m,c.getCameraRef());var i=r.intersectObjects(s.getSceneRef().children,true);if(i&&i.length){h=i[0];}}}var d=null;if(h){var f;switch(this.getIdMode()){case sap.ui.vk.tools.HitTestIdMode.VEsID:f=this._viewport._scene.nodeRefToPersistentId(h.object);break;case sap.ui.vk.tools.HitTestIdMode.ThreeJS:f=h.object.id;break;default:f=h.object.id;break;}d={id:f,object:h.object,point:h.point,clickType:b};this.fireHit(d);}return d;}};
a.prototype.destroy=function(){T.prototype.destroy.call(this);this._viewport=null;this._handler=null;};
return a;});
sap.ui.predefine('sap/ui/vk/tools/HitTestToolHandler',["jquery.sap.global","sap/ui/base/EventProvider"],function(q,E){"use strict";
var H=E.extend("sap.ui.vk.tools.HitTestToolHandler",{
metadata:{},
constructor:function(T){this._tool=T;this._rect=null;this._gesture=false;this._nomenu=false;}
});
H.prototype.destroy=function(){this._tool=null;this._rect=null;this._gesture=false;};
H.prototype._getOffset=function(o){var r=o.getBoundingClientRect();var p={x:r.left+window.pageXOffset,y:r.top+window.pageYOffset};return p;};
H.prototype._inside=function(e){var i=this._tool._viewport.getIdForLabel();var d=document.getElementById(i);if(d==null){return false;}var o=this._getOffset(d);this._rect={x:o.x,y:o.y,w:d.offsetWidth,h:d.offsetHeight};return(e.x>=this._rect.x&&e.x<=this._rect.x+this._rect.w&&e.y>=this._rect.y&&e.y<=this._rect.y+this._rect.h);};
H.prototype.beginGesture=function(e){e.handled=false;};
H.prototype.move=function(e){e.handled=false;};
H.prototype.endGesture=function(e){e.handled=false;};
H.prototype._executeHittest=function(e,c){if(this._inside(e)&&!this._gesture){this._gesture=false;var x=e.x-this._rect.x,y=e.y-this._rect.y;this._gizmo=this._tool.getGizmo();if(this._gizmo){this._gizmo.show(this._tool._viewport);this._gizmo.moveGizmo(x,y);}var s=this._tool._viewport.getScene();var a=this._tool._viewport.getCamera();this._tool.hitTest(x,y,s,a,c);if(this._gizmo){this._gizmo.hide();}}};
H.prototype.click=function(e){this._executeHittest(e,sap.ui.vk.tools.HitTestClickType.Single);e.handled=true;};
H.prototype.doubleClick=function(e){this._executeHittest(e,sap.ui.vk.tools.HitTestClickType.Double);e.handled=false;};
H.prototype.contextMenu=function(e){this._executeHittest(e,sap.ui.vk.tools.HitTestClickType.Context);e.handled=false;};
H.prototype.getViewport=function(){return this._tool._viewport;};
return H;},true);
sap.ui.predefine('sap/ui/vk/tools/MoveTool',["jquery.sap.global","./library","./Tool","./MoveToolHandler","./MoveToolGizmo"],function(q,l,T,M,a){"use strict";
var b=T.extend("sap.ui.vk.tools.MoveTool",{
metadata:{events:{moving:{parameters:{x:"float",y:"float",z:"float"}},moved:{parameters:{x:"float",y:"float",z:"float"}}}},
constructor:function(i,s){T.apply(this,arguments);this._viewport=null;this._handler=null;this._gizmo=null;}
});
b.prototype.init=function(){if(T.prototype.init){T.prototype.init.call(this);}this.setFootprint(["sap.ui.vk.threejs.Viewport"]);this.setAggregation("gizmo",new a());};
b.prototype.isViewportType=function(t){if(this._viewport&&this._viewport.getMetadata().getName()===t){return true;}return false;};
b.prototype.setActive=function(v,c,g){if(T.prototype.setActive){T.prototype.setActive.call(this,v,c,g);}if(v){this._activateTool(c);}else{this._deactivateTool();}if(c){c.setShouldRenderFrame();}return this;};
b.prototype._activateTool=function(c){this._viewport=c;this._handler=new M(this);this._gizmo=this.getGizmo();if(this._gizmo){this._gizmo.show(c,this);}this._prepare();};
b.prototype._deactivateTool=function(){if(this._handler){if(this._viewport._loco){this._viewport._loco.removeHandler(this._handler);}this._handler=null;}if(this._gizmo){this._gizmo.hide();this._gizmo=null;}};
b.prototype._prepare=function(){var o=false;if(this._viewport._loco){this._viewport._loco.addHandler(this._handler);o=true;}return o;};
b.prototype.queueCommand=function(c){if(this._prepare()){if(this.isViewportType("sap.ui.vk.threejs.Viewport")){c();}}return this;};
b.prototype.destroy=function(){T.prototype.destroy.call(this);this._viewport=null;this._handler=null;};
b.prototype.getCoordinateSystem=function(){return this.getGizmo().getCoordinateSystem();};
b.prototype.setCoordinateSystem=function(v){this.getGizmo().setCoordinateSystem(v);if(this._viewport){this._viewport.setShouldRenderFrame();}return this;};
b.prototype.move=function(v){if(this._gizmo){this._gizmo.move(v);}if(this._viewport){this._viewport.setShouldRenderFrame();}return this;};
return b;});
sap.ui.predefine('sap/ui/vk/tools/MoveToolGizmo',["jquery.sap.global","./library","./Gizmo"],function(q,c,G){"use strict";
var M=G.extend("sap.ui.vk.tools.MoveToolGizmo",{metadata:{library:"sap.ui.vk.tools"}});
M.prototype.init=function(){if(G.prototype.init){G.prototype.init.apply(this);}this._viewport=null;this._tool=null;this._sceneGizmo=new THREE.Scene();this._gizmo=new THREE.Group();this._touchAreas=new THREE.Group();this._sceneGizmo.add(this._gizmo);this._coordinateSystem=sap.ui.vk.tools.CoordinateSystem.Local;this._nodes=[];this._matViewProj=new THREE.Matrix4();this._gizmoSize=144;this._gizmoOffset=new THREE.Vector3();function d(a,b,t){var f=144,l=window.devicePixelRatio*0.5,h=32,i=6,j=48;a.multiplyScalar(1/f);var k=new THREE.CylinderBufferGeometry(l,l,f-h,4);var m=new THREE.Matrix4().makeBasis(new THREE.Vector3(a.y,a.z,a.x),a,new THREE.Vector3(a.z,a.x,a.y));m.setPosition(a.clone().multiplyScalar((f-h)*0.5));k.applyMatrix(m);var n=new THREE.Mesh(k,new THREE.MeshBasicMaterial({color:b,transparent:true}));n.matrixAutoUpdate=false;n.userData.color=b;var o=new THREE.CylinderBufferGeometry(0,i,h,12,1);m.setPosition(a.clone().multiplyScalar(f-h*0.5));o.applyMatrix(m);var p=new THREE.Mesh(o,new THREE.MeshBasicMaterial({color:b,transparent:true}));p.matrixAutoUpdate=false;n.add(p);var r=new THREE.CylinderGeometry(j*0.5,j*0.5,j,12,1);r.applyMatrix(m);var s=new THREE.CylinderGeometry(j*0.5,j*0.2,j,12,1);m.setPosition(a.clone().multiplyScalar(f*0.5));r.merge(s,m);t.add(new THREE.Mesh(r,new THREE.MeshBasicMaterial()));return n;}function e(a,b,t){var f=new Float32Array(9);f[a]=f[b+6]=1;f[a+3]=f[b+3]=0.5;var v=new THREE.Vector3().setComponent(a,0.333);var h=new THREE.Vector3().setComponent(b,0.333);var g=new THREE.Geometry();g.vertices.push(new THREE.Vector3(),v,h,v.clone().add(h));g.faces.push(new THREE.Face3(0,2,1),new THREE.Face3(1,2,3));var m=new THREE.MeshBasicMaterial({color:0xFFFF00,opacity:0.5,transparent:true,visible:false,side:THREE.DoubleSide});var p=new THREE.Mesh(g,m);p.matrixAutoUpdate=false;p.userData.colors=f;var l=new THREE.BufferGeometry();var i=new Float32Array(9);i[a]=i[a+3]=i[b+3]=i[b+6]=0.333;l.addAttribute("position",new THREE.Float32BufferAttribute(i,3));l.addAttribute("color",new THREE.Float32BufferAttribute(f,3));var j=new THREE.Line(l,new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors,transparent:true,linewidth:window.devicePixelRatio}));j.matrixAutoUpdate=false;p.add(j);var k=new THREE.Geometry();k.vertices.push(new THREE.Vector3(),v,h,v.clone().add(h));k.faces.push(new THREE.Face3(0,1,2),new THREE.Face3(2,1,3));t.add(new THREE.Mesh(k,new THREE.MeshBasicMaterial({side:THREE.DoubleSide})));return p;}this._gizmo.add(d(new THREE.Vector3(1,0,0),0xFF0000,this._touchAreas));this._gizmo.add(d(new THREE.Vector3(0,1,0),0x00FF00,this._touchAreas));this._gizmo.add(d(new THREE.Vector3(0,0,1),0x0000FF,this._touchAreas));this._gizmo.add(e(1,2,this._touchAreas));this._gizmo.add(e(2,0,this._touchAreas));this._gizmo.add(e(0,1,this._touchAreas));this._axisTitles=this._createAxisTitles();this._sceneGizmo.add(this._axisTitles);var g=new THREE.Geometry();g.vertices.push(new THREE.Vector3(),new THREE.Vector3());this._line=new THREE.LineSegments(g,new THREE.LineBasicMaterial());this._line.frustumCulled=false;this._line.visible=false;this._gizmo.add(this._line);};
M.prototype.hasDomElement=function(){return false;};
M.prototype.getCoordinateSystem=function(){return this._coordinateSystem;};
M.prototype.setCoordinateSystem=function(a){this._coordinateSystem=a;var s=a===sap.ui.vk.tools.CoordinateSystem.Screen;var g=this._gizmo.children,t=this._touchAreas.children;g[2].visible=g[3].visible=g[4].visible=!s;t[2].visible=t[3].visible=t[4].visible=!s;this._axisTitles.children[2].visible=!s;};
M.prototype.show=function(v,t){this._viewport=v;this._tool=t;this._nodes.length=0;this._updateSelection(v._viewStateManager);};
M.prototype.hide=function(){this._viewport=null;this._tool=null;};
M.prototype.getGizmoCount=function(){if(this._coordinateSystem===sap.ui.vk.tools.CoordinateSystem.Local){return this._nodes.length;}else{return this._nodes.length>0?1:0;}};
M.prototype.getTouchObject=function(i){if(this._nodes.length===0){return null;}this._updateGizmoObjectTransformation(this._touchAreas,i);return this._touchAreas;};
M.prototype.highlightHandle=function(a,h){var i,b=[];for(i=0;i<3;i++){var d=this._gizmo.children[i];var e=(a<3?i===a:((i===(a+1)%3)||(i===(a+2)%3)));b[i]=e;var f=e?0xFFFF00:d.userData.color;d.material.color.setHex(f);d.material.opacity=(e||h)?1:0.35;d.children[0].material.color.setHex(f);d.children[0].material.opacity=(e||h)?1:0.35;}for(i=3;i<6;i++){var p=this._gizmo.children[i];p.material.visible=i===a;var g=p.children[0].geometry.attributes.color;if(i===a){g.copyArray([1,1,0,1,1,0,1,1,0]);}else{g.copyArray(p.userData.colors);}g.needsUpdate=true;p.children[0].material.opacity=(i===a||h)?1:0.35;}this._axisTitles.children.forEach(function(o,i){o.material.color.setHex(b[i]?0xFFFF00:o.userData.color);o.material.opacity=b[i]||h?1:0.35;});};
M.prototype.beginGesture=function(){this._matOrigin=this._gizmo.matrixWorld.clone();this._nodes.forEach(function(n){var a=n.node;n.matOrigin=a.matrixWorld.clone();n.originLocal=a.position.clone();n.origin=new THREE.Vector3().setFromMatrixPosition(a.matrixWorld);n.matParentInv=new THREE.Matrix4().getInverse(a.parent.matrixWorld);});};
M.prototype.endGesture=function(){this._line.visible=false;this._tool.fireMoved({x:this._gizmoOffset.x,y:this._gizmoOffset.y,z:this._gizmoOffset.z});};
M.prototype._setOffset=function(o,g){if(this._coordinateSystem===sap.ui.vk.tools.CoordinateSystem.Local){var n=this._nodes[g];var m=new THREE.Matrix4().getInverse(n.node.matrixWorld);var s=new THREE.Vector3().setFromMatrixScale(n.node.matrixWorld);var a=n.origin.clone().applyMatrix4(m);o=n.origin.clone().add(o).applyMatrix4(m).sub(a).multiply(s);}else if(this._coordinateSystem===sap.ui.vk.tools.CoordinateSystem.Screen){var b=this._viewport.getRenderer().getSize();var p=this._gizmo.position.clone().applyMatrix4(this._matViewProj);var d=this._gizmo.position.clone().add(o).applyMatrix4(this._matViewProj);o.set(Math.round((d.x-p.x)*0.5*b.width),Math.round((d.y-p.y)*0.5*b.height),0);}if(this._tool.fireEvent("moving",{x:o.x,y:o.y,z:o.z},true)){this._move(o);if(this._coordinateSystem===sap.ui.vk.tools.CoordinateSystem.Screen){o.set(new THREE.Vector3().setFromMatrixColumn(this._matOrigin,0).normalize().dot(o),new THREE.Vector3().setFromMatrixColumn(this._matOrigin,1).normalize().dot(o),0);}this._line.geometry.vertices[0].setScalar(0).sub(o);this._line.geometry.verticesNeedUpdate=true;this._line.geometry.computeBoundingBox();o.set(Math.abs(o.x),Math.abs(o.y),Math.abs(o.z));o.multiplyScalar(1/Math.max(o.x,o.y,o.z));this._line.material.color.setRGB(o.x,o.y,o.z);this._line.visible=true;}};
M.prototype._move=function(o){this._gizmoOffset.copy(o);if(this._coordinateSystem===sap.ui.vk.tools.CoordinateSystem.Local){this._nodes.forEach(function(n){var f=n.node;var g=this._extractBasis(f.matrixWorld);var p=n.origin.clone();p.add(g[0].multiplyScalar(o.x)).add(g[1].multiplyScalar(o.y)).add(g[2].multiplyScalar(o.z));f.matrixWorld.setPosition(p);f.matrix.multiplyMatrices(n.matParentInv,f.matrixWorld);f.position.setFromMatrixPosition(f.matrix);}.bind(this));this._viewport._updateBoundingBoxesIfNeeded();}else{if(this._coordinateSystem===sap.ui.vk.tools.CoordinateSystem.Screen){var s=this._viewport.getRenderer().getSize();var a=this._viewport.getCamera().getCameraRef();var b=new THREE.Vector4().copy(this._gizmo.position).applyMatrix4(this._matViewProj);var d=o.x*2*b.w/(a.projectionMatrix.elements[0]*s.width);var e=o.y*2*b.w/(a.projectionMatrix.elements[5]*s.height);o.setFromMatrixColumn(a.matrixWorld,0).multiplyScalar(d);o.add(new THREE.Vector3().setFromMatrixColumn(a.matrixWorld,1).multiplyScalar(e));}this._gizmo.position.setFromMatrixPosition(this._matOrigin).add(o);this._nodes.forEach(function(n){if(!n.ignore){var f=n.node;f.matrixWorld.setPosition(n.origin.clone().add(o));f.matrix.multiplyMatrices(n.matParentInv,f.matrixWorld);f.position.setFromMatrixPosition(f.matrix);}});}this._viewport.setShouldRenderFrame();};
M.prototype.move=function(o){this.beginGesture();this._move(new THREE.Vector3(o.x,o.y,o.z||0));};
M.prototype.expandBoundingBox=function(b){if(this._viewport){this._expandBoundingBox(b,this._viewport.getCamera().getCameraRef());}};
M.prototype.handleSelectionChanged=function(e){if(this._viewport){this._updateSelection(this._viewport._viewStateManager);}};
M.prototype._updateGizmoTransformation=function(i,a){var s=this._updateGizmoObjectTransformation(this._gizmo,i);this._updateAxisTitles(this._axisTitles,this._gizmo,a,this._gizmoSize+18,s);this._line.scale.setScalar(1/(this._gizmoSize*s));};
M.prototype.render=function(){if(this._nodes.length>0){var r=this._viewport.getRenderer(),a=this._viewport.getCamera().getCameraRef();this._matViewProj.multiplyMatrices(a.projectionMatrix,a.matrixWorldInverse);r.clearDepth();for(var i=0,l=this.getGizmoCount();i<l;i++){this._updateGizmoTransformation(i,a);r.render(this._sceneGizmo,a);}}};
M.prototype.onBeforeRendering=function(){};
M.prototype.onAfterRendering=function(){};
return M;},true);
sap.ui.predefine('sap/ui/vk/tools/RectSelectTool',["jquery.sap.global","./library","./Tool","./RectSelectToolHandler","sap/ui/vk/Loco"],function(q,a,T,R,L){"use strict";
var b=T.extend("sap.ui.vk.tools.RectSelectTool",{
metadata:{properties:{subtractMode:{type:"boolean",defaultValue:false}}},
constructor:function(i,s){if(b._instance){return b._instance;}T.apply(this,arguments);this._viewport=null;this._handler=new R(this);this._loco=null;b._instance=this;}
});
b.prototype.init=function(){if(T.prototype.init){T.prototype.init.call(this);}this.setFootprint(["sap.ui.vk.dvl.Viewport","sap.ui.vk.threejs.Viewport"]);};
b.prototype.setActive=function(v,d,g){if(d&&d.getImplementation){d=d.getImplementation();}if(T.prototype.setActive){T.prototype.setActive.call(this,v,d,g);}if(v){this._activateTool(d);}else{this._deactivateTool();}if(d){d.setShouldRenderFrame();}return this;};
b.prototype._activateTool=function(d){this._viewport=d;if(this._prepare()){this._handler.activate(d);}};
b.prototype._deactivateTool=function(){this._handler.deactivate();};
b.prototype._prepare=function(){if(this.isViewportType("sap.ui.vk.dvl.Viewport")&&this._viewport._dvl){return true;}else if(this.isViewportType("sap.ui.vk.threejs.Viewport")&&this._viewport._scene&&this._viewport._scene.getSceneRef()){return true;}else{return false;}};
b.prototype.queueCommand=function(d){if(this._prepare()){if(this.isViewportType("sap.ui.vk.threejs.Viewport")){d();}}return this;};
function c(d,e,v){var m=d.elements;var i=m[15]===1;var r=2/m[0];var t=2/m[5];var f,g;if(i){f=-m[12]*r;g=-m[13]*t;}else{f=m[8]*r;g=m[9]*t;}var h=(r+f)*0.5;var l=f-h;var j=(t+g)*0.5;var k=g-j;var n=THREE.Math.lerp(l,h,Math.min(e.x1,e.x2)/v.width);var o=THREE.Math.lerp(l,h,Math.max(e.x1,e.x2)/v.width);var p=THREE.Math.lerp(j,k,Math.min(e.y1,e.y2)/v.height);var s=THREE.Math.lerp(j,k,Math.max(e.y1,e.y2)/v.height);m[0]=2/(o-n);m[5]=2/(p-s);if(i){m[12]=-(o+n)/(o-n);m[13]=-(p+s)/(p-s);}else{m[8]=(o+n)/(o-n);m[9]=(p+s)/(p-s);}}
b.prototype.select=function(x,y,d,e,s,f){var n=[];if(!this._prepare()){return n;}if(this.isViewportType("sap.ui.vk.dvl.Viewport")){n=this._viewport.rectSelect(x,y,d,e);if(n.length>0){var p={picked:n};this._viewport.fireNodesPicked(p);if(this.getSubtractMode()){this._viewport._viewStateManager.setSelectionStates([],n);}else{this._viewport._viewStateManager.setSelectionStates(n,[]);}}return n;}var g=s?s.getSceneRef():undefined;var h=f?f.getCameraRef():undefined;var v=this._viewport._getViewStateManagerThreeJS();if(!h||!g||!v||x===d||y===e){return n;}var r={x1:x,y1:y,x2:d,y2:e};var m=h.projectionMatrix.clone();c(m,r,this._viewport._renderer.getSize());var j=new THREE.Matrix4().multiplyMatrices(m,h.matrixWorldInverse);var k=new THREE.Frustum().setFromMatrix(j);var o=new THREE.Vector3();function t(z){var A=z.geometry;if(A!==undefined&&k.intersectsObject(z)){var i,l=0;if(A.isGeometry){var B=A.vertices;for(i=0,l=B.length;i<l;i++){o.copy(B[i]).applyMatrix4(z.matrixWorld);if(!k.containsPoint(o)){break;}}}else if(A.isBufferGeometry){var C=A.attributes.position;if(C!==undefined){for(i=0,l=C.count;i<l;i++){o.fromBufferAttribute(C,i).applyMatrix4(z.matrixWorld);if(!k.containsPoint(o)){break;}}}}return l>0&&i===l;}return false;}function u(l){if(l.visible===false){return;}var z=0,A=0;if(l.geometry!==undefined){z++;if(t(l)){A++;}}var B=l.children;if(B.length>0){for(var i=0;i<B.length;i++){var C=B[i];if(C.geometry!==undefined&&!C.name&&C.children.length===0){if(C.visible===true){z++;if(t(C)){A++;}}}else{u(C);}}}if(A>0&&z===A){n.push(l);}}u(g);if(n.length>0){var w={picked:n};this._viewport.fireNodesPicked(w);if(this.getSubtractMode()){v.setSelectionStates([],n);}else{v.setSelectionStates(n,[]);}}return n;};
b.prototype.destroy=function(){T.prototype.destroy.call(this);this._viewport=null;this._handler=null;};
return b;});
sap.ui.predefine('sap/ui/vk/tools/RotateOrbitTool',["jquery.sap.global","./library","./Tool","sap/ui/vk/helpers/RotateOrbitHelperDvl","sap/ui/vk/helpers/RotateOrbitHelperThree"],function(q,l,T,R,a){"use strict";
var b=T.extend("sap.ui.vk.tools.RotateOrbitTool",{
metadata:{events:{rotate:{parameters:{dx:"int",dy:"int"}}}},
constructor:function(i,s){if(b._instance){return b._instance;}T.apply(this,arguments);this.setToolid("1a1fced1-9b42-d7f3-5fdf-8d338b3591a6");this._viewport=null;this._rotateOrbitHelper=null;b._instance=this;}
});
b.prototype.init=function(){if(T.prototype.init){T.prototype.init.call(this);}this.setFootprint(["sap.ui.vk.dvl.Viewport","sap.ui.vk.threejs.Viewport"]);};
b.prototype.setActive=function(v,c,g){if(c&&c.getImplementation){c=c.getImplementation();}if(T.prototype.setActive){T.prototype.setActive.call(this,v,c,g);}if(v){this._activateTool(c);}else{this._deactivateTool();}return this;};
b.prototype._activateTool=function(c){this._viewport=c;if(this._prepare()){this._rotateOrbitHelper.activateOrbitMode();}};
b.prototype._deactivateTool=function(){if(this._rotateOrbitHelper){this._rotateOrbitHelper.deactivateOrbitMode();this._rotateOrbitHelper=null;}};
b.prototype._prepare=function(){if(this.isViewportType("sap.ui.vk.dvl.Viewport")&&this._viewport._dvl){if(this._rotateOrbitHelper==null){this._dvlRendererId=this._viewport._dvlRendererId;this._dvl=this._viewport._dvl;this._rotateOrbitHelper=new R(this,this._dvl);}}else if(this.isViewportType("sap.ui.vk.threejs.Viewport")){if(this._rotateOrbitHelper==null){this._rotateOrbitHelper=new a(this);}}else{return false;}return true;};
b.prototype.rotate=function(d,c){if(this._prepare()){this._rotateOrbitHelper.rotate(d,c);}};
b.prototype.destroy=function(){T.prototype.destroy.call(this);this._viewport=null;this._rotateOrbitHelper=null;};
return b;});
sap.ui.predefine('sap/ui/vk/tools/RotateTool',["jquery.sap.global","./library","./Tool","./RotateToolHandler","./RotateToolGizmo"],function(q,l,T,R,a){"use strict";
var b=T.extend("sap.ui.vk.tools.RotateTool",{
metadata:{events:{rotating:{parameters:{x:"float",y:"float",z:"float"}},rotated:{parameters:{x:"float",y:"float",z:"float"}}}},
constructor:function(i,s){T.apply(this,arguments);this._viewport=null;this._handler=null;this._gizmo=null;}
});
b.prototype.init=function(){if(T.prototype.init){T.prototype.init.call(this);}this.setFootprint(["sap.ui.vk.threejs.Viewport"]);this.setAggregation("gizmo",new a());};
b.prototype.isViewportType=function(t){if(this._viewport&&this._viewport.getMetadata().getName()===t){return true;}return false;};
b.prototype.setActive=function(v,c,g){if(T.prototype.setActive){T.prototype.setActive.call(this,v,c,g);}if(v){this._activateTool(c);}else{this._deactivateTool();}if(c){c.setShouldRenderFrame();}return this;};
b.prototype._activateTool=function(c){this._viewport=c;this._handler=new R(this);this._gizmo=this.getGizmo();if(this._gizmo){this._gizmo.show(c,this);}this._prepare();};
b.prototype._deactivateTool=function(){if(this._handler){if(this._viewport._loco){this._viewport._loco.removeHandler(this._handler);}this._handler=null;}if(this._gizmo){this._gizmo.hide();this._gizmo=null;}};
b.prototype._prepare=function(){var o=false;if(this._viewport._loco){this._viewport._loco.addHandler(this._handler);o=true;}return o;};
b.prototype.queueCommand=function(c){if(this._prepare()){if(this.isViewportType("sap.ui.vk.threejs.Viewport")){c();}}return this;};
b.prototype.destroy=function(){T.prototype.destroy.call(this);this._viewport=null;this._handler=null;};
b.prototype.getCoordinateSystem=function(){return this.getGizmo().getCoordinateSystem();};
b.prototype.setCoordinateSystem=function(v){this.getGizmo().setCoordinateSystem(v);if(this._viewport){this._viewport.setShouldRenderFrame();}return this;};
b.prototype.rotate=function(v){if(this._gizmo){this._gizmo.rotate(v);}if(this._viewport){this._viewport.setShouldRenderFrame();}return this;};
return b;});
sap.ui.predefine('sap/ui/vk/tools/RotateToolGizmo',["jquery.sap.global","./library","./Gizmo"],function(q,b,G){"use strict";
var R=G.extend("sap.ui.vk.tools.RotateToolGizmo",{metadata:{library:"sap.ui.vk.tools"}});
R.prototype.init=function(){if(G.prototype.init){G.prototype.init.apply(this);}this._viewport=null;this._tool=null;this._sceneGizmo=new THREE.Scene();this._gizmo=new THREE.Group();this._touchAreas=new THREE.Group();this._sceneGizmo.add(this._gizmo);this._coordinateSystem=sap.ui.vk.tools.CoordinateSystem.Local;this._nodes=[];this._matViewProj=new THREE.Matrix4();this._gizmoSize=144;this._gizmoRotation=new THREE.Vector3();function c(e,f,r,s){var g=new THREE.TorusBufferGeometry(r,window.devicePixelRatio/288,4,s);if(e===0){g.rotateY(Math.PI/2);}else if(e===1){g.rotateX(Math.PI/2);}var h=new THREE.Mesh(g,new THREE.MeshBasicMaterial({color:f,transparent:true}));h.matrixAutoUpdate=false;h.userData.color=f;return h;}function a(e,r,s){var g=new THREE.TorusBufferGeometry(r,24/144,4,s);if(e===0){g.rotateY(Math.PI/2);}else if(e===1){g.rotateX(Math.PI/2);}return new THREE.Mesh(g,new THREE.MeshBasicMaterial({opacity:0.2,transparent:true}));}for(var i=0;i<3;i++){this._gizmo.add(c(i,0xFF<<8*(2-i),1,128));this._touchAreas.add(a(i,1,24));}this._gizmo.add(new THREE.AxisHelper(0.75));var d=new THREE.MeshBasicMaterial({color:0x0080FF,opacity:0.5,transparent:true,side:THREE.DoubleSide});this._arcMesh=new THREE.Mesh(new THREE.Geometry(),d);this._arcMesh.drawMode=THREE.TriangleFanDrawMode;this._arcMesh.visible=false;this._gizmo.add(this._arcMesh);this._axisTitles=this._createAxisTitles();this._sceneGizmo.add(this._axisTitles);};
R.prototype.hasDomElement=function(){return false;};
R.prototype.getCoordinateSystem=function(){return this._coordinateSystem;};
R.prototype.setCoordinateSystem=function(c){this._coordinateSystem=c;var s=c===sap.ui.vk.tools.CoordinateSystem.Screen;this._gizmo.children[0].visible=this._gizmo.children[1].visible=!s;this._touchAreas.children[0].visible=this._touchAreas.children[1].visible=!s;this._axisTitles.visible=!s;};
R.prototype.show=function(v,t){this._viewport=v;this._tool=t;this._nodes.length=0;this._updateSelection(v._viewStateManager);};
R.prototype.hide=function(){this._viewport=null;this._tool=null;};
R.prototype.getGizmoCount=function(){if(this._coordinateSystem===sap.ui.vk.tools.CoordinateSystem.Local){return this._nodes.length;}else{return this._nodes.length>0?1:0;}};
R.prototype.getTouchObject=function(i){if(this._nodes.length===0){return null;}this._updateGizmoObjectTransformation(this._touchAreas,i);return this._touchAreas;};
R.prototype.getGizmoObject=function(){return this._nodes.length>0?this._gizmo:null;};
R.prototype.highlightHandle=function(a,h){for(var i=0;i<3;i++){var c=this._gizmo.children[i];var d=i===a?0xFFFF00:c.userData.color;c.material.color.setHex(d);c.material.opacity=a===-1||i===a?1:0.35;c.material.visible=h||i===a;}this._axisTitles.children.forEach(function(o,i){o.material.color.setHex(i===a?0xFFFF00:o.userData.color);o.material.opacity=a===-1||i===a?1:0.35;o.material.visible=h||i===a;});};
R.prototype.beginGesture=function(){this._matOrigin=this._gizmo.matrixWorld.clone();this._nodes.forEach(function(n){n.node.parent.updateMatrixWorld(true);n.matOrigin=n.node.matrixWorld.clone();n.matLocalOrigin=n.node.matrix.clone();n.matParentInv=new THREE.Matrix4().getInverse(n.node.parent.matrixWorld);n.quaternion=n.node.quaternion.clone();});};
R.prototype.endGesture=function(){this._arcMesh.visible=false;this._tool.fireRotated({x:this._gizmoRotation.x,y:this._gizmoRotation.y,z:this._gizmoRotation.z});};
R.prototype._rotate=function(e){this._gizmoRotation.set(THREE.Math.radToDeg(e.x),THREE.Math.radToDeg(e.y),THREE.Math.radToDeg(e.z));var a=new THREE.Quaternion();if(this._coordinateSystem===sap.ui.vk.tools.CoordinateSystem.Local){a.setFromEuler(e);this._nodes.forEach(function(h){h.node.quaternion.copy(h.quaternion).multiply(a);h.node.matrixWorldNeedsUpdate=true;});this._viewport._updateBoundingBoxesIfNeeded();}else{e=e.toArray();for(var i=0;i<3;i++){var c=e[i];if(c){var d=e[3].charCodeAt(i)-88;if(d>=0&&d<3){var f=new THREE.Vector3().setFromMatrixColumn(this._matOrigin,d).normalize();var m=new THREE.Matrix4().makeRotationAxis(f,c);var p=new THREE.Vector3().setFromMatrixPosition(this._matOrigin);m.setPosition(p.sub(p.clone().applyMatrix4(m)));for(var n=0,g=this._nodes.length;n<g;n++){var h=this._nodes[n];if(!h.ignore){var j=h.node;j.position.setFromMatrixPosition(h.matOrigin).applyMatrix4(m).applyMatrix4(h.matParentInv);var s=new THREE.Vector3().setFromMatrixScale(h.matOrigin);var l=f.clone().transformDirection(new THREE.Matrix4().getInverse(h.matOrigin)).multiply(s).normalize();a.setFromAxisAngle(l,c);j.quaternion.copy(h.quaternion).multiply(a);j.matrixWorldNeedsUpdate=true;}}}}}}this._viewport.setShouldRenderFrame();};
R.prototype._setRotationAxisAngle=function(c,d,e){var f=e-d;if(Math.abs(f)>Math.PI){f-=Math.PI*2*Math.sign(f);}var g=[0,0,0];g[c]=f;g=new THREE.Euler().fromArray(g);if(this._tool.fireEvent("rotating",{x:THREE.Math.radToDeg(g.x),y:THREE.Math.radToDeg(g.y),z:THREE.Math.radToDeg(g.z)},true)){this._rotate(g);var v=[0,0,0];var h=new THREE.Vector3();var j=(c+1)%3,k=(c+2)%3;var n=Math.max(Math.ceil(Math.abs(f)*64/Math.PI),1);f*=this._coordinateSystem===sap.ui.vk.tools.CoordinateSystem.Local?-1:1;for(var i=0;i<=n;i++){var a=d+f*(i/n);h.set(0,0,0).setComponent(j,Math.cos(a)).setComponent(k,Math.sin(a));v.push(h.x,h.y,h.z);}this._arcMesh.geometry=new THREE.BufferGeometry().addAttribute("position",new THREE.Float32BufferAttribute(v,3));this._arcMesh.visible=true;}};
R.prototype.rotate=function(a){this.beginGesture();this._rotate(new THREE.Euler(THREE.Math.degToRad(a.x||0),THREE.Math.degToRad(a.y||0),THREE.Math.degToRad(a.z||0)));};
R.prototype.expandBoundingBox=function(a){if(this._viewport){this._expandBoundingBox(a,this._viewport.getCamera().getCameraRef());}};
R.prototype.handleSelectionChanged=function(e){if(this._viewport){this._updateSelection(this._viewport._viewStateManager);}};
R.prototype._updateGizmoTransformation=function(i,c){var s=this._updateGizmoObjectTransformation(this._gizmo,i);this._updateAxisTitles(this._axisTitles,this._gizmo,c,this._gizmoSize-18,s);};
R.prototype.render=function(){if(this._nodes.length>0){var r=this._viewport.getRenderer(),c=this._viewport.getCamera().getCameraRef();this._matViewProj.multiplyMatrices(c.projectionMatrix,c.matrixWorldInverse);r.clearDepth();for(var i=0,l=this.getGizmoCount();i<l;i++){this._updateGizmoTransformation(i,c);r.render(this._sceneGizmo,c);}}};
R.prototype.onBeforeRendering=function(){};
R.prototype.onAfterRendering=function(){};
return R;},true);
sap.ui.predefine('sap/ui/vk/tools/RotateTurntableTool',["jquery.sap.global","./library","./Tool","sap/ui/vk/helpers/RotateTurntableHelperDvl","sap/ui/vk/helpers/RotateTurntableHelperThree"],function(q,l,T,R,a){"use strict";
var b=T.extend("sap.ui.vk.tools.RotateTurntableTool",{
metadata:{events:{rotate:{parameters:{dx:"int",dy:"int"}}}},
constructor:function(i,s){if(b._instance){return b._instance;}T.apply(this,arguments);this.setToolid("f271c082-676c-adc6-167f-0d5ce602aa45");this._viewport=null;this._rotateTurntableHelper=null;b._instance=this;}
});
b.prototype.init=function(){if(T.prototype.init){T.prototype.init.call(this);}this.setFootprint(["sap.ui.vk.dvl.Viewport","sap.ui.vk.threejs.Viewport"]);};
b.prototype.setActive=function(v,c,g){if(c&&c.getImplementation){c=c.getImplementation();}if(T.prototype.setActive){T.prototype.setActive.call(this,v,c,g);}if(v){this._activateTool(c);}else{this._deactivateTool();}return this;};
b.prototype._activateTool=function(c){this._viewport=c;if(this._prepare()){this._rotateTurntableHelper.activateTurntableMode();}};
b.prototype._deactivateTool=function(){if(this._rotateTurntableHelper){this._rotateTurntableHelper.deactivateTurntableMode();this._rotateTurntableHelper=null;}};
b.prototype._prepare=function(){if(this.isViewportType("sap.ui.vk.dvl.Viewport")&&this._viewport._dvl){if(this._rotateTurntableHelper==null){this._dvlRendererId=this._viewport._dvlRendererId;this._dvl=this._viewport._dvl;this._rotateTurntableHelper=new R(this,this._dvl);}}else if(this.isViewportType("sap.ui.vk.threejs.Viewport")){if(this._rotateTurntableHelper==null){this._rotateTurntableHelper=new a(this);}}else{return false;}return true;};
b.prototype.rotate=function(d,c){if(this._prepare()){this._rotateTurntableHelper.rotate(d,c);}};
b.prototype.destroy=function(){T.prototype.destroy.call(this);this._viewport=null;this._rotateTurntableHelper=null;};
return b;});
sap.ui.predefine('sap/ui/vk/tools/ScaleTool',["jquery.sap.global","./library","./Tool","./ScaleToolHandler","./ScaleToolGizmo"],function(q,l,T,S,a){"use strict";
var b=T.extend("sap.ui.vk.tools.ScaleTool",{
metadata:{events:{scaling:{parameters:{x:"float",y:"float",z:"float"}},scaled:{parameters:{x:"float",y:"float",z:"float"}}}},
constructor:function(i,s){T.apply(this,arguments);this._viewport=null;this._handler=null;this._gizmo=null;}
});
b.prototype.init=function(){if(T.prototype.init){T.prototype.init.call(this);}this.setFootprint(["sap.ui.vk.threejs.Viewport"]);this.setAggregation("gizmo",new a());};
b.prototype.isViewportType=function(t){if(this._viewport&&this._viewport.getMetadata().getName()===t){return true;}return false;};
b.prototype.setActive=function(v,c,g){if(T.prototype.setActive){T.prototype.setActive.call(this,v,c,g);}if(v){this._activateTool(c);}else{this._deactivateTool();}if(c){c.setShouldRenderFrame();}return this;};
b.prototype._activateTool=function(c){this._viewport=c;this._handler=new S(this);this._gizmo=this.getGizmo();if(this._gizmo){this._gizmo.show(c,this);}this._prepare();};
b.prototype._deactivateTool=function(){if(this._handler){if(this._viewport._loco){this._viewport._loco.removeHandler(this._handler);}this._handler=null;}if(this._gizmo){this._gizmo.hide();this._gizmo=null;}};
b.prototype._prepare=function(){var o=false;if(this._viewport._loco){this._viewport._loco.addHandler(this._handler);o=true;}return o;};
b.prototype.queueCommand=function(c){if(this._prepare()){if(this.isViewportType("sap.ui.vk.threejs.Viewport")){c();}}return this;};
b.prototype.destroy=function(){T.prototype.destroy.call(this);this._viewport=null;this._handler=null;};
b.prototype.getNonUniformScaleEnabled=function(){return this.getGizmo().getNonUniformScaleEnabled();};
b.prototype.setNonUniformScaleEnabled=function(v){this.getGizmo().setNonUniformScaleEnabled(v);if(this._viewport){this._viewport.setShouldRenderFrame();}return this;};
b.prototype.getCoordinateSystem=function(){return this.getGizmo().getCoordinateSystem();};
b.prototype.setCoordinateSystem=function(v){this.getGizmo().setCoordinateSystem(v);if(this._viewport){this._viewport.setShouldRenderFrame();}return this;};
b.prototype.scale=function(v){if(this._gizmo){this._gizmo.scale(v);}if(this._viewport){this._viewport.setShouldRenderFrame();}return this;};
return b;});
sap.ui.predefine('sap/ui/vk/tools/ScaleToolGizmo',["jquery.sap.global","./library","./Gizmo"],function(q,c,G){"use strict";
var S=G.extend("sap.ui.vk.tools.ScaleToolGizmo",{metadata:{library:"sap.ui.vk.tools"}});
S.prototype.init=function(){if(G.prototype.init){G.prototype.init.apply(this);}this._viewport=null;this._tool=null;this._nonUniformScaleEnabled=false;this._sceneGizmo=new THREE.Scene();this._gizmo=new THREE.Group();this._touchAreas=new THREE.Group();this._sceneGizmo.add(this._gizmo);this._gizmoScale=new THREE.Vector3().setScalar(1);this._coordinateSystem=sap.ui.vk.tools.CoordinateSystem.Local;this._nodes=[];this._matViewProj=new THREE.Matrix4();this._gizmoSize=132;var d=144,e=24/d,t=48/d;function f(a,b,i){var m=new THREE.Matrix4().makeBasis(new THREE.Vector3(a.y,a.z,a.x),a,new THREE.Vector3(a.z,a.x,a.y));var j=new THREE.BoxBufferGeometry(e,e,e);j.applyMatrix(m);var k=new THREE.Mesh(j,new THREE.MeshBasicMaterial({color:b,transparent:true}));k.userData.color=b;if(a){k.position.copy(a);var l=window.devicePixelRatio*0.5/d;var n=new THREE.CylinderBufferGeometry(l,l,1,4);m.setPosition(a.clone().multiplyScalar(-0.5));n.applyMatrix(m);var o=new THREE.Mesh(n,new THREE.MeshBasicMaterial({color:b,transparent:true}));o.renderOrder=1;k.add(o);m.setPosition(a);}var p=new THREE.BoxBufferGeometry(t,t,t);p.applyMatrix(m);i.add(new THREE.Mesh(p,new THREE.MeshBasicMaterial({opacity:0.2,transparent:true})));return k;}function g(a,b,i){var l=new THREE.BufferGeometry();var v=new Float32Array(6);v[a]=v[b+3]=0.7;l.addAttribute("position",new THREE.Float32BufferAttribute(v,3));var j=new Float32Array(6);j[a]=j[b+3]=1;l.addAttribute("color",new THREE.Float32BufferAttribute(j,3));var k=new THREE.Line(l,new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors,transparent:true,linewidth:window.devicePixelRatio}));k.userData.colors=j;var m=new THREE.Geometry();var n=new THREE.Vector3().setComponent(a,0.7);var o=new THREE.Vector3().setComponent(b,0.7);m.vertices.push(new THREE.Vector3(),n,o);m.faces.push(new THREE.Face3(0,1,2));var p=new THREE.Mesh(m,new THREE.MeshBasicMaterial({color:0xFFFF00,opacity:0.5,transparent:true,side:THREE.DoubleSide,visible:false}));p.renderOrder=1;k.add(p);i.add(p.clone());return k;}this._gizmo.add(f(new THREE.Vector3(1,0,0),0xFF0000,this._touchAreas));this._gizmo.add(f(new THREE.Vector3(0,1,0),0x00FF00,this._touchAreas));this._gizmo.add(f(new THREE.Vector3(0,0,1),0x0000FF,this._touchAreas));this._gizmo.add(g(1,2,this._touchAreas));this._gizmo.add(g(2,0,this._touchAreas));this._gizmo.add(g(0,1,this._touchAreas));e-=0.1/d;var h=new THREE.MeshBasicMaterial({color:0xC0C0C0,transparent:true});this._gizmo.add(new THREE.Mesh(new THREE.BoxBufferGeometry(e,e,e),h));this._touchAreas.add(new THREE.Mesh(new THREE.BoxBufferGeometry(t,t,t),new THREE.MeshBasicMaterial()));this._axisTitles=this._createAxisTitles();this._sceneGizmo.add(this._axisTitles);this._updateGizmoPartVisibility();};
S.prototype.hasDomElement=function(){return false;};
S.prototype._updateGizmoPartVisibility=function(){var s=this._coordinateSystem===sap.ui.vk.tools.CoordinateSystem.Screen;var g=this._gizmo.children,t=this._touchAreas.children;g[2].visible=t[2].visible=!s;g[3].visible=g[4].visible=t[3].visible=t[4].visible=!s&&this._nonUniformScaleEnabled;g[5].visible=t[5].visible=this._nonUniformScaleEnabled;this._axisTitles.children[2].visible=!s;};
S.prototype.getCoordinateSystem=function(){return this._coordinateSystem;};
S.prototype.setCoordinateSystem=function(a){this._coordinateSystem=a;this._updateGizmoPartVisibility();};
S.prototype.getNonUniformScaleEnabled=function(v){return this._nonUniformScaleEnabled;};
S.prototype.setNonUniformScaleEnabled=function(v){this._nonUniformScaleEnabled=!!v;this._updateGizmoPartVisibility();};
S.prototype.show=function(v,t){this._viewport=v;this._tool=t;this._nodes.length=0;this._updateSelection(v._viewStateManager);};
S.prototype.hide=function(){this._viewport=null;this._tool=null;};
S.prototype.getGizmoCount=function(){if(this._coordinateSystem===sap.ui.vk.tools.CoordinateSystem.Local){return this._nodes.length;}else{return this._nodes.length>0?1:0;}};
S.prototype.getTouchObject=function(i){if(this._nodes.length===0){return null;}this._updateGizmoObjectTransformation(this._touchAreas,i);return this._touchAreas;};
S.prototype.highlightHandle=function(a,h){var b=(a===6)||(a>=0&&!this._nonUniformScaleEnabled);var d=[];var i,o;for(i=0;i<3;i++){o=this._gizmo.children[i];var e=b||(a<3?i===a:((i===(a+1)%3)||(i===(a+2)%3)));d[i]=e;var f=e?0xFFFF00:o.userData.color;o.material.color.setHex(f);o.children[0].material.color.setHex(f);o.children[0].material.opacity=o.material.opacity=e||h?1:0.35;}for(i=3;i<6;i++){o=this._gizmo.children[i];var g=o.geometry.attributes.color;if(b||i===a){g.copyArray([1,1,0,1,1,0]);}else{g.copyArray(o.userData.colors);}g.needsUpdate=true;o.material.opacity=h||i===a?1:0.35;o.children[0].material.visible=i===a;}this._axisTitles.children.forEach(function(o,i){o.material.color.setHex(d[i]?0xFFFF00:o.userData.color);o.material.opacity=d[i]||h?1:0.35;});o=this._gizmo.children[6];o.material.color.setHex(b?0xFFFF00:0xC0C0C0);o.material.opacity=b||h?1:0.35;};
S.prototype.beginGesture=function(){this._matOrigin=this._gizmo.matrixWorld.clone();this._nodes.forEach(function(n){n.scaleOrigin=n.node.scale.clone();n.matOrigin=n.node.matrixWorld.clone();n.matParentInv=new THREE.Matrix4().getInverse(n.node.parent.matrixWorld);});};
S.prototype.endGesture=function(){this._tool.fireScaled({x:this._gizmoScale.x,y:this._gizmoScale.y,z:this._gizmoScale.z});this._gizmoScale.setScalar(1);};
S.prototype._scale=function(s){this._gizmoScale.copy(s);if(this._coordinateSystem===sap.ui.vk.tools.CoordinateSystem.Local){this._nodes.forEach(function(n){n.node.scale.copy(n.scaleOrigin).multiply(s);n.node.matrixWorldNeedsUpdate=true;});this._viewport._updateBoundingBoxesIfNeeded();}else{var m=this._matOrigin.clone().scale(s).multiply(new THREE.Matrix4().getInverse(this._matOrigin));this._nodes.forEach(function(n){if(!n.ignore){var a=n.node;a.matrixWorld.multiplyMatrices(m,n.matOrigin);a.matrix.multiplyMatrices(n.matParentInv,a.matrixWorld);a.matrix.decompose(a.position,new THREE.Quaternion(),a.scale);a.matrixWorldNeedsUpdate=true;}});}this._viewport.setShouldRenderFrame();};
S.prototype.scale=function(s){this.beginGesture();this._scale(s);};
S.prototype._setScale=function(s){if(this._tool.fireEvent("scaling",{x:s.x,y:s.y,z:s.z},true)){this._scale(s);}};
S.prototype.expandBoundingBox=function(b){if(this._viewport){this._expandBoundingBox(b,this._viewport.getCamera().getCameraRef());}};
S.prototype.handleSelectionChanged=function(e){if(this._viewport){this._updateSelection(this._viewport._viewStateManager);}};
S.prototype._updateGizmoTransformation=function(g,a){var s=this._updateGizmoObjectTransformation(this._gizmo,g);this._updateAxisTitles(this._axisTitles,this._gizmo,a,this._gizmoSize+30,s);};
S.prototype.render=function(){if(this._nodes.length>0){var r=this._viewport.getRenderer(),a=this._viewport.getCamera().getCameraRef();this._matViewProj.multiplyMatrices(a.projectionMatrix,a.matrixWorldInverse);r.clearDepth();for(var i=0,l=this.getGizmoCount();i<l;i++){this._updateGizmoTransformation(i,a);r.render(this._sceneGizmo,a);}}};
S.prototype.onBeforeRendering=function(){};
S.prototype.onAfterRendering=function(){};
return S;},true);
sap.ui.predefine('sap/ui/vk/tools/SceneOrientationTool',["jquery.sap.global","./library","./Tool","./SceneOrientationToolHandler","./SceneOrientationToolGizmo"],function(q,l,T,S,a){"use strict";
var b=T.extend("sap.ui.vk.tools.SceneOrientationTool",{
metadata:{properties:{enablePredefinedViews:{type:"boolean",defaultValue:true},enableInitialView:{type:"boolean",defaultValue:true}}},
constructor:function(i,s){if(b._instance){return b._instance;}T.apply(this,arguments);this._viewport=null;this._handler=null;this._menu=null;b._instance=this;}
});
b.prototype.init=function(){if(T.prototype.init){T.prototype.init.call(this);}this.setFootprint(["sap.ui.vk.threejs.Viewport"]);this.setAggregation("gizmo",new a());};
b.prototype.setActive=function(v,c,g){if(T.prototype.setActive){T.prototype.setActive.call(this,v,c,g);}if(v){this._activateTool(c);}else{this._deactivateTool();}return this;};
b.prototype._activateTool=function(c){this._viewport=c;this._handler=new S(this);this._gizmo=this.getGizmo();this._prepare();};
b.prototype._deactivateTool=function(){if(this._handler){if(this._viewport._loco){this._viewport._loco.removeHandler(this._handler);}this._handler=null;}this._gizmo=null;};
b.prototype._prepare=function(){var o=false;if(this._viewport._loco){this._viewport._loco.addHandler(this._handler);o=true;}return o;};
b.prototype.setView=function(v,m){if(this._gizmo){this._gizmo.setView(v,m);}return this;};
b.prototype.queueCommand=function(c){if(this._prepare()){if(this.isViewportType("sap.ui.vk.dvl.Viewport")){if(this._dvlRendererId){this._dvl.Renderer._queueCommand(c,this._dvlRendererId);}}else if(this.isViewportType("sap.ui.vk.threejs.Viewport")){c();}}return this;};
b.prototype.destroy=function(){T.prototype.destroy.call(this);this._viewport=null;this._handler=null;};
return b;});
sap.ui.predefine('sap/ui/vk/tools/SceneOrientationToolGizmo',["jquery.sap.global","./library","./Gizmo","sap/ui/unified/Menu","sap/ui/unified/MenuItem","./SceneOrientationToolGizmoRenderer"],function(q,l,G,M,a,S){"use strict";sap.ui.require("sap.m.Menu");
var b=G.extend("sap.ui.vk.tools.SceneOrientationToolGizmo",{metadata:{library:"sap.ui.vk.tools"}});
function c(d,e){var f=64,g=0.5,h=15,i=3,j=30;d.multiplyScalar(1/80);var k=new THREE.Vector3(d.y,d.z,d.x),n=new THREE.Vector3(d.z,d.x,d.y);var o=new THREE.MeshBasicMaterial({color:e}),p=new THREE.MeshBasicMaterial({color:0xFFFFFF});var r=new THREE.CylinderBufferGeometry(g,g,f-h,4);var m=new THREE.Matrix4().makeBasis(k,d,n).setPosition(d.clone().multiplyScalar((f-h)*0.5));r.applyMatrix(m);var s=new THREE.Mesh(r,o);var t=new THREE.CylinderBufferGeometry(0,i,h,12,1);m.setPosition(d.clone().multiplyScalar(f-h*0.5));t.applyMatrix(m);s.add(new THREE.Mesh(t,o));var u=new THREE.CylinderBufferGeometry(g,g,j,4);m.makeBasis(d,n,k).setPosition(n.clone().multiplyScalar(0.5).add(d).multiplyScalar(j));u.applyMatrix(m);s.add(new THREE.Mesh(u,p));u=new THREE.CylinderBufferGeometry(g,g,j,4);m.setPosition(n.clone().multiplyScalar(0.5).add(d).add(k).multiplyScalar(j));u.applyMatrix(m);s.add(new THREE.Mesh(u,p));u=new THREE.CylinderBufferGeometry(g,g,j,4);m.makeBasis(n,k,d).setPosition(k.clone().multiplyScalar(0.5).add(d).multiplyScalar(j));u.applyMatrix(m);s.add(new THREE.Mesh(u,p));return s;}
b.prototype.init=function(){if(G.prototype.init){G.prototype.init.apply(this);}this._menu=null;this._viewport=null;this._renderer=new THREE.WebGLRenderer({antialias:true,alpha:true});this._renderer.setPixelRatio(window.devicePixelRatio);this._renderer.setSize(1,1);this._camera=new THREE.OrthographicCamera(-1,1,1,-1,0.1,100);this._scene=new THREE.Scene();this._scene.add(c(new THREE.Vector3(1,0,0),0xFF0000));this._scene.add(c(new THREE.Vector3(0,1,0),0x00FF00));this._scene.add(c(new THREE.Vector3(0,0,1),0x0000FF));this._scene.traverse(function(o){o.matrixAutoUpdate=false;});this._axisTitles=this._createAxisTitles(32,16);this._scene.add(this._axisTitles);q(document).click(function(e){if(q(".sapUiVizKitSceneOrientationGizmoButton").length){var d=q(".sapUiVizKitSceneOrientationGizmoButton .sapUiIconMirrorInRTL");if(e.target!==d[0]){this._button.setPressed(false);}}}.bind(this));this._button=new sap.m.ToggleButton({icon:"sap-icon://drop-down-list",tooltip:sap.ui.vk.getResourceBundle().getText("PREDEFINED_VIEW_MENUBUTTONTOOLTIP"),press:function(e){if(!this._menu){this.createMenu();}if(this._button.getPressed()){var d=sap.ui.core.Popup.Dock;var r=sap.ui.getCore().getConfiguration().getRTL();this._menu.open(false,this.getFocusDomRef(),r?d.LeftCenter:d.RightCenter,r?d.LeftBottom:d.RightBottom,this.getDomRef());}else{this._menu.close();}}.bind(this)}).addStyleClass("sapUiVizKitSceneOrientationGizmoButton");this._button.addStyleClass("sapUiSizeCompact");};
b.prototype.createMenu=function(){var t=1000;var m=this._menu=new M();if(this.oParent.getEnableInitialView()){m.addItem(new a({text:sap.ui.vk.getResourceBundle().getText("PREDEFINED_VIEW_INITIAL")}).attachSelect(function(){this.setView(sap.ui.vk.tools.PredefinedView.Initial,t);this._button.setPressed(false);}.bind(this)));}m.addItem(new a({text:sap.ui.vk.getResourceBundle().getText("PREDEFINED_VIEW_FRONT"),startsSection:this.oParent.getEnableInitialView()}).attachSelect(function(){this.setView(sap.ui.vk.tools.PredefinedView.Front,t);this._button.setPressed(false);}.bind(this)));m.addItem(new a({text:sap.ui.vk.getResourceBundle().getText("PREDEFINED_VIEW_BACK")}).attachSelect(function(){this.setView(sap.ui.vk.tools.PredefinedView.Back,t);this._button.setPressed(false);}.bind(this)));m.addItem(new a({text:sap.ui.vk.getResourceBundle().getText("PREDEFINED_VIEW_LEFT")}).attachSelect(function(){this.setView(sap.ui.vk.tools.PredefinedView.Left,t);this._button.setPressed(false);}.bind(this)));m.addItem(new a({text:sap.ui.vk.getResourceBundle().getText("PREDEFINED_VIEW_RIGHT")}).attachSelect(function(){this.setView(sap.ui.vk.tools.PredefinedView.Right,t);this._button.setPressed(false);}.bind(this)));m.addItem(new a({text:sap.ui.vk.getResourceBundle().getText("PREDEFINED_VIEW_TOP")}).attachSelect(function(){this.setView(sap.ui.vk.tools.PredefinedView.Top,t);this._button.setPressed(false);}.bind(this)));m.addItem(new a({text:sap.ui.vk.getResourceBundle().getText("PREDEFINED_VIEW_BOTTOM")}).attachSelect(function(){this.setView(sap.ui.vk.tools.PredefinedView.Bottom,t);this._button.setPressed(false);}.bind(this)));};
b.prototype.setView=function(v,m){var d;switch(v){case sap.ui.vk.tools.PredefinedView.Initial:d=null;break;case sap.ui.vk.tools.PredefinedView.Front:d=new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(0,1,0),0);break;case sap.ui.vk.tools.PredefinedView.Back:d=new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(0,1,0),Math.PI);break;case sap.ui.vk.tools.PredefinedView.Left:d=new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(0,1,0),-Math.PI/2);break;case sap.ui.vk.tools.PredefinedView.Right:d=new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(0,1,0),Math.PI/2);break;case sap.ui.vk.tools.PredefinedView.Top:d=new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(1,0,0),-Math.PI/2);break;case sap.ui.vk.tools.PredefinedView.Bottom:d=new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(1,0,0),Math.PI/2);break;default:return this;}this._viewport._viewportGestureHandler.setView(d,m||0);return this;};
b.prototype.render=function(v){this._viewport=v;this._camera.quaternion.copy(v.getCamera().getCameraRef().quaternion);this._camera.position.set(0,0,1).applyQuaternion(this._camera.quaternion);var w=this._renderer.getSize().width;this._updateAxisTitles(this._axisTitles,this._scene,this._camera,w*0.45,2/w);this._renderer.render(this._scene,this._camera);};
b.prototype.onBeforeRendering=function(){};
b.prototype.onAfterRendering=function(){var d=this.getDomRef();this._renderer.setSize(d.clientWidth,d.clientHeight);d.appendChild(this._renderer.domElement);};
return b;},true);
sap.ui.predefine('sap/ui/vk/tools/SceneOrientationToolGizmoRenderer',["jquery.sap.global"],function(q){"use strict";var S={};
S.render=function(r,c){r.write("<div");r.writeControlData(c);r.addClass("sapUiVizKitSceneOrientationGizmo");r.writeClasses();r.write(">");if(c.getParent().getEnablePredefinedViews()){r.renderControl(c._button);}r.write("</div>");};
return S;},true);
sap.ui.predefine('sap/ui/vk/tools/SceneOrientationToolHandler',["jquery.sap.global","sap/ui/base/EventProvider"],function(q,E){"use strict";
var S=E.extend("sap.ui.vk.tools.SceneOrientationToolHandler",{
metadata:{},
constructor:function(t){this._tool=t;this._rect=null;this._mouse=new THREE.Vector2();}
});
S.prototype.destroy=function(){this._tool=null;this._rect=null;};
S.prototype.hover=function(e){if(this._insideButton(e)){e.handled=true;}};
S.prototype.beginGesture=function(e){if(this._insideButton(e)){e.handled=true;}};
S.prototype.move=function(e){};
S.prototype.endGesture=function(e){if(this._insideButton(e)){e.handled=true;}};
S.prototype.click=function(e){if(this._insideButton(e)){e.handled=true;}};
S.prototype.doubleClick=function(e){if(this._insideButton(e)){e.handled=true;}};
S.prototype.contextMenu=function(e){if(this._insideButton(e)){e.handled=true;}};
S.prototype._insideButton=function(e){var g=this._tool.getGizmo();var d=g?g._button.getDomRef():null;if(!d){return false;}var o=this._getOffset(d);return e.x>=o.x&&e.x<=o.x+d.offsetWidth&&e.y>=o.y&&e.y<=o.y+d.offsetHeight;};
S.prototype.getViewport=function(){return this._tool._viewport;};
S.prototype._getOffset=function(o){var r=o.getBoundingClientRect();var p={x:r.left+window.pageXOffset,y:r.top+window.pageYOffset};return p;};
S.prototype._inside=function(e){var i=this._tool._viewport.getIdForLabel();var d=document.getElementById(i);if(d==null){return false;}var o=this._getOffset(d);this._rect={x:o.x,y:o.y,w:d.offsetWidth,h:d.offsetHeight};return(e.x>=this._rect.x&&e.x<=this._rect.x+this._rect.w&&e.y>=this._rect.y&&e.y<=this._rect.y+this._rect.h);};
return S;},true);
sap.ui.predefine('sap/ui/vk/tools/Tool',["jquery.sap.global","./library","sap/ui/core/Element"],function(q,l,E){"use strict";
var T=E.extend("sap.ui.vk.tools.Tool",{
metadata:{properties:{targetViewportType:"any",toolid:"string",active:{type:"boolean",defaultValue:false},footprint:{type:"string[]"}},associations:{gizmoContainer:{type:"sap.ui.core.Control",cardinality:"0..1"}},aggregations:{gizmo:{type:"sap.ui.vk.tools.Gizmo",multiple:false}},events:{enabled:{parameters:{enabled:"bool",reason:"string"}}}},
constructor:function(i,s){E.apply(this,arguments);this._viewport=null;this._handler=null;}
});
T.prototype.init=function(){if(E.prototype.init){E.prototype.init.call(this);}};
T.prototype.isViewportType=function(t){if(this._viewport&&this._viewport.getMetadata().getName()===t){return true;}return false;};
T.prototype.setActive=function(v,a,g){if(v){var _=a;var b;var c="";if(_&&typeof _.getImplementation==="function"){_=_.getImplementation();}b=_&&_.getMetadata().getName();if(this.getFootprint().indexOf(b)>=0){this.setProperty("active",v,true);}else{this.setProperty("active",false,true);c="Tool does not support Viewport type: "+b;q.sap.log.warning(c);}if(this.getGizmo()){if(g){this.setAssociation("gizmoContainer",g);g.rerender();}else{this.setAssociation("gizmoContainer",a);a.rerender();}}this.fireEnabled({enabled:this.getProperty("active"),reason:c});}else{this.setProperty("active",v,true);this.fireEnabled({enabled:v,reason:"Disabled by application logic."});}};
T.prototype.getGizmoForContainer=function(r){var _=this.getGizmo();if((r.getId()===this.getGizmoContainer())&&_&&this.getActive()){return _;}};
T.prototype.destroy=function(){E.prototype.destroy.call(this);this._viewport=null;this._handler=null;};
return T;});
sap.ui.predefine('sap/ui/vk/tools/TooltipTool',["jquery.sap.global","./library","./Tool","./TooltipToolHandler","./TooltipToolGizmo"],function(q,l,T,a,b){"use strict";
var c=T.extend("sap.ui.vk.tools.TooltipTool",{
metadata:{events:{hover:{parameters:{x:"int",y:"int",nodeRef:"any"}}}},
constructor:function(i,s){if(c._instance){return c._instance;}T.apply(this,arguments);this._viewport=null;this._handler=null;c._instance=this;}
});
c.prototype.init=function(){if(T.prototype.init){T.prototype.init.call(this);}this.setFootprint(["sap.ui.vk.threejs.Viewport"]);this.setAggregation("gizmo",new b());};
c.prototype.setActive=function(v,d,g){T.prototype.setActive.call(this,v,d,g);if(this.getActive()){this._activateTool(d);}else{this._deactivateTool();}return this;};
c.prototype._activateTool=function(d){this._viewport=d;this._handler=new a(this);this._gizmo=this.getGizmo();if(this._gizmo){this._gizmo.show(d,this);}this._prepare();};
c.prototype._deactivateTool=function(){if(this._handler){if(this._viewport._loco){this._viewport._loco.removeHandler(this._handler);}this._handler=null;}if(this._gizmo){this._gizmo.hide();this._gizmo=null;}};
c.prototype._prepare=function(){var o=false;if(this._viewport._loco){this._viewport._loco.addHandler(this._handler);o=true;}return o;};
c.prototype.setTitle=function(t){if(this._gizmo){this._gizmo.setTitle(t);}return this;};
c.prototype.queueCommand=function(d){if(this._prepare()){if(this.isViewportType("sap.ui.vk.dvl.Viewport")){if(this._dvlRendererId){this._dvl.Renderer._queueCommand(d,this._dvlRendererId);}}else if(this.isViewportType("sap.ui.vk.threejs.Viewport")){d();}}return this;};
c.prototype.destroy=function(){T.prototype.destroy.call(this);this._viewport=null;this._handler=null;};
return c;});
sap.ui.predefine('sap/ui/vk/tools/TooltipToolGizmo',["jquery.sap.global","./library","./Gizmo","./TooltipToolGizmoRenderer"],function(q,l,G,T){"use strict";
var a=G.extend("sap.ui.vk.tools.TooltipToolGizmo",{metadata:{library:"sap.ui.vk.tools"}});
a.prototype.init=function(){if(G.prototype.init){G.prototype.init.apply(this);}this._viewport=null;this._tool=null;};
a.prototype.show=function(v,t){this._viewport=v;this._tool=t;var b=this.getDomRef();if(b){b.style.display="none";}};
a.prototype.hide=function(){this._tool=null;var t=this.getDomRef();if(t){t.style.display="none";}};
a.prototype.setTitle=function(t){var b=this.getDomRef();if(b){b.style.display=t?"block":"none";b.innerText=t;}};
a.prototype.update=function(x,y,b,c,n){if(this._tool.fireEvent("hover",{x:x,y:y,nodeRef:n},true)){var t=this.getDomRef();if(t){var o=t.offsetParent;while(o){b-=o.offsetLeft||0;c-=o.offsetTop||0;o=o.offsetParent;}b+=10;c+=15;t.style.left=Math.round(b)+"px";t.style.top=Math.round(c)+"px";var v=this._viewport.getDomRef().getBoundingClientRect();var d=t.getBoundingClientRect();if(d.right>v.right){t.style.left=Math.round(b+v.right-d.right)+"px";}if(d.bottom>v.bottom){t.style.top=Math.round(c+v.bottom-d.bottom)+"px";}}}};
a.prototype.onBeforeRendering=function(){};
a.prototype.onAfterRendering=function(){};
return a;},true);
sap.ui.predefine('sap/ui/vk/tools/TooltipToolGizmoRenderer',["jquery.sap.global"],function(q){"use strict";var T={};
T.render=function(r,c){r.write("<div");r.writeControlData(c);r.addClass("sapUiVizKitTooltip");r.writeClasses();r.write(">");r.write("</div>");};
return T;},true);
sap.ui.predefine('sap/ui/vk/tools/TooltipToolHandler',["jquery.sap.global","sap/ui/base/EventProvider"],function(q,E){"use strict";
var T=E.extend("sap.ui.vk.tools.TooltipToolHandler",{
metadata:{},
constructor:function(t){this._tool=t;this._rect=null;this._rayCaster=new THREE.Raycaster();this._mouse=new THREE.Vector2();}
});
T.prototype.destroy=function(){this._tool=null;this._rect=null;};
T.prototype._updateMouse=function(e){var s=this.getViewport().getRenderer().getSize();this._mouse.x=((e.x-this._rect.x)/s.width)*2-1;this._mouse.y=((e.y-this._rect.y)/s.height)*-2+1;this._rayCaster.setFromCamera(this._mouse,this.getViewport().getCamera().getCameraRef());};
T.prototype.hover=function(e){var g=this._tool.getGizmo();if(g&&this._inside(e)&&this.getViewport().getScene()){this._updateMouse(e);var i=this._rayCaster.intersectObject(this.getViewport().getScene().getSceneRef(),true);g.update(e.x-this._rect.x,e.y-this._rect.y,e.x,e.y,i.length>0?i[0].object:null);e.handled=i.length>0;}};
T.prototype.beginGesture=function(e){};
T.prototype.move=function(e){};
T.prototype.endGesture=function(e){};
T.prototype.click=function(e){};
T.prototype.doubleClick=function(e){};
T.prototype.contextMenu=function(e){};
T.prototype.getViewport=function(){return this._tool._viewport;};
T.prototype._getOffset=function(o){var r=o.getBoundingClientRect();var p={x:r.left+window.pageXOffset,y:r.top+window.pageYOffset};return p;};
T.prototype._inside=function(e){var i=this._tool._viewport.getIdForLabel();var d=document.getElementById(i);if(d==null){return false;}var o=this._getOffset(d);this._rect={x:o.x,y:o.y,w:d.offsetWidth,h:d.offsetHeight};return(e.x>=this._rect.x&&e.x<=this._rect.x+this._rect.w&&e.y>=this._rect.y&&e.y<=this._rect.y+this._rect.h);};
return T;},true);
sap.ui.require.preload({
	"sap/ui/vk/manifest.json":'{"_version":"1.9.0","sap.app":{"id":"sap.ui.vk","type":"library","embeds":[],"applicationVersion":{"version":"1.61.0"},"title":"SAPUI5 Visualization Toolkit.","description":"SAPUI5 Visualization Toolkit.","ach":"CA-UI5-VTK","resources":"resources.json","offline":true},"sap.ui":{"technology":"UI5","supportedThemes":["base","sap_belize","sap_belize_hcb","sap_belize_hcw","sap_belize_plus","sap_bluecrystal","sap_hcb"]},"sap.ui5":{"dependencies":{"minUI5Version":"1.61","libs":{"sap.ui.core":{"minVersion":"1.61.0"},"sap.ui.unified":{"minVersion":"1.61.0","lazy":true},"sap.m":{"minVersion":"1.61.0","lazy":true},"sap.ui.layout":{"minVersion":"1.61.0","lazy":true}}},"library":{"i18n":false,"content":{"controls":["sap.ui.vk.ContainerBase","sap.ui.vk.ContainerContent","sap.ui.vk.FlexibleControl","sap.ui.vk.LegendItem","sap.ui.vk.ListPanel","sap.ui.vk.ListPanelStack","sap.ui.vk.MapContainer","sap.ui.vk.NativeViewport","sap.ui.vk.Notifications","sap.ui.vk.Overlay","sap.ui.vk.RedlineDesign","sap.ui.vk.RedlineSurface","sap.ui.vk.SceneTree","sap.ui.vk.StepNavigation","sap.ui.vk.Toolbar","sap.ui.vk.Viewer","sap.ui.vk.Viewport","sap.ui.vk.ViewportBase","sap.ui.vk.dvl.Viewport","sap.ui.vk.threejs.Viewport"],"elements":["sap.ui.vk.ContentConnector","sap.ui.vk.OverlayArea","sap.ui.vk.RedlineElement","sap.ui.vk.RedlineElementEllipse","sap.ui.vk.RedlineElementFreehand","sap.ui.vk.RedlineElementLine","sap.ui.vk.RedlineElementText","sap.ui.vk.RedlineElementRectangle","sap.ui.vk.ViewStateManager","sap.ui.vk.ViewStateManagerBase","sap.ui.vk.dvl.ViewStateManager","sap.ui.vk.threejs.ViewStateManager"],"types":["sap.ui.vk.CameraFOVBindingType","sap.ui.vk.CameraProjectionType","sap.ui.vk.ContentResourceSourceCategory","sap.ui.vk.dvl.GraphicsCoreApi","sap.ui.vk.SelectionMode","sap.ui.vk.TransformationMatrix","sap.ui.vk.VisibilityMode","sap.ui.vk.ZoomTo"],"interfaces":["sap.ui.vk.DecryptionHandler","sap.ui.vk.AuthorizationHandler"]}}}}',
	"sap/ui/vk/threejs/MataiLoaderWorker.js":'console.log("MataiLoaderWorker started.");var scriptDirectory=self.location.href.slice(0,self.location.href.lastIndexOf("/")+1);self.importScripts(scriptDirectory+"thirdparty/matai.js");sap.ve.matai.createRuntime({prefixURL:scriptDirectory+"thirdparty/"}).then(function(m){"use strict";console.log("MataiLoaderWorker runtime created.");function S(s){this.sceneBuilderId=s;}S.prototype.setScene=function(i){self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"setScene",args:[i]});};S.prototype.createNode=function(i){self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"createNode",args:[i]},[i.matrix.buffer]);};S.prototype.createMesh=function(i){var t=[i.boundingBox.buffer];if(i.matrix){t.push(i.matrix.buffer);}self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"createMesh",args:[i]},t);};S.prototype.setMeshGeometry=function(i){var t=[i.data.index.buffer,i.data.position.buffer];if(i.data.normal){t.push(i.data.normal.buffer);}if(i.data.uv){t.push(i.data.uv.buffer);}self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"setMeshGeometry",args:[i]},t);};S.prototype.insertMesh=function(n,a){self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"insertMesh",args:[n,a]});};S.prototype.createTextAnnotation=function(i){self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"createTextAnnotation",args:[i]});};S.prototype.createTextNote=function(i){self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"createTextNote",args:[i]});};S.prototype.createImageNote=function(i){self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"createImageNote",args:[i]});};S.prototype.insertLeaderLine=function(i){self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"insertLeaderLine",args:[i]});};S.prototype.createCamera=function(i){var t=[i.origin.buffer,i.up.buffer,i.target.buffer];if(i.matrix){t.push(i.matrix.buffer);}self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"createCamera",args:[i]},t);};S.prototype.insertCamera=function(n,c){self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"insertCamera",args:[n,c]});};S.prototype.createDetailView=function(i){var t=[i.origin.buffer,i.size.buffer];if(i.attachmentPoint){t.push(i.attachmentPoint.buffer);}self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"createDetailView",args:[i]},t);};S.prototype.createMaterial=function(i){var t=[i.ambient.buffer,i.diffuse.buffer,i.specular.buffer,i.emissive.buffer];if(i.linestyle){t.push(i.linestyle.color.buffer,i.linestyle.dashPattern.buffer);}if(i.textures){i.textures.forEach(function(a){t.push(a.matrix.buffer);});}self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"createMaterial",args:[i]},t);};S.prototype.createImage=function(i){self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"createImage",args:[i]},[i.data.buffer]);};S.prototype.progress=function(p){self.postMessage({sceneBuilderId:this.sceneBuilderId,method:"progress",args:[p]});};self.onmessage=function(e){var d=e.data;switch(d.method){case"loadSceneFromArrayBuffer":var p=new S(d.sceneBuilderId);m.loadSceneFromArrayBuffer(p,d.buffer,d.fileName,null,d.sourceLocation);break;default:break;}};self.postMessage({ready:true});console.log("MataiLoaderWorker initialized.");});console.log("MataiLoaderWorker starting runtime.");\n',
	"sap/ui/vk/totara/TotaraLoaderWorker.js":'\nfunction HttpConnection(){"use strict";var u;var a;var o;function m(u){var p=new Promise(function(r,b){var x=new XMLHttpRequest();x.onload=function(){if(this.status>=200&&this.status<300){r(x.response);}else{b({status:this.status,statusText:x.statusText});}};x.onerror=function(){b({status:this.status,statusText:x.statusText});};x.open("GET",u,true);if(a){x.setRequestHeader("Authorization",a);}x.responseType="arraybuffer";x.send();});return p;}this.getUrl=function(){return u;};this.close=function(){};this.send=function(b,c,d){if(!b){return;}var t=this;m(encodeURI(u+b)).then(d||function(r){if(t.onResponse){t.onResponse(r);}}).catch(function(r){if(o){o({errorText:"could not connect to server:"+u,error:r.status,reason:r,context:c});}});};this.init=function(s,b){return new Promise(function(r,c){u=s;if(b!=null){b(s).then(function(t){if(t!=null){a=t.token_type+" "+t.access_token;}else{a=null;}r({});}).catch(function(d){return c(d);});}else{r({});}});};this.setOnErrorCallback=function(c){o=c;};this.onResponse=null;}\nfunction WebSocketConnection(){"use strict";var l;var t=this;var c;var o;function i(){if(c&&c.readyState===1){return true;}return false;}function a(m,e,h){if(o){o({errorText:m,error:h,context:e});}}this.setOnErrorCallback=function(e){o=e;};this.getUrl=function(){return l;};this.close=function(){if(c){c.close();c=null;}};this.send=function(m,h){if(!m){return;}if(!i()){a("websocket connection lost",h,4);}else{try{c.send(m);}catch(e){a(e,h);}}};var b=0;function k(){var e=60000;if(c.readyState==1){c.send("");}b=setTimeout(k,e);}function d(){if(b){clearTimeout(b);b=0;}}var f=false;var g=function(e){var r=JSON.stringify(e);var h="setStreamingToken"+("["+r.length+"]")+r;return h;};this.init=function(s,h){return new Promise(function(r,j){if(s){l=s;}else{s=l;}c=new WebSocket(s);c.binaryType="arraybuffer";c.onopen=function(){f=true;if(h!=null){h(s).then(function(e){if(e!=null){var m=g({"token":e.access_token});c.send(m);}k();r({});}).catch(function(e){return j(e);});}else{k();r({});}};c.onclose=function(){d();};c.onmessage=function(e){var m=e.data;if(t.onResponse){t.onResponse(m);}};c.onerror=function(e){if(!f){j("error connecting to "+s);}else{a(e);}};});};this.onResponse=null;}\nfunction findChar(c,s,u){"use strict";for(var i=s;i<u.length;i++){if(u[i]===c){return i;}}return-1;}\nfunction getContentLength(c){"use strict";var l=c.split(",");if(l.length<0||l.length>2){throw"invalid content length";}var j=0;var b=0;try{j=parseInt(l[0],10);if(l.length===2){b=parseInt(l[1],10);}}catch(e){throw"invalid content length";}return{jsonContentLength:j,binaryContentLength:b};}\nfunction Parser(){"use strict";}\nParser.createCommandList=function(a,o){"use strict";var b=new Uint8Array(a);var c=[];var s=0;var d=0;var f;var j;var g;while(d<b.length){d=findChar("[".charCodeAt(0),s,b);if(d===-1){break;}var h=Decoder.decode(b.slice(s,d)).replace(/\\n|\\r|\\s/g,"");s=d+1;d=findChar("]".charCodeAt(0),s,b);if(d===-1){throw"No matching [] for command length. abort";}f=getContentLength(Decoder.decode(b.slice(s,d)));s=d+1;d=s+f.jsonContentLength;j=Decoder.decode(b.slice(s,d));try{j=JSON.parse(j);}catch(e){var i=h+": "+e;throw i;}if(f.binaryContentLength){s=d;d=s+f.binaryContentLength;g=b.slice(s,d);}else{g=undefined;}s=d;var k={name:h,jsonContent:j,binaryContent:g};if(o){o(k);}c.push(k);}return c;};\nfunction Decoder(){"use strict";}\nDecoder.uint8ArrayToString=function(u){"use strict";var f="";try{var C=0x8000;var i=0;var l=u.length;var s;while(i<l){s=u.slice(i,Math.min(i+C,l));f+=String.fromCharCode.apply(null,s);i+=C;}}catch(e){f="";}return f;};\nDecoder.decode=function(u){"use strict";var e=Decoder.uint8ArrayToString(u);return decodeURIComponent(escape(e));};\nfunction LoaderProxy(){"use strict";this.init=function(a,h,b){this._connection=a;this._connectionHTTP=h;this._sceneBuilderId=b;if(!a){throw"no connection provided for loader!";}this._connection.onResponse=function(r){var c=Parser.createCommandList(r);p(c);};};function p(c){var d;for(var i=0;i<c.length;i++){var a=c[i];if(a.binaryContent){d={name:a.name,jsonContent:a.jsonContent,binaryContent:a.binaryContent};self.postMessage(d,[d.binaryContent.buffer]);}else{d={name:a.name,jsonContent:a.jsonContent};self.postMessage(d);}}}this.getConnection=function(){return this._connection;};this.send=function(c){if(this._connectionHTTP&&c.resource){switch(c.method){case"getImage":this._connectionHTTP.send("images/"+c.resource,c,function(r){p([{name:"setImage",jsonContent:{id:c.resource},binaryContent:new Uint8Array(r)}]);});return;case"getGeometry":this._connectionHTTP.send("geometry?id="+c.resource,c,function(r){var d=new DataView(r);var b=d.getUint16(2,true);if(b>0){var g={id:d.getUint32(4,true).toString(),box:[d.getFloat32(14,true),d.getFloat32(18,true),d.getFloat32(22,true),d.getFloat32(26,true),d.getFloat32(30,true),d.getFloat32(34,true)]};var a=d.getUint16(8,true);if(a!==3){g.flags=d.getUint16(38,true);g.pointCount=d.getUint16(46,true);g.elementCount=d.getUint16(48,true);}var e=d.getUint32(52,true);var f=new Uint8Array(r,56,e);p([{name:"setGeometry",jsonContent:g,binaryContent:f}]);}});return;default:break;}}if(this._connection){this._connection.send(c.command);}};this.setSceneBuilderId=function(i){this._sceneBuilderId=i;};this.getSceneBuilderId=function(){return this._sceneBuilderId;};this.authorizationHandler=function(u){return new Promise(function(r,a){var d={name:"getAuthorization",jsonContent:{"url":u}};self.loader.authorizationHandler.resolve=r;self.loader.authorizationHandler.reject=a;self.postMessage(d);});};}\nLoaderProxy.HttpConnection=HttpConnection;LoaderProxy.WebSocketConnection=WebSocketConnection;var loader=new LoaderProxy();var onmessage=function(e){"use strict";var d=e.data;switch(d.method){case"initializeConnection":if(!d.url){break;}var a=loader.getConnection();if(!a||a.getUrl()!==d.url){if(a){a.close();}var c;if(d.url.toLowerCase().startsWith("ws")){c=new WebSocketConnection();c.init(d.url,loader.authorizationHandler).then(function(){loader.init(c,null,d.sceneBuilderId);if(d.command){loader.send(d);}}).catch(function(b){});}else if(d.url.toLowerCase().startsWith("http")){c=new HttpConnection();c.init(d.url,loader.authorizationHandler).then(function(){loader.init(c,null,d.sceneBuilderId);if(d.command){loader.send(d);}}).catch(function(b){});}else{c=new WebSocketConnection();c.init((d.useSecureConnection?"wss://":"ws://")+d.url+"streaming?",loader.authorizationHandler).then(function(){var b=new HttpConnection();b.init((d.useSecureConnection?"https://":"http://")+d.url,loader.authorizationHandler).then(function(){loader.init(c,b,d.sceneBuilderId);if(d.command){loader.send(d);}}).catch(function(f){});}).catch(function(b){});}}else if(d.command){loader.send(d);}break;case"setAuthorization":if(d.error==null){loader.authorizationHandler.resolve(d.authorizationToken);}else{loader.authorizationHandler.reject(d.error);}delete(loader.authorizationHandler.resolve);delete(loader.authorizationHandler.reject);break;default:if(d.command){loader.send(d);}break;}};self.onmessage=onmessage;postMessage({ready:true});\n'
},"sap/ui/vk/library-preload"
);
//# sourceMappingURL=library-preload.js.map