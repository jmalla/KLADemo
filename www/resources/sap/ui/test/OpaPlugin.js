/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2017 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
(function(g){"use strict";var o;if(g.module){o=g.module;g.module=undefined;}sap.ui.define(['jquery.sap.global','sap/ui/core/routing/HashChanger','sap/ui/base/Object','sap/ui/core/mvc/View','./matchers/Ancestor','./matchers/MatcherFactory','./pipelines/MatcherPipeline','./autowaiter/_autoWaiter','sap/ui/test/_opaCorePlugin','sap/ui/test/_OpaLogger'],function($,H,U,V,A,M,a,_,b,c){var m=new M();var d=new a();var C=["id","viewName","controlType","searchOpenDialogs"];var O=U.extend("sap.ui.test.OpaPlugin",{constructor:function(){this._oLogger=c.getLogger("sap.ui.test.Opa5");},getAllControls:function(f){return b.getAllControls(f);},getView:function(v){var e=this.getAllControls(V);return e.filter(function(f){return f.getViewName()===v;})[0];},getControlInView:function(e){var v=((e.viewNamespace||"")+"."+(e.viewName||"")).replace(/\.+/g,'.').replace(/^\.|\.$/g,""),f=this.getView(v),r=[],h,i=typeof e.id==="string",s;if(!f){this._oLogger.debug("Found no view with the name: '"+v+"'");if(i){return null;}return[];}if($.isArray(e.id)){$.each(e.id,function(I,k){h=f.byId(k);if(h){r.push(h);}});return r;}if(i){var E=f.byId(e.id);if(!E){this._oLogger.debug("Found no control with the id: '"+e.id+"' in the view: '"+v+"'");return null;}return E;}var j=this.getAllControlsWithTheParent(f,e.controlType);if($.type(e.id)==="regexp"){s=f.getId();j=j.filter(function(h){var u=h.getId().replace(s,"");return e.id.test(u);});}return j;},getAllControlsWithTheParent:function(p,f){var e=new A(p);return this._filterUniqueControlsByCondition(this.getAllControls(f),e);},getAllControlsInContainer:function(e,f){return this._filterUniqueControlsByCondition(e.find("*").control(),function(h){return b.checkControlType(h,f);});},getMatchingControls:function(e){e=e||{};e.interactable=e.interactable||(!!e.actions||e.autoWait);var r=null;var h=this._modifyControlType(e);if(!h){return typeof e.id==="string"?r:[];}if(e.searchOpenDialogs){r=this.getAllControlsInContainer($("#sap-ui-static"),e.controlType);}else if(e.viewName){r=this.getControlInView(e);}else if(e.id){r=this.getControlByGlobalId(e);}else if(e.controlType){r=this.getAllControls(e.controlType);}else{r=this.getAllControls();}if(!r||e.visible===false){return r;}var i=m.getInteractabilityMatchers(e.interactable);var p=d.process({control:r,matchers:i});if(!p){if($.isArray(r)){return[];}if(r){return null;}return r;}return p;},_getFilteredControls:function(e){var v=this._filterControlsByCondition(e);return v===O.FILTER_FOUND_NO_CONTROLS?O.FILTER_FOUND_NO_CONTROLS:this._filterControlsByMatchers(e,v);},_getFilteredControlsByDeclaration:function(e){var v=this._filterControlsByCondition(e);var f=$.extend({},e,{useDeclarativeMatchers:true});return v===O.FILTER_FOUND_NO_CONTROLS?O.FILTER_FOUND_NO_CONTROLS:this._filterControlsByMatchers(f,v);},_filterControlsByCondition:function(e){var v=null;var p=this._isLookingForAControl(e);if(p){v=this.getMatchingControls(e);}else if(e.autoWait&&_.hasToWait()){return O.FILTER_FOUND_NO_CONTROLS;}if(typeof e.id==="string"&&!v){return O.FILTER_FOUND_NO_CONTROLS;}if(!e.id&&(e.viewName||e.searchOpenDialogs)&&v.length===0){this._oLogger.debug("found no controls in view: "+e.viewName+" with controlType "+e.sOriginalControlType,"","Opa");return O.FILTER_FOUND_NO_CONTROLS;}if($.type(e.id)==="regexp"&&!v.length){this._oLogger.debug("found no control with the id regex"+e.id);return O.FILTER_FOUND_NO_CONTROLS;}if($.isArray(e.id)&&(!v||v.length!==e.id.length)){if(v&&v.length){this._oLogger.debug("found not all controls with the ids "+e.id+" onlyFound the controls: "+v.map(function(f){return f.sId;}));}else{this._oLogger.debug("found no control with the id  "+e.id);}return O.FILTER_FOUND_NO_CONTROLS;}if(e.controlType&&$.isArray(v)&&!v.length){this._oLogger.debug("found no controls with the type  "+e.sOriginalControlType,"","Opa");return O.FILTER_FOUND_NO_CONTROLS;}return v;},_filterControlsByMatchers:function(e,v){var f=e.useDeclarativeMatchers?m.getFilteringMatchers(e):e.matchers;var p=this._isLookingForAControl(e);var r=null;if((v||!p)&&f){r=d.process({matchers:f,control:v});if(!r){return O.FILTER_FOUND_NO_CONTROLS;}}else{r=v;}return r;},getControlByGlobalId:function(e){var s=e.id,v=[],i=[],f=b.getCoreElements();if(typeof s==="string"){v=f[s];if(!v){this._oLogger.debug("Found no control with the global id: '"+s+"'");return null;}if(!b.checkControlType(v,e.controlType)){this._oLogger.error("An id: '"+e.id+"' was passed together with the controlType '"+e.sOriginalControlType+"' but the type does not match the control retrieved: '"+v+"' - null is returned");return null;}return v;}if($.type(s)==="regexp"){for(var p in f){if(!f.hasOwnProperty(p)){continue;}if(!s.test(p)){continue;}i.push(p);}}else if($.isArray(s)){i=s;}return i.map(function(I){return f[I];}).filter(function(h){return b.checkControlType(h,e.controlType)&&h&&!h.bIsDestroyed;});},getControlConstructor:function(s){if(sap.ui.lazyRequire._isStub(s)){this._oLogger.debug("The control type "+s+" is currently a lazy stub.");return null;}var f=$.sap.getObject(s);if(!f){this._oLogger.debug("The control type "+s+" is undefined.");return null;}return f;},_isLookingForAControl:function(e){return Object.keys(e).some(function(k){return C.indexOf(k)!==-1&&!!e[k];});},_filterUniqueControlsByCondition:function(e,f){return e.filter(function(h,p,i){var k=!!f(h);return k&&i.indexOf(h)===p;});},_modifyControlType:function(e){var v=e.controlType;if(typeof v!=="string"){if(v&&v._sapUiLazyLoader){this._oLogger.debug("The control type is currently a lazy stub");return false;}return true;}var f=this.getControlConstructor(v);if(!f){return false;}e.sOriginalControlType=v;e.controlType=f;return true;}});O.FILTER_FOUND_NO_CONTROLS="FILTER_FOUND_NO_CONTROL";return O;},true);if(o){g.module=o;}})(window);
