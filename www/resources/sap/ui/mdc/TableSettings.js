/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2018 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/m/ResponsivePopover","./p13n/FieldsUI","./p13n/FieldsUI2","sap/base/util/array/diff"],function(R,F,a,d){"use strict";var T={_createAndOpenSettings:function(c,s,p,v,S){var o;var r=sap.ui.getCore().getLibraryResourceBundle("sap.ui.mdc");var f=function(){var e=[],P;p.forEach(function(g){var I=-1,i,l=v.length;for(i=0;i<l;i++){if(v[i].name===g.name){I=i;break;}}P={name:g.name,label:I>-1?v[I].label:g.label||g.name,selected:I>-1,position:I};e.push(P);});return e;};var b=new a({fetchFields:f});o=new R({title:r.getText("table.SETTINGS_COLUMN","Column Settings"),placement:"Auto",content:b,afterClose:function(){S(b.getSelectedFields());o.destroy();}});c.addDependent(o);o.openBy(s);},_createAndOpenSettings2:function(c,s,p,v,S){var o;var r=sap.ui.getCore().getLibraryResourceBundle("sap.ui.mdc");var f=function(){var e=[];v.forEach(function(P,i){e.push({name:P.name,label:P.label||P.name,selected:true,position:i});});return e;};var b=new a({fetchFields:f,reorderMode:true});o=new R({title:r.getText("table.SETTINGS_COLUMN","Column Settings"),placement:"Auto",content:b,afterClose:function(){S(b.getSelectedFields());o.destroy();}});c.addDependent(o);o.openBy(s);},showColumnsPanel:function(c,s,r){return new Promise(function(b,e){sap.ui.require([c.getMetadataDelegate()],function(M){if(!M||!M.fetchProperties||!M.createColumn){return;}var p,v,O="_createAndOpenSettings";if(!r){p=M.fetchProperties(c);}else{O+="2";}v=c.getVisibleProperties();T[O](c,s,p,v,function(S){var f=d(v,S,function(o){return o.name;});var m=function(o,A){return A.find(function(E){return E&&(E.name===o.name);});};var C=[];var P=v.slice(0);f.forEach(function(o){if(o.type==="delete"&&P[o.index]===undefined){P.splice(o.index,1);return;}var E;if(o.type==="insert"){E=m(S[o.index],P);if(E){E.index=P.indexOf(E);P.splice(E.index,1,undefined);C.push({selectorControl:c,changeSpecificData:{changeType:"removeMDCColumn",content:E}});}}var g=o.type==="delete"?P[o.index]:S[o.index];g.index=o.index;if(o.type==="delete"){P.splice(g.index,1);}else{P.splice(g.index,0,g);}C.push({selectorControl:c,changeSpecificData:{changeType:o.type==="delete"?"removeMDCColumn":"addMDCColumn",content:g}});});b(C);},c);});});},handleUserChanges:function(c,C){return new Promise(function(r,b){sap.ui.require(["sap/ui/fl/ControlPersonalizationAPI"],function(e){e.addPersonalizationChanges({controlChanges:c}).then(function(D){e.saveChanges(D,C).then(function(){r(arguments);});});});});}};return T;},false);
