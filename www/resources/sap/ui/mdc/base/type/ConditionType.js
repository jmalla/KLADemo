/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2018 SAP SE. All rights reserved
	
 */
sap.ui.define(['sap/ui/model/SimpleType','sap/ui/model/FormatException','sap/ui/model/ParseException','sap/ui/model/ValidateException','sap/ui/model/type/String','sap/ui/mdc/library','sap/ui/mdc/base/FilterOperatorConfig','sap/base/util/merge'],function(S,F,P,V,a,l,b,m){"use strict";var c=l.FieldDisplay;var C=S.extend("sap.ui.mdc.base.type.ConditionType",{constructor:function(){S.apply(this,arguments);this.sName="Condition";}});C.prototype.destroy=function(){S.prototype.destroy.apply(this,arguments);if(this._oDefaultType){this._oDefaultType.destroy();delete this._oDefaultType;}if(this._oFilterOperatorConfig){this._oFilterOperatorConfig.destroy();delete this._oFilterOperatorConfig;}};C.prototype.formatValue=function(o,i){if(o==undefined||o==null){return null;}if(typeof o!=="object"||!o.operator||!o.values||!Array.isArray(o.values)){throw new F("No valid condition provided");}if(!i){i="string";}var D=_.call(this);var t=e.call(this);var j=g.call(this);var k=f.call(this);h.call(this,o,t);switch(this.getPrimitiveType(i)){case"string":case"any":if(D!==c.Value&&o.values.length===1&&j){var s=j.getTextForKey(o.values[0]);if(s){o=m({},o);o.values.push(s);}}if(this.oFormatOptions.onlyEEQ&&o.operator==="EQ"){o=m({},o);o.operator="EEQ";}try{if(this.oFormatOptions.hideOperator&&o.values.length>=1){return t.formatValue(o.values[0],"string");}var O=k.getOperator(o.operator);return O.format(o.values,o,t,D);}catch(E){throw new F(E.message);}break;default:if(t&&o.values.length>=1){return t.formatValue(o.values[0],i);}throw new F("Don't know how to format Condition to "+i);}};C.prototype.parseValue=function(v,i){if(!i){i="string";}else if(i==="any"&&typeof v==="string"){i="string";}if(!v){return null;}var D=_.call(this);var s=d.call(this);var o=g.call(this);var t=e.call(this);var T=t.getMetadata().getName();var j=f.call(this);var k;switch(this.getPrimitiveType(i)){case"string":var n=v;var O;if(t&&(t.getMetadata().getName()==="sap.ui.model.type.Unit"||t.getMetadata().getName()==="sap.ui.model.type.Currency")&&/^[,.\d]+$/.test(n)&&this._sDefaultUnit){if(this._bUnitAfter){n=n+" "+this._sDefaultUnit;}else{n=this._sDefaultUnit+" "+n;}}if(n&&D!==c.Value&&o){var K=o.getKeyForText(n);if(K===undefined||K===null){var p=o.getTextForKey(n);if(p){K=n;n=p;}}if(K!==undefined&&K!==null){return{fieldPath:s,operator:"EEQ",values:[K,n]};}}if(this.oFormatOptions.onlyEEQ){O=j.getOperator("EEQ");if(!O.test(n,t)){n="=="+n;}}else{var q=j.getMatchingOperators(T,n);if(q.length===0){k=j.getDefaultOperator(T);O=j.getOperator(k);n=O?O.format([n]):n;}else{O=q[0];}}try{if(O){var r=O.getCondition(n,t);if(r){r.fieldPath=s;h.call(this,r,t);return r;}}}catch(E){throw new P(E.message);}throw new P("Cannot parse value "+v);default:if(t){if(this.oFormatOptions.onlyEEQ){k="EEQ";}else{k=j.getDefaultOperator(T);}return{fieldPath:s,operator:k,values:[t.parseValue(v,i)]};}throw new P("Don't know how to parse Condition from "+i);}};C.prototype.validateValue=function(o){if(o==undefined||o==null){return null;}if(typeof o!=="object"||!o.operator||!o.values||!Array.isArray(o.values)){throw new V("No valid condition provided");}var t=e.call(this);if(o.operator==="EQ"||o.operator==="EEQ"){try{t.validateValue(o.values[0]);}catch(E){throw new V(E.message);}}};function _(){var D=this.oFormatOptions.display;if(!D){D=c.Value;}return D;}function d(){var s=this.oFormatOptions.fieldPath||"";return s;}function e(){var t=this.oFormatOptions.valueType;if(!t){if(!this._oDefaultType){this._oDefaultType=new a();}t=this._oDefaultType;}return t;}function f(){var o=this.oFormatOptions.filterOperatorConfig;if(!o){if(!this._oFilterOperatorConfig){this._oFilterOperatorConfig=new b();}o=this._oFilterOperatorConfig;}return o;}function g(){var i=this.oFormatOptions.fieldHelpID;if(i){return sap.ui.getCore().byId(i);}return null;}function h(o,t){if(t&&(t.getMetadata().getName()==="sap.ui.model.type.Unit"||t.getMetadata().getName()==="sap.ui.model.type.Currency")&&o.values[0]&&o.values[0][1]){var r=t.formatValue([0,o.values[0][1]],"string");var i=new RegExp(/^([,.\d]+)\s(\w+)$/i);var v=r.match(i);if(v){this._sDefaultUnit=v[2];this._bUnitAfter=true;}else{i=new RegExp(/^(\w+)\s([,.\d]+)$/i);v=r.match(i);if(v){this._sDefaultUnit=v[1];this._bUnitAfter=false;}}}}return C;});
