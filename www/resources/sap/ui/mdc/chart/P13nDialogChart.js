/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2018 SAP SE. All rights reserved
	
 */
sap.ui.define(['sap/ui/core/XMLComposite','sap/ui/model/Filter','sap/ui/model/FilterOperator','sap/ui/base/ManagedObjectObserver','sap/base/Log','sap/ui/Device','sap/ui/model/json/JSONModel'],function(X,F,c,M,L,D,J){"use strict";var P=X.extend("sap.ui.mdc.chart.P13nDialogChart",{metadata:{library:"sap.ui.mdc",properties:{showReset:{type:"boolean",defaultValue:false,invalidate:true},showResetEnabled:{type:"boolean",defaultValue:false,invalidate:true},chartType:{type:"string"}},defaultAggregation:"items",aggregations:{items:{type:"sap.ui.mdc.chart.P13nDialogChartItem",multiple:true,singularName:"item"},availableChartTypes:{type:"sap.ui.core.Item",multiple:true,singularName:"availableChartType"}},events:{initialOrderChanged:{keys:{type:"string[]"}},visibilityChanged:{key:{type:"string"},visible:{type:"boolean"}},positionChanged:{key:{type:"string"},position:{type:"integer"}},roleChanged:{key:{type:"string"},role:{type:"string"}},chartTypeChanged:{chartType:{type:"string"}},ok:{},cancel:{},reset:{}}}});P.prototype.init=function(){var d=new J(D);d.setDefaultBindingMode("OneWay");this.setModel(d,"device");this._sKeyOfMarkedItem=null;this.aFilters=[];};P.prototype.open=function(){this.initialize();this._getCompositeAggregation().open();};P.prototype.initialize=function(){this._removeMarkedStyleFromTableItem(this._getMarkedTableItem());this._updateCountOfItems();this.fireInitialOrderChanged({keys:this._getInitialItemOrder()});var t=this._getVisibleTableItems()[0];this._toggleMarkedTableItem(t);this._updateEnableOfMoveButtons(t);};P.prototype.close=function(){this._getCompositeAggregation().close();};P.prototype.onSelectionChangeOfChartType=function(e){var s=e.getParameter("selectedItem");if(s){this.fireChartTypeChanged({chartType:s.getKey()});}};P.prototype.onChangeOfRole=function(e){var s=e.getParameter("selectedItem");if(s){var t=e.getSource().getParent();this.fireRoleChanged({key:this._getKeyByTableItem(t),role:s.getKey()});}};P.prototype.onSelectionChange=function(e){e.getParameter("listItems").forEach(function(t){this._selectTableItem(t);},this);};P.prototype.onItemPressed=function(e){var t=e.getParameter('listItem');this._toggleMarkedTableItem(t);this._updateEnableOfMoveButtons(t);};P.prototype.onSearchFieldLiveChange=function(e){var s=e.getSource();this._defineTableFiltersByText(s?s.getValue():"");this._filterTable(this.aFilters);};P.prototype.onSwitchButtonShowSelected=function(){this._defineTableFiltersByText(this._getSearchText());this._filterTable(this.aFilters);};P.prototype.onPressButtonMoveToTop=function(){this._moveTableItem(this._getMarkedTableItem(),this._getVisibleTableItems()[0]);};P.prototype.onPressButtonMoveUp=function(){var v=this._getVisibleTableItems();this._moveTableItem(this._getMarkedTableItem(),v[v.indexOf(this._getMarkedTableItem())-1]);};P.prototype.onPressButtonMoveDown=function(){var v=this._getVisibleTableItems();this._moveTableItem(this._getMarkedTableItem(),v[v.indexOf(this._getMarkedTableItem())+1]);};P.prototype.onPressButtonMoveToBottom=function(){var v=this._getVisibleTableItems();this._moveTableItem(this._getMarkedTableItem(),v[v.length-1]);};P.prototype.onPressOk=function(){this.fireOk();};P.prototype.onPressCancel=function(){this.fireCancel();};P.prototype.onPressReset=function(){this._removeMarkedStyleFromTableItem(this._getMarkedTableItem());this.fireReset();};P.prototype.onAfterClose=function(){this.fireCancel();};P.prototype._selectTableItem=function(t){this._toggleMarkedTableItem(t);this._updateEnableOfMoveButtons(t);this._updateCountOfItems();this.fireVisibilityChanged({key:this._getKeyByTableItem(t),visible:t.getSelected()});};P.prototype._moveTableItem=function(t,T){this._removeMarkedStyleFromTableItem(this._getMarkedTableItem());this.firePositionChanged({key:this._getKeyByTableItem(t),position:this._getItemPositionOfKey(this._getKeyByTableItem(T))});this._filterTable(this.aFilters);this._toggleMarkedTableItem(this._getMarkedTableItem());this._updateEnableOfMoveButtons(this._getMarkedTableItem());};P.prototype._getInitialItemOrder=function(){var k=this.getItems().filter(function(i){return i.getVisible();}).map(function(i){return i.getKey();});var K=this.getItems().filter(function(i){return!i.getVisible();}).sort(function(a,b){if(a.getText()<b.getText()){return-1;}else if(a.getText()>b.getText()){return 1;}else{return 0;}}).map(function(i){return i.getKey();});return k.concat(K);};P.prototype._isFilteredByShowSelected=function(){return sap.ui.getCore().byId(this.getId()+"--idShowSelected").getPressed();};P.prototype._getSearchText=function(){var s=sap.ui.getCore().byId(this.getId()+"--idSearchField")||null;return s?s.getValue():"";};P.prototype._getTable=function(){return sap.ui.getCore().byId(this.getId()+"--idList")||null;};P.prototype._getTableBinding=function(){return this._getTable().getBinding("items");};P.prototype._getTableBindingContext=function(){return this._getTableBinding().getContexts();};P.prototype._setMarkedTableItem=function(t){this._sKeyOfMarkedItem=this._getKeyByTableItem(t);};P.prototype._getMarkedTableItem=function(){return this._getTableItemByKey(this._sKeyOfMarkedItem);};P.prototype._getVisibleTableItems=function(){return this._getTable().getItems().filter(function(t){return!!t.getVisible();});};P.prototype._getSelectedTableItems=function(){return this._getTable().getItems().filter(function(t){return!!t.getSelected();});};P.prototype._getTableItemByKey=function(k){var C=this._getTableBindingContext();var t=this._getTable().getItems().filter(function(T,i){return C[i].getObject().getKey()===k;});return t[0];};P.prototype._getKeyByTableItem=function(t){var i=this._getTable().indexOfItem(t);return i<0?null:this._getTableBindingContext()[i].getObject().getKey();};P.prototype._getItemPositionOfKey=function(k){return this.getItems().indexOf(this._getItemByKey(k));};P.prototype._getItemByKey=function(k){var i=this.getItems().filter(function(I){return I.getKey()===k;});return i[0];};P.prototype._defineTableFiltersByText=function(s){this.aFilters=[];if(this._isFilteredByShowSelected()===true){this.aFilters.push(new sap.ui.model.Filter("visible","EQ",true));}if(s){this.aFilters.push(new F([new F("text",c.Contains,s)],false));}};P.prototype._filterTable=function(f){this._removeMarkedStyleFromTableItem(this._getMarkedTableItem());this._getTableBinding().filter(f);this._toggleMarkedTableItem(this._getMarkedTableItem());this._updateEnableOfMoveButtons(this._getMarkedTableItem());};P.prototype._toggleMarkedTableItem=function(t){this._removeMarkedStyleFromTableItem(this._getMarkedTableItem());var k=this._getKeyByTableItem(t);if(k){this._setMarkedTableItem(t);this._addMarkedStyleToTableItem(t);}};P.prototype._addMarkedStyleToTableItem=function(t){if(t){t.addStyleClass("sapUiMdcChartPersonalizationDialogMarked");}};P.prototype._removeMarkedStyleFromTableItem=function(t){if(t){t.removeStyleClass("sapUiMdcChartPersonalizationDialogMarked");}};P.prototype._updateCountOfItems=function(){this._getManagedObjectModel().setProperty("/@custom/countOfSelectedItems",this._getSelectedTableItems().length);};P.prototype._updateEnableOfMoveButtons=function(t){var v=this._getVisibleTableItems();this._getManagedObjectModel().setProperty("/@custom/isMoveUpButtonEnabled",v.indexOf(t)>0);this._getManagedObjectModel().setProperty("/@custom/isMoveDownButtonEnabled",v.indexOf(t)>-1&&v.indexOf(t)<v.length-1);};P._getItemByKey=function(k,a){return a.filter(function(m){return m.key===k;})[0];};P.prototype.formatterRole2Type=function(r,R){var a=R.filter(function(i){return i.getKey()===r;});return a[0].getText();};return P;},true);
