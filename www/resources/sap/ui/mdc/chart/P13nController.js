/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2018 SAP SE. All rights reserved
	
 */
sap.ui.define(['sap/ui/mdc/chart/P13nDialogChart','sap/ui/mdc/chart/P13nDialogChartItem','sap/ui/mdc/chart/P13nDialogSort','sap/ui/mdc/chart/P13nDialogSortItem','sap/ui/core/Item','sap/ui/model/json/JSONModel'],function(P,c,d,e,I,J){"use strict";var f={createAndApplyChangeSetChartType:function(C,s){sap.ui.getCore().loadLibrary('sap.ui.fl',{async:true}).then(function(){sap.ui.require(['sap/ui/fl/FlexControllerFactory','sap/ui/fl/ControlPersonalizationAPI','sap/ui/mdc/flexibility/Chart.flexibility','sap/ui/mdc/flexibility/ChartItem.flexibility','sap/ui/fl/Utils'],function(F,a,b,g,U){var r=[];this._addChangeSetChartType(C,b,s,r);var A=U.getAppComponentForControl(C);var R=r.map(function(E){return E.methodName(E.params);});a.addPersonalizationChanges({controlChanges:R,ignoreVariantManagement:true}).then(function(h){return a.saveChanges(h,A);});}.bind(this));}.bind(this));},showChartDialog:function(D,o,C){return sap.ui.getCore().loadLibrary('sap.ui.fl',{async:true}).then(function(){sap.ui.require(['sap/ui/fl/FlexControllerFactory','sap/ui/fl/ControlPersonalizationAPI','sap/ui/mdc/flexibility/Chart.flexibility','sap/ui/mdc/flexibility/ChartItem.flexibility','sap/ui/fl/Utils'],function(F,g,h,i,U){return F.createForControl(C).waitForChangesToBeApplied(C).then(function(){return new Promise(function(r){var R=[];var j=[];var k={};D.items.sort(function(a,b){if(a.text<b.text){return-1;}else if(a.text>b.text){return 1;}else{return 0;}});var l=D.items.filter(function(M){return!this._getArrayElementByKey(M.key,o.items);}.bind(this));Object.assign(o,{items:o.items.concat(l)});Object.assign(o,{showResetEnabled:this._isDirtyChart(D,o)});var m=new J(o);var A=U.getAppComponentForControl(C);var v=U.getViewForControl(C);var p=new P({showReset:false,showResetEnabled:{path:'$sapuimdcchartP13nDialogChart>/showResetEnabled'},chartType:{path:'$sapuimdcchartP13nDialogChart>/chartType'},availableChartTypes:{path:'$sapuimdcchartP13nDialogChart>/availableChartTypes',templateShareable:false,template:new I({key:"{$sapuimdcchartP13nDialogChart>key}",text:"{$sapuimdcchartP13nDialogChart>text}"})},items:{path:'$sapuimdcchartP13nDialogChart>/items',templateShareable:false,template:new c({key:"{$sapuimdcchartP13nDialogChart>key}",text:"{$sapuimdcchartP13nDialogChart>text}",tooltip:"{$sapuimdcchartP13nDialogChart>tooltip}",visible:"{$sapuimdcchartP13nDialogChart>visible}",role:"{$sapuimdcchartP13nDialogChart>role}",availableRoles:{path:'$sapuimdcchartP13nDialogChart>availableRoles',templateShareable:false,template:new I({key:"{$sapuimdcchartP13nDialogChart>key}",text:"{$sapuimdcchartP13nDialogChart>text}"})},roleDependentTypes:{path:'$sapuimdcchartP13nDialogChart>roleDependentTypes',templateShareable:false,template:new I({key:"{$sapuimdcchartP13nDialogChart>key}",text:"{$sapuimdcchartP13nDialogChart>text}"})}})},initialOrderChanged:function(E){var a=m.getProperty("/items");var b=[];E.getParameter("keys").forEach(function(K){b.push(this._getArrayElementByKey(K,a));}.bind(this));m.setProperty("/items",b);}.bind(this),visibilityChanged:function(E){this._addChangeCreateItem(U,C,v,A,h,E.getParameter("key"),m.getProperty("/items"),k,R);this._addChangeHideOrRevealItem(v,i,E.getParameter("key"),E.getParameter("visible"),m.getProperty("/items"),j);m.setProperty("/showResetEnabled",this._isDirtyChart(D,m.getProperty("/")));}.bind(this),positionChanged:function(E){var a=m.getProperty("/items");var M=this._getArrayElementByKey(E.getParameter("key"),a);a.splice(a.indexOf(M),1);a.splice(E.getParameter("position"),0,M);m.setProperty("/items",a);var b=this._getVisibleItems(a).indexOf(M);if(b>-1){this._addChangeCreateItem(U,C,v,A,h,E.getParameter("key"),m.getProperty("/items"),k,R);this._addChangeMoveItem(C,v,A,h,E.getParameter("key"),b,j);}m.setProperty("/showResetEnabled",this._isDirtyChart(D,m.getProperty("/")));}.bind(this),roleChanged:function(E){this._addChangeCreateItem(U,C,v,A,h,E.getParameter("key"),m.getProperty("/items"),k,R);this._addChangeSetRole(v,i,E.getParameter("key"),E.getParameter("role"),m.getProperty("/items"),j);m.setProperty("/showResetEnabled",this._isDirtyChart(D,m.getProperty("/")));}.bind(this),chartTypeChanged:function(E){this._addChangeSetChartType(C,h,E.getParameter("chartType"),j);m.setProperty("/showResetEnabled",this._isDirtyChart(D,m.getProperty("/")));}.bind(this),reset:function(){},ok:function(E){E.getSource().close();E.getSource().destroy();var a=[];g.addPersonalizationChanges({controlChanges:R,ignoreVariantManagement:true}).then(function(b){a=a.concat(b);var q=j.map(function(s){return s.methodName(s.params);});return g.addPersonalizationChanges({controlChanges:q,ignoreVariantManagement:true});}).then(function(b){a=a.concat(b);return g.saveChanges(a,A);}).then(function(){return r();});},cancel:function(E){m.setProperty("/",jQuery.extend(true,{},n));E.getSource().close();E.getSource().destroy();return r();}});p.setModel(m,"$sapuimdcchartP13nDialogChart");var n=jQuery.extend(true,{},m.getProperty("/"));C.addDependent(p);p.open();}.bind(this));}.bind(this));}.bind(this));}.bind(this));},showSortDialog:function(D,o,C){return new Promise(function(r,g){sap.ui.getCore().loadLibrary('sap.ui.fl',{async:true}).then(function(){sap.ui.require(['sap/ui/fl/FlexControllerFactory','sap/ui/fl/ControlPersonalizationAPI','sap/ui/mdc/flexibility/Chart.flexibility','sap/ui/mdc/flexibility/ChartItem.flexibility','sap/ui/fl/Utils'],function(F,h,i,j,U){F.createForControl(C).waitForChangesToBeApplied(C).then(function(){var R=[];D.items.sort(function(a,b){if(a.text<b.text){return-1;}else if(a.text>b.text){return 1;}else{return 0;}});var k=D.items.filter(function(M){return!this._getArrayElementByKey(M.key,o.items);}.bind(this));Object.assign(o,{items:o.items.concat(k)});Object.assign(o,{showResetEnabled:this._isDirtySort(D,o)});var l=new J(o);var A=U.getAppComponentForControl(C);var p=new d({showReset:false,showResetEnabled:{path:'$sapuimdcchartP13nDialogSort>/showResetEnabled'},items:{path:'$sapuimdcchartP13nDialogSort>/items',templateShareable:false,template:new e({key:"{$sapuimdcchartP13nDialogSort>key}",text:"{$sapuimdcchartP13nDialogSort>text}",tooltip:"{$sapuimdcchartP13nDialogSort>tooltip}",sortOrder:"{$sapuimdcchartP13nDialogSort>sortOrder}",selected:"{$sapuimdcchartP13nDialogSort>selected}"})},initialOrderChanged:function(E){var a=l.getProperty("/items");var b=[];E.getParameter("keys").forEach(function(K){b.push(this._getArrayElementByKey(K,a));}.bind(this));l.setProperty("/items",b);}.bind(this),sortCreated:function(E){this._addChangeCreateSort(C,i,E.getParameter("key"),E.getParameter("sortOrder"),R);l.setProperty("/showResetEnabled",this._isDirtySort(D,l.getProperty("/")));}.bind(this),sortRemoved:function(E){this._addChangeRemoveSort(C,i,E.getParameter("key"),R);l.setProperty("/showResetEnabled",this._isDirtySort(D,l.getProperty("/")));}.bind(this),sortOrderChanged:function(E){this._addChangeSetSortOrder(C,i,E.getParameter("key"),E.getParameter("sortOrder"),R);l.setProperty("/showResetEnabled",this._isDirtySort(D,l.getProperty("/")));}.bind(this),positionChanged:function(E){var a=l.getProperty("/items");var M=this._getArrayElementByKey(E.getParameter("key"),a);a.splice(a.indexOf(M),1);a.splice(E.getParameter("position"),0,M);l.setProperty("/items",a);var b=this._getSelectedItems(a).indexOf(M);if(b>-1){this._addChangeMoveSort(C,i,E.getParameter("key"),b,R);}l.setProperty("/showResetEnabled",this._isDirtySort(D,l.getProperty("/")));}.bind(this),reset:function(){},ok:function(E){E.getSource().close();E.getSource().destroy();var a=R.map(function(b){return b.methodName(b.params);});h.addPersonalizationChanges({controlChanges:a,ignoreVariantManagement:true}).then(function(b){return h.saveChanges(b,A);}).then(function(){return r(true);});},cancel:function(E){l.setProperty("/",jQuery.extend(true,{},m));E.getSource().close();E.getSource().destroy();return r(false);}});p.setModel(l,"$sapuimdcchartP13nDialogSort");var m=jQuery.extend(true,{},l.getProperty("/"));C.addDependent(p);p.open();}.bind(this));}.bind(this));}.bind(this));}.bind(this));},_addChangeCreateItem:function(U,C,v,a,b,k,m,i,r){var M=this._getArrayElementByKey(k,m);var o=b.createItem.createChange({chart:C,appComponent:a,itemIdsOfAlreadyCreatedChanges:i,id:v?v.createId(M.key):M.key,key:M.key});if(o){r.push(o);}},_addChangeHideOrRevealItem:function(v,C,k,V,m,r){var M=this._getArrayElementByKey(k,m);r.push({methodName:C[V?"revealItem":"hideItem"].createChange,params:{id:v?v.createId(M.key):M.key}});},_addChangeSetRole:function(v,C,k,r,m,R){var M=this._getArrayElementByKey(k,m);R.push({methodName:C.setRole.createChange,params:{id:v?v.createId(M.key):M.key,role:r}});},_addChangeMoveItem:function(C,v,a,b,k,r,R){R.push({methodName:b.moveItem.createChange,params:{chart:C,appComponent:a,id:v?v.createId(k):k,relativePosition:r}});},_addChangeSetChartType:function(C,a,s,r){r.push({methodName:a.setChartType.createChange,params:{chart:C,chartType:s}});},_addChangeCreateSort:function(C,a,k,s,r){r.push({methodName:a.createSort.createChange,params:{chart:C,key:k,sortOrder:s}});},_addChangeRemoveSort:function(C,a,k,r){r.push({methodName:a.removeSort.createChange,params:{chart:C,key:k}});},_addChangeSetSortOrder:function(C,a,k,s,r){r.push({methodName:a.setSortOrder.createChange,params:{chart:C,key:k,sortOrder:s}});},_addChangeMoveSort:function(C,a,k,r,R){R.push({methodName:a.moveSort.createChange,params:{chart:C,key:k,relativePosition:r}});},_getArrayElementByKey:function(k,a){var E=a.filter(function(o){return o.key!==undefined&&o.key===k;});return E.length?E[0]:null;},_getSelectedItems:function(m){return m.filter(function(M){return M.selected;});},_getVisibleItems:function(m){return m.filter(function(M){return M.visible;});},_isDirtyChart:function(D,o){var i=function(a,b){if(a.length!==b.length){return false;}var g=a.filter(function(h,j){return h.key!==b[j].key||h.visible!==b[j].visible||h.role!==b[j].role;});return g.maxLength===0;};return(D.chartType!==o.chartType)||!i(o.items,D.items);},_isDirtySort:function(D,o){var i=function(a,b){if(a.length!==b.length){return false;}var g=a.filter(function(h,j){return h.key!==b[j].key||h.visible!==b[j].visible||h.role!==b[j].role;});return g.maxLength===0;};return(D.chartType!==o.chartType)||!i(o.items,D.items);}};return f;},true);
