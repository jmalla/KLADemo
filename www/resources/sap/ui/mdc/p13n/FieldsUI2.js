/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2018 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/Device","sap/ui/core/Control","sap/m/List","sap/m/StandardListItem","sap/m/OverflowToolbar","sap/m/ToolbarSpacer","sap/m/Title","sap/m/Button","sap/m/SearchField","sap/m/FlexBox","sap/ui/model/Filter","sap/ui/model/Sorter","sap/ui/model/json/JSONModel","sap/ui/core/dnd/DragInfo","sap/ui/core/dnd/DragDropInfo"],function(D,C,L,S,O,T,a,B,b,F,c,d,J,e,f){"use strict";var g=C.extend("sap.ui.mdc.p13n.FieldsUI2",{library:"sap.ui.mdc",metadata:{defaultAggregation:"items",properties:{fetchFields:{type:"function"},reorderMode:{type:"boolean",defaultValue:false}},aggregations:{_content:{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"}}},constructor:function(){C.apply(this,arguments);var r=sap.ui.getCore().getLibraryResourceBundle("sap.ui.mdc");var m="MultiSelect",h=new O({content:[new a({text:r.getText("fieldsui.SELECTED_FIELDS")}),new T(),new b({width:"15rem",liveChange:[this._onSelectedListSearch,this]})]}),t=new S({title:"{label}",selected:"{selected}"}),i;if(this.getReorderMode()){m="SingleSelectMaster";[new B({icon:"sap-icon://collapse-group",tooltip:r.getText("fieldsui.MOVE_TO_TOP"),press:[this._onMoveTop,this]}),new B({icon:"sap-icon://slim-arrow-up",tooltip:r.getText("fieldsui.MOVE_UP"),press:[this._onMoveUp,this]}),new B({icon:"sap-icon://slim-arrow-down",tooltip:r.getText("fieldsui.MOVE_DOWN"),press:[this._onMoveDown,this]}),new B({icon:"sap-icon://expand-group",tooltip:r.getText("fieldsui.MOVE_TO_BOTTOM"),press:[this._onMoveBottom,this]})].forEach(function(o){h.addContent(o);});t.unbindProperty("selected");i=[new f({sourceAggregation:"items",targetAggregation:"items",dropPosition:"Between",drop:[this._onRearrange,this]}),new e({sourceAggregation:"items",dragStart:[this._onDragStart,this]})];}this._oSelectedList=new L(this.getId()+"-list",{mode:m,growing:true,growingThreshold:50,growingScrollToLoad:true,includeItemInSelection:true,rememberSelections:false,noDataText:r.getText("fieldsui.MOVE_TO_SELECTED"),headerToolbar:h,items:{path:"/",key:"name",template:t},dragDropConfig:i});this._oSelectedModel=new J([]);this._oSelectedList.setModel(this._oSelectedModel);this.setAggregation("_content",this._oSelectedList);this.refreshFields();},renderer:function(r,o){r.write("<div");r.writeControlData(o);r.addClass("sapUiMDCFieldsUI");r.writeClasses();r.write(">");r.renderControl(o.getAggregation("_content"));r.write("</div>");}});g.prototype.exit=function(){this._oSelectedList=null;this._oSelectedModel.destroy();this._oSelectedModel=null;};g.prototype.setFetchFields=function(h){this.setProperty("fetchFields",h,true);if(this._oSelectedModel){this.refreshFields();}return this;};g.prototype.refreshFields=function(){var A=this.getFetchFields()()||[];A.sort(function(m,h){if(m.selected&&h.selected){return(m.position||0)-(h.position||0);}else if(m.selected){return-1;}else if(h.selected){return 1;}return 0;});this._oSelectedModel.setData(A);};g.prototype.getSelectedFields=function(){var h=this._oSelectedModel.getData().slice();return h.filter(function(o){return o.selected;});};g.prototype._onSelectedListSearch=function(E){this._oSelectedList.getBinding("items").filter(new c("label","Contains",E.getParameter("newValue")));};g.prototype._moveItem=function(i,n){var I=this._oSelectedList.getItems();var s=this._oSelectedModel.getData();var o=s.indexOf(i.getBindingContext().getObject());n=(n<=0)?0:Math.min(n,I.length-1);n=s.indexOf(I[n].getBindingContext().getObject());if(n==o){return;}s.splice(n,0,s.splice(o,1)[0]);this._oSelectedModel.setData(s);};g.prototype._moveSelectedItem=function(n){var i=this._oSelectedList.getItems();var s=this._oSelectedList.getSelectedItem();var h=i.indexOf(s);if(h<0){return;}var N=(typeof n=="number")?n:h+(n=="Up"?-1:1);this._moveItem(s,N,true);};g.prototype._onMoveTop=function(E){this._moveSelectedItem(0);};g.prototype._onMoveUp=function(E){this._moveSelectedItem("Up");};g.prototype._onMoveDown=function(E){this._moveSelectedItem("Down");};g.prototype._onMoveBottom=function(E){this._moveSelectedItem(this._oSelectedList.getItems().length-1);};g.prototype._onRearrange=function(E){var o=E.getParameter("draggedControl");var h=E.getParameter("droppedControl");var s=E.getParameter("dropPosition");var i=this._oSelectedList.indexOfItem(h)+(s=="Before"?-1:1);this._moveItem(o,i);};g.prototype._onDragStart=function(E){E.getParameter("target").setSelected(true);};return g;},false);
