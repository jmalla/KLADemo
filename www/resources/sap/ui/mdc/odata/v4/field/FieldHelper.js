/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2018 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/mdc/odata/v4/CommonHelper","sap/ui/mdc/base/FieldBase","sap/ui/mdc/ResourceModel","sap/ui/model/odata/v4/AnnotationHelper","sap/ui/base/ManagedObject","sap/base/Log"],function(c,F,R,A,M,L){"use strict";var I="@Org.OData.Measures.V1.ISOCurrency",U={},C=', ';U[I]={ui5Type:"sap.ui.model.type.Currency",formatOptions:'parseAsString : true'};var a={buildExpressionForCriticalityIcon:function(s){if(s){var e="{= (${"+s+"} === 'com.sap.vocabularies.UI.v1.CriticalityType/Negative') || (${"+s+"} === '1') || (${"+s+"} === 1) ? 'sap-icon://status-negative' : "+"(${"+s+"} === 'com.sap.vocabularies.UI.v1.CriticalityType/Critical') || (${"+s+"} === '2') || (${"+s+"} === 2) ? 'sap-icon://status-critical' : "+"(${"+s+"} === 'com.sap.vocabularies.UI.v1.CriticalityType/Positive') || (${"+s+"} === '3') || (${"+s+"} === 3) ? 'sap-icon://status-positive' : "+"'sap-icon://status-inactive' }";return e;}return undefined;},buildExpressionForCriticalityColor:function(s){if(s){var e="{= (${"+s+"} === 'com.sap.vocabularies.UI.v1.CriticalityType/Negative') || (${"+s+"} === '1') || (${"+s+"} === 1) ? 'Error' : "+"(${"+s+"} === 'com.sap.vocabularies.UI.v1.CriticalityType/Critical') || (${"+s+"} === '2') || (${"+s+"} === 2) ? 'Warning' : "+"(${"+s+"} === 'com.sap.vocabularies.UI.v1.CriticalityType/Positive') || (${"+s+"} === '3') || (${"+s+"} === 3) ? 'Success' : "+"'None' }";return e;}return undefined;},buildExpressionForTextValue:function(p,d){var m=d.context.getModel(),P=d.context.getPath(),t=m.getObject(P+"@com.sap.vocabularies.Common.v1.Text"),T=t?A.value(t,d):"",e="";p=A.getNavigationPath(p);if(p.indexOf('/')>-1&&T){e="{"+p.substr(0,p.indexOf('/')+1)+T.substr(1,T.length-2)+"}";}else{e=T;}if(e){e="{ path : '"+e.substr(1,e.length-2)+"', mode : 'OneWay'}";}return e;},getStableIdPartFromDataField:function(d,p){var P="",s="";if(d.$Type&&d.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAction"){return c.replaceSpecialCharsInId(d.Action);}else if(d.$Type&&(d.$Type==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"||d.$Type==="com.sap.vocabularies.UI.v1.DataFieldWithIntentBasedNavigation")){if(typeof d.SemanticObject=="string"){s=c.replaceSpecialCharsInId(d.SemanticObject);}else if(d.SemanticObject.$Path){s=c.replaceSpecialCharsInId(d.SemanticObject.$Path);}if(typeof d.Action=="string"){s=s+"::"+c.replaceSpecialCharsInId(d.Action);}else if(d.Action&&d.Action.$Path){s=s+"::"+c.replaceSpecialCharsInId(d.Action.$Path);}return s;}else if(d.$Type&&d.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAnnotation"){return c.replaceSpecialCharsInId(d.Target.$AnnotationPath);}else if(d.Value&&d.Value.$Path){return c.replaceSpecialCharsInId(d.Value.$Path);}else if(d.Value&&d.Value.$Apply&&d.Value.$Function==="odata.concat"){for(var i=0;i<d.Value.$Apply.length;i++){if(d.Value.$Apply[i].$Path){if(P){P=P+"::";}P=P+c.replaceSpecialCharsInId(d.Value.$Apply[i].$Path);}}return P;}else if(p&&p.context&&p.context.getObject("@sapui.name")){return c.replaceSpecialCharsInId(p.context.getObject("@sapui.name"));}else{L.error("Annotation Helper: Unable to create a stable ID. Please check the annotations.");}return undefined;},isNotAlwaysHidden:function(d,D){var o=D.context,i=false;if(d.Value&&d.Value.$Path){i=o.getObject("Value/$Path@com.sap.vocabularies.UI.v1.Hidden");}if(!i||i.$Path){i=o.getObject("@com.sap.vocabularies.UI.v1.Hidden");if(!i||i.$Path){i=false;}}return!i;},isSemanticKey:function(o,v){var e=o.getPath().split('/')[1];var s=o.getModel().getObject("/"+e+"/@com.sap.vocabularies.Common.v1.SemanticKey");if(s){for(var i=0;i<s.length;i++){if(s[i].$PropertyPath===v.$Path){return true;}}}return false;},getEditMode:function(o,p,d,D,e){if(e==='Display'||e==='ReadOnly'||e==='Disabled'){return e;}var P=o.getPath(0);var m=o.getModel(0);var b,i,f,r,s,E,g,h,j;if(d==="com.sap.vocabularies.UI.v1.DataFieldWithIntentBasedNavigation"||d==="com.sap.vocabularies.UI.v1.DataFieldWithUrl"){return'Display';}if(m.getObject(P+"@Org.OData.Core.V1.Computed")){b=m.getObject(P+"@Org.OData.Core.V1.Computed/Bool")?m.getObject(P+"@Org.OData.Core.V1.Computed/Bool"):"true";}if(m.getObject(P+"@Org.OData.Core.V1.Immutable")){i=m.getObject(P+"@Org.OData.Core.V1.Immutable/Bool")?m.getObject(P+"@Org.OData.Core.V1.Immutable/Bool"):"true";}r=(b=="true"||i=="true");var k=function(b,i){if(b){return b=="false";}if(i){return i=="true";}return true;};h=k(b,i);if(m.getObject(P+"@com.sap.vocabularies.Common.v1.FieldControl")){if(m.getObject(P+"@com.sap.vocabularies.Common.v1.FieldControl/$Path")){var l=m.getObject(P+"@com.sap.vocabularies.Common.v1.FieldControl");var n=m.createBindingContext(P+"@com.sap.vocabularies.Common.v1.FieldControl");j="$"+A.value(l,{context:n})+" === 1";}else if(m.getObject(P+"@com.sap.vocabularies.Common.v1.FieldControl/$EnumMember")){f=m.getObject(P+"@com.sap.vocabularies.Common.v1.FieldControl/$EnumMember");r=(r||f=="com.sap.vocabularies.Common.v1.FieldControlType/ReadOnly");}}if(r){if(!h||!D){return'Display';}else{return"{= !${IsActiveEntity} && !${HasActiveEntity} ? 'Editable' : 'Display'}";}}var q;g=M.bindingParser(e)?"$"+e:"'"+e+"'";if(j){s=j+" ? 'Display' :"+g;q="{= "+s+"}";}else{s=g;q=e;}E=h||!D?q:"{= !${IsActiveEntity} && !${HasActiveEntity} ? 'Display' : "+s+"}";return E;},isLineItem:function(p,i){if(i.context.getPath().indexOf("@com.sap.vocabularies.UI.v1.LineItem")>-1){return true;}return false;},getRequiredForDataField:function(f,i){if(f!==undefined){if(f.$EnumMember&&f.$EnumMember==="com.sap.vocabularies.Common.v1.FieldControlType/Mandatory"){return true;}else if(f.$Path){var e="{= $"+A.value(f,{context:i.context})+" === 7 ? true : false}";return e;}}return false;},_createBindingForDraftAdminBlock:function(m,e,f){var p="/"+e+"/DraftAdministrativeData/";return m.requestObject(p).then(function(d){var b="{parts: [{path: 'HasDraftEntity', targetType: 'any'}, "+"{path: 'DraftAdministrativeData/InProcessByUser'}, "+"{path: 'DraftAdministrativeData/LastChangedByUser'} ";if(d.InProcessByUserDescription){b+=" ,{path: 'DraftAdministrativeData/InProcessByUserDescription'}";}if(d.LastChangedByUserDescription){b+=", {path: 'DraftAdministrativeData/LastChangedByUserDescription'}";}b+="], formatter: 'sap.ui.mdc.odata.v4.field.FieldRuntime."+f+"'}";return b;});},getBindingForDraftAdminBlockInline:function(i,e){return a._createBindingForDraftAdminBlock(i.getModel(),e,'formatDraftOwnerTextInline');},getBindingForDraftAdminBlockInPopover:function(i,e){return a._createBindingForDraftAdminBlock(i.getModel(),e,'formatDraftOwnerTextInPopover');},typeConstraints:function(p,P){var s="",m,t=p.$Type;s+=(p.$Nullable!==undefined&&!p.$Nullable?'nullable: '+p.$Nullable:'');if(["Edm.Decimal","Edm.DateTimeOffset"].indexOf(t)>-1){s+=(s?C:'');s+=(p.$Precision?'precision: '+p.$Precision:'');s+=(p.$Scale?(s?C:'')+'scale: '+(p.$Scale==="variable"?"'"+p.$Scale+"'":p.$Scale):'');}else if(t==="Edm.String"){m=p.$MaxLength;if(m){s+=(s?C:'');s+="maxLength: "+m;}if(P["@com.sap.vocabularies.Common.v1.IsUpperCase"]){}}return s;},value:function(p,i){var o=i.context,P=o.getPath(),m=p.$Path||p.$Name||P.split("/").pop(),s=!p.$Name&&("/"+i.schemaChildName+"/"+m),b=s&&(s+"@"),d=b?i.context.getObject(b,i.context):{},r=p.$Path?o.getObject(P,i.context):p;return Promise.resolve().then(function(v){var e='',f='',g='',h,j,u;if(m&&d){j=d.hasOwnProperty(I)&&I;if(j){h=d[j];u=U[j];e='{'+'parts: ['+'\''+m+'\',\''+h.$Path+'\''+'], type: \''+u.ui5Type+'\'';g+=u.formatOptions;}else{e='{path: \''+m+'\'';e+=',type: \''+F.mapEdmTypes[r.$Type]+'\'';}f+=(f?C:'')+a.typeConstraints(r,d);e+=f?',constraints: {'+f+'}':'';g+=['Edm.Date','Edm.DateTimeOffset'].indexOf(r.$Type)>-1?(g?C:'')+'style : \'medium\'':'';e+=g?',formatOptions : {'+g+'}':'';e+='}';}else{e=A.value(p,{context:o});}return e;});},getFieldGroupIds:function(o,p,e){var m=o.getInterface(0).getModel(),b=m.getObject('/'),s={},f=function(k){return b[k]['$kind']==='EntitySet';},d=function(E){var e=b[E]['$Type'],i=m.getObject('/'+e+'@');Object.keys(i).filter(function(j){return j.indexOf('@com.sap.vocabularies.Common.v1.SideEffects')>-1;}).forEach(function(S){var q=S.indexOf('#')>-1&&S.substr(S.indexOf('#'))||'',j=i[S],k=j.SourceProperties||[],l=j.SourceEntities||[];k.forEach(function(r){var P=r['$PropertyPath'],n=A.getNavigationPath(P),O=e;if(n.indexOf('/')>-1){O=m.getObject('/'+e+'/'+n.substr(0,n.lastIndexOf('/')))['$Type'];P=n.substr(n.lastIndexOf('/')+1);}s[O]=s[O]||[[],{}];s[O][1][P]=s[O][1][P]||[];s[O][1][P].push(e+q);});l.forEach(function(r){var n=r['$NavigationPropertyPath'],O=m.getObject('/'+e+'/'+n)['$Type'];s[O]=s[O]||[[],{}];s[O][0].push(e+q);});});};Object.keys(b).filter(f).forEach(d);var P=p,n=A.getNavigationPath(p),O=e,g,h;if(n.indexOf('/')>-1){O=m.getObject('/'+e+'/'+n.substr(0,n.lastIndexOf('/')));P=n.substr(n.lastIndexOf('/'));}g=s[O][0].concat(s[O][1][P]||[]);if(g.length){h=g.reduce(function(r,i){return(r&&r+','+i)||i;});}return h;}};a.isSemanticKey.requiresIContext=true;a.buildExpressionForTextValue.requiresIContext=true;a.getEditMode.requiresIContext=true;a.getRequiredForDataField.requiresIContext=true;a.getBindingForDraftAdminBlockInline.requiresIContext=true;a.getBindingForDraftAdminBlockInPopover.requiresIContext=true;a.value.requiresIContext=true;a.getFieldGroupIds.requiresIContext=true;return a;},true);
