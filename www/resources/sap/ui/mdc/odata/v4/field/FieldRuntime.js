/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2018 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/core/XMLTemplateProcessor",'sap/ui/core/util/XMLPreprocessor','sap/ui/core/Fragment','sap/ui/mdc/ResourceModel','sap/ui/fl/Utils'],function(X,a,F,R,f){"use strict";var b={formatDraftOwnerText:function(h,d,D,s,c,i){var e='';if(h){var u=D||d||c||s;if(!i){e+=d?R.getText('draft.GENERIC_LOCKED_OBJECT_POPOVER_TEXT'):R.getText('draft.LAST_CHANGE_USER_TEXT')+' ';}e+=u?R.getText('draft.OWNER',[u]):R.getText('draft.ANOTHER_USER');}return e;},formatDraftOwnerTextInline:function(h,d,D,s,c){return b.formatDraftOwnerText(h,d,s,D,c,true);},formatDraftOwnerTextInPopover:function(h,d,D,s,c){return b.formatDraftOwnerText(h,d,s,D,c,false);},onDraftLinkPressed:function(e,E){var t=this,s=e.getSource(),v=f.getViewForControl(s),B=s.getBindingContext(),m=B.getModel().getMetaModel(),V=v.getId(),d;this.mDraftPopovers=this.mDraftPopovers||{};this.mDraftPopovers[V]=this.mDraftPopovers[V]||{};d=this.mDraftPopovers[V][E];if(d){d.setBindingContext(B);d.openBy(s);}else{var c='sap.ui.mdc.odata.v4.field.DraftPopOverAdminData',p=X.loadTemplate(c,'fragment');Promise.resolve(a.process(p,{},{bindingContexts:{entitySet:m.createBindingContext("/"+E)},models:{entitySet:m}})).then(function(o){return F.load({definition:o,controller:t});}).then(function(P){d=t.mDraftPopovers[V][E]=P;d.setModel(R.getModel(),"i18n");v.addDependent(d);d.setBindingContext(B);d.openBy(s);});}},closeDraftAdminPopover:function(e){e.getSource().getParent().getParent().close();},handleChange:function(e,E){var t=this,s=e.getSource();this.aChangedFields=this.aChangedFields||[];this.aPendingSideEffects=this.aPendingSideEffects||[];if(s.getFieldGroupIds()){s.getFieldGroupIds().forEach(function(c){if(t.aPendingSideEffects.indexOf(c)===-1){t.aPendingSideEffects.push(c);}});}},handleSideEffect:function(e,B){var t=this,c=e.getParameter('fieldGroupIds'),o=e.getSource().getBindingContext(),C=o.getBinding().getContext(),m=o.getModel().getMetaModel();c=c||[];c.forEach(function(s){var p=[],w=s.indexOf('#')>-1,E=(w&&s.split('#')[0])||s,q=(w&&s.split('#')[1])||'',S='/'+E+'@com.sap.vocabularies.Common.v1.SideEffects',d;if(E!==B){return;}S=(w&&(S+'#'+q))||S;d=m.getObject(S);if(d&&t.aPendingSideEffects.indexOf(s)>-1){p=p.concat(d.TargetProperties||[]).concat(d.TargetEntities||[]);if(p.length){if(d.PreparationAction){var P=m.getObject('/'+E+'/$Key')[0];C.getModel().bindContext(d.PreparationAction+'(...)',C,{'$select':P}).execute();}C.requestSideEffects(p).then(function(){t.aPendingSideEffects.splice(t.aPendingSideEffects.indexOf(s),1);},function(){});}}});}};return b;},true);
