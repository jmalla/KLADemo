/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2018 SAP SE. All rights reserved
	
 */
sap.ui.define(['sap/ui/fl/changeHandler/Base','sap/ui/core/util/reflection/JsControlTreeModifier','sap/ui/model/Sorter'],function(B,J,S){"use strict";return{"createItem":{layers:{USER:true},createChange:function(p){if(sap.ui.getCore().byId(p.id)){return null;}if(p.itemIdsOfAlreadyCreatedChanges[p.id]){return null;}p.itemIdsOfAlreadyCreatedChanges[p.id]=true;var s=J.getSelector(p.id,p.appComponent);if(!s.idIsLocal){throw new Error("Invalid 'idIsLocal'. The id "+p.id+" should contain the app component id");}return{selectorControl:p.chart,changeSpecificData:{changeType:"createItem",content:{selectorItem:s,key:p.key}}};},changeHandler:{applyChange:function(c,C,p){var s=c.getContent().selectorItem;return new Promise(function(r){C.getModel();sap.ui.require(['sap/ui/mdc/chart/Item',p.modifier.getProperty(C,"metadataDelegate")],function(I,M){if(p.modifier.bySelector(s,p.appComponent,p.view)){return r();}var k=c.getContent().key;var m=M.retrieveAllMetadata(C);var a=m.items.filter(function(d){return d.name===k;});if(!a.length){return r();}var i=p.modifier.getControlIdBySelector(s,p.appComponent);var o=p.modifier.createControl("sap.ui.mdc.chart.Item",p.appComponent,p.view,i,{name:a[0].name,label:a[0].label,role:a[0].role,type:a[0].kind});var b=p.modifier.getAggregation(C,"items");p.modifier.insertAggregation(C,"items",o,b.length);return r();});});},revertChange:function(c,C,p){var s=c.getContent().selectorItem;var i=p.modifier.bySelector(s,p.appComponent,p.view);if(!i){return B.markAsNotApplicable("revertChange of createItem: the item with selector "+s+" is not existing and therefore can not be reverted.",true);}p.modifier.removeAggregation(C,"items",i);},completeChangeContent:function(c,s){}}},"moveItem":{layers:{USER:true},createChange:function(p){if(!p.chart){throw new Error("Invalid chart. The existing chart object is mandatory");}if(!sap.ui.getCore().byId(p.id)){throw new Error("Invalid id. The item with the id "+p.id+" is mandatory");}var s=J.getSelector(p.id,p.appComponent);if(!s.idIsLocal){throw new Error("Invalid 'idIsLocal'. The id "+p.id+" should contain the app component id");}return{selectorControl:p.chart,changeSpecificData:{changeType:"moveItem",content:{selectorItem:s,relativePosition:p.relativePosition}}};},changeHandler:{applyChange:function(c,C,p){var s=c.getContent().selectorItem;var i=p.modifier.bySelector(s,p.appComponent,p.view);if(!i){return B.markAsNotApplicable("applyChange of moveIem: the item with selectorItem "+s+" dose not yet exist and therefore it can not be moved.",true);}var I=p.modifier.findIndexInParentAggregation(i);if(I===c.getContent().relativePosition){return;}c.setRevertData(I);p.modifier.removeAggregation(C,"items",i);p.modifier.insertAggregation(C,"items",i,c.getContent().relativePosition);},revertChange:function(c,C,p){var s=c.getContent().selectorItem;var i=p.modifier.bySelector(s,p.appComponent,p.view);if(!i){return;}var I=p.modifier.findIndexInParentAggregation(i);if(I===c.getRevertData()){return;}p.modifier.removeAggregation(C,"items",i);p.modifier.insertAggregation(C,"items",i,c.getRevertData());c.resetRevertData();},completeChangeContent:function(c,s){}}},"setChartType":{layers:{USER:true},createChange:function(p){if(!p.chart){throw new Error("Invalid chart. The existing chart object is mandatory");}return{selectorControl:p.chart,changeSpecificData:{changeType:"setChartType",content:{chartType:p.chartType}}};},changeHandler:{applyChange:function(c,C,p){c.setRevertData(p.modifier.getProperty(C,"chartType"));p.modifier.setProperty(C,"chartType",c.getContent().chartType);},revertChange:function(c,C,p){p.modifier.setProperty(C,"chartType",c.getRevertData());c.resetRevertData();},completeChangeContent:function(c,s){}}},"createSort":{layers:{USER:true},createChange:function(p){if(!p.chart){throw new Error("Invalid chart. The existing chart object is mandatory");}return{selectorControl:p.chart,changeSpecificData:{changeType:"createSort",content:{path:p.key,sortOrder:p.sortOrder}}};},changeHandler:{applyChange:function(c,C,p){if(!C.getSorters){return B.markAsNotApplicable("We can apply the 'createSort' change only during runtime, therefore the change can not be applied during XML processing.",true);}var s=C.getSorters();s.push(new S(c.getContent().path,c.getContent().sortOrder==="Descending"));C.setSorters(s);},revertChange:function(c,C,p){if(!C.getSorters){return B.markAsNotApplicable("We can apply the 'createSort' change only during runtime, therefore the change can not be applied during XML processing.",true);}var s=C.getSorters().filter(function(o){return o.sPath!==c.getContent().path;});C.setSorters(s);},completeChangeContent:function(c,s){}}},"removeSort":{layers:{USER:true},createChange:function(p){if(!p.chart){throw new Error("Invalid chart. The existing chart object is mandatory");}return{selectorControl:p.chart,changeSpecificData:{changeType:"removeSort",content:{path:p.key}}};},changeHandler:{applyChange:function(c,C,p){if(!C.getSorters){return B.markAsNotApplicable("We can apply the 'removeSort' change only during runtime, therefore the change can not be applied during XML processing.",true);}var s=C.getSorters().filter(function(o){return o.sPath!==c.getContent().path;});C.setSorters(s);},revertChange:function(c,C,p){},completeChangeContent:function(c,s){}}},"setSortOrder":{layers:{USER:true},createChange:function(p){if(!p.chart){throw new Error("Invalid chart. The existing chart object is mandatory");}return{selectorControl:p.chart,changeSpecificData:{changeType:"setSortOrder",content:{path:p.key,sortOrder:p.sortOrder}}};},changeHandler:{applyChange:function(c,C,p){if(!C.getSorters){return B.markAsNotApplicable("We can apply the 'setSortOrder' change only during runtime, therefore the change can not be applied during XML processing.",true);}var s=C.getSorters();var a=s.filter(function(o){return o.sPath===c.getContent().path;});c.setRevertData(a[0].sortOrder);a[0].bDescending=c.getContent().sortOrder==="Descending";C.setSorters(s);},revertChange:function(c,C,p){var s=C.getSorters();var a=s.filter(function(o){return o.sPath===c.getContent().path;});a[0].bDescending=c.getRevertData()==="Descending";c.resetRevertData();C.setSorters(s);},completeChangeContent:function(c,s){}}},"moveSort":{layers:{USER:true},createChange:function(p){if(!p.chart){throw new Error("Invalid chart. The existing chart object is mandatory");}return{selectorControl:p.chart,changeSpecificData:{changeType:"moveSort",content:{path:p.key,relativePosition:p.relativePosition}}};},changeHandler:{applyChange:function(c,C,p){if(!C.getSorters){return B.markAsNotApplicable("We can apply the 'moveSorter' change only during runtime, therefore the change can not be applied during XML processing.",true);}var s=C.getSorters();var a=s.filter(function(o){return o.sPath===c.getContent().path;});s.splice(s.indexOf(a[0]),1);s.splice(c.getContent().relativePosition,0,a[0]);C.setSorters(s);},revertChange:function(c,C,p){},completeChangeContent:function(c,s){}}}};},true);
