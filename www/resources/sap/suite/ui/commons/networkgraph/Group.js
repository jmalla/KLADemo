/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/suite/ui/commons/library","sap/ui/thirdparty/jquery","./ElementBase","sap/ui/core/IconPool"],function(l,q,E,I){"use strict";var a=l.networkgraph.ElementStatus;var S={COLLAPSED_HEIGHT:32,COLLAPSED_WIDTH:160,ROUNDING:6,ICON_OFFSET:8,ICON_SIZE:15,HEADER_SIZE:32};var i=I.getIconInfo("collapse-all"),s=I.getIconInfo("expand-all"),b=I.getIconInfo("horizontal-grip");i=i&&i.content;s=s&&s.content;b=b&&b.content;var r=sap.ui.getCore().getLibraryResourceBundle("sap.suite.ui.commons");var G=E.extend("sap.suite.ui.commons.networkgraph.Group",{metadata:{library:"sap.suite.ui.commons",properties:{key:{type:"string",group:"Misc",defaultValue:null},collapsed:{type:"boolean",group:"Misc",defaultValue:false},icon:{type:"string",group:"Appearance",defaultValue:null},minWidth:{type:"float",defaultValue:undefined}},events:{collapseExpand:{},showDetail:{},press:{}}}});G.prototype.aProcessRequiredProperties=["key"];G.BUTTONS={MENU:"menu",COLLAPSE:"collapse"};G.prototype.init=function(){this._iWidth=S.COLLAPSED_WIDTH;this._iHeight=S.COLLAPSED_HEIGHT;this._oActionButtons={};this._clearChildren();this._bIsHidden=false;};G.prototype._afterRendering=function(){this._setupEvents();if(!this._isVerticalSwimLane()){this._correctTitle("sapSuiteUiCommonsNetworkGroupTitle");}else{this._correctSwimLaneVerticalTitle();}if(!this._isVisible()){this.$().hide();}this._removeFromInvalidatedControls();};G.prototype._correctSwimLaneVerticalTitle=function(){var g=function(){var c=this.$("title-clip").children().first();return{x:parseInt(c.attr("x"),10),y:parseInt(c.attr("y"),10),width:parseInt(c.attr("width"),10),height:parseInt(c.attr("height"),10)};}.bind(this);var $=this.$().find(".sapSuiteUiCommonsNetworkGroupTitle");if($[0]){$.css("writing-mode","tb");var B=$[0].getBBox(),m=g(),d=(B.height-m.height)+(B.y-m.y);$.attr("transform","rotate(180 "+(B.x+B.width/2-1)+" "+(B.y+B.height/2)+")");if(d>0){$.attr("y",B.y+d);}}};G.prototype._correctSwimLaneVerticalTitle=function(){var g=function(){var c=this.$("title-clip").children().first();return{x:parseInt(c.attr("x"),10),y:parseInt(c.attr("y"),10),width:parseInt(c.attr("width"),10),height:parseInt(c.attr("height"),10)};}.bind(this);var $=this.$().find(".sapSuiteUiCommonsNetworkGroupTitle");if($[0]){$.css("writing-mode","tb");var B=$[0].getBBox(),m=g(),d=(B.height-m.height)+(B.y-m.y);$.attr("transform","rotate(180 "+(B.x+B.width/2-1)+" "+(B.y+B.height/2)+")");if(d>0){$.attr("y",B.y+d);}}};G.prototype._render=function(o){var F=4;var g="",x=this.getX(),y=this.getY(),c;o=o||{};if(this._isIgnored()||this._isEmpty()||!this.getVisible()){return"";}if(this.getParent()._isLayered()){c=this._getElementId(o.idSufix);g+=this._renderControl("g",{id:c,"data-sap-ui":c,xindex:o.xIndex||0,nodeid:this.getKey(),"class":this._getGroupClass()},false);if(!this._bIsSwimLane){g+=this._renderStandard();}g+=this._renderControl("rect",{id:this.getId()+"-focusheader",x:x+F,style:this._getColorStyle({stroke:E.ColorType.Focus}),y:y+F,width:this._iWidth-F*2,height:S.HEADER_SIZE-F*2,"class":"sapSuiteUiCommonsNetworkGroupFocus"});g+="<g>";if(this._bIsSwimLane){g+=this._renderSwimLane();}g+=this._prepareRenderTitle();g+=this._renderHeaderButtons();g+="</g>";g+="</g>";}return g;};G.prototype._renderSwimLaneVertical=function(){var h="",x=Math.max(this.getX(),1),y=Math.max(this.getY(),1),X=this.getX()+this._iWidth,Y=this.getY()+this._iHeight,c=this.getCollapsed();h+=this._renderControl("rect",{x:x,y:y,width:this._iWidth,height:this._iHeight,"class":"sapSuiteUiCommonsNetworkLaneBackground"});if(!c){h+=this._renderControl("rect",{x:x,y:y,width:this._iWidth,height:S.HEADER_SIZE,"class":"sapSuiteUiCommonsNetworkLaneHeader"});}h+=this._renderControl("line",{x1:x,y1:y,x2:x,y2:Y,"class":"sapSuiteUiCommonsNetworkLane sapSuiteUiCommonsNetworkLaneBorder sapSuiteUiCommonsNetworkLaneBorderBegin"});h+=this._renderControl("line",{x1:this.getX(),y1:y,x2:X,y2:y,"class":""});h+=this._renderControl("line",{x1:X,y1:y,x2:X,y2:Y,"class":"sapSuiteUiCommonsNetworkLane sapSuiteUiCommonsNetworkLaneBorder sapSuiteUiCommonsNetworkLaneBorderEnd"});h+=this._renderControl("line",{x1:x,y1:Y,x2:x+this._iWidth,y2:Y,"class":"sapSuiteUiCommonsNetworkLane"});if(!c){h+=this._renderControl("line",{x1:x,y1:y+S.HEADER_SIZE,x2:x+this._iWidth,y2:y+S.HEADER_SIZE,"class":"sapSuiteUiCommonsNetworkLane"});}if(this.getStatus()&&this.getStatus()!==a.Standard){var C=this._getColorStyle({stroke:E.ColorType.Border});var O=3;if(!this.getCollapsed()){h+=this._renderControl("rect",{x:x,y:y+O,width:4,height:25,style:C,"class":"sapSuiteUiCommonsNetworkLaneStatusBar"});}else{h+=this._renderControl("rect",{x:x+O,y:y,width:this._iWidth-O*2,height:O,style:C,"class":"sapSuiteUiCommonsNetworkLaneStatusBar"});}}return h;};G.prototype._renderSwimLaneHorizontal=function(){var h="",x=Math.max(this.getX(),1),y=Math.max(this.getY(),1),X=this.getX()+this._iWidth,Y=this.getY()+this._iHeight;var H=32;h+=this._renderControl("rect",{x:x,y:y,width:this._iWidth,height:this._iHeight,"class":"sapSuiteUiCommonsNetworkLaneBackground"});if(!this.getCollapsed()){h+=this._renderControl("rect",{x:x,y:y,width:S.HEADER_SIZE,height:this._iHeight,"class":"sapSuiteUiCommonsNetworkLaneHeader"});}h+=this._renderControl("line",{x1:this.getX(),y1:y,x2:X,y2:y,"class":"sapSuiteUiCommonsNetworkLane sapSuiteUiCommonsNetworkLaneBorder sapSuiteUiCommonsNetworkLaneBorderBegin"});h+=this._renderControl("line",{x1:this.getX(),y1:Y,x2:X,y2:Y,"class":"sapSuiteUiCommonsNetworkLane sapSuiteUiCommonsNetworkLaneBorder sapSuiteUiCommonsNetworkLaneBorderEnd"});h+=this._renderControl("line",{x1:x,y1:y,x2:x,y2:Y,"class":"sapSuiteUiCommonsNetworkLane"});h+=this._renderControl("line",{x1:X,y1:y,x2:X,y2:Y,"class":"sapSuiteUiCommonsNetworkLane"});if(this._isVerticalSwimLane()){h+=this._renderControl("line",{x1:x+H,y1:y,x2:x+H,y2:Y,"class":"sapSuiteUiCommonsNetworkLane"});}return h;};G.prototype._renderSwimLane=function(){return this._isTopBottom()?this._renderSwimLaneHorizontal():this._renderSwimLaneVertical();};G.prototype._renderStandard=function(){var x=this.getX(),y=this.getY();var g=this._renderControl("rect",{x:x,y:y,rx:S.ROUNDING,ry:S.ROUNDING,"class":"sapSuiteUiCommonsNetworkGroupWrapper",style:this._getColorStyle({stroke:E.ColorType.Border}),width:this._iWidth,height:this._iHeight});if(this.getCollapsed()){g+=this._renderControl("rect",{id:this.getId()+"-header",style:this._getColorStyle({fill:E.ColorType.Background,stroke:E.ColorType.Border}),x:x,y:y,width:this._iWidth,height:S.HEADER_SIZE,"class":"sapSuiteUiCommonsNetworkGroupHeader"});}else{g+=this._renderRoundRect({id:this.getId()+"-header",x:x,y:y,width:this._iWidth,style:this._getColorStyle({fill:E.ColorType.Background,stroke:E.ColorType.Border}),height:S.HEADER_SIZE,"class":"sapSuiteUiCommonsNetworkGroupHeader",topRight:S.ROUNDING,topLeft:S.ROUNDING});}return g;};G.prototype._prepareRenderTitle=function(){var B=70,T=S.HEADER_SIZE/2,c=15,O=6,t=this._isTopBottom(),v=this._isVerticalSwimLane(),d=(v?this._iHeight:this._iWidth)-O-B,e=this.getParent()._bIsRtl;var h="";var x=e?this.getX()+this._iWidth-S.ICON_OFFSET:this.getX()+S.ICON_OFFSET,y=this.getY()+T;if(this._bIsSwimLane){if(v){x=t?this.getX()+S.HEADER_SIZE/2:this.getX()+this._iWidth/2;y=this.getY()+B;}else if(t){x=this.getX()+B;}}if(this.getIcon()){h+=this._renderIcon({attributes:{style:this._getColorStyle({fill:E.ColorType.Content}),"class":"sapSuiteUiCommonsNetworkGraphIcon sapSuiteUiCommonsNetworkGraphGroupTitleIcon",x:x,y:y},icon:this.getIcon(),height:S.ICON_SIZE});d-=(S.ICON_SIZE+S.ICON_OFFSET);if(v){y+=(S.ICON_SIZE+S.ICON_OFFSET);}else{x+=(S.ICON_SIZE+S.ICON_OFFSET);}}if(this.getTitle()){var C=v?x-c:x;if(e&&!v){C-=d;}h+=this._renderClipPath({id:this.getId()+"-title-clip",x:C,y:y-c,width:v?S.HEADER_SIZE:d,height:v?d+c:null});h+=this._renderTitle({style:this._getColorStyle({fill:E.ColorType.Content}),"class":"sapSuiteUiCommonsNetworkGroupTitle "+(v?"sapSuiteUiCommonsNetworkGroupTitleVertical":""),x:x,y:y,maxWidth:d,direction:v&&e?"ltr":"",title:this.getTitle()});}return h;};G.prototype._renderHeaderButtons=function(){var F=2,L=0.5;var g="",c=0,t=0,v=this._isVerticalSwimLane(),d=this._isTopBottom(),e=sap.ui.getCore().getConfiguration().getRTL(),R=e;var x=e?this.getX()+S.ICON_SIZE*3:this.getX()+this._iWidth-S.ICON_SIZE,y=this.getY();if(this._bIsSwimLane){if(v){x=d?this.getX()+S.HEADER_SIZE/2:this.getX()+this._iWidth/2;}else if(d){x=this.getX()+S.ICON_SIZE*4-S.ICON_SIZE;R=true;}}var C=function(T,h,j,k,B){x-=c;y+=t;g+="<g><title>"+T+"</title>";g+=this._renderRoundRect({id:this.getId()+"-"+j,x:x-S.ICON_SIZE,y:y,width:S.ICON_SIZE*2-L,height:S.ICON_SIZE*2-L*2,"class":"sapSuiteUiCommonsNetworkGroupHeaderActionIconWrapper",topRight:e?0:k,topLeft:e?k:0,bottomRight:B});g+=this._renderControl("rect",{x:x-S.ICON_SIZE+F,y:y+F,width:S.ICON_SIZE*2-L-F*2,height:S.ICON_SIZE*2-L*2-F*2,"class":"sapSuiteUiCommonsNetworkActionButtonFocusCircle"});g+=this._renderText({attributes:{style:this._getColorStyle({fill:E.ColorType.Content}),x:x,y:y+S.ICON_SIZE,"class":"sapSuiteUiCommonsNetworkGroupHeaderActionIcon sapSuiteUiCommonsNetworkGraphIcon"},text:h,height:S.ICON_SIZE-2});g+="</g>";if(v){t+=S.ICON_SIZE*2;}else{c+=S.ICON_SIZE*2;}}.bind(this);var f=this._bIsSwimLane?0:S.ROUNDING;if(R){C(r.getText("NETWORK_GRAPH_GROUP_DETAIL"),b,"menu");C(r.getText("NETWORK_GRAPH_EXPAND_COLLAPSE"),this.getCollapsed()?s:i,"collapse",f,this.getCollapsed()?f:0);}else{C(r.getText("NETWORK_GRAPH_EXPAND_COLLAPSE"),this.getCollapsed()?s:i,"collapse",f,this.getCollapsed()?f:0);C(r.getText("NETWORK_GRAPH_GROUP_DETAIL"),b,"menu");}return g;};G.prototype._getGroupClass=function(){return"sapSuiteUiCommonsNetworkGroup "+this._getStatusClass()+(this.getCollapsed()?"sapSuiteUiCommonsNetworkGroupCollapsed":"sapSuiteUiCommonsNetworkGroupExpanded")+(this._bIsSwimLane?" sapSuiteUiCommonsNetworkGroupSwimLane":"")+(this._isVerticalSwimLane()?" sapSuiteUiCommonsNetworkGroupVerticalSwimLane":"");};G.prototype.getChildNodes=function(){this._checkForProcessData();return this.aChildren;};G.prototype.getChildLines=function(){this._checkForProcessData();return this.aLines;};G.prototype.getParentNodes=function(){this._checkForProcessData();return this.aParents;};G.prototype.getParentLines=function(){this._checkForProcessData();return this.aParentLines;};G.prototype.getNodes=function(){this._checkForProcessData();return this.aNodes;};G.prototype.isHidden=function(){return this._bIsHidden;};G.prototype.setHidden=function(v){this.$()[v?"hide":"show"]();this._bIsHidden=v;};G.prototype._isCollapsedSwimLane=function(){return this._bIsSwimLane&&this.getCollapsed();};G.prototype._clearChildren=function(){this.aNodes=[];this.aLines=[];this.aChildren=[];this.aParentLines=[];this.aParents=[];};G.prototype._hasVisibleNodes=function(g){return this.aNodes.some(function(n){return!n._bIsHidden;});};G.prototype._hideShow=function(c){this.$()[c?"hide":"show"]();this._bIsHidden=c;};G.prototype._setButtonFocus=function($,f){var F=f?"addClass":"removeClass";$[F]("sapSuiteUiCommonsNetworkElementFocus");};G.prototype._setMenuButtonFocus=function(f){this._setButtonFocus(q(this._oActionButtons.menu),f);};G.prototype._setCollapseButtonFocus=function(f){this._setButtonFocus(q(this._oActionButtons.collapse),f);};G.prototype._setupEvents=function(){var $=this.$("menu"),c=this.$("header"),d=this.$("collapse"),e=this.$().find(".sapSuiteUiCommonsNetworkGroupHeaderActionIconWrapper");this._oActionButtons.menu=$.parent()[0];this._oActionButtons.collapse=d.parent()[0];$.click(function(o){this._setMenuButtonFocus(true);var f=this.fireEvent("showDetail",{},true);if(f){this._openDetail();}if(this.getParent()){this.getParent().setFocus({item:this,button:G.BUTTONS.MENU});}}.bind(this));d.click(function(o){this._collapse();if(this.getParent()){this.getParent().setFocus({item:this,button:G.BUTTONS.COLLAPSE});}}.bind(this));c.click(function(o){if(this.getParent()){this.getParent().setFocus({item:this});}this.firePress();}.bind(this));e.mouseover(function(o){var f=q(o.currentTarget);f.css("fill",this._getColor(E.ColorType.HoverBackground));f.parent().find("text").css("fill",this._getColor(E.ColorType.HoverContent));f.css("stroke",this._getColor(E.ColorType.HoverBorder));}.bind(this));e.mouseout(function(o){var f=q(o.currentTarget);f.css("fill","");f.parent().find("text").css("fill",this._getColor(E.ColorType.Content));f.css("stroke","");}.bind(this));};G.prototype._collapse=function(){this.getParent()._selectElementAfterScroll=this;this.fireEvent("collapseExpand",{},true);this.setCollapsed(!this.getCollapsed());};G.prototype._openDetail=function(){var $=this.$("menu");this.getParent()._tooltip.openDetail({item:this,opener:$[0]});};G.prototype._isEmpty=function(){return this.aNodes.length===0;};G.prototype._isIgnored=function(){if(!this._useInLayout()){return true;}return!this.aNodes.some(function(n){return n._useInLayout();});};G.prototype._isVisible=function(){return this._bIsSwimLane||this.aNodes.some(function(n){return!n.isHidden();});};G.prototype._resetSize=function(){if(this.getCollapsed()){this._iHeight=S.COLLAPSED_HEIGHT;this._iWidth=S.COLLAPSED_WIDTH;}};G.prototype._getAccessibilityLabel=function(){return r.getText("NETWORK_GRAPH_GROUP")+" "+this.getTitle();};G.prototype._isTopBottom=function(){var p=this.getParent();return p&&p._isTopBottom();};G.prototype._isVerticalSwimLane=function(){if(this._bIsSwimLane){var t=this._isTopBottom();return(t&&!this.getCollapsed())||(!t&&this.getCollapsed());}return false;};G.prototype.setX=function(x){this.fX=x;return this;};G.prototype.getX=function(){return this.fX;};G.prototype.setY=function(y){this.fY=y;return this;};G.prototype.getY=function(){return this.fY;};G.prototype.setCollapsed=function(c){if(c!==this.getCollapsed()){var p=this.getParent(),d=[];this.setProperty("collapsed",c,true);if(c){this.getNodes().forEach(function(n){if(n.getSelected()){n.setSelected(false);d.push(n);}});this.getChildLines().forEach(function(L){if(L.getSelected()&&L._isInCollapsedGroup()){L.setSelected(false);d.push(L);}});if(p){p.fireSelectionChange({items:d});}}if(p){p.invalidate();}}return this;};return G;});
