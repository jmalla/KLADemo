sap.ui.define(["jquery.sap.global","sap/ui/core/mvc/ControllerExtension","sap/ui/core/format/DateFormat","sap/m/MessageBox","sap/ui/model/Filter","sap/ui/model/Sorter","sap/ui/generic/app/navigation/service/SelectionVariant","sap/suite/ui/generic/template/lib/testableHelper","sap/suite/ui/generic/template/detailTemplates/detailUtils","sap/suite/ui/generic/template/ObjectPage/extensionAPI/ExtensionAPI","sap/suite/ui/generic/template/js/AnnotationHelper","sap/m/Table","sap/ui/layout/DynamicSideContent","sap/suite/ui/generic/template/lib/ShareUtils","sap/base/Log"],function(q,C,D,M,F,S,a,t,d,E,A,R,b,c,L){"use strict";function s(O){O.setSelectedSection(null);}function I(e){return e.data("inlineCreate")==="true";}function f(B,e){if(B.getBindings){var g=B.getBindings();for(var i=0;i<g.length;i++){f(g[i],e);}}else{var T=B.getType();B.setType(T,e);}}var r=/[A-Za-z].*[A-Za-z]/;var m=720;var o={getMethods:function(v,T,g){var B=d.getControllerBase(v,T,g);B.state.aUnsavedDataCheckFunctions=[];v.oController=g;var h;var O;var l;function n(e){var i=e.getParameter("bindingParams");i.parameters=i.parameters||{};i.parameters.usePreliminaryContext=true;i.parameters.batchGroupId="facets";return i;}function p(){L.info("Activate object");var e=T.oServices.oCRUDManager.activateDraftEntity();e.then(function(i){T.oServices.oApplication.showMessageToast(T.oCommonUtils.getText("OBJECT_SAVED"));if(i&&i.context){var j=g.getOwnerComponent();T.oServices.oViewDependencyHelper.setAllPagesDirty([j.getId()]);T.oServices.oViewDependencyHelper.unbindChildren(j);var k=j.getNavToListOnSave();T.oServices.oApplication.invalidatePaginatorInfo();if(k){T.oServices.oNavigationController.navigateToRoot(true);}else{T.oServices.oNavigationController.navigateToContext(i.context,undefined,true,undefined,true);}}var x={activationPromise:e};T.oComponentUtils.fire(g,"AfterActivate",x);},q.noop);}function u(){B.state.beforeSaveHelper.prepareAndRunSaveOperation(true,p);}function w(){var e=g.getView();var i=e.getBindingContext();var j=e.getModel().getPendingChanges();j=j&&j[i.getPath().replace("/","")]||{};var k=Object.keys(j)||[];var x=T.oComponentUtils.isNonDraftCreate();var y1=k.indexOf("__metadata");if(y1>-1){k.splice(y1,1);}var z1=T.oServices.oCRUDManager.saveEntity();z1.then(function(B1){var C1=T.oComponentUtils.getTemplatePrivateModel();C1.setProperty("/objectPage/displayMode",1);v.setEditable(false);T.oServices.oViewDependencyHelper.setRootPageToDirty();T.oServices.oViewDependencyHelper.unbindChildren(g.getOwnerComponent());T.oServices.oApplication.invalidatePaginatorInfo();if(x){if(B1&&B1.getPath()!=="/undefined"){T.oServices.oNavigationController.navigateToContext(B1,undefined,true);}else{T.oServices.oNavigationController.navigateBack();}T.oServices.oApplication.showMessageToast(T.oCommonUtils.getText("OBJECT_CREATED"));}else{T.oServices.oApplication.showMessageToast(T.oCommonUtils.getText("OBJECT_SAVED"));if(!T.oComponentUtils.isDraftEnabled()&&!h){T.oServices.oNavigationController.navigateBack();}}if(k.length>0){T.oServices.oApplicationController.executeSideEffects(i,k);}});var A1={saveEntityPromise:z1};T.oComponentUtils.fire(g,"AfterSave",A1);}function y(){B.state.beforeSaveHelper.prepareAndRunSaveOperation(true,w);}function z(e){if(I(e.getSource())){var i=e.getParameter("bindingParams");if(i.filters&&i.filters.length){var j=new F(i.filters);i.filters=new F({filters:[new F({filters:[new F({path:"IsActiveEntity",operator:"EQ",value1:true}),j],and:true}),new F({filters:[new F({path:"IsActiveEntity",operator:"EQ",value1:false}),new F({filters:[j,new F({path:"HasActiveEntity",operator:"EQ",value1:false})],and:false})],and:true})],and:false});}var k=i.sorter[0]&&i.sorter[0].getGroupFunction();var x=k&&function(y1){var z1=y1.getObject();if(z1.IsActiveEntity||z1.HasActiveEntity){var A1=q.extend({},k(y1));A1.key=A1.key.charAt(0)==="ยง"?"ยง"+A1.key:A1.key;return A1;}return{key:"ยง",text:T.oCommonUtils.getText("NEW_ENTRY_GROUP")};};if(e.getSource().data("disableInlineCreateSort")==="false"){i.sorter.unshift(new S("HasActiveEntity",false,x));}}}function G(){return O.getHeaderTitle();}function H(e){var i=T.oComponentUtils.getTemplatePrivateModel();var j={shareEmailPressed:function(){var k=i.getProperty("/objectPage/headerInfo/objectTitle");var x=i.getProperty("/objectPage/headerInfo/objectSubtitle");if(x){k=k+" - "+x;}var y1=document.URL.replace(/\(/g,'%28').replace(/\)/g,'%29');sap.m.URLHelper.triggerEmail(null,k,y1);},shareJamPressed:function(){c.openJamShareDialog(i.getProperty("/objectPage/headerInfo/objectTitle")+" "+i.getProperty("/objectPage/headerInfo/objectSubtitle"));},getModelData:function(){return{title:i.getProperty("/objectPage/headerInfo/objectTitle"),subtitle:i.getProperty("/objectPage/headerInfo/objectSubtitle"),customUrl:document.URL};}};c.openSharePopup(T.oCommonUtils,e.getSource(),j);}function J(){var e=T.oCommonUtils.getDialogFragment("sap.suite.ui.generic.template.ObjectPage.view.fragments.RelatedAppsSheet",{buttonPressed:function(i){var j=i.getSource();var k=j.getBindingContext("buttons");var x=k.getProperty("link");var y1=k.getProperty("param");var z1=x.intent;var A1=z1.split("#")[1].split("-")[0];var B1=z1.split("-")[1].split("?")[0].split("~")[0];var C1={target:{semanticObject:A1,action:B1},params:y1};sap.ushell.Container.getService("CrossApplicationNavigation").toExternal(C1);}},"buttons");return e;}function K(){var e=T.oServices.oApplication.getBusyHelper();if(e.isBusy()){return;}var i=g.getOwnerComponent();var j=T.oCommonUtils;var k=T.oComponentUtils.getTemplatePrivateModel();var x=(k.getProperty("/objectPage/headerInfo/objectTitle")||"").trim();var y1=k.getProperty("/objectPage/headerInfo/objectSubtitle");var z1;var A1={title:j.getText("DELETE")};if(x){if(y1){z1=[" ",x,y1];A1.text=j.getText("DELETE_WITH_OBJECTINFO",z1);}else{z1=[x];A1.text=j.getText("DELETE_WITH_OBJECTTITLE",z1);}}else{A1.text=j.getText("ST_GENERIC_DELETE_SELECTED");}var B1=Promise.resolve(g.beforeDeleteExtension());B1.then(function(C1){q.extend(A1,C1);M.show(A1.text,{icon:M.Icon.WARNING,styleClass:T.oCommonUtils.getContentDensityClass(),title:A1.title,actions:[M.Action.DELETE,M.Action.CANCEL],onClose:function(D1){if(D1===M.Action.DELETE){var E1=i.getModel("_templPrivGlobal");var F1={objectPage:{currentEntitySet:i.getProperty("entitySet")}};E1.setProperty("/generic/multipleViews",F1);var G1=T.oServices.oCRUDManager.deleteEntity();var H1=i.getBindingContext().getPath();var I1=Object.create(null);I1[H1]=G1;T.oServices.oApplication.prepareDeletion(I1);var J1={deleteEntityPromise:G1};e.setBusy(G1);T.oComponentUtils.fire(g,"AfterDelete",J1);}}});},q.noop);}function N(e){T.oServices.oApplication.performAfterSideEffectExecution(K);}function P(e,i){var j,k;if(e){k=e.context||e;if(T.oServices.oDraftController.getDraftContext().hasDraft(k)){T.oServices.oViewDependencyHelper.setRootPageToDirty();j=k.context||k;}}if(j){T.oServices.oApplication.invalidatePaginatorInfo();if(B.fclInfo.navigateToDraft&&!i){B.fclInfo.navigateToDraft(j);}else{T.oServices.oNavigationController.navigateToContext(j,undefined,true,2,true);}}else{var x=T.oComponentUtils.getTemplatePrivateModel();x.setProperty("/objectPage/displayMode",2);}v.setEditable(true);}var Q;function U(e){T.oServices.oCRUDManager.editEntity(e).then(function(i){if(i.draftAdministrativeData){Q(i.draftAdministrativeData.CreatedByUserDescription||i.draftAdministrativeData.CreatedByUser);}else{P(i.context,false);}});}Q=function(e){var i=T.oCommonUtils.getDialogFragment("sap.suite.ui.generic.template.ObjectPage.view.fragments.UnsavedChangesDialog",{onEdit:function(){i.close();U(true);},onCancel:function(){i.close();}},"Dialog");var j=i.getModel("Dialog");var k=T.oCommonUtils.getText("DRAFT_LOCK_EXPIRED",[e]);j.setProperty("/unsavedChangesQuestion",k);i.open();};function V(){var j="{\"SelectionVariantID\":\"\"}";var k=g.getOwnerComponent();var y1=k.getEntitySet();var z1=k.getModel();var A1=z1.getMetaModel();var B1=A1.getODataEntitySet(y1);var C1=A1.getODataEntityType(B1.entityType);var D1=C1.property;var E1=[];for(var x in D1){var F1=D1[x]["com.sap.vocabularies.Common.v1.FieldControl"]&&D1[x]["com.sap.vocabularies.Common.v1.FieldControl"].Path;if(F1&&E1.indexOf(F1)<0){E1.push(F1);}}var G1=g.getView().getBindingContext();var H1=G1.getObject();var I1=new a();for(var i in D1){var J1=D1[i].type;var K1=D1[i].name;var L1=H1[D1[i].name];if(E1.indexOf(K1)>-1){continue;}if(K1&&(L1||J1==="Edm.Boolean")){if(J1==="Edm.Time"&&L1.ms!==undefined){L1=L1.ms;}if(typeof L1!=="string"){try{L1=L1.toString();}catch(e){L1=L1+"";}}I1.addParameter(K1,L1);}}j=I1.toJSONString();return j;}function W(e,Y){var i=true;var j=Y.getModel();Y=Y instanceof R?Y.getParent():Y;var k=T.oCommonUtils.getDeleteRestrictions(Y);var x=k&&k.Deletable&&k.Deletable.Path;if(x){i=j.getProperty(x,e);}return i;}var X;var Y;function Z(e,j){X=e;Y=j instanceof R?j.getParent():j;var k=[];return T.oCommonUtils.getDialogFragment("sap.suite.ui.generic.template.ObjectPage.view.fragments.TableDeleteConfirmation",{onCancel:function(i){var x=i.getSource().getParent();x.close();},onDelete:function(x){var y1=T.oServices.oApplication.getBusyHelper();var z1=x.getSource().getParent();var A1=T.oCommonUtils.getSelectedContexts(Y);k=[];var B1;var C1;var D1=g.getView().getModel().getObject(A1[0].getPath());for(var i=0;i<A1.length;i++){if(W(A1[i],Y)){k.push(A1[i].getPath());}}var E1=T.oServices.oCRUDManager.deleteEntities(k);y1.setBusy(E1);T.oServices.oApplicationController.executeSideEffects(Y.getBindingContext(),[],[Y.getTableBindingPath()]);var F1=X.getParent().getParent().getId();E1.then(function(H1){T.oServices.oViewDependencyHelper.unbindChildren(g.getOwnerComponent());T.oCommonUtils.refreshSmartTable(Y);if(D1.IsActiveEntity===false){C1=0;}else{C1=H1.length;}B1=k.length-C1;var I1="";if(B1>0){if(B1>1){I1=T.oCommonUtils.getContextText("DELETE_SUCCESS_PLURAL_WITH_COUNT",Y.getId(),null,[B1]);}else{if(C1>0){I1=T.oCommonUtils.getContextText("DELETE_SUCCESS_WITH_COUNT",Y.getId(),null,[B1]);}else{I1=T.oCommonUtils.getContextText("ITEM_DELETED",Y.getId());}}}if(C1>0){if(C1>1){I1+=I1&&I1+"\n";I1+=T.oCommonUtils.getContextText("DELETE_ERROR_PLURAL_WITH_COUNT",Y.getId(),null,[C1]);}else{if(B1>0){I1+="\n";I1+=T.oCommonUtils.getContextText("DELETE_ERROR_WITH_COUNT",Y.getId(),null,[C1]);}else{I1+=T.oCommonUtils.getContextText("DELETE_ERROR",Y.getId());}}}if(I1){if(C1>0){M.error(I1);}else{T.oServices.oApplication.showMessageToast(I1);}}});var G1={deleteEntitiesPromise:E1,sUiElementId:F1,aContexts:A1};T.oComponentUtils.fire(g,"AfterLineItemDelete",G1);z1.close();}},"delete");}function $(e){var j=T.oServices.oApplication.getBusyHelper();if(j.isBusy()){return;}var X=e.getSource();var Y=T.oCommonUtils.getOwnerControl(X);if(!T.oCommonUtils.isSmartTable(Y)){Y=Y.getParent();}var k=T.oCommonUtils.getSelectedContexts(Y);if(k.length===0){M.error(T.oCommonUtils.getText("ST_GENERIC_NO_ITEM_SELECTED"),{styleClass:T.oCommonUtils.getContentDensityClass()});return;}var x=[];var y1=[];for(var i=0;i<k.length;i++){if(W(k[i],Y)){x.push(k[i].getPath());}else{y1.push(k[i]);}}var z1={};if(k.length>1){z1.title=T.oCommonUtils.getText("ST_GENERIC_DELETE_TITLE_WITH_COUNT",[k.length]);z1.text=T.oCommonUtils.getContextText("DELETE_SELECTED_ITEMS",Y.getId());}else{z1.title=T.oCommonUtils.getText("ST_GENERIC_DELETE_TITLE");z1.text=T.oCommonUtils.getContextText("DELETE_SELECTED_ITEM",Y.getId());}if(y1.length>0){z1.undeletableText=T.oCommonUtils.getContextText("DELETE_UNDELETABLE_ITEMS",Y.getId(),null,[y1.length,k.length]);}var A1={sUiElementId:X.getParent().getParent().getId(),aContexts:k};var B1=Promise.resolve(g.beforeLineItemDeleteExtension(A1));B1.then(function(C1){q.extend(z1,C1);var D1=Z(X,Y);if(!y1.length){z1.undeletableText=undefined;}var E1=D1.getModel("delete");E1.setData(z1);D1.open();},q.noop);}function _(){var i=g.byId("imageDialog")||T.oCommonUtils.getDialogFragment("sap.suite.ui.generic.template.ObjectPage.view.fragments.ImageDialog",{onImageDialogClose:function(){i.close();}},"headerImage");return i;}function a1(){var e=g.byId("template::ObjectPage::TitleImage");if(!e){return;}var i=g.getView().byId("template::ObjectPage::ObjectPageHeader");e.setVisible(false);i.attachStateChange(function(j){var k=j.getParameter("isExpanded");e.setVisible(!k);});}function b1(){var e;var j=T.oComponentUtils.getTemplatePrivateModel();var k=function(i){return function(x){var y1=x.getSource();var z1=y1.getExternalValue();j.setProperty("/objectPage/headerInfo/"+i,z1);if(!z1&&i==="objectTitle"){var A1=T.oComponentUtils.getHeaderDataAvailablePromise();A1.then(function(B1){z1=y1.getExternalValue();if(z1){return;}var C1=g.getView();var D1=B1.getObject();var E1=C1.getModel("ui");var F1=E1.getProperty("/createMode");if(F1&&D1&&(D1.IsActiveEntity===undefined||D1.IsActiveEntity===false||D1.HasActiveEntity===false)){e=e||T.oCommonUtils.getText("NEW_OBJECT");j.setProperty("/objectPage/headerInfo/objectTitle",e);}});}};};O.getCustomData().forEach(function(x){var y1=x.getKey();if(y1==="objectTitle"||y1==="objectSubtitle"){var z1=x.getBinding("value");var A1=!z1&&x.getBindingInfo("value");if(!z1&&!A1){j.setProperty("/objectPage/headerInfo/"+y1,x.getValue());return;}var B1=k(y1);if(z1){z1.attachChange(B1);f(z1,"string");}else{A1.events={change:B1};for(var i=0;i<A1.parts.length;i++){A1.parts[i].targetType="string";}}}});}function c1(e){e.preventDefault();var i=T.oCommonUtils.getControlInformation(e,null,true);if(!i){return;}T.oCommonUtils.processDataLossConfirmationIfNonDraft(function(){var j=T.oComponentUtils.getTemplatePrivateModel();var k=j.getProperty("/objectPage/displayMode");T.oServices.oNavigationController.navigateToContext(i.internalHash,null,false,k);},q.noop,B.state);}function d1(e,i){L.info("Set binding context to "+e,"Subsection: "+i.getId(),"Class sap.suite.ui.generic.template.ObjectPage.controller.ControllerImplementation");i.setBindingContext(e);}function e1(e,i,j,k){if(i){var x=e?T.oComponentUtils.getHeaderDataAvailablePromise():Promise.resolve();x.then(function(){d1(undefined,j);var y1=j.getId();L.info("Start refreshing of Subsection: "+y1,"Class sap.suite.ui.generic.template.ObjectPage.controller.ControllerImplementation");k.refresh(null,true);L.info("End refreshing of Subsection: "+y1,"Class sap.suite.ui.generic.template.ObjectPage.controller.ControllerImplementation");});}else{d1(null,j);}}var f1={lazyLoading:e1.bind(null,false),lazyLoadingAfterHeader:e1.bind(null,true),reuseComponent:function(i,e){var j=e.getBlocks()[0];var k=i?T.oComponentUtils.getHeaderDataAvailablePromise():Promise.resolve();k.then(T.oComponentUtils.onVisibilityChangeOfReuseComponent.bind(null,i,j));}};function g1(e,i,j){if(j instanceof b){j=j.getMainContent()[0];}else if(!j.getContent){return;}j.getContent().forEach(function(k){if(T.oCommonUtils.isSmartTable(k)){if(i||e[k.getEntitySet()]){if(k.isInitialised()){T.oCommonUtils.refreshSmartTable(k);}else{k.attachInitialise(function(){T.oCommonUtils.refreshSmartTable(k);});}if(!i){T.oServices.oApplicationController.executeSideEffects(g.getOwnerComponent().getBindingContext(),[],[k.getTableBindingPath()]);}}}});}function h1(e,i,j){var k=j.getBlocks().concat(j.getMoreBlocks());e.refresh=function(z1,A1){var B1=g1.bind(null,z1,A1);k.forEach(B1);};var x=T.oCommonUtils.getElementCustomData(j).strategyForVisibilityChange;var y1=f1[x];e.strategyForVisibilityChange=y1||q.noop;if(y1){i.push("subSectionListeningToVisibilityChange");}}function i1(e){return T.oCommonUtils.getControlInformation(e,h1);}function j1(i,e,j){e=e||i1(j);if(e.isVisible===i){return;}e.isVisible=i;e.strategyForVisibilityChange(i,j,e);}function k1(i){T.oCommonUtils.executeForAllInformationObjects("subSectionListeningToVisibilityChange",j1.bind(null,i));}function l1(e){var i=e&&e.getParameter("section");l=i?i.getId():O.getSelectedSection();}function m1(e){l1(e);B.stateChanged();}function n1(e,i,j,k,x){var y1=A.createP13NColumnKey(x);var z1=A.getBindingForHiddenPath(x);if(z1==="{= !${} }"){e.push(y1);return false;}if(typeof(z1)==="string"){var A1=z1.match(r)&&z1.match(r)[0];if(A1&&A1.indexOf("/")>0&&k.navigationProperty){var B1=g.getOwnerComponent().getEntitySet();var C1=A1.split("/",1)[0];if(j.getODataAssociationSetEnd(k,C1).entitySet===B1){i[y1]=A1.split("/").slice(1).join("/");return true;}}}else if(!z1){e.push(y1);}return false;}function o1(Y,e,j,k,x,y1){var z1=[];var A1=Object.create(null);var B1=false;for(var i=0;i<y1.length;i++){var C1=y1[i];B1=n1(z1,A1,k,x,C1)||B1;}if(B1){e.dynamicHideInfos={staticHiddenColumns:z1,columnKeyToHiddenPath:A1};j.push("smartTableWithDynamicColumnHide");}if(z1.length){Y.deactivateColumns(z1);}}function p1(e,j,Y){j.push("smartTable");Y=T.oCommonUtils.isMTable(Y)?Y.getParent():Y;var k=Y.getModel().getMetaModel();var x=k.getODataEntitySet(Y.getEntitySet());var y1=k.getODataEntityType(x.entityType);var z1=y1["com.sap.vocabularies.UI.v1.LineItem"];var A1=Y.getCustomData();for(var i=0;i<A1.length;i++){if(A1[i].getKey()==="lineItemQualifier"){z1=y1["com.sap.vocabularies.UI.v1.LineItem#"+A1[i].getValue()];break;}}o1(Y,e,j,k,y1,z1);}function q1(Y){return T.oCommonUtils.getControlInformation(Y,p1);}function r1(e,i,j){i.push("searchField");var k=T.oCommonUtils.isMTable(j.getParent().getParent())?j.getParent().getParent().getParent():j.getParent().getParent();e.table=k;var x=q1(k);x.searchField=j;}function s1(e){return T.oCommonUtils.getControlInformation(e,r1);}function t1(e){s1(e);}function u1(e){var i=s1(e);i.searchString=e.getSource().getValue();i.table.rebindTable();}function v1(e,i){i.setValue("");if(e.searchString){e.searchString="";e.table.rebindTable();}}function w1(){T.oCommonUtils.executeForAllInformationObjects("searchField",v1);}v.refreshFacets=function(e){var i=function(j){var k=i1(j);k.refresh(e,false);};O.getSections().forEach(function(j){j.getSubSections().forEach(i);});};v.getHeaderInfoTitleForNavigationMenue=function(){var e=T.oComponentUtils.getTemplatePrivateModel();var i=e.getProperty("/generic/viewLevel");var j=e.getProperty("/objectPage/headerInfo/objectTitle");T.oServices.oApplication.subTitleForViewLevelChanged(i,j);};v.onComponentActivate=B.onComponentActivate;v.getCurrentState=function(){var e=Object.create(null);if(l){e.section={data:l,lifecycle:{permanent:true,pagination:true}};}var i=Object.create(null);g.provideCustomStateExtension(i);for(var j in i){e["$custom$"+j]=i[j];}var k=true;var x=function(y1,z1){if(!(y1 instanceof C)){throw new Error("State must always be set with respect to a ControllerExtension");}if(!k){throw new Error("State must always be provided synchronously");}var A1=y1.getMetadata().getNamespace();if(z1){for(var B1 in z1){e["$extension$"+A1+"$"+B1]=z1[B1];}}};g.templateBaseExtension.provideExtensionStateData(x);k=false;return e;};v.applyState=function(e,i){var j=Object.create(null);var k=Object.create(null);for(var x in e){if(x.indexOf("$custom$")===0){j[x.substring(8)]=e[x];}else if(x.indexOf("$extension$")===0){var y1=x.substring(11,x.indexOf("$",11));var z1=k[y1];if(!z1){z1=Object.create(null);k[y1]=z1;}var A1=x.substring(x.indexOf("$",11)+1,x.length);z1[A1]=e[x];}}g.applyCustomStateExtension(j,i);var B1=true;var C1=function(D1){if(!(D1 instanceof C)){throw new Error("State must always be retrieved with respect to a ControllerExtension");}if(!B1){throw new Error("State must always be restored synchronously");}var y1=D1.getMetadata().getNamespace();return k[y1];};g.templateBaseExtension.restoreExtensionStateData(C1,i);B1=false;if(i){if(l!==(e.section||"")){B.stateChanged();}return;}w1();if(e.section){O.setSelectedSection(e.section);l1();}else{Promise.all([T.oComponentUtils.getHeaderDataAvailablePromise(),T.oComponentUtils.getNavigationFinishedPromise()]).then(s.bind(null,O));l="";}};v.beforeRebind=function(){k1(false);};v.afterRebind=function(){L.info("Call of _triggerVisibleSubSectionsEvents","","Class sap.suite.ui.generic.template.ObjectPage.controller.ControllerImplementation");O._triggerVisibleSubSectionsEvents();};v.applyHeaderContextToSmartTablesDynamicColumnHide=function(e){var i=function(j,Y){var k=j.dynamicHideInfos.staticHiddenColumns.slice();for(var x in j.dynamicHideInfos.columnKeyToHiddenPath){var y1=j.dynamicHideInfos.columnKeyToHiddenPath[x];if(e.getProperty(y1)){k.push(x);}}Y.deactivateColumns(k);};T.oCommonUtils.executeForAllInformationObjects("smartTableWithDynamicColumnHide",i);};var U=t.testable(U,"editEntity");var W=t.testable(W,"isEntryDeletable");var p=t.testable(p,"onActivateImpl");var x1={onInit:function(){O=g.byId("objectPage");var e=g.getOwnerComponent();var x=O.getSections();for(var k=1;k<x.length;k++){var y1=x[k];var z1=y1.getSubSections();z1.forEach(i1);}var A1=G();var B1=e.getAppComponent().getConfig();var C1=B1&&B1.settings&&B1.settings.objectPageDynamicHeaderTitleWithVM;v.aBreadCrumbs=A1&&(C1?A1.getBreadcrumbs().getLinks():A1.getBreadCrumbsLinks());if(C1){a1();}B.onInit(null,O.getScrollDelegate.bind(O),k1.bind(null,true));b1();T.oCommonUtils.executeGlobalSideEffect();O.attachEvent("subSectionEnteredViewPort",function(i){var j=i.getParameter("subSection");L.info("Viewport entered ","Subsection: "+j.getId(),"Class sap.suite.ui.generic.template.ObjectPage.controller.ControllerImplementation");j1(true,null,j);});sap.ui.Device.resize.attachHandler(function(D1){var E1;for(var i=1;i<x.length;i++){var F1=x[i].getSubSections();for(var j=0;j<F1.length;j++){var G1=F1[j];var H1=G1.getBlocks()[0];if(H1 instanceof b){var I1=G1.getActions();var J1=I1[I1.length-1];if(H1.getShowSideContent()){E1=T.oCommonUtils.getContextText("HideSideContent",G1.getId(),"HIDE_SIDE_CONTENT");if(D1.width>m){H1.setShowMainContent(true);}}else{E1=T.oCommonUtils.getContextText("ShowSideContent",G1.getId(),"SHOW_SIDE_CONTENT");}J1.setText(E1);}}}},O);},handlers:{onEditAndActiveToggle:function(e,i){T.oServices.oApplication.performAfterSideEffectExecution(function(){var j=T.oServices.oApplication.getBusyHelper();if(j.isBusy()){return;}var k=e.getBindingContext();var x=T.oServices.oApplication.getDraftSiblingPromise(k);j.setBusy(x.then(function(y1){if(i){L.info("Navigating to draft entity");P(y1,true);}else{L.info("Navigating to active entity");T.oServices.oNavigationController.navigateToContext(y1,null,true,1,true);}}));});},addEntry:function(e){var X=e.getSource();var Y=T.oCommonUtils.getOwnerControl(X);Y=T.oCommonUtils.isMTable(Y)?Y.getParent():Y;var i=I(Y);if(!X.data("CrossNavigation")&&i){T.oCommonEventHandlers.addEntry(X,true);return;}T.oCommonUtils.processDataLossConfirmationIfNonDraft(function(){T.oCommonEventHandlers.addEntry(X,false);},q.noop,B.state);},submitChangesForSmartMultiInput:function(){if(T.oComponentUtils.isDraftEnabled()){T.oCommonEventHandlers.submitChangesForSmartMultiInput();}},deleteEntries:$,onSelectionChange:function(e){T.oCommonUtils.setEnabledToolbarButtons(e.getSource());},onCancel:function(e){var i="Proceed";var j;if(T.oComponentUtils.isNonDraftCreate()||!h){i="LeavePage";}T.oCommonUtils.processDataLossConfirmationIfNonDraft(function(){var k=T.oComponentUtils.getTemplatePrivateModel();k.setProperty("/objectPage/displayMode",1);if(T.oComponentUtils.isNonDraftCreate()){v.setEditable(false);}else if(h){v.setEditable(false);}if(T.oComponentUtils.isNonDraftCreate()||!h){T.oServices.oNavigationController.navigateBack();}},q.noop,B.state,i,j,e);},onContactDetails:function(e){T.oCommonEventHandlers.onContactDetails(e);},onPressDraftInfo:function(e){var i=g.getView().getBindingContext();var j=sap.ui.getCore().byId(e.getSource().getId()+(e.getId()==="markChangesPress"?"-changes":"-lock"));T.oCommonUtils.showDraftPopover(i,j);},onPressDraftInfoObjectPageDynamicHeaderTitle:function(e){var i=g.getView().getBindingContext();var j=g.byId("template::ObjectPage::ObjectMarkerObjectPageDynamicHeaderTitle");T.oCommonUtils.showDraftPopover(i,j);},onShareObjectPageActionButtonPress:H,onRelatedApps:function(e){var x,y1,z1,A1,B1,C1,D1;var E1,F1,G1,H1,I1;x=e.getSource();G1=sap.ushell&&sap.ushell.Container;y1=G1&&G1.getService("URLParsing");z1=y1.parseShellHash(document.location.hash);H1=z1.semanticObject;I1=z1.action;A1=g.getView&&g.getView().getBindingContext();var J1=g.getOwnerComponent().getModel().getMetaModel();var K1=A1.getObject();var L1=K1.__metadata.type;var M1=J1.getODataEntityType(L1);var N1=M1["com.sap.vocabularies.Common.v1.SemanticKey"];var O1={};if(N1&&N1.length>0){for(var j=0;j<N1.length;j++){var P1=N1[j].PropertyPath;if(!O1[P1]){O1[P1]=[];O1[P1].push(K1[P1]);}}}else{for(var k in M1.key.propertyRef){var Q1=M1.key.propertyRef[k].name;if(!O1[Q1]){O1[Q1]=[];O1[Q1].push(K1[Q1]);}}}B1=g.getOwnerComponent().getAppComponent();C1=G1&&G1.getService("CrossApplicationNavigation");D1=C1.getLinks({semanticObject:H1,params:O1,ui5Component:B1});E1=J();F1=E1.getModel("buttons");F1.setProperty("/buttons",[]);E1.openBy(x);D1.done(function(R1){var S1=[];R1.sort(function(W1,X1){if(W1.text<X1.text){return-1;}if(W1.text>X1.text){return 1;}return 0;});for(var i=0;i<R1.length;i++){var T1=R1[i];var U1=T1.intent;var V1=U1.split("-")[1].split("?")[0];if(V1!==I1){S1.push({enabled:true,text:T1.text,link:T1,param:O1});}}if(S1.length===0){S1.push({enabled:false,text:T.oCommonUtils.getText("NO_RELATED_APPS")});}F1.setProperty("/buttons",S1);});},onSemanticObjectLinkPopoverLinkPressed:function(e){T.oCommonEventHandlers.onSemanticObjectLinkPopoverLinkPressed(e,B.state);},onEdit:function(e){var X=e.getSource();if(X.data("CrossNavigation")){T.oCommonEventHandlers.onEditNavigateIntent(X);return;}h=true;U();},onSave:y,onActivate:u,onSmartFieldUrlPressed:function(e){T.oCommonEventHandlers.onSmartFieldUrlPressed(e,B.state);},onBreadCrumbUrlPressed:c1,onDiscardDraft:function(e){T.oCommonEventHandlers.onDiscardDraft(e,B.state.beforeSaveHelper);},onDelete:N,onCallActionFromToolBar:function(e){T.oCommonEventHandlers.onCallActionFromToolBar(e,B.state);},onCallAction:function(e){var i=g.getOwnerComponent();var j=i.getEntitySet();var k=T.oCommonUtils.getCustomData(e);var x=[];x.push(g.getView().getBindingContext());if(x[0]&&k.Type==="com.sap.vocabularies.UI.v1.DataFieldForAction"){T.oCommonUtils.processDataLossConfirmationIfNonDraft(function(){var y1={functionImportPath:k.Action,contexts:x,sourceControl:"",label:k.Label,operationGrouping:k.InvocationGrouping,navigationProperty:i.getNavigationProperty()};T.oServices.oCRUDManager.callAction(y1).then(function(z1){var A1=z1&&z1[0];if(A1&&A1.response&&A1.response.context&&(!A1.actionContext||A1.actionContext&&A1.response.context.getPath()!==A1.actionContext.getPath())){T.oServices.oViewDependencyHelper.setParentToDirty(i,j,1);}});},q.noop,B.state,"Proceed");}else if(k.Type==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"){T.oCommonEventHandlers.onDataFieldForIntentBasedNavigation(e,B.state);}},onDataFieldForIntentBasedNavigation:function(e){T.oCommonEventHandlers.onDataFieldForIntentBasedNavigation(e,B.state);},onDataFieldWithIntentBasedNavigation:function(e){T.oCommonEventHandlers.onDataFieldWithIntentBasedNavigation(e,B.state);},onDataFieldWithNavigationPath:function(e){T.oCommonEventHandlers.onDataFieldWithNavigationPath(e);},onChartInit:function(e){var i=e.getSource().getChart();var j=g._templateEventHandlers.onSelectionChange;i.attachSelectData(j).attachDeselectData(j);var k=i.getParent();T.oCommonUtils.checkToolbarIntentsSupported(k);},onDataRequested:function(i){L.info("Data requested","SmartTable: "+i,"Class sap.suite.ui.generic.template.ObjectPage.controller.ControllerImplementation");},onDataReceived:function(e){T.oCommonEventHandlers.onDataReceived(e);},onBeforeRebindDetailTable:function(e){var Y=e.getSource();var i=n(e);var j=q1(Y);var k=j.searchField;if(k){var x=T.oCommonUtils.getControlInformation(k);if(x.searchString){i.parameters.custom={search:x.searchString};}}T.oCommonEventHandlers.onBeforeRebindTable(e,{ensureExtensionFields:g.templateBaseExtension.ensureFieldsForSelect,addExtensionFilters:g.templateBaseExtension.addFilters});g.onBeforeRebindTableExtension(e);z(e);if(T.oCommonUtils.isAnalyticalTable(Y.getTable())){i.parameters.entitySet=Y.getEntitySet();}},onShowDetails:function(e){T.oCommonEventHandlers.onShowDetails(e.getSource(),B.state);},onListNavigate:function(e){if(!g.onListNavigationExtension(e)){T.oCommonEventHandlers.onListNavigate(e.getSource(),B.state);}},onBeforeSemanticObjectLinkPopoverOpens:function(e){var i=e.getParameters();T.oCommonUtils.processDataLossConfirmationIfNonDraft(function(){var j=V();T.oCommonUtils.semanticObjectLinkNavigation(i,j,g);},q.noop,B.state,q.noop);},onSemanticObjectLinkNavigationPressed:function(e){var i=e.getParameters();var X=e.getSource();T.oCommonEventHandlers.onSemanticObjectLinkNavigationPressed(X,i);},onSemanticObjectLinkNavigationTargetObtained:function(e){var i=e.getParameters();var X=e.getSource();T.oCommonEventHandlers.onSemanticObjectLinkNavigationTargetObtained(X,i,B.state);},onSemanticObjectLinkNavigationTargetObtainedSmartLink:function(e){var i,X;i=e.getParameters();X=e.getSource();X=X.getParent().getParent().getParent().getParent();T.oCommonEventHandlers.onSemanticObjectLinkNavigationTargetObtained(X,i,B.state);},onHeaderImagePress:function(e){var i=_();var j=e.getSource().getId();i.addAriaLabelledBy(j);var k=i.getModel("headerImage");k.setProperty("/src",e.getSource().getSrc());if(sap.ui.Device.system.phone){i.setProperty("stretch",true);}i.open();},sectionNavigate:m1,onInlineDataFieldForAction:function(e){T.oCommonEventHandlers.onInlineDataFieldForAction(e,B.state);},onInlineDataFieldForIntentBasedNavigation:function(e){T.oCommonEventHandlers.onInlineDataFieldForIntentBasedNavigation(e.getSource(),B.state);},onDeterminingDataFieldForAction:function(e){T.oCommonEventHandlers.onDeterminingDataFieldForAction(e);},onBeforeRebindChart:function(e){n(e);var i=e.getSource();i.oModels=i.getChart().oPropagatedProperties.oModels;var j={ensureExtensionFields:q.noop,addExtensionFilters:g.templateBaseExtension.addFilters};T.oCommonUtils.onBeforeRebindTableOrChart(e,j);},onToggleDynamicSideContent:function(e){var i,X;X=e.getSource();var j=X.getParent();var k=j.getBlocks()[0];if(k.getShowSideContent()){i=T.oCommonUtils.getContextText("ShowSideContent",j.getId(),"SHOW_SIDE_CONTENT");k.setShowSideContent(false);if(sap.ui.Device.resize.width<=m){k.setShowMainContent(true);}}else{i=T.oCommonUtils.getContextText("HideSideContent",j.getId(),"HIDE_SIDE_CONTENT");k.setShowSideContent(true);if(sap.ui.Device.resize.width<=m){k.setShowMainContent(false);}}X.setText(i);},onTableInit:function(e){var Y=e.getSource();var i=Y.getTable();q1(Y);T.oCommonUtils.checkToolbarIntentsSupported(Y);if(I(Y)&&!Y.data("CrossNavigation")){i.addEventDelegate({onkeyup:function(e){if(e.ctrlKey&&e.keyCode===q.sap.KeyCodes.ENTER&&Y.getEditable()){T.oCommonEventHandlers.addEntry(Y,true);e.preventDefault();e.setMarked();}}});}},onSearchObjectPage:u1,onSearchLiveChange:t1},formatters:{setNoDataTextForSmartTable:function(){var e=T.oCommonUtils.getText("NOITEMS_SMARTTABLE");if(e!=="NOITEMS_SMARTTABLE"){return e;}return"";},setVMVisibilityForVendor:function(){var e=q.sap.getUriParameters();if(e.mParams["sap-ui-layer"]){var j=e.mParams["sap-ui-layer"];for(var i=0;i<j.length;i++){if(j[i].toUpperCase()==="VENDOR"){return true;}}}return false;}},extensionAPI:new E(T,g,B)};x1.handlers=q.extend(B.handlers,x1.handlers);return x1;}};return o;});
