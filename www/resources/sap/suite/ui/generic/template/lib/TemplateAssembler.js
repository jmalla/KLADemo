sap.ui.define(["jquery.sap.global","sap/ui/core/mvc/ControllerExtension","sap/ui/core/mvc/OverrideExecution","sap/ui/core/mvc/View","sap/suite/ui/generic/template/lib/TemplateViewController","sap/suite/ui/generic/template/lib/TemplateComponent","sap/suite/ui/generic/template/lib/CRUDManager","sap/suite/ui/generic/template/lib/CommonUtils","sap/suite/ui/generic/template/lib/ComponentUtils","sap/suite/ui/generic/template/lib/CommonEventHandlers","sap/suite/ui/generic/template/lib/testableHelper","sap/suite/ui/generic/template/support/lib/CommonMethods","sap/base/Log"],function(q,C,O,V,T,a,b,c,d,e,t,f,L){"use strict";var A=Object.create(null);var r=function(o){var s=o.appComponent.getId();A[s]=o;return function(){delete A[s];};};function g(o){var s=o.getId();var R=A[s];return R;}function h(o){return g(o.getAppComponent()).oTemplateContract.componentRegistry[o.getId()];}function F(o){while(o&&!(o instanceof V)){o=o.getParent();}return o;}function G(o){while(o){var v=F(o);var k=v&&v.getController();var l=k&&k.getOwnerComponent();if(l instanceof a){var m=h(l);return m;}else{o=l&&l.oContainer;}}}function i(k,o,l,m,n,p){var s=o.oComponent.getTemplateName();l=q.extend(true,{},l);m=q.extend(true,{},m);var u,v;var E;l.constructor=function(){T.prototype.constructor.apply(this,arguments);o.oController=this;var M=k(n,this);o.oControllerUtils=n;this._templateEventHandlers=Object.freeze(M.handlers||{});this._templateFormatters=Object.freeze(M.formatters||{});E=Object.freeze(M.extensionAPI||{});this.extensionAPI=E;var y;u=function(){var z=this.getView();y=z.getId();L.info("Init view "+y+" of template "+s);n.oServices.oApplicationController.registerView(z);n.oCommonUtils=new c(this,n.oServices,n.oComponentUtils);n.oServices.oCRUDManager=new b(this,n.oComponentUtils,n.oServices,n.oCommonUtils,p.oTemplateContract.oBusyHelper);n.oCommonEventHandlers=new e(this,n.oComponentUtils,n.oServices,n.oCommonUtils);(M.onInit||q.noop)();}.bind(this);v=function(){p.oTemplateContract.oApplicationProxy.destroyView(y);(M.onExit||q.noop)();L.info("View "+y+" of template "+s+" exited");};};l.onInit=function(){u();};l.onExit=function(){v();};m.metadata=m.metadata||{};m.metadata.methods=m.metadata.methods||{};for(var w in m){if(typeof m[w]==="function"){var x=m.metadata.methods[w];if(!x){x={};m.metadata.methods[w]=x;}x.public=(x.public!==false);x.final=x.final||false;x.overrideExecution=x.overrideExecution||O.After;}}m.metadata.methods.getExtensionAPI={"public":true,"final":true};m.getExtensionAPI=function(){return E;};l.templateBaseExtension=C.extend(s+"BaseExtension",m);return T.extend(s,l);}function j(o){var k=o.methods.oControllerSpecification;return k&&function(){var l=o.oComponent.getAppComponent();var m=g(l);var n=l.getTransactionController();var N=l.getNavigationController();var p={oComponentUtils:o.utils,oServices:{oTemplateCapabilities:{},oApplicationController:l.getApplicationController(),oTransactionController:n,oNavigationController:N,oDraftController:n.getDraftController(),oApplication:m.application,oViewDependencyHelper:m.oViewDependencyHelper}};o.viewRegistered.catch(function(E){N.navigateToMessagePage({viewLevel:o.viewLevel,title:o.oTemplateContract.getText("ST_ERROR"),text:o.oTemplateContract.getText("ST_GENERIC_UNKNOWN_NAVIGATION_TARGET"),description:E.message});});return i(k.getMethods,o,k.oControllerDefinition,k.oControllerExtensionDefinition,p,m);};}r=t.testableStatic(r,"TemplateComponent_RegisterAppComponent");return{getTemplateComponent:function(k,s,o){var l=s+".Component";o=o||{};o.init=function(){var m=this.getComponentData();var n=m.registryEntry;n.viewRegistered=new Promise(function(R,v){n.fnViewRegisteredResolve=function(E){if(E){n.fnViewRegisteredResolve=q.noop;v(E);}else{delete n.fnViewRegisteredResolve;R();}};});n.oViewRenderedPromise=new Promise(function(R){n.fnViewRenderdResolve=R;});n.oViewRenderedPromise.then(function(){f.setApplicationStatus(f.mApplicationStatus.RENDERED);f.publishEvent("elements","ViewRendered",{});});n.reuseComponentProxies=Object.create(null);n.componentName=l;n.oComponent=this;n.activationTakt=0;n.aKeys=[];var p=g(n.oAppComponent);n.oTemplateContract=p.oTemplateContract;(a.prototype.init||q.noop).apply(this,arguments);n.utils=new d(this,n);n.methods=k(this,n.utils)||{};n.oGenericData={};n.mRefreshInfos=Object.create(null);var u=this.getId();n.oTemplateContract.componentRegistry[u]=n;n.oTemplateContract.oBusyHelper.setBusy(n.viewRegistered,true);n.oApplication=p.application;n.createViewController=j(n);n.componentCreateResolve(this);delete n.componentCreateResolve;delete m.registryEntry;(n.methods.init||q.noop)();};o.exit=function(){var m=this.getId();var n=h(this);var p=g(this.getAppComponent());var M=n.methods;(M.exit||q.noop)();delete p.oTemplateContract.componentRegistry[m];(a.prototype.exit||q.noop).apply(this,arguments);};o.onBeforeRendering=function(){var m=h(this);(a.prototype.onBeforeRendering||q.noop).bind(this,m).apply(this,arguments);var M=m.methods;(M.onBeforeRendering||q.noop)();};o.onAfterRendering=function(){var m=h(this);if(m.fnViewRenderdResolve&&!m.fnViewRegisteredResolve){m.fnViewRenderdResolve();delete m.fnViewRenderdResolve;}(a.prototype.onAfterRendering||q.noop).bind(this,m).apply(this,arguments);var M=m.methods;(M.onAftereRendering||q.noop)();};o.onActivate=function(B,I){var m=h(this);m.sCurrentBindingPath=B;var n=function(){m.utils.bindComponent(m.sCurrentBindingPath,I);m.utils.refreshBinding();return(m.methods.onActivate||q.noop)(B,I);};return m.fnViewRegisteredResolve?m.viewRegistered.then(n):(n()||Promise.resolve());};o.setIsRefreshRequired=function(I){if(I){var m=h(this);if(m.utils.isComponentActive()){m.viewRegistered.then(m.utils.refreshBinding.bind(null,true,{}));I=false;}}this.setProperty("isRefreshRequired",I);};o.onDeactivate=q.noop;return a.extend(l,o);},getRegisterAppComponent:function(){var R=r;r=null;return R;},getExtensionAPIPromise:function(o){var k=G(o);if(!k){return Promise.reject();}return k.viewRegistered.then(function(){return k.oController.extensionAPI;});},getExtensionAPI:function(o){var k=G(o);return k&&k.oController&&k.oController.extensionAPI;}};});
