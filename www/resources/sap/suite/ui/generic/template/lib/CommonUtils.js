sap.ui.define(["jquery.sap.global","sap/ui/base/Object","sap/ui/base/Event","sap/ui/core/mvc/ControllerExtension","sap/ui/model/Context","sap/ui/model/Filter","sap/m/Table","sap/m/ListBase","sap/m/MessageBox","sap/ui/generic/app/navigation/service/NavigationHandler","sap/ui/generic/app/navigation/service/NavError","sap/suite/ui/generic/template/lib/testableHelper","sap/base/Log"],function(q,B,E,C,a,F,R,L,M,N,b,t,c){"use strict";var o=sap.ui.getCore();function d(e,P){var i=sap.ui.require(P);return typeof i==="function"&&(e instanceof i);}function f(e){return d(e,"sap/ui/comp/smarttable/SmartTable");}function g(e){return d(e,"sap/ui/comp/smartchart/SmartChart");}function h(e){return d(e,"sap/ui/table/Table");}function l(e){return d(e,"sap/ui/table/AnalyticalTable");}function m(e){return d(e,"sap/ui/table/TreeTable");}function n(e){return d(e,"sap/m/Table");}function p(e){if(g(e)||f(e)){return e.getEntitySet();}else if(f(e.getParent())){return e.getParent().getEntitySet();}}function r(S){var e,i,j,k;e=S.getEntitySet();i=S.getModel().getMetaModel();j=i.getODataEntitySet(e);k=i.getODataEntityType(j.entityType);return k;}function s(S,e){var T=e&&sap.ui.getCore().byId(e);if(T){if(S.scrollToElement){S.scrollToElement(T.getDomRef());}T.focus();}}var f=t.testableStatic(f,"CommonUtils_isSmartTable");function u(v,S,w){var x;var y=Object.create(null);function z(e,i,j){var k=e instanceof E?e.getSource():e;var K1=k.getId();var L1=y[K1];if(!L1){if(j){return null;}L1={control:k,infoObject:Object.create(null),categories:[]};(i||q.noop)(L1.infoObject,L1.categories,k);y[K1]=L1;}return L1.infoObject;}function A(e,i){for(var j in y){var k=y[j];if(k.categories.indexOf(e)>=0){i(k.infoObject,k.control);}}}function D(e){S.oApplication.attachControlToParent(e,v.getView());}function G(e){if(e.getVisible&&!e.getVisible()){return null;}return e.getParent()||e.oContainer;}function H(e){var i=v.getView();var j=false;for(var k=i.getVisible()&&o.byId(e);k&&!j;k=G(k)){j=k===i;}return j;}function I(e){for(var i=0;i<e.length;i++){var j=e[i];if(H(j)){return j;}}return"";}function J(e,i,j,k){return S.oApplication.getDialogFragmentForView(v.getView(),e,i,j,k);}var K;function O(){var e=v.getOwnerComponent();K=K||e.getModel("i18n").getResourceBundle();return K.getText.apply(K,arguments);}function P(k,e,i,j){var K1,L1,M1,N1;var O1=v.getOwnerComponent();var P1=e.indexOf("::"+O1.getEntitySet()+"--")+2;K1=e.substring(P1,e.lastIndexOf("::"));K1=K1.replace(/--/g,"|").replace(/::/g,"|");L1=k+"|"+K1;M1=i||k;N1=O(L1,j);if(N1===L1){N1=O(M1,j);}return N1;}function Q(e,i){var i=i||e.getSelectionBehavior();if(i==="DATAPOINT"){return{"dataPoints":e.getSelectedDataPoints().dataPoints,"count":e.getSelectedDataPoints().count};}else if(i==="CATEGORY"){return{"dataPoints":e.getSelectedCategories().categories,"count":e.getSelectedCategories().count};}else if(i==="SERIES"){return{"dataPoints":e.getSelectedSeries().series,"count":e.getSelectedSeries().count};}}function T(e,j,k){var K1=[];if(f(e)){e=e.getTable();}else if(g(e)){e=e.getChart();if(e&&e.getMetadata().getName()==="sap.chart.Chart"){var L1=false;j=j||e.getSelectionBehavior();k=k||Q(e,j);if(k&&k.count>0){if(j==="DATAPOINT"){L1=true;}var M1=k.dataPoints;var N1=[];for(var i=0;i<M1.length;i++){if(L1){if(M1[i].context){K1.push(M1[i].context);}}else{N1.push(M1[i].dimensions);}}if(!L1){K1[0]=N1;}}}}if(e instanceof L){K1=e.getSelectedContexts();}else if(h(e)){var O1=e.getSelectedIndices();for(var i=0;i<O1.length;i++){K1.push(e.getContextByIndex(O1[i]));}}return K1;}function U(e){var i={};if(e instanceof sap.ui.core.Element){e.getCustomData().forEach(function(j){i[j.getKey()]=j.getValue();});}return i;}function V(e){var j,k,K1,L1,M1,N1;var O1=e1(e);if(!f(O1)&&!g(O1)){O1=O1.getParent();}var P1=T(O1);var Q1=O1.getModel();var R1=Q1.getMetaModel();var S1=v.getView();k=b1(O1);_(k,P1,Q1,O1);if(f(O1)){j=O1.getCustomToolbar()&&O1.getCustomToolbar().getContent();}else if(g(O1)){j=O1.getToolbar()&&O1.getToolbar().getContent();}if(j&&j.length>0){for(var i=0;i<j.length;i++){M1=undefined;K1=j[i];if(K1.getMetadata().getName()==="sap.m.Button"&&K1.getVisible()){N1=U(K1);if(N1&&N1.Type){L1=S1.getLocalId(K1.getId());if(N1.Type==="CRUDActionDelete"){M1=Z(Q1,R1,P1,O1);O1.getModel("_templPriv").setProperty("/listReport/deleteEnabled",M1);}else if(N1.Type==="com.sap.vocabularies.UI.v1.DataFieldForAction"||N1.Type==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"){M1=Y(Q1,R1,P1,N1.Type,N1.Action,O1);}}if(/generic\/controlProperties/.test(K1.getBindingPath("enabled"))&&M1!==undefined){X(L1,"enabled",M1);}}}}}function W(e){var i;var j=e1(e);var k=T(j);var K1=e.getModel();i=c1();_(i,k,K1,j);}function X(i,e,j){var k=v.getView().getModel("_templPriv");var K1=k.getProperty("/generic/controlProperties/"+i);if(!K1){K1={};K1[e]=j;k.setProperty("/generic/controlProperties/"+i,K1);}else{k.setProperty("/generic/controlProperties/"+i+"/"+e,j);}}function Y(e,i,k,K1,L1,M1){var N1,O1,P1,Q1;var R1=false;if(K1==="com.sap.vocabularies.UI.v1.DataFieldForAction"){N1=i.getODataFunctionImport(L1);P1=N1&&N1["sap:action-for"];if(P1&&P1!==""&&P1!==" "){if(k.length>0){Q1=N1["sap:applicable-path"];if(Q1&&Q1!==""&&Q1!==" "){for(var j=0;j<k.length;j++){if(!k[j]){continue;}O1=e.getObject(k[j].getPath());if(O1&&O1[Q1]){R1=true;break;}}}else{R1=true;}}}else{R1=true;}}else if(K1==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"){if(k.length>0||(g(M1)&&M1.getDrillStackFilters().length>0)){R1=true;}}return R1;}function Z(e,j,k,K1){var L1=$(K1);var M1=false;var N1;var O1=j.getODataEntitySet(K1.getEntitySet());if(sap.suite.ui.generic.template.js.AnnotationHelper.areDeleteRestrictionsValid(j,O1.entityType,L1)){if(k.length>0){var P1=L1&&L1.Deletable&&L1.Deletable.Path;for(var i=0;i<k.length;i++){N1=e.getObject(k[i].getPath());if(!N1){break;}if(P1){if(k[i]&&e.getProperty(P1,k[i])){if(!(N1.IsActiveEntity&&N1.HasDraftEntity&&N1.DraftAdministrativeData&&e.getProperty("DraftAdministrativeData/InProcessByUser",k[i]))){M1=true;break;}}}else{if(!(N1.IsActiveEntity&&N1.HasDraftEntity&&N1.DraftAdministrativeData&&e.getProperty("DraftAdministrativeData/InProcessByUser",k[i]))){M1=true;break;}}}}}return M1;}function $(e){var i=e.getModel()&&e.getModel().getMetaModel();var j=i&&i.getODataEntitySet(e.getEntitySet());var k=j&&j["Org.OData.Capabilities.V1.DeleteRestrictions"];return k;}function _(e,i,j,k){var K1=d1(k);var L1=v.getView().getModel("_templPriv");var M1=L1.getProperty("/generic/listCommons/breakoutActionsEnabled");if(K1){var N1=v.byId("template::IconTabBar");var O1="";if(N1){O1=N1.getSelectedKey();}a1(M1,K1,e,i,j,O1,k);}L1.setProperty("/generic/listCommons/breakoutActionsEnabled",M1);}function a1(e,i,j,k,K1,L1,M1){var N1;for(var O1 in i){N1=true;if(i[O1].requiresSelection){if(k.length>0){if(i[O1].applicablePath!==undefined&&i[O1].applicablePath!==""){N1=false;for(var P1=0;P1<k.length;P1++){var Q1="";var R1=i[O1].applicablePath.split("/");if(R1.length>1){for(var S1=0;S1<R1.length-1;S1++){Q1+="/"+R1[S1];}}var T1=K1.getObject(k[P1].getPath()+Q1);var U1=R1[R1.length-1];if(T1[U1]===true){N1=true;break;}}}}else if(g(M1)&&M1.getDrillStackFilters().length>0){N1=true;}else{N1=false;}}var V1=i[O1].id+((L1&&!i[O1].determining)?"-"+L1:"");e[V1]={enabled:N1};}}function b1(e){var i=[];var j=d1(e);for(var k in j){i.push(j[k].id);}return i;}function c1(){var e=[];var i=d1();for(var j in i){if(i[j].determining){e.push(j);}}return e;}function d1(e){var i=v.getOwnerComponent();var j=i.getAppComponent().getManifestEntry("sap.ui5");var k=j.extends&&j.extends.extensions&&j.extends.extensions["sap.ui.controllerExtensions"];k=k&&k[i.getTemplateName()];k=k&&k["sap.ui.generic.app"];var K1=i.getEntitySet();var L1=U(e).sectionId;if(!L1){return k&&k[K1]&&k[K1]["Actions"];}else{var M1=k&&k[K1]&&k[K1]["Sections"];return M1&&M1[L1]&&M1[L1].Actions;}}function e1(e){var i=e;while(i){if(i instanceof R||h(i)||f(i)||g(i)){return i;}i=i.getParent&&i.getParent();}return null;}function f1(e){if(f(e)){e=e.getTable();}if(h(e)){return e.getBindingInfo("rows");}else if(e instanceof R){return e.getBindingInfo("items");}return null;}function g1(e){var i=f1(e);if(i&&i.binding){i.binding.refresh();}else if(e&&e.rebindTable){e.rebindTable();}}function h1(e){var i=v.getOwnerComponent();var j=i.getModel();var k,K1;var L1=!S.oApplication.checkEtags();if(L1){K1=f1(e);if(K1){k=K1.path;var M1=e.getEntitySet();var N1=j.getMetaModel();var O1=N1.getODataEntitySet(M1);if(v.getMetadata().getName()==='sap.suite.ui.generic.template.AnalyticalListPage.view.AnalyticalListPage'&&i1(j,O1)){j.invalidateEntityType(O1.entityType);}else{j.invalidate(j1.bind(null,k));}var P1=i.getId();var Q1=Object.create(null);Q1[P1]=true;S.oApplication.refreshAllComponents(Q1);}}}function i1(e,i){q.sap.require("sap.ui.model.analytics.odata4analytics");var j=new sap.ui.model.analytics.odata4analytics.Model(sap.ui.model.analytics.odata4analytics.Model.ReferenceByModel(e));var k=j.findQueryResultByName(i.name);var K1=k&&k.getParameterization();return!!K1;}function j1(e,k,i){var j=e[0]==="/"?e.substr(1):e;if(k.split("(")[0]===j){return true;}else{return false;}}function k1(e,i){var j=e.getPath();var k=v.getOwnerComponent();var K1=k.getComponentContainer().getElementBinding();var L1=K1?K1.getPath():"";var M1=null;if(j.indexOf(L1)!==0){M1=f1(i).path;}var N1=!S.oApplication.isNewHistoryEntryRequired(e,M1);var O1;if(w.isDraftEnabled()){O1=S.oDraftController.isActiveEntity(e)?1:6;}else{O1=k.getModel("ui").getProperty("/editable")?6:1;}var P1=w.getViewLevel();if(P1===0){var Q1=S.oApplication.getForwardNavigationProperty(P1);}if(Q1){var R1=new Promise(function(T1){e.getModel().createBindingContext(Q1,e,null,function(U1){if(U1){S.oNavigationController.navigateToContext(U1,M1,N1,O1);T1();}else{w.navigateToDataLoadedFailedPage();T1();}});});var S1=S.oApplication.getBusyHelper();S1.setBusy(R1);}else{S.oNavigationController.navigateToContext(e,M1,N1,O1);}}function l1(e,i){if(e instanceof a){S.oNavigationController.navigateToContext(e,i&&i.navigationProperty,i&&i.replaceInHistory);return;}var j=i&&i.routeName;if(j){w.navigateRoute(j,e,null,i&&i.replaceInHistory);return;}c.warning("navigateToContext called without context or route");}function m1(e){if(e instanceof b){if(e.getErrorCode()==="NavigationHandler.isIntentSupported.notSupported"){M.show(O("ST_NAV_ERROR_NOT_AUTHORIZED_DESC"),{title:O("ST_GENERIC_ERROR_TITLE")});}else{M.show(e.getErrorCode(),{title:O("ST_GENERIC_ERROR_TITLE")});}}}function n1(e,i){B1(function(){x=I1();var j={semanticObject:e.semanticObject,action:e.action};var k=x.mixAttributesAndSelectionVariant(e.parameters);v.adaptNavigationParameterExtension(k,j);x.navigate(e.semanticObject,e.action,k.toJSONString(),null,m1);},q.noop,i,"LeavePage");}function o1(e){var K1=[],L1,M1,N1;var O1=v.getOwnerComponent();var P1=O1.getModel().getMetaModel();if(!e){return{};}var Q1=O1.getAppComponent().getConfig().pages[0];if(!Q1){return{};}var R1=function(i){N1=P1.getODataEntitySet(i.entitySet).entityType;M1=P1.getODataEntityType(N1);L1={};L1={entitySet:i.entitySet,aKeys:P1.getODataEntityType(N1).key.propertyRef,navigationProperty:i.navigationProperty};for(var j=0,T1=L1.aKeys.length;j<T1;j++){var k=0,U1=M1.property.length;for(k;k<U1;k++){if(L1.aKeys[j].name===M1.property[k].name){L1.aKeys[j].type=M1.property[k].type;break;}}}};var S1=function(e,Q1){if(!Q1.pages){return K1;}for(var i=0,j=Q1.pages.length;i<j;i++){if(!Q1.pages[i]){break;}if(e===Q1.pages[i].entitySet){R1(Q1.pages[i]);K1.splice(0,0,L1);break;}K1=S1(e,Q1.pages[i]);if(K1.length>0){R1(Q1.pages[i]);K1.splice(0,0,L1);}}return K1;};return S1(e,Q1);}function p1(k,e){var K1,L1,i,M1;for(i=0,M1=k.length;i<M1;i++){if(k[i].navigationProperty){L1+="/"+k[i].navigationProperty;}else{L1="/"+k[i].entitySet;}for(var j=0,N1=k[i].aKeys.length;j<N1;j++){if(j===0){L1+="(";K1="";}else{K1=",";}switch(k[i].aKeys[j].type){case"Edm.Guid":if(e.DraftAdministrativeData&&e.DraftAdministrativeData.DraftIsCreatedByMe){L1+=K1+k[i].aKeys[j].name+"="+"guid'"+e.DraftAdministrativeData[k[i].aKeys[j].name]+"'";}else{L1+=K1+k[i].aKeys[j].name+"="+"guid'"+e[k[i].aKeys[j].name]+"'";}break;case"Edm.Boolean":if(e.DraftAdministrativeData&&e.DraftAdministrativeData.DraftIsCreatedByMe){L1+=K1+k[i].aKeys[j].name+"="+false;}else{L1+=K1+k[i].aKeys[j].name+"="+e[k[i].aKeys[j].name];}break;default:if(typeof e[k[i].aKeys[j].name]==="string"){L1+=K1+k[i].aKeys[j].name+"="+"'"+e[k[i].aKeys[j].name]+"'";}else{L1+=K1+k[i].aKeys[j].name+"="+e[k[i].aKeys[j].name];}break;}if(j===(N1-1)){L1+=")";}}}return L1;}function q1(e,k,v){var K1,L1,M1,N1,O1,P1,Q1;var R1={semanticObject:"",action:""};x=I1();for(N1 in e.semanticAttributesOfSemanticObjects){K1=x.mixAttributesAndSelectionVariant({},k);for(M1 in e.semanticAttributesOfSemanticObjects[N1]){if(!K1.getSelectOption(M1)){K1.addParameter(M1,"");}}O1=K1.getPropertyNames();R1.semanticObject=N1;v.adaptNavigationParameterExtension(K1,R1);P1=K1.getSelectOptionsPropertyNames();Q1=K1.getParameterNames();for(var i=0,S1=O1.length;i<S1;i++){if(P1.indexOf(O1[i])<0&&Q1.indexOf(O1[i])<0){delete e.semanticAttributesOfSemanticObjects[N1][O1[i]];K1.removeSelectOption(O1[i]);}}if(N1===e.semanticObject){var T1=e.semanticAttributesOfSemanticObjects[""];for(var j=0,S1=Q1.length;j<S1;j++){if(Q1[j]in T1){K1.removeParameter(Q1[j]);}else{K1.removeParameter(Q1[j]);var U1=e.semanticAttributesOfSemanticObjects[e.semanticObject][Q1[j]];if(typeof U1==="undefined"||U1===null){U1="";}else{U1=String(U1);}K1.addParameter(Q1[j],U1);}}K1=x.mixAttributesAndSelectionVariant(e.semanticAttributesOfSemanticObjects[N1],k);L1=K1.toJSONString();}}delete e.semanticAttributes;x.processBeforeSmartLinkPopoverOpens(e,L1);}function r1(e,j){var k=function(O1){for(var i=0;i<O1.length;i++){j(O1[i].name);}};var K1=v.getView().getModel().getMetaModel();var L1=K1.getODataEntitySet(e,false);var M1=K1.getODataEntityType(L1.entityType,false);k(M1.key.propertyRef);var N1=S.oDraftController.getDraftContext();if(N1.isDraftEnabled(e)){k(N1.getSemanticKey(e));j("IsActiveEntity");j("HasDraftEntity");j("HasActiveEntity");}}function s1(e,i){if(!w.isDraftEnabled()||!e){return;}var j=e.getControlByKey("EditState");var k=j&&j.getSelectedKey()||"";switch(k){case"1":i.filters.push(new F("IsActiveEntity","EQ",true));i.filters.push(new F("HasDraftEntity","EQ",false));break;case"2":i.filters.push(new F("IsActiveEntity","EQ",false));break;case"3":i.filters.push(new F("IsActiveEntity","EQ",true));i.filters.push(new F("SiblingEntity/IsActiveEntity","EQ",null));i.filters.push(new F("DraftAdministrativeData/InProcessByUser","NE",""));break;case"4":i.filters.push(new F("IsActiveEntity","EQ",true));i.filters.push(new F("SiblingEntity/IsActiveEntity","EQ",null));i.filters.push(new F("DraftAdministrativeData/InProcessByUser","EQ",""));break;default:var K1=new F({filters:[new F("IsActiveEntity","EQ",false),new F("SiblingEntity/IsActiveEntity","EQ",null)],and:false});if(i.filters[0]&&i.filters[0].aFilters){var L1=i.filters[0];i.filters[0]=new F([L1,K1],true);}else{i.filters.push(K1);}break;}}function t1(e,i){if(i){e.filters.push(new F("IsActiveEntity","EQ",true));}else{var j=new F({filters:[new F("IsActiveEntity","EQ",false),new F("SiblingEntity/IsActiveEntity","EQ",null)],and:false});if(e.filters[0]&&e.filters[0].aFilters){var k=e.filters[0];e.filters[0]=new F([k,j],true);}else{e.filters.push(j);}}}function u1(i,j,k){if(j&&i&&i.getAnalyticBindingPath&&i.getConsiderAnalyticalParameters()){try{var K1=i.getAnalyticBindingPath();if(K1){j(K1);}}catch(e){c.warning("Mandatory parameters have no values","",k);}}}function v1(e,j,k){for(var i=0;i<j.length;i++){var K1=j[i];var L1=K1.lastIndexOf("/");var M1;if(L1<0){if(S.oApplication.getNavigationProperty(e,K1)){M1=K1;}else{continue;}}else{M1=K1.substring(0,L1);}if(k.indexOf(M1)===-1){k.push(M1);}}}function w1(e,i,j){var k=e.getParameter("bindingParams"),K1=e.getSource().getId();k.parameters=k.parameters||{};var L1=w.getTemplatePrivateModel();var M1=L1.getProperty("/listReport/vDraftState");var N1=L1.getProperty("/listReport/activeObjectEnabled");var O1=function(V1,W1,K1){if(i&&i[V1]){var X1=true;var Y1=function(){var Z1=arguments[0];if(!(Z1 instanceof C)){throw new Error("Please provide a valid ControllerExtension in order to execute extension "+V1);}if(!X1){throw new Error("Extension "+V1+" must be executed synchronously");}var $1=Array.prototype.slice.call(arguments,1);W1.apply(null,$1);};i[V1](Y1,K1);X1=false;}};var P1=function(V1){if(!K1||v.byId(K1)===e.getSource()){k.filters.push(V1);}};if((v.getMetadata().getName()!=='sap.suite.ui.generic.template.AnalyticalListPage.view.AnalyticalListPage')||(v.getMetadata().getName()!=='sap.suite.ui.generic.template.ObjectPage.view.Details')){if(M1=="0"&&w.isDraftEnabled()){t1(k,N1);}else{s1(j,k);}}O1("addExtensionFilters",P1,K1);if(v.getMetadata().getName()!=='sap.suite.ui.generic.template.ObjectPage.view.Details'){u1(j,i.setBindingPath,i.isAnalyticalListPage?"AnalyticalListPage":"ListReport");}var Q1=e.getSource();var R1=Q1.getEntitySet();var S1=k.parameters.select&&k.parameters.select.split(",")||[];var T1=k.parameters.expand&&k.parameters.expand.split(",")||[];var U1=function(V1,K1){if(V1&&(!K1||v.byId(K1)===e.getSource())){var W1=V1.split(',');W1.forEach(function(X1){if(X1&&q.inArray(X1,S1)===-1){S1.push(X1);}});}};if(!i.isAnalyticalListPage){r1(R1,U1);}O1("ensureExtensionFields",U1,K1);(i.addNecessaryFields||q.noop)(S1,U1,R1);v1(R1,S1,T1);if(T1.length>0){k.parameters.expand=T1.join(",");}if(S1.length>0){k.parameters.select=S1.join(",");}}function x1(e,i,j){if(!e){return O("DRAFT_OBJECT");}else if(i){return O(j?"LOCKED_OBJECT":"UNSAVED_CHANGES");}else{return"";}}function y1(){var e=J("sap.suite.ui.generic.template.fragments.DraftAdminDataPopover",{formatText:function(){var i=Array.prototype.slice.call(arguments,1);var k=arguments[0];if(!k){return"";}if(i.length>0&&(i[0]===null||i[0]===undefined||i[0]==="")){if(i.length>3&&(i[3]===null||i[3]===undefined||i[3]==="")){return(i.length>2&&(i[1]===null||i[1]===undefined||i[1]===""))?"":i[2];}else{return O(k,i[3]);}}else{return O(k,i[0]);}},closeDraftAdminPopover:function(){e.close();},formatDraftLockText:x1},"admin");return e;}function z1(e,i,j,k,K1,L1){var M1=S.oApplication.getBusyHelper();if(!K1&&M1.isBusy()){return;}if(!w.isDraftEnabled()){var N1=false;if(j&&j.aUnsavedDataCheckFunctions){N1=j.aUnsavedDataCheckFunctions.some(function(R1){return R1();});}var O1=v.getView();var P1=O1.getModel();if(N1||P1.hasPendingChanges()){var Q1;D1(function(){O1.setBindingContext(null);P1.resetChanges();O1.setBindingContext();w.fire(v,"AfterCancel",{});Q1=e();},function(){Q1=i();},k,L1);return Q1;}}return e();}function A1(e,i,j,k){var K1=false;if(j&&j.aUnsavedDataCheckFunctions){K1=j.aUnsavedDataCheckFunctions.some(function(M1){return M1();});}if(K1||v.getView().getModel().hasPendingChanges()){var L1;F1(function(){v.getView().getModel().resetChanges();w.fire(v,"AfterCancel",{});L1=e();},function(){L1=i();},k);return L1;}return e();}function B1(e,i,j,k,K1,L1){if(K1){return z1(e,i,j,k,true,L1);}S.oApplication.performAfterSideEffectExecution(z1.bind(null,e,i,j,k,false,L1));}var C1;function D1(e,i,j,k){var K1;C1=e;if(!j||!k){var L1=J("sap.suite.ui.generic.template.fragments.DataLoss",{onDataLossOK:function(){L1.close();C1();},onDataLossCancel:function(){L1.close();i();}},"dataLoss");if(!j){j="LeavePage";}K1=L1.getModel("dataLoss");K1.setProperty("/mode",j);L1.open();}else{var M1=J("sap.suite.ui.generic.template.fragments.DiscardDraftPopover",{onDiscardConfirm:function(){C1();}},"discard");K1=M1.getModel("discard");K1.setProperty("/placement",sap.m.PlacementType.Top);if(j!=="Proceed"){K1.setProperty("/isCreateDraft",true);}else{K1.setProperty("/isCreateDraft",false);}K1.setProperty("/mode",j);M1.openBy(k.getSource());}}var E1;function F1(e,i,j){E1=e;if(!j){j="LeavePage";}var k=J("sap.suite.ui.generic.template.fragments.DataLossTechnicalError",{onDataLossOK:function(){k.close();E1();},onDataLossCancel:function(){k.close();i();}},"dataLoss");var K1=k.getModel("dataLoss");K1.setProperty("/mode",j);k.open();}function G1(e,i,j,k,K1,L1){if(i.busy.check&&k.isBusy()){L1();return;}var M1=i.busy.set?function(){k.setBusy(Promise.resolve(),false,{actionLabel:i.sActionLabel});return e();}:e;var N1=i.mConsiderObjectsAsDeleted?function(P1){S.oApplication.prepareDeletion(i.mConsiderObjectsAsDeleted);return M1();}:M1;var O1=(i.dataloss.popup?B1(N1,L1,j,(i.dataloss.navigation?"LeavePage":"Proceed"),true):N1());if(O1 instanceof Promise){O1.then(K1,L1);}else{K1();}}function H1(e,i,j){i=q.extend(true,{busy:{set:true,check:true},dataloss:{popup:true,navigation:false}},i);var k=S.oApplication.getBusyHelper();var K1=new Promise(function(L1,M1){S.oApplication.performAfterSideEffectExecution(G1.bind(null,e,i,j,k,L1,M1));});if(i.busy.set){k.setBusy(K1,false,{actionLabel:i.sActionLabel});}return K1;}function I1(){x=x||new N(v);return x;}function J1(e){var j;var k=w.getTemplatePrivateModel();var K1=v.getOwnerComponent();var L1,M1,N1,O1,P1,Q1=[],R1=[],i,S1,T1,U1,V1,W1,X1;var Y1,Z1;L1=K1.getAppComponent();M1=sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService&&sap.ushell.Container.getService("CrossApplicationNavigation");N1=k.getProperty("/generic/supportedIntents/");if(g(e)){j=e.getToolbar();}else if(f(e)){j=e.getCustomToolbar();}O1=j.getContent();P1=O1.length;for(i=0;i<P1;i++){S1=U(O1[i]);if(S1.hasOwnProperty("SemanticObject")&&S1.hasOwnProperty("Action")){T1=S1.SemanticObject;U1=S1.Action;V1={semanticObject:T1,action:U1,ui5Component:L1};Q1.push([V1]);W1=q.extend({},V1);W1.bLinkIsSupported=false;R1.push(W1);}}if(Q1.length>0&&M1){X1=M1.getLinks(Q1);X1.done(function($1){N1=k.getProperty("/generic/supportedIntents/");Y1=$1.length;for(i=0;i<Y1;i++){if($1[i][0].length>0){R1[i].bLinkIsSupported=true;}T1=R1[i].semanticObject;U1=R1[i].action;Z1=k.getProperty("/generic/supportedIntents/"+T1);if(!Z1){N1[T1]={};N1[T1][U1]={"visible":R1[i].bLinkIsSupported};}else if(!Z1[U1]){Z1[U1]={"visible":R1[i].bLinkIsSupported};}else{Z1[U1]["visible"]=R1[i].bLinkIsSupported;}}k.updateBindings();});}}var I1=t.testable(I1,"getNavigationHandler");var _=t.testable(_,"fillEnabledMapForBreakoutActions");var b1=t.testable(b1,"getBreakoutActionIds");var e1=t.testable(e1,"getOwnerControl");var T=t.testable(T,"getSelectedContexts");return{isSmartTable:f,isSmartChart:g,isUiTable:h,isAnalyticalTable:l,isTreeTable:m,isMTable:n,getPositionableControlId:I,getCurrentEntitySetName:p,getMetaModelEntityType:r,getText:O,getContextText:P,getNavigationHandler:I1,getNavigationKeyProperties:o1,mergeNavigationKeyPropertiesWithValues:p1,executeGlobalSideEffect:function(){if(w.isDraftEnabled()){var e=v.getView();e.attachBrowserEvent("keydown",function(i){var j=(i.target.type==="search")?true:false;var k=(i.target.type==="textarea")?true:false;if(i.keyCode===13&&i.ctrlKey!==true&&e.getModel("ui").getProperty("/editable")&&!j&&!k){var K1=v.getOwnerComponent().getAppComponent().getConfig();var L1=K1.settings&&K1.settings.forceGlobalRefresh;var M1;S.oApplication.addSideEffectPromise(new Promise(function(N1){M1=N1;}));setTimeout(function(){var N1=S.oApplicationController.executeSideEffects(e.getBindingContext(),null,null,L1);N1.then(function(){M1();setTimeout(function(){document.getElementById(i.target.id).focus();});});});}});}},setEnabledToolbarButtons:V,setEnabledFooterButtons:W,fillEnabledMapForBreakoutActions:_,getBreakoutActions:d1,getSelectedContexts:T,getSelectionPoints:Q,getDeleteRestrictions:$,setPrivateModelControlProperty:X,navigateFromListItem:k1,navigateToContext:l1,navigateExternal:n1,semanticObjectLinkNavigation:q1,getCustomData:function(e){var j=e.getSource().getCustomData();var k={};for(var i=0;i<j.length;i++){k[j[i].getKey()]=j[i].getValue();}return k;},onBeforeRebindTableOrChart:w1,formatDraftLockText:x1,showDraftPopover:function(e,i){var j=y1();var k=j.getModel("admin");k.setProperty("/IsActiveEntity",e.getProperty("IsActiveEntity"));k.setProperty("/HasDraftEntity",e.getProperty("HasDraftEntity"));j.bindElement({path:e.getPath()+"/DraftAdministrativeData"});if(j.getBindingContext()){j.openBy(i);}else{j.getObjectBinding().attachDataReceived(function(){j.openBy(i);});}},getContentDensityClass:function(){return S.oApplication.getContentDensityClass();},attachControlToView:D,getDialogFragment:J,processDataLossConfirmationIfNonDraft:B1,processDataLossTechnicalErrorConfirmation:A1,securedExecution:H1,getOwnerControl:e1,getTableBindingInfo:f1,refreshSmartTable:g1,refreshModel:h1,getElementCustomData:U,triggerAction:function(e,i,j,k,K1){B1(function(){S.oCRUDManager.callAction({functionImportPath:j.Action,contexts:e,sourceControl:k,label:j.Label,operationGrouping:"",navigationProperty:""}).then(function(L1){if(L1&&L1.length>0){var M1=L1[0];if(M1.response&&M1.response.context&&(!M1.actionContext||M1.actionContext&&M1.response.context.getPath()!==M1.actionContext.getPath())){S.oApplication.getBusyHelper().getUnbusy().then(S.oViewDependencyHelper.setMeToDirty.bind(null,v.getOwnerComponent(),i));}}});},q.noop,K1,"Proceed");},checkToolbarIntentsSupported:J1,getControlInformation:z,executeForAllInformationObjects:A,focusControl:s};}return B.extend("sap.suite.ui.generic.template.lib.CommonUtils",{constructor:function(e,S,i){q.extend(this,u(e,S,i));}});});
