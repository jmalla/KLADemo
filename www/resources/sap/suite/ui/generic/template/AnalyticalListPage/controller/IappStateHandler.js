sap.ui.define(["jquery.sap.global","sap/ui/base/Object","sap/ui/generic/app/navigation/service/SelectionVariant","sap/ui/Device","sap/ui/comp/state/UIState","sap/ui/core/mvc/ControllerExtension","sap/base/Log"],function(q,B,S,D,U,C,L){"use strict";function g(s,c,n){var a="sap.suite.ui.generic.template.customData";var b="sap.suite.ui.generic.template.genericData";var d="sap.suite.ui.generic.template.extensionData";var F="visual";var e="compact";var p;var I=false,f=false,_=null,h;var o=null;var A=null;var r={appStateKey:"",urlParams:{}};function j(){return p.then(function(){if(r.appStateKey){return{"sap-iapp-state":[r.appStateKey]};}return r.urlParams;});}function R(i){if(i&&i.editStateFilter!==undefined){var X=c.byId("editStateFilter");if(X){X.setSelectedKey((i.editStateFilter===null)?0:i.editStateFilter);}}var Y=s.oController.getOwnerComponent().getModel("_templPriv");if(i.chartVariantId&&s.oSmartChart){s.oSmartChart.setCurrentVariantId(i.chartVariantId);}if(i.filterMode){Y.setProperty('/alp/filterMode',i.filterMode);s.filterBarController.handleFilterSwitch(i.filterMode);}else{m();}if(i.contentView){((D.system.phone||D.system.tablet&&!D.system.desktop)&&i.contentView==="charttable")?Y.setProperty('/alp/contentView',"chart"):Y.setProperty('/alp/contentView',i.contentView);}if(i.autoHide){Y.setProperty('/alp/autoHide',i.autoHide);}}function k(i){if(!i){return;}var X=true;var Y=function(Z){if(!(Z instanceof C)){throw new Error("State must always be retrieved with respect to a ControllerExtension");}var $=Z.getMetadata().getNamespace();if(!X){throw new Error("State must always be restored synchronously");}return i[$];};c.templateBaseExtension.restoreExtensionAppStateData(Y);X=false;}function l(i){i=i||{};if(i.hasOwnProperty(a)&&i.hasOwnProperty(b)){R(i[b]);y(i[a]);k(i[d]);}else{if(i._editStateFilter!==undefined){R({editStateFilter:i._editStateFilter});delete i._editStateFilter;}m();y(i);}}function m(){var i=s.oController.getOwnerComponent().getModel("_templPriv"),X=s.oSmartFilterbar.isCurrentVariantStandard()?s.oController.getOwnerComponent().getDefaultFilterMode():i.getProperty('/alp/filterMode');if(!(X===F||X===e)){L.error("Defaulting to Visual filter due to incorrect value of defaultFilterMode in App descriptor");X=F;}if(X===F&&s.hideVisualFilter){L.error("Visual filter is hidden defaulting to compact");X=e;}s.filterBarController.setDefaultFilter(X);}function t(i,X,Y){s.oSmartFilterbar.setSuppressSelection(false);var Z=i.appStateKey||"";if(I){return;}A=Z;I=true;var $=(!Z&&X)||{};if(Y!==sap.ui.generic.app.navigation.service.NavType.initial){var a1=i&&i.bNavSelVarHasDefaultsOnly;var b1=new S(i.selectionVariant);if((b1.getSelectOptionsPropertyNames().indexOf("DisplayCurrency")===-1)&&(b1.getSelectOptionsPropertyNames().indexOf("P_DisplayCurrency")===-1)&&(b1.getParameterNames().indexOf("P_DisplayCurrency")===-1)){v(b1,i);}if((!a1||s.oSmartFilterbar.isCurrentVariantStandard())){var c1={selectionVariant:b1};if(Y!==sap.ui.generic.app.navigation.service.NavType.iAppState){s.oController.modifyStartupExtension(c1);}G(c1.selectionVariant);E(c1.selectionVariant);}else{var d1=new S(JSON.stringify(s.oSmartFilterbar.getUiState().getSelectionVariant())),e1=d1.getSelectOption("sap.suite.ui.generic.template.customData"),f1=d1.getSelectOption("sap.suite.ui.generic.template.genericData");u(d1,e1,f1,true);var c1={selectionVariant:d1};s.oController.modifyStartupExtension(c1);u(c1.selectionVariant,e1,f1,false);if(!q.sap.equal(c1.selectionVariant,new S(JSON.stringify(s.oSmartFilterbar.getUiState().getSelectionVariant())))){G(c1.selectionVariant);E(c1.selectionVariant);}}if(i.tableVariantId&&s.oSmartTable){s.oSmartTable.setCurrentVariantId(i.tableVariantId);}var g1=s.oController.getOwnerComponent().getModel("_templPriv");if(Y===sap.ui.generic.app.navigation.service.NavType.xAppState&&g1.getProperty('/alp/filterMode')===F){z();}if(i.customData){l(i.customData);}else{m();}if(!a1){s.oSmartFilterbar.checkSearchAllowed(s);if(s.oController.getView().getModel("_templPriv").getProperty("/alp/searchable")){f=true;s.oSmartFilterbar.search();}}else{if(s.oSmartFilterbar.isLiveMode()||s.oSmartFilterbar.isCurrentVariantExecuteOnSelectEnabled()){s.oSmartFilterbar.checkSearchAllowed(s);if(s.oController.getView().getModel("_templPriv").getProperty("/alp/searchable")){f=true;}}}r={appStateKey:Z,urlParams:$};}else{var b1=new S(JSON.stringify(s.oSmartFilterbar.getUiState().getSelectionVariant())),e1=b1.getSelectOption("sap.suite.ui.generic.template.customData"),f1=b1.getSelectOption("sap.suite.ui.generic.template.genericData");u(b1,e1,f1,true);var c1={selectionVariant:b1};s.oController.modifyStartupExtension(c1);u(c1.selectionVariant,e1,f1,false);if(!q.sap.equal(c1.selectionVariant,new S(JSON.stringify(s.oSmartFilterbar.getUiState().getSelectionVariant())))){G(c1.selectionVariant);E(c1.selectionVariant);}if(s.oSmartFilterbar.isLiveMode()||s.oSmartFilterbar.isCurrentVariantExecuteOnSelectEnabled()){s.oSmartFilterbar.checkSearchAllowed(s);if(s.oController.getView().getModel("_templPriv").getProperty("/alp/searchable")){f=true;}}m();}M();o=null;if(!f){Q();}else{I=false;}}function u(i,X,Y,Z){if(Z){i.removeSelectOption("sap.suite.ui.generic.template.customData");i.removeSelectOption("sap.suite.ui.generic.template.genericData");}else{i.massAddSelectOption("sap.suite.ui.generic.template.customData",X);i.massAddSelectOption("sap.suite.ui.generic.template.genericData",Y);}}function v(i,X){var Y=s.oSmartFilterbar.determineMandatoryFilterItems(),Z;for(var $=0;$<Y.length;$++){if(Y[$].getName().indexOf("P_DisplayCurrency")!==-1){if(X.oDefaultedSelectionVariant.getSelectOption("DisplayCurrency")&&X.oDefaultedSelectionVariant.getSelectOption("DisplayCurrency")[0].Low){Z=X.oDefaultedSelectionVariant.getSelectOption("DisplayCurrency")[0].Low;}if(Z){i.addParameter("P_DisplayCurrency",Z);}if(s.alr_visualFilterBar&&Z){s.alr_visualFilterBar.setDisplayCurrency(Z);}break;}}}function w(){var i={};i[a]={};var X=s.oController.getOwnerComponent().getModel("_templPriv");i[b]={chartVariantId:s.oSmartChart&&s.oSmartChart.getCurrentVariantId(),filterMode:X.getProperty('/alp/filterMode'),contentView:X.getProperty('/alp/contentView'),autoHide:X.getProperty('/alp/autoHide')};var Y=c.byId("editStateFilter");if(Y){i[b].editStateFilter=Y.getSelectedKey();}c.getCustomAppStateDataExtension(i[a]);var Z;var $=true;var a1=function(b1,c1){if(!(b1 instanceof C)){throw new Error("State must always be set with respect to a ControllerExtension");}if(!$){throw new Error("State must always be provided synchronously");}if(c1){Z=Z||Object.create(null);var d1=b1.getMetadata().getNamespace();Z[d1]=c1;}};c.templateBaseExtension.provideExtensionAppStateData(a1);$=false;if(Z){i[d]=Z;}return i;}function x(){var X=s.oSmartFilterbar.getUiState({allFilters:false}).getSelectionVariant();var Y=c.getVisibleSelectionsWithDefaults();for(var i=0;i<Y.length;i++){if(!X.getValue(Y[i])){X.addSelectOption(Y[i],"I","EQ","");}}if(s.oController.byId('template::PageVariant').currentVariantGetModified()&&X.SelectionVariantID){X.SelectionVariantID="";}return{selectionVariant:JSON.stringify(X),tableVariantId:s.oSmartTable&&s.oSmartTable.getCurrentVariantId(),customData:w()};}function y(i){c.restoreCustomAppStateDataExtension(i||{});}function z(){var i=q.extend(true,{},s.oSmartFilterbar.getFilterData(true)),X=s.oController.getOwnerComponent().getModel("_filter");X.setData(i);s.filterBarController._updateFilterLink();}function E(i){s.oSmartFilterbar.clearVariantSelection();s.oSmartFilterbar.clear();h=i;N(i.toJSONObject(),true,false);}function G(X){var Y=X.getParameterNames().concat(X.getSelectOptionsPropertyNames());for(var i=0;i<Y.length;i++){s.oSmartFilterbar.addFieldToAdvancedArea(Y[i]);}if(s.alr_visualFilterBar&&s.bVisualFilterInitialised){s.alr_visualFilterBar.addVisualFiltersToBasicArea(Y);}}function H(){if(s._bIsStartingUp){return;}if(I){return;}var i=x();try{o=n.storeInnerAppStateWithImmediateReturn(i);}catch(X){L.error("AnalyticalListPage.fnStoreCurrentAppStateAndAdjustURL: "+X);}if(o instanceof sap.ui.generic.app.navigation.service.NavError){o=null;return;}if(o&&A!==o.appStateKey){r.appStateKey=o.appStateKey;}}function J(){var i=s.oController.getOwnerComponent().getModel("_templPriv");if(i.getProperty('/alp/filterMode')===F){if(s.alr_visualFilterBar&&s.alr_visualFilterBar.bIsInitialised&&i.getProperty("/alp/searchable")===false){s.oSmartFilterbar.showFilterDialog();}}}function K(){if(s.oSmartFilterbar.isInitialised()){s.oSmartFilterbar.checkSearchAllowed(s);}}function M(){var i=s.oController.getOwnerComponent().getModel("_filter");i.setData(q.extend(true,{},s.oSmartFilterbar.getFilterData(true)));s.filterBarController._updateFilterLink();}function N(i,X,Y){var Z=new U({selectionVariant:i});s.oSmartFilterbar.setUiState(Z,{replace:X,strictMode:Y});}function O(i){p=n.parseNavigation();}function P(){try{var i=new Promise(function(Y,Z){_=Y;p.done(t);p.fail(Z);});return i;}catch(X){W();}}function Q(){I=false;_();}function T(){return h;}function V(i){if(!i){var X=s.oIappStateHandler.fnGetStartUpSelectionVariant();if(X){var Y=X.getParameterNames().concat(X.getSelectOptionsPropertyNames());s.alr_visualFilterBar.addVisualFiltersToBasicArea(Y);}}s.alr_visualFilterBar.updateVisualFilterBindings(true);if(s.oSmartFilterbar.isCurrentVariantStandard()){s.oIappStateHandler.fnCheckMandatory();s.oIappStateHandler.fnCheckToLaunchDialog();}}function W(){m();M();if(s.alr_visualFilterBar&&s.alr_visualFilterBar.bIsInitialised){s.oIappStateHandler.fnUpdateVisualFilterBar(true);}}return{getFilterState:w,fnCheckMandatory:K,fnCheckToLaunchDialog:J,getCurrentAppState:x,fnUpdateSVFB:M,fnSetDefaultFilter:m,fnRestoreFilterState:l,getUrlParameterInfo:j,onSmartFilterBarInitialise:O,onSmartFilterBarInitialized:P,fnStoreCurrentAppStateAndAdjustURL:H,fnSetFiltersUsingUIState:N,fnResolveStartUpPromise:Q,fnGetStartUpSelectionVariant:T,fnUpdateVisualFilterBar:V,fnOnError:W};}return B.extend("sap.suite.ui.generic.template.AnalyticalListPage.controller.IappStateHandler",{constructor:function(s,c,n){q.extend(this,g(s,c,n));}});});
