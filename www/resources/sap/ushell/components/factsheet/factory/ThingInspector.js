// Copyright (c) 2009-2017 SAP SE, All Rights Reserved
sap.ui.define(["jquery.sap.global","sap/suite/ui/commons/UnifiedThingInspector","sap/ushell/components/factsheet/annotation/Mapping","sap/ui/vbm/library","sap/ui/base/Object","sap/ui/core/format/NumberFormat","sap/viz/ui5/data/FlattenedDataset"],function($,U,M,v,O,N,F){"use strict";var t,c={},A=[],L={},d,f,g,h,q,r,s,u,w,x,y,z,B={},C,D,E,G,H,I,J,K,P,Q,R,S,T,V,W,X,Y,Z,_,a1,b1,c1,d1="displayFactSheet";W=sap.ui.getCore().getConfiguration().getFormatSettings().getFormatLocale();if(sap.ui.getCore().getConfiguration().getLanguage()==="ZH"){W=new sap.ui.core.Locale("zh_CN");}function e1(a){return a<0?true:false;}function f1(a){var b=Number(a).toFixed(0);if(e1(a)){b=Number(b)*-1;}return b;}function g1(a,b){var e,o,i,n;if(!a){return"";}o=new RegExp(N.oDefaultFloatFormat.groupingSeparator,"g");if(b>=0){b=parseInt(b,10);n=N.getFloatInstance({minFractionDigits:b,maxFractionDigits:b},W);}else{n=N.getFloatInstance({minFractionDigits:0,maxFractionDigits:99},W);}e=n.format(a);i=e.replace(/[\D]/g,"");if(i&&i.length>6){a=a.replace(o,"");if(f1(a)<1000){return N.getIntegerInstance().format(a);}n=N.getFloatInstance({minFractionDigits:1,maxFractionDigits:1,style:"short"},W);return n.format(a);}else{return e;}}function h1(){var p,a,o="",b,m,e,k,i,j,n,l,i1;b=this.getElementBinding().sPath.split("/")[1];m=this.getModel();e=this.mBindingInfos.value.parameters;k=this.mBindingInfos.value.parts;for(i=0;i<e.length;i+=1){o=o+e[i].string;}for(j=0;j<k.length;j+=1){p=k[j].path;l="{"+p+"}";a=m.oData[b][p];o=o.replace(l,a);}n=C(o);if($.isNumeric(n)){i1=this.mBindingInfos.value.parts.filter(function(j1){return(j1.path===p);});n=g1(n,i1[0].type.oFormatOptions.maxFractionDigits);this.setDoubleFontSize(true);}this.setValue(n);this.getElementBinding().detachChange(h1);}a1=function(){var a="";if(t.getName()&&t.getDescription()){a=t.getName()+", "+t.getDescription();}else if(t.getName()&&!t.getDescription()){a=t.getName();}else if(!t.getName()&&t.getDescription()){a=t.getDescription();}return a;};h=function(a){var b,e,i;b=a.slice(1).split("/");e="/";for(i=0;i<b.length;i+=1){if((b[i].indexOf("(")>0)&&(b[i].indexOf("sid(")<0)){break;}else{e+=b[i]+"/";}}return e;};q=function(a,m){var e,b,i,n;b=a.slice(m.sServiceUrl.length+1);if(b.indexOf("/")>=0){i=b.split("/");n=i[i.length];e=i[i.length-1];if(e.indexOf("(")>=0){e=e.slice(e.indexOf("("));}e=this.getNavEntitySet(e,n,m.getMetadata());}else{if(b.indexOf("(")>=0){e=b.slice(0,b.indexOf("("));}else{if(b.indexOf("?")>=0){e=b.slice(0,b.indexOf("?"));}else{e=b;}}}return e;};G=function(a,m){var e,k="",o,b;e=a.slice(m.sServiceUrl.length+1);if(e.indexOf("(")>=0){k=e.slice(e.indexOf("(")+1,e.indexOf(")"));if(k.indexOf("=")<=0){o=m.getServiceMetadata();b=s(q(a,m),o);k=H(b,o)+"="+k;}}return k;};H=function(e,m){var i,a,j;for(i=m.dataServices.schema.length-1;i>=0;i-=1){a=m.dataServices.schema[i];if(a.namespace===e.slice(0,e.lastIndexOf("."))){for(j=0;j<a.entityType.length;j+=1){if(a.entityType[j].name===e.slice(e.lastIndexOf(".")+1)){return a.entityType[j].key.propertyRef[0].name;}}}}};r=function(e,m){var i,a,b,j;for(i=m.dataServices.schema.length-1;i>=0;i-=1){a=m.dataServices.schema[i];if(a.entityContainer){b=a.entityContainer[0].entitySet;for(j=b.length-1;j>=0;j-=1){if(b[j].entityType===e){return b[j].name;}}}}};s=function(e,m,b){var i,a,k,j,l;for(i=m.dataServices.schema.length-1;i>=0;i-=1){a=m.dataServices.schema[i];if(a.entityContainer){k=a.entityContainer[0].entitySet;for(j=k.length-1;j>=0;j-=1){if(k[j].name===e){if(b){l=k[j].entityType.slice(a.namespace.length+1);}else{l=k[j].entityType;}return l;}}}}};u=function(e,n,m){var a,i,b,l,k,j,o;a=e.split(".");for(i=m.dataServices.schema.length-1;i>=0;i-=1){b=m.dataServices.schema[i];l=a[0];if(a.length>2){for(k=1;k<a.length-1;k+=1){l+="."+a[k];}}if(b.namespace===l){for(j=0;j<b.entityType.length;j+=1){if(b.entityType[j].name===a[a.length-1]){if(b.entityType[j].navigationProperty){for(k=0;k<b.entityType[j].navigationProperty.length;k+=1){if(b.entityType[j].navigationProperty[k].name===n){o=b.entityType[j].navigationProperty[k];return{name:o.relationship,toRole:o.toRole};}}}}}}}};w=function(e,n,m){var a,b,o,i,l,j,p,k;a=s(e,m);if(n.charAt(0)==="@"){if(c.termDefinitions&&c.termDefinitions[n]){b=c.termDefinitions[n];if(b.indexOf("Collection")>=0){b=b.slice(b.indexOf("(")+1,b.indexOf(")"));}return r(b,m);}}else{o=u(a,n,m);if(o){for(i=m.dataServices.schema.length-1;i>=0;i-=1){l=m.dataServices.schema[i];if(l.entityContainer&&l.entityContainer[0].associationSet){for(j=l.entityContainer[0].associationSet.length-1;j>=0;j-=1){p=l.entityContainer[0].associationSet[j];if(p.association===o.name){for(k=0;k<p.end.length;k+=1){if(p.end[k].role===o.toRole){return p.end[k].entitySet;}}}}}}}}};x=function(e,n,m){var a,o,i,b,j,l,k,p,i1;a=s(e,m);p=a.split(".")[a.split(".").length-1];o=u(a,n,m);if(o){for(i=m.dataServices.schema.length-1;i>=0;i-=1){b=m.dataServices.schema[i];for(j=0;j<b.entityType.length&&!i1;j+=1){if(b.entityType[j].name===p){for(k=0;k<b.entityType[j].navigationProperty.length;k+=1){if(b.entityType[j].navigationProperty[k].name===n){i1=b.entityType[j].navigationProperty[k].toRole;break;}}}}for(j=b.association.length-1;j>=0;j-=1){l=b.association[j];if(b.namespace+"."+l.name===o.name){for(k=0;k<l.end.length;k+=1){if(l.end[k].role===i1){return l.end[k].multiplicity;}}}}}}else{jQuery.sap.log.error("\""+n+"\" wasn't found in the metadata document. Check whether the corresponding search connector is active.");return 0;}};y=function(e,m){var o,a,b,i;o={};if(c.expand){if(c.expand[s(e,m)]){a=c.expand[s(e,m)];b=[];for(i in a){if(a.hasOwnProperty(i)){b.push(a[i]);}}o.expand=b.join(", ");}}return o;};c1=function(a,e,o){var m,b,j,k,l,n;for(m=o.dataServices.schema.length-1;m>=0;m-=1){b=o.dataServices.schema[m];for(j=0;j<b.entityType.length;j+=1){if(b.entityType[j].name===e.split(".")[e.split(".").length-1]){for(k=0;k<b.entityType[j].navigationProperty.length;k+=1){if(b.entityType[j].navigationProperty[k].name===a){for(l=0;l<b.association.length;l+=1){for(n=b.association[l].end.length-1;n>=0;n-=1){if(b.association[l].end[n].role===b.entityType[j].navigationProperty[k].toRole){return(b.association[l].end[n].type);}}}}}}}}};z=function(p,o){var b={},j;b.parts=[];b.parameters=[];for(j=p.length-1;j>=0;j-=1){if(p[j].Type==="Path"){if(p[j].EdmType){switch(p[j].EdmType){case"Edm.DateTimeOffset":case"Edm.DateTime":b.parts.push({path:p[j].Value,type:new sap.ui.model.type.DateTime({"UTC":true})});break;case"Edm.Time":b.parts.push({path:p[j].Value+"/ms",type:new sap.ui.model.type.Time({source:{pattern:"timestamp"},UTC:true})});break;case"Edm.Date":b.parts.push({path:p[j].Value,type:new sap.ui.model.type.Date({"UTC":true})});break;case"Edm.Decimal":case"Edm.Double":case"Edm.Single":b.parts.push({path:p[j].Value,type:new sap.ui.model.type.Float()});break;case"Edm.Int16":case"Edm.Int32":case"Edm.Int64":b.parts.push({path:p[j].Value,type:new sap.ui.model.type.Integer()});break;default:b.parts.push({path:p[j].Value});break;}}else{b.parts.push({path:p[j].Value});}}else if(p[j].Type==="String"){b.parameters.unshift({string:p[j].Value});}}b.formatter=function(){var a="",e,k,l,i,m="",n=false,i1=0,j1=0;if(arguments&&arguments.length>=1){e=arguments.length-1;l="";i=0;if(p&&p[0]&&(p[0].Type==="String")&&(p[0].Value.substr(0,1)==="#")){n=true;}for(k=0;k<p.length;k+=1){if(p[k].Type==="Path"){l=arguments[e];if(!l||(l.length===0)){if(a.length>i){if(a.indexOf("(")>i){a=a.substr(0,i);}else{a=a.substr(0,i);l=a;}}}else{if(n){l=encodeURIComponent(l);}a+=l;i1+=1;}e-=1;i=a.length;}else{i=a.length;m=p[k].Value;if(m.indexOf("(")!==-1){j1+=1;}if((l&&l.length>0)||(m.indexOf("(")!==-1)||(m&&(m.substr(0,1)==="#"))){a+=p[k].Value;}else{m="";}}}if(o){a=o(a);}a=a.trim();if((i1===1)&&(j1>0)&&(a.substr(0,1)==="(")&&(a.substr(-1)===")")){a=a.substr(1,a.length-2);}return a.trim();}};return b;};Q=function(o,p){var k;for(k in o){if(o.hasOwnProperty(k)){if(k==="__metadata"){continue;}else if(k===p){return o[k];}else if(typeof o[k]==="object"){return Q(o[k],p);}}}};C=function(a){var l,n,b,e={},i;l=a.lastIndexOf("/");n=a.slice(0,l);b=a.slice(l+1);if(!B[a]){e=new sap.ui.model.json.JSONModel();e.loadData(n,null,false);B[a]=e.getData();}else{e=B[a];}if(B[a]&&B[a].d){if(!B[a].d[b]){i=Q(B[a].d,b);}else{i=B[a].d[b];}}return i;};D=function(o,e,m,a){var b,i,n,j,k,l,p,i1;b=new sap.ui.core.Control();i=R(o.Value,o.EdmType,e);if(o.Value&&o.Value["com.sap.vocabularies.UI.v1.IsImageURL"]){b=new sap.m.Image({height:"50px"});if(i.BindingInfo){b.bindProperty("src",i.BindingInfo);}else{b.setProperty("src",i.String);}}else{if(o.UrlRef||o.Url||(o.Target&&o.Target.Path)){b=new sap.m.Link({wrapping:true});}else{b=new sap.m.Text();if(o.EdmType==="Edm.Decimal"||o.EdmType==="Edm.Double"||o.EdmType==="Edm.Single"||o.EdmType==="Edm.Int16"||o.EdmType==="Edm.Int32"||o.EdmType==="Edm.Int64"){b.setTextAlign(sap.ui.core.TextAlign.End);}}b.addStyleClass("sapFactsheetUtiDataField");if(i.BindingInfo){b.bindProperty("text",i.BindingInfo);}else{b.setProperty("text",i.String);}}if((o.RecordType==="com.sap.vocabularies.UI.v1.DataFieldWithNavigation")&&m){n=o.Target.Path;if(c[e][n.slice(1)]){if(n.charAt(0)==="@"){if(n.indexOf("/")<0){j=c[e][n.slice(1)].UrlRef;}else{j=c[e][n.slice(1,n.indexOf("/"))].UrlRef;}b.bindProperty("href",I(j));}}b.attachPress(function(j1){return false;});}if(o.RecordType==="com.sap.vocabularies.UI.v1.DataFieldWithUrl"){if(o.Url.String){b.setHref(o.Url.String);}else{b.bindProperty("href",I(o.Url));k=new sap.m.Text({wrapping:true});if(i.BindingInfo){k.bindProperty("text",jQuery.extend({},i.BindingInfo));}else{k.setProperty("text",i.String);}b.setVisible(false);l=new sap.ui.layout.VerticalLayout();l.addContent(b);l.addContent(k);if(!A[A.indexOf(a)].Links){A[A.indexOf(a)].Links=[];}if(o.Url.Apply){p=o.Url.Apply.Parameters[0].Value.slice(o.Url.Apply.Parameters[0].Value.indexOf("#")+1,o.Url.Apply.Parameters[0].Value.indexOf("-"));i1=o.Url.Apply.Parameters[0].Value.slice(o.Url.Apply.Parameters[0].Value.indexOf("#")+1,o.Url.Apply.Parameters[0].Value.indexOf("?"));}A[A.indexOf(a)].Links.push({sSemanticObject:p,sIntend:i1,oVL:l});}}if(l){return l;}else{return b;}};E=function(o,l,p,b){var a,e="",i="",m,j,k,n;a=new sap.m.Label(l);a.addStyleClass("sapFactsheetUtiLabel");if(b){e=":";}if(o.Label){if(o.Label.String){a.setText(o.Label.String.trim()+e);a.setTooltip(o.Label.String.trim());}else{if(o.Label.Path){a.bindProperty("text",o.Label.Path);a.bindProperty("tooltip",o.Label.Path);}}}else{if(o.Value){if(o.Value.Path&&p){m=p[o.Value.Path];for(j in m){if(m.hasOwnProperty(j)){if(j==="http://www.sap.com/Protocols/SAPData"){if(m[j].label){i=m[j].label;break;}}}}}else if(o.Value.Apply&&(o.Value.Apply.Name==="odata.concat")){for(k in o.Value.Apply.Parameters){if(o.Value.Apply.Parameters.hasOwnProperty(k)){n=o.Value.Apply.Parameters[k];if(n.Type==="Path"){m=p[n.Value];for(j in m){if(m.hasOwnProperty(j)){if(j==="http://www.sap.com/Protocols/SAPData"){if(m[j].label){i=m[j].label;break;}}}}break;}}}}a.setText(i+e);a.setTooltip(i);}}return a;};R=function(o,e,a){var b={},p,k,l=[],j,m,n,i1=[],j1,k1,i,l1,m1,n1,o1,p1=[],q1;q1=function(a,r1,s1){var p,t1={};p=c.propertyAnnotations[a];if(p&&p[r1]&&p[r1][s1]){if(p[r1][s1].Path){t1.Type="Path";t1.Value=p[r1][s1].Path;}else{t1.Type="String";t1.Value=p[r1][s1].String;}}return t1;};if(!o){return false;}if(o.Apply){if(o.Apply.Name==="odata.concat"){if(a&&c.propertyAnnotations&&c.propertyAnnotations[a]){k=o.Apply.Parameters;for(j=0;j<k.length;j+=1){l.push(k[j]);if(k[j].Type==="Path"){p=q1(a,k[j].Value,"Org.OData.Measures.V1.ISOCurrency");if(!$.isEmptyObject(p)){l.push({Type:"String",Value:" "});l.push({Type:p.Type,Value:p.Value});}p=q1(a,k[j].Value,"Org.OData.Measures.V1.Unit");if(!$.isEmptyObject(p)){l.push({Type:"String",Value:" "});l.push({Type:p.Type,Value:p.Value});}}}b.BindingInfo=z(l);}else{b.BindingInfo=z(o.Apply.Parameters);}}}else{if(o.Path){if(o.Path.charAt(0)==="@"){m=c[a][o.Path.slice(1,o.Path.indexOf("/"))].UrlRef;n=o.Path.slice(o.Path.indexOf("/")+1);if(m&&m.Apply){j1=m.Apply.Parameters;switch(m.Apply.Name){case"odata.concat":i1=j1;i1.push({Type:"String",Value:"/"+n});break;case"odata.fillUriTemplate":k1=j1[0].Value.split("{");for(i in k1){if(k1.hasOwnProperty(i)){if(k1[i].indexOf("}")<0){i1.push({Type:"String",Value:k1[i]});}else{l1=k1[i].split("}");for(j=1;j<j1.length;j+=1){if(j1[j].Name===l1[0]){m1=j1[j].Value;if(m1.Path){i1.push({Type:"Path",Value:m1.Path});}else{if(m1.Apply&&m1.Apply.Name&&(m1.Apply.Name.toLowerCase()==="odata.uriencode")){n1=m1.Apply.Parameters[0];i1.push({Type:n1.Type,Value:encodeURIComponent(n1.Value)});i1.push({Type:"String",Value:"{"+encodeURIComponent(n1.Value)+"}"});}}}}i1.push({Type:"String",Value:l1[1]});}}}i1.push({Type:"String",Value:"/"+n});b.fnChange=h1;break;default:break;}b.BindingInfo=z(i1,C);}else{if(m&&m.Path){i1.push({Type:"Path",Value:m.Path},{Type:"String",Value:"/"+n});b.BindingInfo=z(i1,C);}else{if(m&&m.String){b.String=C(m.String+"/"+n);}}}}else{b.BindingInfo={};switch(e){case"Edm.DateTimeOffset":case"Edm.DateTime":b.BindingInfo={path:o.Path,type:new sap.ui.model.type.DateTime({"UTC":true})};break;case"Edm.Time":b.BindingInfo={path:o.Path+"/ms",type:new sap.ui.model.type.Time({source:{pattern:"timestamp"},UTC:true})};break;case"Edm.Date":b.BindingInfo={path:o.Path,type:new sap.ui.model.type.Date({"UTC":true})};break;case"Edm.Decimal":case"Edm.Double":case"Edm.Single":case"Edm.Int16":case"Edm.Int32":case"Edm.Int64":if((e==="Edm.Decimal")||(e==="Edm.Double")||(e==="Edm.Single")){o1=new sap.ui.model.type.Float();}else if((e==="Edm.Int16")||(e==="Edm.Int32")||(e==="Edm.Int64")){o1=new sap.ui.model.type.Integer();}if(c.propertyAnnotations){p1.push({Type:"Path",Value:o.Path,EdmType:e},{Type:"String",Value:" "});p=q1(a,o.Path,"Org.OData.Measures.V1.ISOCurrency");if(!$.isEmptyObject(p)){p1.push({Type:p.Type,Value:p.Value});}p=q1(a,o.Path,"Org.OData.Measures.V1.Unit");if(!$.isEmptyObject(p)){p1.push({Type:p.Type,Value:p.Value});}b.BindingInfo=z(p1);}else{b.BindingInfo={path:o.Path,type:o1};}break;default:b.BindingInfo={path:o.Path};break;}}}else{if(o.String){b.String=o.String;}}}return b;};I=function(o){var a=[],p,b,j,e,i={},k,l,m;if(o&&o.Apply){p=o.Apply.Parameters;switch(o.Apply.Name){case"odata.fillUriTemplate":p[0].Value=p[0].Value.trim();b=p[0].Value.split("{");for(j=0;j<b.length;j+=1){if(b[j].indexOf("}")<0){a.push({"Value":b[j],"Type":"String"});}else{e=b[j].split("}");i={};i.Value=e[0];i.Type="Path";for(j=1;j<p.length;j+=1){if(p[j].Name===i.Value){k=p[j].Value;if(k.Path){i.Value=k.Path;}else{if(k.Apply&&k.Apply.Name&&k.Apply.Name.toLowerCase()==="odata.uriencode"){i.Value=k.Apply.Parameters[0].Value;}}break;}}a.push(i);a.push({"Value":e[1],"Type":"String"});}}l=sap.ushell.Container.getService("NavTargetResolution").getCurrentResolution();if(l&&l.url){m=jQuery.sap.getUriParameters(l.url).get("sap-system");if(m){a.push({Type:"String",Value:"&sap-system="+m});}}break;default:break;}}return z(a);};J=function(o){var a=sap.ui.core.TextAlign.Begin;if(o.EdmType==="Edm.Decimal"||o.EdmType==="Edm.Double"||o.EdmType==="Edm.Single"||o.EdmType==="Edm.Int16"||o.EdmType==="Edm.Int32"||o.EdmType==="Edm.Int64"){a=sap.ui.core.TextAlign.End;}return a;};S=function(m,e,a,o,b,k){var l,p,j=0,n=0,i1=0,j1=0,k1,i,l1,m1,n1;if(!b){b=m.getServiceMetadata();}if(!a){a=[];}l=s(e,b);n1=new sap.ui.layout.form.SimpleForm({labelMinWidth:150,maxContainerCols:2});p=(c.propertyExtensions)?c.propertyExtensions[l]:[];if(o&&o.High){n=o.High;}if(o&&o.Medium){i1=o.Medium;}if(o&&o.Low){j1=o.Low;}for(i=0;i<a.length;i+=1){k1=b1(a[i]);if(o&&(k1==="High")){if(n){n-=1;}else{continue;}}else if(o&&(k1==="Medium")){if(i1){i1-=1;}else{continue;}}else if(o&&(k1==="Low")){if(j1){j1-=1;}else{continue;}}if(o&&o.Total&&(j>=o.Total)){break;}j+=1;l1=new sap.ui.core.Control().setModel(m);m1=E(a[i],{textAlign:sap.ui.core.TextAlign.End},p,false);m1.addStyleClass("sapFactsheetUtiFormPadding");l1=D(a[i],l,b,k);l1.addStyleClass("sapFactsheetUtiFormPadding");if(l1.setTextAlign){l1.setTextAlign(sap.ui.core.TextAlign.Begin);}n1.addContent(m1);n1.addContent(l1);}n1.addStyleClass("sapFactsheetUtiFormLayout");return n1;};T=function(m,e,o,b,a){var j,k="",l,n,p,i1,j1,k1,l1,m1,n1,o1,p1=[],i,q1,r1,s1;j=m.getServiceMetadata();switch(o.RecordType){case"com.sap.vocabularies.UI.v1.ReferenceFacet":l=new sap.suite.ui.commons.UnifiedThingGroup();if(o.Label&&o.Label.String){l.setTitle(o.Label.String);}n=o.Target.AnnotationPath;p=n.substring(n.lastIndexOf("@")+1);n=n.substring(0,n.lastIndexOf("@")-1);if(n){k=x(e,n,j);}i1=p.split("#");switch(i1[0]){case"com.sap.vocabularies.UI.v1.LineItem":case"com.sap.vocabularies.UI.v1.Chart":case"com.sap.vocabularies.UI.v1.Badge":case"com.sap.vocabularies.UI.v1.Identification":if(n){j1=w(e,n,j);q1=s(j1,j);}else{q1=s(e,j);}if(i1[0]==="com.sap.vocabularies.UI.v1.Chart"){p="com.sap.vocabularies.UI.v1.LineItem";}r1=c[q1][p];if(c.propertyExtensions){s1=c.propertyExtensions[q1];}if(k==="*"&&i1[0]!=="com.sap.vocabularies.UI.v1.Identification"){k1=V(m,r1,q1,j,b+"/"+n,o,s1,a);l.setContent(k1);}if(i1[0]==="com.sap.vocabularies.UI.v1.Identification"){l1=c[q1]["com.sap.vocabularies.UI.v1.Identification"];m1=new sap.ui.layout.VerticalLayout({width:"100%"}).setModel(m);if(n){m1.addContent(S(m,j1,l1,null,null,a)).addStyleClass("sapFactsheetUtiPanel");m1.bindElement(b+"/"+n);}else{m1.addContent(S(m,e,l1,null,null,a).addStyleClass("sapFactsheetUtiPanel"));}l.setContent(m1);}break;case"com.sap.vocabularies.UI.v1.StatusInfo":if(n){j1=w(e,n,j);n1=c[s(j1,j)]["com.sap.vocabularies.UI.v1.StatusInfo"];l.setContent(S(m,j1,n1,null,null,a).addStyleClass("sapFactsheetUtiPanel").bindElement(b+"/"+n));}else{n1=c[s(e,j)]["com.sap.vocabularies.UI.v1.StatusInfo"];l.setContent(S(m,e,n1,null,null,a).addStyleClass("sapFactsheetUtiPanel"));}break;case"com.sap.vocabularies.UI.v1.FieldGroup":o1=c[s(e,j)][p];if(o1){if(!l.getTitle()||(l.getTitle()==="")){if(o1.Label){if(o1.Label.String){l.setTitle(o1.Label.String);}else{if(o1.Label.Path){l.bindProperty("title",o1.Label.Path);}}}}if(n){j1=w(e,n,j);l.setContent(S(m,j1,o1.Data,null,null,a).addStyleClass("sapFactsheetUtiPanel").bindElement(b+"/"+n));}else{l.setContent(S(m,e,o1.Data,null,null,a).addStyleClass("sapFactsheetUtiPanel"));}}break;default:break;}return l;case"com.sap.vocabularies.UI.v1.ReferenceURLFacet":l=new sap.ui.ux3.ThingGroup({title:o.Label.String});l.setContent(K(o));return l;case"com.sap.vocabularies.UI.v1.CollectionFacet":for(i=0;i<o.Facets.length;i+=1){p1.push(T(m,e,o.Facets[i],b,a));}return p1;default:break;}};K=function(o){var i,a,b;switch(o.UrlContentType.String){case"image/png":case"image/jpeg":case"image/gif":i=new sap.m.Image({width:"100%"});if(o.Url.String){i.setSrc(o.Url.String);}return i;default:a=new sap.ui.core.HTML();if(o.Url.String){a.setContent("<iframe src = '"+o.Url.String+"' width='100%' height='250px' frameborder='0'></iframe>");}else{if(o.Url.Path){a.bindProperty("content",{path:o.Url.Path,formatter:function(e){b="<iframe src = '"+o.Url.Path+"' width='100%' height='250px' frameborder='0'></iframe>";return b;}});}}return a;}};V=function(m,a,e,o,b,l,n,i1){var j1,k1,l1,m1,n1,i,k,o1=[],p1=[],q1=[],r1=[],s1,t1,u1,v1,w1,x1,y1,z1=[],A1,B1,C1,D1=[],E1,F1,G1,H1,I1,J1,K1,L1,M1=false,N1,O1;L1=sap.ui.getCore().getLibraryResourceBundle("sap.suite.ui.commons");if(!o){o=m.getServiceMetadata();}j1=(c.propertyExtensions)?c.propertyExtensions[e]:[];k1=6;if(jQuery.device.is.tablet&&jQuery.device.is.landscape){k1=5;}else if(jQuery.device.is.tablet&&jQuery.device.is.portrait){k1=4;}else if(jQuery.device.is.phone&&jQuery.device.is.landscape){k1=3;}else if(jQuery.device.is.phone&&jQuery.device.is.portrait){k1=2;}l1=0;m1=0;for(i=0;i<a.length;i+=1){n1=b1(a[i]);if(n1==="High"){l1+=1;}}if(k1>l1){m1=k1-l1;}else if(k1<l1){l1=k1;}p1.push(new sap.m.Column({visible:false}));o1.push(new sap.m.Text().bindText("__metadata/uri"));for(i=0;i<a.length;i+=1){O1="";u1=new sap.ui.core.Control();n1=b1(a[i]);u1=D(a[i],e,o,i1);s1=E(a[i],null,j1);if(a[i].Value.Path){C1=a[i].Value.Path;if(n&&n[C1]&&n[C1]["http://www.sap.com/Protocols/SAPData"]&&n[C1]["http://www.sap.com/Protocols/SAPData"].sortable){s1.data("IsSortable",n[C1]["http://www.sap.com/Protocols/SAPData"].sortable);if(n[C1]["http://www.sap.com/Protocols/SAPData"].sortable==="true"){M1=true;}}else{s1.data("IsSortable","true");M1=true;}if(n&&n[C1]&&n[C1]["http://www.sap.com/Protocols/SAPData"]&&n[C1]["http://www.sap.com/Protocols/SAPData"].filterable){s1.data("IsFilterable",n[C1]["http://www.sap.com/Protocols/SAPData"].filterable);if(n[C1]["http://www.sap.com/Protocols/SAPData"].filterable==="true"){M1=true;}}else{s1.data("IsFilterable","true");M1=true;}}else{N1=true;for(k=0;k<a[i].Value.Apply.Parameters.length;k+=1){if(a[i].Value.Apply.Parameters[k].Type==="Path"){C1=a[i].Value.Apply.Parameters[k].Value;if(n[C1]&&n[C1]["http://www.sap.com/Protocols/SAPData"]&&n[C1]["http://www.sap.com/Protocols/SAPData"].sortable){if(n[C1]["http://www.sap.com/Protocols/SAPData"].sortable==="false"){N1=false;O1="";break;}}if(O1){O1+=";";}O1+=C1;}}C1=O1;if(N1===false){s1.data("IsSortable","false");}else{s1.data("IsSortable","true");M1=true;}s1.data("IsFilterable","false");}if(a[i].EdmType){s1.data("EdmType",a[i].EdmType);}s1.data("ColumnName",C1);q1.push(s1);r1.push(u1);if(n1==="High"){if(l1>0){t1=true;l1-=1;}else{t1=false;}}else if(n1==="Medium"){if(m1>0){t1=true;m1-=1;}else{t1=false;}}else{t1=false;}p1.push(new sap.m.Column({header:s1,hAlign:J(a[i]),visible:t1}));o1.push(u1);}v1=new sap.m.ColumnListItem({type:sap.m.ListType.Navigation,unread:false,cells:o1});if(l){w1=l.Label.String;}v1.attachPress({aColumns:a,aLabels:q1,aControls:r1,sTitle:w1},function(j,p){var P1,Q1,s1,i,R1,S1,T1;P1=j.getSource().getCells()[0].getText().substr(j.getSource().getCells()[0].getText().lastIndexOf("/"));Q1=new sap.m.Table({backgroundDesign:sap.m.BackgroundDesign.Transparent,showSeparators:sap.m.ListSeparators.None,columns:[new sap.m.Column({hAlign:sap.ui.core.TextAlign.End}),new sap.m.Column()]});Q1.addStyleClass("sapFactsheetUtiPanel");Q1.addStyleClass("sapFactsheetUtiTilePadding");Q1.addStyleClass("sapFactsheetUtiTableNoTopBorder");Q1.bindElement(P1);for(i=0;i<a.length;i+=1){s1=q1[i].clone();s1.setText(s1.getText()+":");T1=r1[i].clone();s1.setLabelFor(T1);Q1.addItem(new sap.m.ColumnListItem({cells:[s1,T1]}));}R1=new sap.suite.ui.commons.UnifiedThingGroup({content:Q1,title:w1,description:a1()});S1=new sap.m.Page({title:t.getTitle(),showNavButton:true,content:[R1]});t.navigateToPage(S1,true);t.attachAfterNavigate(Q1,function(j){if(j.getParameters().getParameters().toId.indexOf("__page")>=0){var U1;U1=Q1.getItems();if(U1.length>0&&A.indexOf(i1)>=0){A[A.indexOf(i1)].bLoaded=true;A[A.indexOf(i1)].bProcessed=false;A[A.indexOf(i1)].bIsTable=true;A[A.indexOf(i1)].oTableItems=U1;d(A.indexOf(i1));}}});});x1=new sap.m.Table({growing:true,columns:p1});x1.setModel(m);x1.bindItems({path:b,template:v1});F1=new sap.m.VBox({items:[new sap.m.Input({placeholder:L1.getText("USHELL_FACTSHEET_ENTER_YOUR_FILTER"),change:function(j){var p,P1,Q1,R1,i;p=j.getSource().getParent().getParent().getId();P1=sap.ui.getCore().byId(p.substr(0,p.indexOf("-")));Q1=P1.getFilterItems();for(i=0;i<Q1.length;i+=1){if(Q1[i]instanceof sap.m.ViewSettingsCustomItem&&Q1[i].getKey()===this.oParent.data("ColumnName")){R1=Q1[i];break;}}if(R1){if((j.getParameter("newValue")===undefined)||(j.getParameter("newValue")==="")){R1.setSelected(false);R1.setFilterCount(0);}else{R1.setSelected(true);R1.setFilterCount(1);}}}}).addStyleClass("sapFactsheetUtiFilterInput")]});G1=new sap.m.VBox({items:[new sap.m.List({mode:sap.m.ListMode.SingleSelectLeft,includeItemInSelection:true,items:[new sap.m.StandardListItem({title:L1.getText("USHELL_FACTSHEET_GREATER_THEN")}).data("FilterOperator",sap.ui.model.FilterOperator.GT),new sap.m.StandardListItem({title:L1.getText("USHELL_FACTSHEET_EQUALS")}).data("FilterOperator",sap.ui.model.FilterOperator.EQ),new sap.m.StandardListItem({title:L1.getText("USHELL_FACTSHEET_LESS_THEN")}).data("FilterOperator",sap.ui.model.FilterOperator.LT)]}),new sap.m.Input({placeholder:L1.getText("USHELL_FACTSHEET_ENTER_YOUR_FILTER"),change:function(j){var p,P1,Q1,R1,i;p=j.getSource().getParent().getParent().getId();P1=sap.ui.getCore().byId(p.substr(0,p.indexOf("-")));Q1=P1.getFilterItems();for(i=0;i<Q1.length;i+=1){if((Q1[i]instanceof sap.m.ViewSettingsCustomItem)&&(Q1[i].getKey()===this.oParent.data("ColumnName"))){R1=Q1[i];break;}}if(R1){if((j.getParameter("newValue")===undefined)||(j.getParameter("newValue")==="")){R1.setSelected(false);R1.setFilterCount(0);}else{R1.setSelected(true);R1.setFilterCount(1);}}}}).addStyleClass("sapFactsheetUtiFilterInput")]});new sap.m.VBox({items:[new sap.m.List({mode:sap.m.ListMode.SingleSelectLeft,includeItemInSelection:true,items:[new sap.m.StandardListItem({title:L1.getText("USHELL_FACTSHEET_AFTER")}).data("FilterOperator",sap.ui.model.FilterOperator.GT),new sap.m.StandardListItem({title:L1.getText("USHELL_FACTSHEET_AT")}).data("FilterOperator",sap.ui.model.FilterOperator.EQ),new sap.m.StandardListItem({title:L1.getText("USHELL_FACTSHEET_BEFORE")}).data("FilterOperator",sap.ui.model.FilterOperator.LT)]}),new sap.m.DateTimeInput({type:sap.m.DateTimeInputType.Date,valueFormat:new sap.ui.model.type.DateTime({pattern:"yyyy/MM/dd HH:mm:ss UTC+00:00"}).getOutputPattern(),placeholder:L1.getText("USHELL_FACTSHEET_ENTER_YOUR_FILTER"),change:function(j){var p,P1,Q1,R1,i;p=j.getSource().getParent().getParent().getId();P1=sap.ui.getCore().byId(p.substr(0,p.indexOf("-")));Q1=P1.getFilterItems();for(i=0;i<Q1.length;i+=1){if((Q1[i]instanceof sap.m.ViewSettingsCustomItem)&&(Q1[i].getKey()===this.oParent.data("ColumnName"))){R1=Q1[i];break;}}if((j.getParameter("newValue")===undefined)||(j.getParameter("newValue")==="")){R1.setSelected(false);R1.setFilterCount(0);}else{R1.setSelected(true);R1.setFilterCount(1);}}}).addStyleClass("sapFactsheetUtiFilterInput")]});H1=function(u1){var j=[],i,p,P1=u1.getItems(),Q1;if(P1[0].getParent().data("EdmType")==="Edm.String"&&P1[0].getValue()){j.push(new sap.ui.model.Filter(P1[0].getParent().data("ColumnName"),sap.ui.model.FilterOperator.Contains,P1[0].getValue()));}else if(P1[0].getParent().data("EdmType")==="Edm.Decimal"&&P1[1].getValue()){for(i=0;i<P1[0].getItems().length;i+=1){if(P1[0].getItems()[i].getSelected()===true){p=P1[0].getItems()[i].data("FilterOperator");break;}}Q1=P1[1].getValue();for(i=Q1.length-1;i>0;i-=1){if(Q1[i]===","){Q1=Q1.replace(Q1[i],".");break;}}j.push(new sap.ui.model.Filter(P1[1].getParent().data("ColumnName"),p,Q1));}else if(P1[0].getParent().data("EdmType")==="Edm.Date"&&P1[1].getValue()){for(i=0;i<P1[0].getItems().length;i+=1){if(P1[0].getItems()[i].getSelected()===true){p=P1[0].getItems()[i].data("FilterOperator");break;}}j.push(new sap.ui.model.Filter(P1[1].getParent().data("ColumnName"),p,P1[1].getValue()));}else{j.push(new sap.ui.model.Filter(P1[0].getParent().data("ColumnName"),sap.ui.model.FilterOperator.EQ,P1[0].getValue()));}return j;};I1=function(p){var P1=p.getSource(),Q1=P1.getFilterItems(),R1,i,j;for(i=0;i<Q1.length;i+=1){if(Q1[i]&&Q1[i]instanceof sap.m.ViewSettingsCustomItem){Q1[i].setSelected(false);Q1[i].setFilterCount(0);R1=Q1[i].getCustomControl().getItems();for(j=0;j<R1.length;j+=1){if((R1[j]instanceof sap.m.Input)||(R1[j]instanceof sap.m.DateTimeInput)){R1[j].setValue("");}if((R1[j]instanceof sap.m.List)&&(R1[j].getSelectedItem()!==null)){R1[j].removeSelections();}}}}};J1=I1;for(i=0;i<p1.length;i+=1){if(p1[i+1]){s1=q1[i].clone();if(s1.getText()&&(s1.data("IsSortable")==="true")&&p1[i+1].getVisible()){A1=new sap.m.ViewSettingsItem({text:s1.getText(),key:s1.data("ColumnName")});if(i===0){A1.setSelected(true);}A1.Sort=s1.Sort;z1.push(A1);}if(s1.getText()&&(s1.data("IsFilterable")==="true")){if(s1.data("EdmType")==="Edm.String"){K1=F1.clone().data("ColumnName",s1.data("ColumnName")).data("EdmType",s1.data("EdmType"));}else if(s1.data("EdmType")==="Edm.Decimal"){K1=G1.clone().data("ColumnName",s1.data("ColumnName")).data("EdmType",s1.data("EdmType"));}if((s1.data("EdmType")==="Edm.String")||(s1.data("EdmType")==="Edm.Decimal")){E1=new sap.m.ViewSettingsCustomItem({key:s1.data("ColumnName"),text:s1.getText(),customControl:K1,customData:new sap.ui.core.CustomData({key:"callback",value:H1})});D1.push(E1);}}}}B1=new sap.m.ViewSettingsDialog({sortItems:z1,filterItems:D1,cancel:J1,resetFilters:I1,confirm:function(j){var P1,Q1,R1=[],S1,T1=[],U1,V1=[],W1=[],p,i,X1;P1=j.getParameters();Q1=x1.getBinding("items");if(P1.sortItem){S1=P1.sortItem.getKey();U1=P1.sortDescending;if(S1.indexOf(";")>0){T1=S1.split(";");for(i=0;i<T1.length;i+=1){R1.push(new sap.ui.model.Sorter(T1[i],U1));}}else if(S1){R1.push(new sap.ui.model.Sorter(S1,U1));}Q1.sort(R1);}p=P1;for(i=0;i<p.filterItems.length;i+=1){if(p.filterItems[i]instanceof sap.m.ViewSettingsCustomItem){X1=p.filterItems[i].getCustomData()[0].getValue();V1=X1.apply(this,[p.filterItems[i].getCustomControl()]);if(V1){if(!Array.isArray(V1)){V1=[V1];}W1=W1.concat(V1);}}else if(p.filterItems[i]instanceof sap.m.ViewSettingsItem){V1=p.filterItems[i].getCustomData()[0].getValue();if(V1){if(!Array.isArray(V1)){V1=[V1];}W1=W1.concat(V1);}}}Q1.filter(W1);}});if(M1===true&&(z1.length>0||D1.length>0)){x1.setHeaderToolbar(new sap.m.Toolbar({content:[new sap.m.Label(),new sap.m.ToolbarSpacer(),new sap.m.Button({icon:"sap-icon://drop-down-list",press:function(j){B1.open();},tooltip:sap.ui.getCore().getLibraryResourceBundle("sap.m").getText("P13NDIALOG_VIEW_SETTINGS")})]}));}x1.setNoDataText(sap.ui.getCore().getLibraryResourceBundle("sap.m").getText("PULL2REFRESH_LOADING_LONG"));y1=(function(i1){return function(j){var p=this.getItems();if(p.length===0){this.setNoDataText(L1.getText("FACETOVERVIEW_NO_CONTENT_TEXT"));}else{this.setNoDataText(sap.ui.getCore().getLibraryResourceBundle("sap.m").getText("PULL2REFRESH_LOADING_LONG"));}if(p.length>0&&A.indexOf(i1)>=0){A[A.indexOf(i1)].bLoaded=true;A[A.indexOf(i1)].bProcessed=false;A[A.indexOf(i1)].bIsTable=true;A[A.indexOf(i1)].oTableItems=p;}d(A.indexOf(i1));};}(i1));x1.attachUpdateFinished(y1);return x1;};X=function(a,o,b,e){var i;switch(a){case"com.sap.vocabularies.UI.v1.ChartType/Area":i=new sap.viz.ui5.Area({});break;case"com.sap.vocabularies.UI.v1.ChartType/Bar":i=new sap.viz.ui5.Bar({});break;case"com.sap.vocabularies.UI.v1.ChartType/Bubble":i=new sap.viz.ui5.Bubble({});break;case"com.sap.vocabularies.UI.v1.ChartType/Column":i=new sap.viz.ui5.Column({});break;case"com.sap.vocabularies.UI.v1.ChartType/ColumnStacked":i=new sap.viz.ui5.StackedColumn({});break;case"com.sap.vocabularies.UI.v1.ChartType/ColumnStacked100":i=new sap.viz.ui5.StackedColumn100({});break;case"com.sap.vocabularies.UI.v1.ChartType/Donut":i=new sap.viz.ui5.Donut({});break;case"com.sap.vocabularies.UI.v1.ChartType/HeatMap":i=new sap.viz.ui5.Heatmap({});break;case"com.sap.vocabularies.UI.v1.ChartType/HorizontalArea":i=new sap.viz.ui5.HorizontalArea({});break;case"com.sap.vocabularies.UI.v1.ChartType/Line":i=new sap.viz.ui5.Line({});break;case"com.sap.vocabularies.UI.v1.ChartType/Pie":i=new sap.viz.ui5.Pie({});break;case"com.sap.vocabularies.UI.v1.ChartType/Scatter":i=new sap.viz.ui5.Scatter({});break;case"com.sap.vocabularies.UI.v1.ChartType/TreeMap":i=new sap.viz.ui5.Treemap({});break;case"com.sap.vocabularies.UI.v1.ChartType/AreaStacked":case"com.sap.vocabularies.UI.v1.ChartType/AreaStacked100":case"com.sap.vocabularies.UI.v1.ChartType/BarStacked":case"com.sap.vocabularies.UI.v1.ChartType/BarStacked100":case"com.sap.vocabularies.UI.v1.ChartType/HorizontalAreaStacked":case"com.sap.vocabularies.UI.v1.ChartType/HorizontalAreaStacked100":case"com.sap.vocabularies.UI.v1.ChartType/Radar":case"com.sap.vocabularies.UI.v1.ChartType/Waterfall":break;}if(i){if(o&&o.String){i.setTitle(new sap.viz.ui5.types.Title({visible:true,text:o.String}));}if(b&&b.String){i.setTooltip(b.String);}i.setWidth("100%");i.setHeight("17rem");i.setDataset(e);}else{i=new sap.m.Text({});}return i;};Y=function(i){var a;i=i||1;if(jQuery.device.is.phone){a=(7*i)+"rem";}else{a=(11*i-1)+"rem";}return a;};Z=function(a){var i,b=0,e=0,j=0,o;for(i=0;i<a.length;i+=1){o=b1(a[i]);if(o){switch(o){case"High":b+=1;break;case"Medium":e+=1;break;case"Low":j+=1;break;}}}return{High:b,Medium:e,Low:j};};b1=function(o){var e="";if(o.Importance){e=o.Importance.EnumMember;}else if(o["com.sap.vocabularies.UI.v1.Importance"]){e=o["com.sap.vocabularies.UI.v1.Importance"].EnumMember;}return e.substr(e.indexOf("/")+1);};_=function(m,a,e,b){var i=false,o,j,k,l;o=new sap.suite.ui.commons.KpiTile({doubleFontSize:false});if(a.ValueFormat){j=a.ValueFormat.NumberOfFractionalDigits.Int;}if(a.Title&&a.Title.String){o.setDescription(a.Title.String);}else{if(a.Title&&a.Title.Path){o.bindProperty("description",{path:a.Title.Path});}}if(a.Value&&a.Value.String){o.setValue(a.Value.String);}else{if(a.Value&&a.Value.Path){k=R(a.Value,a.Value.EdmType,e);if(k.fnChange){o.setModel(m);o.bindElement(b);o.getElementBinding().attachChange(k.fnChange,o);}if(k.String){if($.isNumeric(k.String)){i=true;o.setValue(g1(k.String,j));}else{o.setValue(k.String);}}else if(k.BindingInfo){l=k.BindingInfo;if(l.parts&&l.parts.length===2){o.bindProperty("valueUnit",l.parts[0]);l.parts[1].type=undefined;l.parts[1].formatter=(function(){return function(n){return g1(n,j);};}(j));o.bindProperty("value",l.parts[1]);}else if(l.parts&&l.parts.length===1){l.parts[0].type=undefined;l.parts[0].formatter=(function(){return function(n){return g1(n,j);};}(j));o.bindProperty("value",l);}else{o.bindProperty("value",l);}}}}if(a.Value.EdmType==="Edm.Decimal"||a.Value.EdmType==="Edm.Double"||a.Value.EdmType==="Edm.Single"||a.Value.EdmType==="Edm.Int16"||a.Value.EdmType==="Edm.Int32"||a.Value.EdmType==="Edm.Int64"||i===true){o.setDoubleFontSize(true);}return o;};g=function(m){var a=[],b=[],e,j,k,i,l;j=function(o){if(k(o)===false){if(o.constructor===Array){for(i=0;i<o.length;i+=1){k(o[i]);}}if(o.constructor===O){for(l in o){if(o.hasOwnProperty(l)){if(o[l].constructor!==String){j(o[l]);}}}}}};k=function(o){if(o.RecordType&&o.RecordType==="com.sap.vocabularies.UI.v1.DataFieldWithUrl"){if(o.Url&&o.Url.Apply){e=o.Url.Apply.Parameters[0].Value.slice(o.Url.Apply.Parameters[0].Value.indexOf("#")+1,o.Url.Apply.Parameters[0].Value.indexOf("-"));if(a.indexOf(e)<0){a.push(e);}return true;}}else{return false;}};for(l in c){if(c.hasOwnProperty(l)){if(l.indexOf(m.dataServices.schema[0].namespace)>=0){j(c[l]);}}}for(i=0;i<a.length;i+=1){if(!L.hasOwnProperty(a[i])){b.push(a[i]);}}return b;};f=function(a){var i,o,l,b;if(a.length>0){o=new sap.ui.model.json.JSONModel();l="/sap/opu/odata/UI2/INTEROP/SemanticObjects?$expand=Links&$format=json";b="&$filter=id%20eq%20%27";for(i=0;i<a.length;i+=1){if(b.length>22){b+="%20or%20id%20eq%20%27"+a[i]+"%27";}else{b+=a[i]+"%27";}}l+=l+b;o.loadData(l);o.attachRequestCompleted(function(){var i,j,e,k=[];if(this.getData().d&&this.getData().d.results){e=this.getData().d.results;for(i=0;i<e.length;i+=1){L[e[i].id]="";k=e[i].Links.results;for(j=0;j<k.length;j+=1){L[k[j].id.slice(0,k[j].id.indexOf("~"))]="";}}}L.InteropCompleted=true;d();});}else{L.InteropCompleted=true;}};d=function(a){var i,j,k,n,b,e,l;if(L.InteropCompleted===true){for(i=0;i<A.length;i+=1){if(A[i].bLoaded&&!A[i].bProcessed&&A[i].Links){l=A[i].Links;for(j=0;j<l.length;j+=1){if(L.hasOwnProperty(l[j].sIntend)===true){if(A[i].bIsTable===true){if(A[i].oTableItems){b=A[i].oTableItems;for(k=0;k<b.length;k+=1){e=b[k].getCells();for(n=0;n<e.length;n+=1){if(e[n]instanceof sap.ui.layout.VerticalLayout&&e[n].getContent()[0].getBindingInfo("href").parts===l[j].oVL.getContent()[0].getBindingInfo("href").parts&&e[n].getContent()[1].getBindingInfo("text").parts===l[j].oVL.getContent()[1].getBindingInfo("text").parts){e[n].getContent()[0].setVisible(true);e[n].getContent()[1].setVisible(false);}}}}}else{l[j].oVL.getContent()[0].setVisible(true);l[j].oVL.getContent()[1].setVisible(false);}}else if(A[i].bIsTable===false){l[j].oVL.getContent()[1].setText(l[j].oVL.getContent()[0].getText());}A[i].bProcessed=true;}}}}if(a>=0){if(A[a].bLoaded&&!A[a].bProcessed&&A[a].Links){l=A[a].Links;for(j=0;j<l.length;j+=1){if(A[a].bIsTable===false){l[j].oVL.getContent()[1].setText(l[j].oVL.getContent()[0].getText());}}}}};P=function(e,l,t){var m,n,p,i1,j1,k1,l1,m1,i,n1={},o1,p1,q1,r1,j,s1,t1,u1,v1,w1,x1,y1,z1,A1,B1=0,C1=0,D1,E1,F1,G1,H1,I1,J1,K1=[],L1,M1,N1,O1,P1,Q1,R1,S1,T1,U1,V1,W1,X1,Y1,Z1,$1,_1,a2=0,b2,c2,d2,e2,f2,g2,h2;m=h(e);x1=l.substring(0,l.substring(0,l.lastIndexOf("/")).lastIndexOf("/"));y1=l.substring(l.substring(0,l.lastIndexOf("/")).lastIndexOf("/"));if(window.location.search.indexOf("cbn_keep_anno_case%3Dtrue")===-1){y1=y1.toLowerCase();}n=new sap.ui.model.odata.ODataModel(m,{annotationURI:x1+y1,loadAnnotationsJoined:true,loadMetadataAsync:false,json:true});n.setCountSupported(false);t.setModel(n);p=q(e,n);i1="/"+e.slice(m.length);j1=n.getServiceMetadata();c=n.getServiceAnnotations();k1=s(p,j1);l1=c[k1]["com.sap.vocabularies.UI.v1.HeaderInfo"];m1=c[k1]["com.sap.vocabularies.UI.v1.Facets"];t.bindElement(i1,y(p,j1));z1=sap.ui.getCore().getLibraryResourceBundle("sap.suite.ui.commons");L.InteropCompleted=false;f(g(j1));t.addStyleClass("sapFactsheetUtiThingType"+p.replace(/\s/g,""));if(l1.TypeName.String){t.setTitle(l1.TypeName.String);}else{if(l1.TypeName.Path){t.bindProperty("title",{path:l1.TypeName.Path});}}if(l1.ImageUrl&&l1.ImageUrl.String){t.setIcon(l1.ImageUrl.String);}else if(l1.ImageUrl&&l1.ImageUrl.Path){t.bindProperty("icon",{path:l1.ImageUrl.Path});}else if(l1.TypeImageUrl&&l1.TypeImageUrl.String){t.setIcon(l1.TypeImageUrl.String);}else if(l1.TypeImageUrl&&l1.TypeImageUrl.Path){t.bindProperty("icon",{path:l1.TypeImageUrl.Path});}if(l1.Title.Value.String){t.setName(l1.Title.Value.String);}else{t.bindProperty("name",R(l1.Title.Value,l1.Title.EdmType,k1).BindingInfo);}if(l1.Description&&l1.Description.Value){if(l1.Description.Value.String){t.setDescription(l1.Description.Value.String);}else{t.bindProperty("description",R(l1.Description.Value,l1.Description.EdmType,k1).BindingInfo);}}for(b2 in c[k1]){if(c[k1].hasOwnProperty(b2)){if(b2.search("com.sap.vocabularies.UI.v1.DataPoint")!==-1){c2=c[k1][b2];if(c2){t.addKpi(_(n,c2,k1,i1));a2+=1;}}if(a2>=3){break;}}}for(i=0;i<m1.length;i+=1){if(m1[i]["com.sap.vocabularies.UI.v1.IsSummary"]){t1=m1[i];break;}}if(t1){A1=15;for(j=0;j<t1.Facets.length;j+=1){D1=t1.Facets[j].Target.AnnotationPath.substring(t1.Facets[j].Target.AnnotationPath.lastIndexOf("@")+1);o1=t1.Facets[j].Target.AnnotationPath;o1=o1.substring(0,o1.lastIndexOf("@")-1);t1.Facets[j].NavPath=o1;E1=w(p,o1,j1);t1.Facets[j].NavEntitySet=E1;if(E1){F1=E1;}else{F1=p;}t1.Facets[j].EntitySet=F1;G1=s(E1,j1);if(G1){H1=G1;}else{H1=k1;}t1.Facets[j].EntityType=H1;I1=[];if(c[H1][D1].length){I1=c[H1][D1];}else if(c[H1][D1].Data.length){I1=c[H1][D1].Data;}t1.Facets[j].Content=I1;for(i=0;i<I1.length;i+=1){J1=b1(I1[i]);if(J1==="High"){B1+=1;}else if(J1==="Medium"){C1+=1;}}}if(B1>=A1){B1=A1;C1=0;}else if((B1+C1)>A1){C1=A1-B1;if(C1<0){C1=0;}}if(jQuery.device.is.phone){C1=0;}N1=A1-B1-C1;V1=new sap.suite.ui.commons.FacetOverview({title:z1.getText("UNIFIEDTHINGINSPECTOR_GENERAL_INFORMATION_HEADER_TEXT")});A=[];A.push(V1);A[0].bLoaded=false;A[0].bProcessed=false;A[0].bIsTable=false;O1=[];Q1=C1+B1;for(j=0;j<t1.Facets.length;j+=1){R1=S(n,t1.Facets[j].EntitySet,t1.Facets[j].Content,{High:B1,Medium:C1,Low:0},null,V1).addStyleClass("sapFactsheetUtiTilePadding");if(j>0){R1.addStyleClass("sapFactsheetUtiPaddingTop");}if(t1.Facets[j].NavPath){R1.bindElement(i1+"/"+t1.Facets[j].NavPath);}P1=Z(t1.Facets[j].Content);B1-=P1.High;C1-=P1.Medium;if(((P1.High>0)&&((B1+P1.High)>0))||((P1.Medium>0)&&((C1+P1.Medium)>0))){O1.push(R1);if(j>0){if(N1>0){N1-=1;}else if(C1>0){C1-=1;}else if(B1>0){B1-=1;}}}if((B1<1)&&(C1<1)){break;}}if(B1<0){B1=0;}if(C1<0){C1=0;}n1=new sap.ui.layout.VerticalLayout({content:O1,width:"100%"});S1=Y();U1=1;if((Q1>3)&&(Q1<=9)){S1=Y(2);U1=2;}else if(Q1>9){S1=Y(3);U1=3;}V1.setContent(n1);V1.setRowSpan(U1);if(jQuery.device.is.phone){V1.setHeightType(sap.suite.ui.commons.FacetOverviewHeight.Auto);}else{V1.setHeight(S1);}V1.addStyleClass("sapFactsheetUtiGeneralInformationOverviewFacet");V1.attachPress({facets:t1},function(o,a){var b,k,i2,j2,n1;t.removeAllFacetContent();i2=new sap.suite.ui.commons.UnifiedThingGroup();i2.setDescription(a1());i2.setTitle(z1.getText("UNIFIEDTHINGINSPECTOR_GENERAL_INFORMATION_HEADER_TEXT"));i2.addStyleClass("sapFactsheetUtiGeneralInformationUtg");if(a.facets.Facets.length>1){b="L6 M12 S12";}else{b="L12 M12 S12";}A[0].Links=[];j2=new sap.ui.layout.VerticalLayout({width:"100%"});for(i=0;i<a.facets.Facets.length;i+=1){if(i%2===0){k=new sap.ui.layout.Grid({hSpacing:1,vSpacing:1,defaultSpan:b});}n1=T(n,p,a.facets.Facets[i],i1,this);n1.addStyleClass("sapFactsheetUtiGeneralInformationUtgContent");if((i===0)&&(a.facets.Facets.length>1)&&(n1.getTitle().trim()==="")){n1.setTitle(z1.getText("UNIFIEDTHINGINSPECTOR_GENERAL_INFORMATION_HEADER_TEXT"));}k.addContent(n1);if(i%2!==0){j2.addContent(k);}}A[0].bLoaded=true;A[0].bProcessed=false;A[0].bIsTable=false;d(0);if(i%2!==0){j2.addContent(k);}i2.setContent(j2);t.addFacetContent(i2);t.navigateToDetail();});t.addFacet(V1);}q1=function(r1){return function(a){var o,b,k,i2,j2,k2,l2,m2,n2,o2,i1,p2,q2,r2,s2,t2,u2,v2,w2,i;if((r1.cardinality==="*"&&a.results&&a.results.length&&a.results.length!==0)||(r1.cardinality==="1"&&a)){o2=new sap.ui.model.json.JSONModel();if(r1.cardinality==="*"){if(a.results&&a.results.length){o2.setData(a);}}else{o2.setData({result:a});i1="/result";}o=new sap.ui.model.odata.ODataModel("/sap/opu/odata/sap/VBI_APPL_DEF_SRV",false);b=c[r1.navigationType]["com.sap.vocabularies.UI.v1.GeoLocation"];q2=c[r1.navigationType]["com.sap.vocabularies.UI.v1.HeaderInfo"];r2=c[r1.navigationType]["com.sap.vocabularies.UI.v1.Identification"];if(b.Longitude&&b.Latitude){i2={"Data":{"Set":{"N":[{"name":"Spots","E":[]}]}}};if(r1.cardinality==="1"){if(b.Longitude.Path&&b.Latitude.Path){k=a[b.Longitude.Path]+";"+a[b.Latitude.Path]+";0";}i2.Data.Set.N[0].E.push({"A":k,"I":"pin_blue.png"});}else{for(i=0;i<a.results.length;i+=1){if(b.Longitude.Path&&b.Latitude.Path){k=a.results[i][b.Longitude.Path]+";"+a.results[i][b.Latitude.Path]+";0";}i2.Data.Set.N[0].E.push({"A":k,"I":"pin_blue.png"});}if(a.results.length!==0){k=a.results[0][b.Longitude.Path]+";"+a.results[0][b.Latitude.Path]+";0";}}}w2=parseInt(a.__count,10);if(Number(w2)){r1.facet.setQuantity(w2);}l2=function(x2){var y2,z2,A2,B2,C2;y2=$.parseJSON(x2.getParameters().data);if(y2.Action.name==="DETAIL_REQUEST"&&y2.Action.instance){z2=y2.Action.instance;if(o2.oData.results){i1="/results/"+z2.split(".")[1];}v2=q2.TypeName.String.substring(0,17);B2=parseFloat(Y(0.7))*16;C2=parseFloat(Y(1.5))*16;A2={"SAPVB":{"version":"2.0","xmlns:VB":"VB","Windows":{"Remove":{"name":"Detail1"},"Set":{"name":"Detail1","Window":{"id":"Detail1","type":"callout","refParent":"Main","refScene":"","offsetX":"16","offsetY":"-27","modal":"false","width":C2,"height":B2,"caption":v2,"pos.bind":z2+".GeoPosition"}}},"Scenes":{"Set":{"name":"Details","Scene":{"id":"Details","navControlVisible":"false"}}}}};this.load(A2);}};m2=function(x2){var b2,y2,E1,z2;if(!s2){s2=D(q2.Title,r1.navigationType,j1,r1.facet);s2.setModel(o2);s2.bindElement(i1);t2=D(q2.Description,r1.navigationType,j1,r1.facet);t2.setModel(o2);t2.bindElement(i1);for(b2 in b.Address){if(b2==="label"){p2=D({Value:b.Address[b2]},r1.navigationType,j1,r1.facet);p2.setModel(o2);p2.bindElement(i1);break;}}z2=7;if(jQuery.device.is.tablet&&jQuery.device.is.landscape){z2=4;}else if(jQuery.device.is.tablet&&jQuery.device.is.portrait){z2=5;}else if(jQuery.device.is.phone&&jQuery.device.is.landscape){z2=2;}else if(jQuery.device.is.phone&&jQuery.device.is.portrait){z2=3;}u2=new sap.ui.layout.VerticalLayout({width:"100%"}).setModel(n);if(r1.navigationPath){E1=w(r1.entitySet,r1.navigationPath,j1);u2.addContent(S(n,E1,r2,{High:z2},null,r1.facet));u2.setModel(o2).bindElement(i1);}else{u2.addContent(S(n,r1.entitySet,r2,{High:z2},null,r1.facet)).setModel(o2).bindElement(i1);}}else{s2.bindElement(i1);if(t2){t2.bindElement(i1);}if(p2){p2.bindElement(i1);}if(u2){u2.bindElement(i1);}}y2=parseFloat(Y(1.5))*16*0.95+"px";if(s2){s2.placeAt(x2.getParameter("contentarea").id);s2.addStyleClass("sapFactsheetUtiGeoPopupHead");if(jQuery.device.is.phone){s2.addStyleClass("sapFactsheetUtiGeoPopupHeadFontPhone");}s2.setWidth(y2);}if(t2){t2.placeAt(x2.getParameter("contentarea").id);t2.addStyleClass("sapFactsheetUtiGeoPopupDescr");if(jQuery.device.is.phone){t2.addStyleClass("sapFactsheetUtiGeoPopupDescrFontPhone");}t2.setWidth(y2);}if(p2){p2.placeAt(x2.getParameter("contentarea").id);p2.addStyleClass("sapFactsheetUtiGeoPopupText");p2.setWidth(y2);}if(u2&&u2.getContent()[0]&&u2.getContent()[0].getContent&&u2.getContent()[0].getContent().length>0){u2.placeAt(x2.getParameter("contentarea").id);u2.addStyleClass("sapFactsheetUtiGeoPopupText");u2.setWidth(y2);}if(A.indexOf(r1.facet)>=0){A[A.indexOf(r1.facet)].bLoaded=true;A[A.indexOf(r1.facet)].bProcessed=false;A[A.indexOf(r1.facet)].bIsTable=false;}d(A.indexOf(r1.facet));};n2=function(x2){if(s2){s2.destroy();s2=undefined;}if(t2){t2.destroy();t2=undefined;}if(p2){p2.destroy();p2=undefined;}if(u2){u2.destroy();u2=undefined;}$(x2.getParameter("contentarea").id).empty();};j2=function(r1){return function(a){var x2,y2,z2,A2,i;A2=a.ProjectJSON;A2=A2.indexOf("{")?A2.substr(A2.indexOf("{")):A2;x2=$.parseJSON(A2);x2.SAPVB.Scenes.Set.SceneGeo.initialStartPosition=k;x2.SAPVB.Scenes.Set.SceneGeo.initialZoom=12;x2.SAPVB.Actions.Set.Action.push({id:"200",name:"TAP_ON_MAP",refEvent:"Click",refScene:"MainScene",refVO:"Map"});if(i2){x2.SAPVB.Data=i2.Data;}for(i=0;i<x2.SAPVB.Scenes.Set.SceneGeo.VO.length;i+=1){if(x2.SAPVB.Scenes.Set.SceneGeo.VO[i].datasource==="Spots"){if(x2.SAPVB.Scenes.Set.SceneGeo.VO[i].scale&&x2.SAPVB.Scenes.Set.SceneGeo.VO[i].scale.split(";").length!==3){x2.SAPVB.Scenes.Set.SceneGeo.VO[i].scale="1.0;1.0;1.0";break;}}}r1.facet.getContent().attachSubmit(function(B2){if(jQuery.device.is.tablet||jQuery.device.is.phone){r1.facet.firePress();}});r1.facet.getContent().load(x2);r1.facet.attachPress("",function(B2,C2){var D2=[],E2=[],i,F2;if(!y2){y2=new sap.ui.vbm.VBI({width:"100%",height:"100%",plugin:false,config:null});y2.addStyleClass("sapFactsheetUtiGeoPopup");}x2.SAPVB.Scenes.Set.SceneGeo.NavigationDisablement.move="false";x2.SAPVB.Scenes.Set.SceneGeo.NavigationDisablement.zoom="false";x2.SAPVB.Scenes.Set.SceneGeo.NavigationDisablement.pitch="false";x2.SAPVB.Scenes.Set.SceneGeo.NavigationDisablement.yaw="false";x2.SAPVB.Scenes.Set.SceneGeo.SuppressedNavControlVisibility="false";y2.load(x2);if(r1.cardinality==="*"){for(i=0;i<o2.oData.results.length;i+=1){D2.push(o2.oData.results[i][b.Longitude.Path]);E2.push(o2.oData.results[i][b.Latitude.Path]);}}y2.attachSubmit(l2);y2.attachOpenWindow(m2);y2.attachCloseWindow(n2);z2=new sap.suite.ui.commons.UnifiedThingGroup({content:y2,title:r1.facetContent.Label.String,description:a1()});t.removeAllFacetContent();t.addFacetContent(z2);t.navigateToDetail();t.attachAfterNavigate(D2,function(B2){if(B2.getParameters().getParameters().toId.indexOf("-detail-page")!==-1){if(jQuery.device.is.phone){F2="300px";}else{F2=Math.floor($("#"+B2.getParameters().getParameters().toId+"-cont").height()-128)+"px";}y2.setHeight(F2);if(D2.length>1){y2.zoomToGeoPosition(D2,E2);}}});});};};k2=function(x2){return function(y2){t.removeFacet(x2);};};o.read("VBIApplicationSet('ZFACTSHEETS')","","",false,j2(r1),k2(r1.facet));}else{r1.facet.setQuantity(undefined);r1.facet.addStyleClass("sapFactsheetUtiEmptyTile");r1.facet.setHeightType(jQuery.device.is.phone?sap.suite.ui.commons.FacetOverviewHeight.Auto:sap.suite.ui.commons.FacetOverviewHeight.S);r1.facet.setContent(undefined);r1.facet.setTitle(undefined);}};};p1=function(r1){return function(a){var o,b,k,i2,j2,k2,i,j,n1,l2,m2,n2,o2,p2,q2,r2,s2,t2,u2,v2,w2,x2,y2,z2,A2,B2="",C2,D2,E2,F2,G2,H2;o=new sap.ui.model.json.JSONModel();if(r1.facetContent.Target&&r1.facetContent.Target.AnnotationPath&&r1.facetContent.Target.AnnotationPath.split("#")[1]&&c[r1.navigationType]["com.sap.vocabularies.UI.v1.Badge#"+r1.facetContent.Target.AnnotationPath.split("#")[1]]){b=c[r1.navigationType]["com.sap.vocabularies.UI.v1.Badge#"+r1.facetContent.Target.AnnotationPath.split("#")[1]];}else{b=c[r1.navigationType]["com.sap.vocabularies.UI.v1.Badge"];}if(r1.cardinality==="*"){if(a.results&&a.results.length){C2=r1.facetContent.Target.AnnotationPath;d2=C2.substring(C2.lastIndexOf("@")+1);if(d2==="com.sap.vocabularies.UI.v1.Chart"){D2=c[r1.navigationType]["com.sap.vocabularies.UI.v1.Chart"];E2=c.propertyExtensions[r1.navigationType];F2=[];for(i=0;i<D2.Dimensions.length;i+=1){F2.push({axis:1,name:E2[D2.Dimensions[i].PropertyPath]["http://www.sap.com/Protocols/SAPData"].label,value:"{"+D2.Dimensions[i].PropertyPath+"}"});}G2=[];for(i=0;i<D2.Measures.length;i+=1){G2.push({name:E2[D2.Measures[i].PropertyPath]["http://www.sap.com/Protocols/SAPData"].label,value:"{"+D2.Measures[i].PropertyPath+"}"});}H2=new F({dimensions:F2,measures:G2,data:{path:"/results"}});n1=X(D2.ChartType.EnumMember,D2.Title,D2.Description,H2);n1.setModel(o);r1.facet.setHeightType(jQuery.device.is.phone?sap.suite.ui.commons.FacetOverviewHeight.Auto:sap.suite.ui.commons.FacetOverviewHeight.XL);}else{n1=new sap.ui.layout.VerticalLayout({width:"100%"}).addStyleClass("sapFactsheetUtiVLayoutPadding");for(i=0;i<a.results.length;i+=1){j2=new sap.ui.layout.HorizontalLayout().addStyleClass("sapFactsheetUtiHLayoutPadding");k=D(b.Title,r1.navigationType,j1,r1.facet);if(k.setWrapping){k.setWrapping(false);}sap.ui.getCore().byId(t.getId()+"-master-page").addDelegate({onAfterShow:(function(j2){return function(){var I2,J2;I2=j2.getParent().getDomRef().clientWidth;J2=I2;if(j2.getContent()[0]){J2-=j2.getContent()[0].getDomRef().clientWidth;if(I2<j2.getContent()[0].getDomRef().clientWidth){j2.getContent()[0].getDomRef().setAttribute("style","width:"+I2+"px");return;}}if(j2.getContent()[1]){J2-=j2.getContent()[1].getDomRef().clientWidth;}if(J2<10){J2=0;}if(j2.getContent()[2]){j2.getContent()[2].getDomRef().setAttribute("style","width:"+J2+"px");}};}(j2))});o=new sap.ui.model.json.JSONModel();o.setData({result:a.results[i]});k.setModel(o);k.bindElement("/result");k2=false;if(a.results[i][b.Title.Value.Path]){k2=true;}if(b.Title.Value.Apply){for(j=0;j<b.Title.Value.Apply.Parameters.length;j+=1){if(b.Title.Value.Apply.Parameters[j].Type==="Path"){if(a.results[i][b.Title.Value.Apply.Parameters[j].Value]){k2=true;break;}}}}B2="";if(k2){j2.addContent(k);if(b.MainInfo&&((b.MainInfo.EdmType&&b.MainInfo.EdmType==="Edm.Decimal")||(b.MainInfo.Value&&b.MainInfo.Value.Apply&&b.MainInfo.Value.Apply.Parameters[0]&&b.MainInfo.Value.Apply.Parameters[0].EdmType&&b.MainInfo.Value.Apply.Parameters[0].EdmType==="Edm.Decimal"))){B2="comma";}else if(b.MainInfo&&b.MainInfo.Value.Path&&a.results[i][b.MainInfo.Value.Path]){B2="dash";}else if(b.MainInfo&&b.MainInfo.Value.Apply){for(j=0;j<b.MainInfo.Value.Apply.Parameters.length;j+=1){if(b.MainInfo.Value.Apply.Parameters[j].Type==="Path"){if(a.results[i][b.MainInfo.Value.Apply.Parameters[j].Value]){B2="dash";break;}}}}if(B2==="dash"){j2.addContent(new sap.ui.core.HTML({content:"<span class=\"sapFactsheetUtiSeparatorPadding sapMText\"> &ndash; </span>"}));}if(B2==="comma"){j2.addContent(new sap.m.Text({text:", "}).addStyleClass("sapFactsheetUtiSeparatorPaddingForDecimal"));}}if(b.MainInfo){i2=D(b.MainInfo,r1.navigationType,j1,r1.facet);if(i2.setWrapping){i2.setWrapping(false);}i2.setModel(o);i2.bindElement("/result");j2.addContent(i2);}n1.addContent(j2);}}l2=parseInt(a.__count,10);if(Number(l2)){r1.facet.setQuantity(l2);}r1.facet.setContent(n1);r1.facet.attachPress({facet:r1.facetContent},function(I2,J2){var n1;t.removeAllFacetContent();A[A.indexOf(r1.facet)].Links=[];n1=T(n,r1.entitySet,J2.facet,r1.bindingPath,this);n1.setDescription(a1());t.addFacetContent(n1);if(A.indexOf(r1.facet)>=0){A[A.indexOf(r1.facet)].bLoaded=false;A[A.indexOf(r1.facet)].bProcessed=false;A[A.indexOf(r1.facet)].bIsTable=true;}d(A.indexOf(r1.facet));t.navigateToDetail();});}else{r1.facet.setQuantity(0);r1.facet.addStyleClass("sapFactsheetUtiEmptyTile");r1.facet.setHeightType(jQuery.device.is.phone?sap.suite.ui.commons.FacetOverviewHeight.Auto:sap.suite.ui.commons.FacetOverviewHeight.S);}if(A.indexOf(r1.facet)>=0){A[A.indexOf(r1.facet)].bLoaded=true;A[A.indexOf(r1.facet)].bProcessed=false;A[A.indexOf(r1.facet)].bIsTable=false;}d(A.indexOf(r1.facet));}else{o.setData({result:a});for(z2 in a){if(a.hasOwnProperty(z2)){if(z2!=="__metadata"){if(typeof a[z2]==="string"&&a[z2]){if(parseInt(a[z2],10)!==0){A2=true;break;}}else if(typeof a[z2]==="number"&&parseInt(a[z2],10)!==0){A2=true;break;}}}}if(A2){m2=new sap.ui.layout.VerticalLayout();n2=(c.propertyExtensions)?c.propertyExtensions[r1.navigationType]:[];o2=new sap.ui.layout.HorizontalLayout().addStyleClass("sapFactsheetUtiHLayoutLabelValue");p2=E(b.Title,{},n2,true).addStyleClass("sapFactsheetUtiLabelMargin");k=D(b.Title,r1.navigationType,j1,r1.facet);k.setModel(o);k.bindElement("/result");o2.addContent(p2);o2.addContent(k);m2.addContent(o2);if(b.MainInfo){q2=new sap.ui.layout.HorizontalLayout().addStyleClass("sapFactsheetUtiHLayoutLabelValue");r2=E(b.MainInfo,{},n2,true).addStyleClass("sapFactsheetUtiLabelMargin");i2=D(b.MainInfo,r1.navigationType,j1,r1.facet);i2.setModel(o);i2.bindElement("/result");q2.addContent(r2);q2.addContent(i2);m2.addContent(q2);}if(b.SecondaryInfo){s2=new sap.ui.layout.HorizontalLayout().addStyleClass("sapFactsheetUtiHLayoutLabelValue");t2=E(b.SecondaryInfo,{},n2,true).addStyleClass("sapFactsheetUtiLabelMargin");u2=D(b.SecondaryInfo,r1.navigationType,j1,r1.facet);u2.setModel(o);u2.bindElement("/result");s2.addContent(t2);s2.addContent(u2);m2.addContent(s2);}if(b.TypeImageUrl||b.ImageUrl){if(b.ImageUrl){v2=b.ImageUrl;}else{v2=b.TypeImageUrl;}w2=new sap.ui.layout.HorizontalLayout();x2="64px";if(jQuery.device.is.phone){x2="48px";}if(v2.String&&(v2.String.substr(0,11)==="sap-icon://")){y2=new sap.ui.core.Icon({size:x2,width:x2});}else{y2=new sap.m.Image({width:x2});}y2.addStyleClass("sapFactsheetUtiRelIcon");if(v2&&v2.String){y2.setSrc(v2.String);}else{if(v2&&v2.Path){y2.bindProperty("src",v2.Path);}}w2.addContent(y2);w2.addContent(m2);r1.facet.setContent(w2);}else{r1.facet.setContent(m2);}r1.facet.attachPress({facet:r1.facetContent},function(I2,J2){var n1;t.removeAllFacetContent();A[A.indexOf(r1.facet)].Links=[];n1=T(n,r1.entitySet,J2.facet,r1.bindingPath,this);n1.setDescription(a1());t.addFacetContent(n1);if(A.indexOf(r1.facet)>=0){A[A.indexOf(r1.facet)].bLoaded=true;A[A.indexOf(r1.facet)].bProcessed=false;A[A.indexOf(r1.facet)].bIsTable=false;}d(A.indexOf(r1.facet));t.navigateToDetail();});}else{r1.facet.addStyleClass("sapFactsheetUtiEmptyTile");r1.facet.setHeightType(jQuery.device.is.phone?sap.suite.ui.commons.FacetOverviewHeight.Auto:sap.suite.ui.commons.FacetOverviewHeight.S);}if(A.indexOf(r1.facet)>=0){A[A.indexOf(r1.facet)].bLoaded=true;A[A.indexOf(r1.facet)].bProcessed=false;A[A.indexOf(r1.facet)].bIsTable=false;}d(A.indexOf(r1.facet));}};};g2=function(r1){return function(a){t.removeFacet(r1.facet);};};e2=function(r1){return function(a){var o,b,i,k,i2;b=c[r1.navigationType]["com.sap.vocabularies.UI.v1.MediaResource"];if(r1.cardinality==="*"){if(a.results&&a.results.length){o=new sap.ui.layout.HorizontalLayout().addStyleClass("sapFactsheetUtiPictureViewerOverview");for(i=0;i<a.results.length;i+=1){o.addContent(new sap.m.Image({src:a.results[i][b.Thumbnail.Url.Path],height:"85px"}));if(i===3){break;}}k=parseInt(a.__count,10);if(Number(k)){r1.facet.setQuantity(k);}r1.facet.setContent(o);r1.facet.attachPress({facet:r1.facetContent,data:a},function(j2,k2){var l2,f2,m2;t.removeAllFacetContent();i2=new sap.suite.ui.commons.UnifiedThingGroup();if(k2.facet.Label&&k2.facet.Label.String){i2.setTitle(k2.facet.Label.String);}i2.setDescription(a1());if(jQuery.device.is.phone){f2="350px";}else{f2="550px";}l2=new sap.m.Carousel({height:f2});for(i=0;i<k2.data.results.length;i+=1){m2=new sap.m.Image({src:k2.data.results[i][b.Url.Path]});if(jQuery.device.is.phone){m2.addStyleClass("sapFactsheetUtiCarouselMaxImageHeightPhone");}else{m2.addStyleClass("sapFactsheetUtiCarouselMaxImageHeight");}l2.addPage(m2);}i2.setContent(l2);t.addFacetContent(i2);t.navigateToDetail();});}else{r1.facet.setQuantity(0);r1.facet.addStyleClass("sapFactsheetUtiEmptyTile");r1.facet.setHeightType(jQuery.device.is.phone?sap.suite.ui.commons.FacetOverviewHeight.Auto:sap.suite.ui.commons.FacetOverviewHeight.S);}}};};h2=function(o,i2){var k,i,j,j2=[],k2={},l2,m2,n2,o2,p2,q2,r2,s2;m2=function(j1,a){var i,b="";if(j1){if(j1.Path){return a[j1.Path];}else if(j1.String){return j1.String;}else if(j1.Apply.Name==="odata.concat"){for(i=0;i<j1.Apply.Parameters.length;i+=1){if(j1.Apply.Parameters[i].Type==="Path"){b=b+a[j1.Apply.Parameters[i].Value];}else if(j1.Apply.Parameters[i].Type==="String"){b=b+j1.Apply.Parameters[i].Value;}}return b;}}};k2.iCount=0;k2.aContacts=[];for(i=0;i<o.__batchResponses.length;i+=1){if(!o.__batchResponses[i].data){continue;}j2=o.__batchResponses[i].data.results;if(!j2){j2=[];j2.push(o.__batchResponses[i].data);}if(j2.length>0){l2=c[j2[0].__metadata.type]["com.sap.vocabularies.Communication.v1.Contact"];if(l2){for(j=0;j<j2.length;j+=1){n2=o2=p2="";if(l2.tel){for(k=0;k<l2.tel.length;k+=1){if(l2.tel[k].type&&l2.tel[k].type.EnumMember){q2=m2(l2.tel[k].uri,j2[j]);switch(l2.tel[k].type.EnumMember){case"com.sap.vocabularies.Communication.v1.PhoneType/voice":n2=q2?q2.replace("tel:",""):"";n2=n2?n2.replace(";ext=",""):"";break;case"com.sap.vocabularies.Communication.v1.PhoneType/cell":o2=q2?q2.replace("tel:",""):"";o2=o2?o2.replace(";ext=",""):"";break;case"com.sap.vocabularies.Communication.v1.PhoneType/fax":p2=q2?q2.replace("tel:",""):"";p2=p2?p2.replace(";ext=",""):"";break;}}}}s2=l2.email&&l2.email.address?l2.email.address:"";r2=m2(l2.photo,j2[j]);k2.iCount+=1;k2.aContacts.push({fn:m2(l2.fn,j2[j]),title:m2(l2.title,j2[j]),org:m2(l2.org,j2[j]),phone:n2,mobile:o2,fax:p2,photo:r2,email:m2(s2,j2[j]),sEntity:j2[0].__metadata.type,bExistsPhoto:r2?true:false,bUseIcon:r2?false:true,sOrder:k2.iCount});}}}}if(i2){k2.aContacts.sort(function(a,b){return a[i2]>b[i2]?1:-1;});}return k2;};M1=function(r1){return function(o){var i,a,b,k,i2,j2,k2,l2;a=h2(o,"sOrder");b=new sap.ui.layout.Grid({defaultSpan:"L6 M6 S12",hSpacing:0,vSpacing:0}).addStyleClass("sapFactsheetUtiContactsGrid");for(i=0;i<a.aContacts.length&&i<4;i+=1){j2=new sap.ui.layout.VerticalLayout();if(a.aContacts[i].photo){k2=new sap.m.Image({height:"55px",src:a.aContacts[i].photo});}else{k2=new sap.ui.core.Icon({size:"50px",src:sap.ui.core.IconPool.getIconURI("person-placeholder")}).addStyleClass("sapFactsheetUtiRelIcon");}j2.addContent(k2);j2.addStyleClass("sapFactsheetUtiContactsImage");i2=new sap.ui.layout.VerticalLayout({content:[new sap.m.Text({text:a.aContacts[i].fn}).addStyleClass("sapFactsheetUtiTextName"),new sap.m.Text({text:a.aContacts[i].title}).addStyleClass("sapFactsheetUtiTextValue")]});k=new sap.ui.layout.HorizontalLayout({content:[j2,i2]}).addStyleClass("sapFactsheetUtiContactsBox");b.addContent(k);}V1=sap.ui.getCore().byId(t.data("contactFacetId"));V1.setQuantity(a.iCount);if(i>0){V1.setContent(b);if(i<=2){l2=sap.suite.ui.commons.FacetOverviewHeight.M;}else{l2=sap.suite.ui.commons.FacetOverviewHeight.L;}V1.attachPress(function(){var i,K1=[],L1;n.clearBatch();for(i=0;i<c[k1]["com.sap.vocabularies.UI.v1.Contacts"].length;i+=1){o1=c[k1]["com.sap.vocabularies.UI.v1.Contacts"][i].AnnotationPath;o1=o1.substring(0,o1.lastIndexOf("@")-1);if(o1!==""){L1=i1+"/"+o1;}else{L1=i1;}K1.push(n.createBatchOperation(L1,"GET"));}n.addBatchReadOperations(K1);n.submitBatch(function(o){var a,m2,n2,o2,p2,q2,r2;r2=jQuery.sap.resources({url:jQuery.sap.getModulePath("sap.ushell.components.container.")+"/resources/resources.properties",language:sap.ui.getCore().getConfiguration().getLanguage()});a=h2(o,"sEntity");m2=new sap.ui.model.json.JSONModel();m2.setData(a);n2=new sap.m.ColumnListItem({type:sap.m.Inactive,unread:false,cells:[new sap.ui.layout.VerticalLayout({content:[new sap.m.Image({src:"{photo}",width:"74px",visible:"{bExistsPhoto}"}),new sap.ui.core.Icon({size:"76px",src:sap.ui.core.IconPool.getIconURI("person-placeholder"),visible:"{bUseIcon}"}).addStyleClass("sapFactsheetUtiRelIcon")]}),new sap.ui.layout.VerticalLayout({content:[new sap.m.Text({text:"{fn}"}).addStyleClass("sapFactsheetUtiContactsName"),new sap.m.Label({text:"{title}"}),new sap.m.Label({text:"{org}"})]}),new sap.m.Link({text:"{phone}",href:"tel:{phone}"}),new sap.m.Link({text:"{mobile}",href:"tel:{mobile}"}),new sap.m.Link({text:"{fax}",href:"tel:{fax}"}),new sap.m.Link({text:"{email}",href:"mailto:{email}"})]});o2=new sap.m.Table({threshold:2,inset:false,showUnread:true,scrollToLoad:true,columns:[new sap.m.Column({hAlign:sap.ui.core.TextAlign.Center,width:"12%",header:new sap.m.Text({text:""})}),new sap.m.Column({hAlign:sap.ui.core.TextAlign.Begin,header:new sap.m.Text({text:r2.getText("USHELL_FACTSHEET_NAME")})}),new sap.m.Column({hAlign:sap.ui.core.TextAlign.Begin,width:"12%",header:new sap.m.Text({text:r2.getText("USHELL_FACTSHEET_PHONE")}),minScreenWidth:"Tablet",demandPopin:true}),new sap.m.Column({hAlign:sap.ui.core.TextAlign.Begin,width:"12%",header:new sap.m.Text({text:sap.ushell.resources.i18n.getText("mobile")}),minScreenWidth:"Tablet",demandPopin:true}),new sap.m.Column({hAlign:sap.ui.core.TextAlign.Begin,width:"12%",header:new sap.m.Text({text:sap.ushell.resources.i18n.getText("fax")}),minScreenWidth:"Tablet",demandPopin:true}),new sap.m.Column({hAlign:sap.ui.core.TextAlign.Begin,width:"26%",header:new sap.m.Text({text:r2.getText("USHELL_FACTSHEET_EMAIL")}),minScreenWidth:"Tablet",demandPopin:true})],items:{path:"/aContacts",template:n2}});p2=new sap.m.ViewSettingsDialog({sortItems:[new sap.m.ViewSettingsItem({key:"fn",text:r2.getText("USHELL_FACTSHEET_NAME")}),new sap.m.ViewSettingsItem({key:"phone",text:r2.getText("USHELL_FACTSHEET_PHONE")}),new sap.m.ViewSettingsItem({key:"mobile",text:sap.ushell.resources.i18n.getText("mobile")}),new sap.m.ViewSettingsItem({key:"fax",text:sap.ushell.resources.i18n.getText("fax")}),new sap.m.ViewSettingsItem({key:"email",text:r2.getText("USHELL_FACTSHEET_EMAIL")})],confirm:function(s2){var t2,u2,v2=[];t2=s2.getParameters();u2=o2.getBinding("items");if(t2.sortItem){v2.push(new sap.ui.model.Sorter(t2.sortItem.getKey(),t2.sortDescending));u2.sort(v2);}}});o2.setHeaderToolbar(new sap.m.Toolbar({content:[new sap.m.Label(),new sap.m.ToolbarSpacer(),new sap.m.Button({icon:"sap-icon://drop-down-list",press:function(s2){p2.open();}})]}));o2.setModel(m2);q2=new sap.suite.ui.commons.UnifiedThingGroup({title:V1.getTitle(),description:a1(),content:o2});t.removeAllFacetContent();t.addFacetContent(q2);t.navigateToDetail();});});}else{l2=sap.suite.ui.commons.FacetOverviewHeight.S;V1.addStyleClass("sapFactsheetUtiEmptyTile");V1.setQuantity(0);}V1.setHeightType(jQuery.device.is.phone?sap.suite.ui.commons.FacetOverviewHeight.Auto:l2);};};for(i=0;i<m1.length;i+=1){if(m1[i]["com.sap.vocabularies.UI.v1.Map"]){o1=m1[i].Target.AnnotationPath;o1=o1.substring(0,o1.lastIndexOf("@")-1);Y1="1";X1=k1;if(o1){X1=c1(o1,k1,j1);Y1=x(p,o1,j1);}f2="100%";if(jQuery.device.is.phone){f2="150px";}W1=new sap.ui.vbm.VBI({width:"100%",height:f2,plugin:false,config:null});V1=new sap.suite.ui.commons.FacetOverview({title:m1[i].Label.String.trim(),heightType:jQuery.device.is.phone?sap.suite.ui.commons.FacetOverviewHeight.Auto:sap.suite.ui.commons.FacetOverviewHeight.L,content:W1});A.push(V1);A[A.length-1].bLoaded=false;A[A.length-1].bProcessed=false;A[A.length-1].bIsTable=false;r1={cardinality:Y1,navigationPath:o1,facet:V1,facetContent:m1[i],navigationType:X1,metadata:j1,bindingPath:i1,entitySet:p};if(Y1==="*"){Z1=["$inlinecount=allpages","$top=1000"];}else{Z1=[];}n.read(i1+"/"+o1,"",Z1,true,q1(r1));t.addFacet(V1);}else{if(m1[i].Target){o1=m1[i].Target.AnnotationPath;o1=o1.substring(0,o1.lastIndexOf("@")-1);d2=m1[i].Target.AnnotationPath.substring(m1[i].Target.AnnotationPath.lastIndexOf("@")+1);if(o1){X1=c1(o1,k1,j1);V1=new sap.suite.ui.commons.FacetOverview({title:m1[i].Label.String.trim(),heightType:jQuery.device.is.phone?sap.suite.ui.commons.FacetOverviewHeight.Auto:sap.suite.ui.commons.FacetOverviewHeight.M});Y1=x(p,o1,j1);if(Y1!==0){r1={cardinality:Y1,navigationPath:o1,facet:V1,facetContent:m1[i],navigationType:X1,metadata:j1,bindingPath:i1,entitySet:p};if(m1[i]["com.sap.vocabularies.UI.v1.Gallery"]){if(Y1==="*"){Z1=["$inlinecount=allpages"];}else{Z1=[];}n.read(i1+"/"+o1,"",Z1,true,e2(r1));}else{A.push(V1);A[A.length-1].bLoaded=false;A[A.length-1].bProcessed=false;A[A.length-1].bIsTable=false;if(Y1==="*"){Z1=["$inlinecount=allpages","$top=3"];}else{Z1=[];}n.read(i1+"/"+o1,"",Z1,true,p1(r1),g2(r1));}t.addFacet(V1);}}else{if(d2==="com.sap.vocabularies.UI.v1.Contacts"){V1=new sap.suite.ui.commons.FacetOverview({title:m1[i].Label.String.trim(),heightType:jQuery.device.is.phone?sap.suite.ui.commons.FacetOverviewHeight.Auto:sap.suite.ui.commons.FacetOverviewHeight.M});t.data("contactFacetId",V1.sId);r1={facet:V1};n.clearBatch();for(j=0;j<c[k1][d2].length;j+=1){o1=c[k1][d2][j].AnnotationPath;o1=o1.substring(0,o1.lastIndexOf("@")-1);if(o1!==""){Y1=x(p,o1,j1);if(Y1==="*"){L1=i1+"/"+o1+"?$top=4"+"&$inlinecount=allpages";}else{L1=i1+"/"+o1;}}else{L1=i1;}K1.push(n.createBatchOperation(L1,"GET"));}n.addBatchReadOperations(K1);n.submitBatch(M1(r1));t.addFacet(V1);}}}}}T1=new sap.ushell.ui.footerbar.AddBookmarkButton();_1=function(){var b,i,d2,a,k,i2={},b2,j2,k2,l2,o,m2,n2,o2,p2;T1.setAppData({title:t.getTitle(),subtitle:t.getName()+" - "+t.getDescription()});T1.setEnabled(true);n2=sap.ushell.Container.getService("URLParsing");o2=n2.getShellHash(window.location.href);p2=n2.parseShellHash(o2);k2=p2.semanticObject;v1=new sap.suite.ui.commons.LinkActionSheet({showCancelButton:true,placement:sap.m.PlacementType.Top});s1=G(e,n);b=s1.split(",");for(i=0;i<b.length;i+=1){b[i]=b[i].replace("='","=","g");if(b[i].lastIndexOf("'")===b[i].length-1){b[i]=b[i].slice(0,-1);}}for(d2 in c[k1]){if(c[k1].hasOwnProperty(d2)){if(d2.indexOf("com.sap.vocabularies.Common.v1.SecondaryKey")===0){a=c[k1][d2];for(i=0;i<a.length;i+=1){k=this.getBoundContext().getProperty(a[i].PropertyPath);if(k){b.push(a[i].PropertyPath+"="+k);}}}}}for(i=0;i<b.length;i+=1){b2=b[i].substr(0,b[i].indexOf("="));j2=b[i].substr(b[i].indexOf("=")+1,b[i].length);i2[decodeURIComponent(b2)]=decodeURIComponent(j2);}u1=sap.ushell.Container.getService("CrossApplicationNavigation").getSemanticObjectLinks(k2,i2);u1.done(jQuery.proxy(function(q2){var i,r2,s2;for(i=0;i<q2.length;i+=1){s2=q2[i].intent;if(s2.indexOf(d1)<0&&s2.indexOf("-analyzeKPIDetails~")<0&&s2.indexOf("-analyzeSBKPIDetails~")<0&&s2.indexOf("-NavigateToMaintainCusProj~")<0&&s2.indexOf("CostCenter-manageCostCenter~")<0&&s2.indexOf("AccountingDocument-analyzeDocumentJournal~")<0&&s2.indexOf("AccountingDocument-analyzeGLLineItem~")<0&&s2.indexOf("ControllingDocument-analyzeCostCenters~")<0&&s2.indexOf("ControllingDocument-analyzeInternalOrders~")<0&&s2.indexOf("ControllingDocument-analyzeMarketSegment~")<0&&s2.indexOf("ControllingDocument-analyzeProfitCentersActuals~")<0&&s2.indexOf("ControllingDocument-analyzeProfitLoss~")<0&&s2.indexOf("ControllingDocument-analyzeProjectsActuals~")<0&&s2.indexOf("PurchaseOrder-create~")<0){r2=sap.ushell.Container.getService("CrossApplicationNavigation").hrefForExternal({target:{shellHash:s2}});v1.addItem(new sap.m.Link({text:q2[i].text,href:r2}));t.setTransactionsVisible(true);}}}));t.attachTransactionsButtonPress(function(q2){v1.openBy(q2.getParameter("caller"));});this.detachChange(_1);sap.ushell.services.AppConfiguration.setWindowTitle(t.getTitle().trim()+": "+t.getName().trim()+" ("+t.getDescription().trim()+")");t.setActionsVisible(true);$1=new sap.m.Button({text:z1.getText("UNIFIEDTHINGINSPECTOR_FOOTER_BUTTON_EMAIL_LINK"),icon:"sap-icon://email",press:function(oE){sap.m.URLHelper.triggerEmail("",t.getName(),window.location.href);}});w1=new sap.m.ActionSheet({placement:sap.m.PlacementType.Top});l2=e.substr(0,e.lastIndexOf("/")+1);for(o in n.oData){if(n.oData.hasOwnProperty(o)){l2=l2+o;m2=o.substring(o.indexOf("(")+1,o.indexOf(")"));break;}}w1.addButton(new sap.ushell.ui.footerbar.JamDiscussButton({jamData:{businessObject:{appContext:"CB",odataServicePath:e.substr(0,e.lastIndexOf("/")+1),collection:p,key:m2,name:t.getTitle(),ui_url:window.location.href}}}));w1.addButton(new sap.ushell.ui.footerbar.JamShareButton({jamData:{object:{id:window.location.href,display:new sap.m.Text({text:t.getTitle()}),share:""},externalObject:{appContext:"CB",odataServicePath:e.substr(0,e.lastIndexOf("/")+1),collection:p,key:m2,name:t.getTitle()}}}));w1.addButton(T1);w1.addButton($1);t.attachActionsButtonPress(function(q2){w1.openBy(q2.getParameter("caller"));});A[0].bLoaded=true;A[0].bProcessed=false;d(0);};t.getElementBinding().attachChange(_1);t.attachBackAction(function(o){history.back();});t.addDelegate({onAfterRendering:function(){t._adjustFacetLayout();}});return t;};return function(a,b){try{t=P(a,b,new U({configurationVisible:false}));}catch(e){throw e;}return t;};},true);
