// Copyright (c) 2009-2017 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell/utils","sap/ushell/library","sap/m/MessagePopover","sap/ui/core/Component","sap/ui/core/ComponentContainer","sap/ui/core/Control","sap/ui/thirdparty/URI","sap/ushell/EventHub"],function(u,a,M,C,b,c,U,E){"use strict";var p="sap.ushell.components.container.",s=p+"ApplicationContainer",d="sap.ushell.Container.dirtyState.",l,S={"sap.ushell.services.CrossApplicationNavigation":{isTrustedPostMessageSourceFn:function(){return true;},oServiceCalls:{"hrefForExternal":{executeServiceCallFn:function(e){return new jQuery.Deferred().resolve(sap.ushell.Container.getService("CrossApplicationNavigation").hrefForExternal(e.oMessageData.body.oArgs)).promise();}},"getSemanticObjectLinks":{executeServiceCallFn:function(e){return sap.ushell.Container.getService("CrossApplicationNavigation").getSemanticObjectLinks(e.oMessageData.body.sSemanticObject,e.oMessageData.body.mParameters,e.oMessageData.body.bIgnoreFormFactors,undefined,undefined,e.oMessageData.body.bCompactIntents);}},"isIntentSupported":{executeServiceCallFn:function(e){return sap.ushell.Container.getService("CrossApplicationNavigation").isIntentSupported(e.oMessageData.body.aIntents);}},"isNavigationSupported":{executeServiceCallFn:function(e){return sap.ushell.Container.getService("CrossApplicationNavigation").isNavigationSupported(e.oMessageData.body.aIntents);}},"backToPreviousApp":{executeServiceCallFn:function(e){sap.ushell.Container.getService("CrossApplicationNavigation").backToPreviousApp();return new jQuery.Deferred().resolve().promise();}},"historyBack":{executeServiceCallFn:function(e){sap.ushell.Container.getService("CrossApplicationNavigation").historyBack(e.oMessageData.body.iSteps);return new jQuery.Deferred().resolve().promise();}},"getAppStateData":{executeServiceCallFn:function(e){return sap.ushell.Container.getService("CrossApplicationNavigation").getAppStateData(e.oMessageData.body.sAppStateKey);}},"toExternal":{executeServiceCallFn:function(e){var O=u.clone(e.oMessageData.body.oArgs);var P=(O||{}).params;var Q=P&&P.hasOwnProperty("sap-system");if(Q){if(u.isPlainObject(P["sap-system"])){var R=P["sap-system"];var T=P["sap-system-src"];var V=typeof T==="string";if(!V){e.storeSapSystemData(R);}else{e.storeSapSystemData(R,T);P["sap-system-src"]=T;}P["sap-system"]=R.id;}else if(e.matchesLocalSid(P["sap-system"])){delete P["sap-system"];}}return new jQuery.Deferred().resolve(sap.ushell.Container.getService("CrossApplicationNavigation").toExternal(O)).promise();}}}},"sap.ushell.CrossApplicationNavigation":{isTrustedPostMessageSourceFn:function(){return true;},oServiceCalls:{"backToPreviousApp":{executeServiceCallFn:function(e){sap.ushell.Container.getService("CrossApplicationNavigation").backToPreviousApp();return new jQuery.Deferred().resolve().promise();}}}},"sap.ushell.ui5service.ShellUIService":{isTrustedPostMessageSourceFn:function(){return true;},oServiceCalls:{"setTitle":{executeServiceCallFn:function(e){return new jQuery.Deferred().resolve(e.oContainer.getShellUIService().setTitle(e.oMessageData.body.sTitle)).promise();}},"setBackNavigation":{executeServiceCallFn:function(e){return e.executeSetBackNavigationService(e.oMessage,e.oMessageData);}}}},"sap.ushell.services.Container":{isTrustedPostMessageSourceFn:function(){return true;},oServiceCalls:{"setDirtyFlag":{executeServiceCallFn:function(e){sap.ushell.Container.setDirtyFlag(e.oMessageData.body.bIsDirty);return new jQuery.Deferred().resolve().promise();}},"getFLPUrl":{executeServiceCallFn:function(e){return new jQuery.Deferred().resolve(sap.ushell.Container.getFLPUrl()).promise();}}}}},r;function f(T){var e=sap.ushell.Container.getService("CrossApplicationNavigation");e.isUrlSupported(T.url).done(function(){T.promise.resolve({"allowed":true,"id":T.id});}).fail(function(){T.promise.resolve({"allowed":false,"id":T.id});});}function i(){var e={"asyncURLHandler":N.prototype._adaptIsUrlSupportedResultForMessagePopover};if(M&&M.setDefaultHandlers){M.setDefaultHandlers(e);}}E.once("RendererExtensionPluginsLoaded").do(i);l=new u.Map();function g(e){return l.get(e.getId());}function h(e){var O=S[e.sService];if(O){Object.keys(e.oServiceCalls).forEach(function(Q){O.oServiceCalls[Q]=e.oServiceCalls[Q];});return;}var P={isTrustedPostMessageSourceFn:function(){return true;},oServiceCalls:{}};if(e.isTrustedPostMessageSourceFn){P.isTrustedPostMessageSourceFn=e.isTrustedPostMessageSourceFn;}Object.keys(e.oServiceCalls).forEach(function(Q){P.oServiceCalls[Q]=e.oServiceCalls[Q];});S[e.sService]=P;}function j(){return S;}function k(e){var P=jQuery.sap.getUriParameters(e).mParams,O=P["sap-xapp-state"],R;delete P["sap-xapp-state"];R={startupParameters:P};if(O){R["sap-xapp-state"]=O;}return R;}function m(e,O){if(!r){r=jQuery.sap.resources({url:jQuery.sap.getModulePath(p)+"/resources/resources.properties",language:sap.ui.getCore().getConfiguration().getLanguage()});}return r.getText(e,O);}function n(){return new sap.ui.core.Icon({size:"2rem",src:"sap-icon://error",tooltip:N.prototype._getTranslatedText("an_error_has_occured")});}function o(e){var O=e.getAggregation("child"),P;if(O instanceof b){P=O.getComponentInstance().getMetadata().getName().replace(/\.Component$/,"");jQuery.sap.log.debug("unloading component "+P,null,s);}e.destroyAggregation("child");}function q(e,O,P){var Q,R,T,V,W,X,Y,Z={},$,_;T=O.indexOf("?");if(T>=0){X=N.prototype._getParameterMap(O);Z=X.startupParameters;O=O.slice(0,T);}if(O.slice(-1)!=='/'){O+='/';}if(/\.view\.(\w+)$/i.test(P)){W=/^SAPUI5=(?:([^\/]+)\/)?([^\/]+)\.view\.(\w+)$/i.exec(P);if(!W){jQuery.sap.log.error("Invalid SAPUI5 URL",P,s);return N.prototype._createErrorControl();}Y=W[1];$=W[2];_=W[3].toUpperCase();if(Y){$=Y+"."+$;}else{V=$.lastIndexOf(".");if(V<1){jQuery.sap.log.error("Missing namespace",P,s);return N.prototype._createErrorControl();}Y=$.slice(0,V);}}else{Y=P.replace(/^SAPUI5=/,"");}jQuery.sap.registerModulePath(Y,O+Y.replace(/\./g,'/'));N.prototype._destroyChild(e);if($){if(e.getApplicationConfiguration()){Z.config=e.getApplicationConfiguration();}R=sap.ui.view({id:e.getId()+"-content",type:_,viewData:Z||{},viewName:$});e.fireEvent("applicationConfiguration");}else{jQuery.sap.log.debug("loading component "+Y,null,s);var a1=X?{startupParameters:X.startupParameters}:{startupParameters:{}};if(X&&X["sap-xapp-state"]){a1["sap-xapp-state"]=X["sap-xapp-state"];}if(e.getApplicationConfiguration()){a1.config=e.getApplicationConfiguration();}Q=sap.ui.component({id:e.getId()+"-component",componentData:a1,name:Y});e.fireEvent("applicationConfiguration",{"configuration":Q.getMetadata().getConfig()});R=new b({id:e.getId()+"-content",component:Q});}R.setWidth(e.getWidth());R.setHeight(e.getHeight());R.addStyleClass("sapUShellApplicationContainer");e.setAggregation("child",R,true);return R;}function t(e,O){setTimeout(function(){sap.ui.getCore().getEventBus().publish("sap.ushell",e,O);},0);}function v(e,O,P){var Q,R,T,V,W={startupParameters:{}},X,Y=e.getComponentHandle(),Z=sap.ushell.Container.getService("PluginManager"),$,_;u.addTime("createUi5Component");Q=O.indexOf("?");if(Q>=0){V=N.prototype._getParameterMap(O);W={startupParameters:V.startupParameters};if(V["sap-xapp-state"]){W["sap-xapp-state"]=V["sap-xapp-state"];}O=O.slice(0,Q);}if(e.getApplicationConfiguration()){W.config=e.getApplicationConfiguration();}if(O.slice(-1)!=='/'){O+='/';}N.prototype._destroyChild(e);X={id:e.getId()+"-component",name:P,componentData:W};jQuery.sap.log.debug("Creating component instance for "+P,JSON.stringify(X),s);sap.ui.getCore().getEventBus().publish("sap.ushell.components.container.ApplicationContainer","_prior.newUI5ComponentInstantion",{name:P});if(Y){R=Y.getInstance(X);}else{jQuery.sap.registerModulePath(P,O);jQuery.sap.log.error("No component handle available for '"+P+"'; fallback to component.load()",null,s);R=sap.ui.component({id:e.getId()+"-component",name:P,componentData:W});}e.fireEvent("applicationConfiguration",{"configuration":R.getMetadata().getConfig()});T=new b({id:e.getId()+"-content",component:R});T.setHeight(e.getHeight());T.setWidth(e.getWidth());T.addStyleClass("sapUShellApplicationContainer");e._disableRouterEventHandler=N.prototype._disableRouter.bind(this,R);sap.ui.getCore().getEventBus().subscribe("sap.ushell.components.container.ApplicationContainer","_prior.newUI5ComponentInstantion",e._disableRouterEventHandler);e.setAggregation("child",T,true);if(Z){$=Z.getPluginLoadingPromise("RendererExtensions");_=$&&$.state();if(_==="pending"){$.done(function(){N.prototype._publishExternalEvent("appComponentLoaded",{component:R});}).fail(function(){N.prototype._publishExternalEvent("appComponentLoaded",{component:R});});}if(_==="resolved"||_==="rejected"){N.prototype._publishExternalEvent("appComponentLoaded",{component:R});}}N.prototype._publishExternalEvent("appComponentLoaded",{component:R});return T;}function w(e){var O;if((e instanceof C)&&(typeof e.getRouter==="function")){O=e.getRouter();if(O&&(typeof O.stop==="function")){jQuery.sap.log.info("router stopped for instance "+e.getId());O.stop();}}}function x(e){var O=document.createElement("a"),P=jQuery.sap.getUriParameters(e).get("sap-client"),Q;O.href=e;Q=O.protocol+"//"+O.host;return new sap.ushell.System({alias:P?Q+"?sap-client="+P:Q,baseUrl:Q,client:P||undefined,platform:"abap"});}function y(e,O){var T=false,P=e.getDomRef(),Q=e.getApplicationType(),R,V;if(P){if(u.isApplicationTypeEmbeddedInIframe(Q)){R=U(P.src||window.location&&window.location.href||'');V=R.protocol()+"://"+R.host();T=(O.source===P.contentWindow)||(O.origin===V);}else if(Q===sap.ushell.components.container.ApplicationType.URL){R=U();V=R.protocol()+"://"+R.host();T=(O.origin===V);}}return T;}function z(e,O,P){var R=JSON.stringify({type:"request",service:O,request_id:jQuery.sap.uid(),body:{}});jQuery.sap.log.debug("Sending post message request to origin ' "+P+"': "+R,null,"sap.ushell.components.container.ApplicationContainer");e.postMessage(R,P);}function A(){var e=this.getDomRef();if(!e||e.tagName!=="IFRAME"){return null;}return e;}function B(O,P,Q){var R=jQuery.sap.getObject("sap-ushell-config.services.PostMessage.config",0),T=Q&&Q.service,V,W,X,Y,Z=false;jQuery.sap.log.debug("Received post message request from origin '"+P.origin+"': "+JSON.stringify(Q),null,"sap.ushell.components.container.ApplicationContainer");if(Q.type!=="request"||!T){return;}for(var $ in S){if(S.hasOwnProperty($)){if(T.indexOf($)!==-1){W=S[$];X=$;Z=true;break;}}}if(Z===false){return;}V=T.split(".")[3];if(R&&R.enabled===false){jQuery.sap.log.warning("Received message for "+V+", but this "+"feature is disabled. It can be enabled via launchpad configuration "+"property 'services.PostMessage.config.enabled: true'",undefined,"sap.ushell.components.container.ApplicationContainer");return;}if(!N.prototype._isTrustedPostMessageSource(O,P)||!W.isTrustedPostMessageSourceFn(O,P)){jQuery.sap.log.warning("Received message from untrusted origin '"+P.origin+"': "+JSON.stringify(P.data),null,"sap.ushell.components.container.ApplicationContainer");return;}function _(e,g1){var h1=JSON.stringify({type:"response",service:Q.service,request_id:Q.request_id,status:e,body:g1});jQuery.sap.log.debug("Sending post message response to origin ' "+P.origin+"': "+h1,null,"sap.ushell.components.container.ApplicationContainer");if(typeof P.source!=="object"||P.source===null){jQuery.sap.log.debug("Cannot send response message to origin ' "+P.origin,"`source` member of request message is not an object","sap.ushell.components.container.ApplicationContainer");return;}P.source.postMessage(h1,P.origin);}function a1(P,Q){var e=new jQuery.Deferred(),g1;if(Q.body&&Q.body.callbackMessage&&Q.body.callbackMessage.service){g1=N.prototype._backButtonPressedCallback.bind(null,P.source,Q.body.callbackMessage.service,P.origin);}e.resolve(O.getShellUIService().setBackNavigation(g1));return e.promise();}function b1(g1,h1){var i1,j1,k1,l1=[g1.id];if(arguments.length>1){l1.unshift(h1);}try{k1=JSON.stringify(g1);}catch(e){jQuery.sap.log.error("Cannot stringify and store expanded system data: "+e);}if(k1){j1=u.getLocalStorage();i1=u.generateLocalStorageKey("sap-system-data",l1);j1.setItem(i1,k1);}}function c1(){var e=sap.ushell.Container.getLogonSystem();var g1=e.getName();var h1=e.getClient();return"sid("+g1+"."+h1+")";}function d1(e){return c1().toLowerCase()===e.toLowerCase();}var e1={matchesLocalSid:d1,getLocalSystemInSidForma:c1,storeSapSystemData:b1,executeSetBackNavigationService:a1,sendResponseMessage:_,oMessage:P,oMessageData:Q,oContainer:O};try{Y=W.oServiceCalls[Q.service.replace(X+".","")];if(Y&&Y.executeServiceCallFn){Y.executeServiceCallFn(e1).done(function(e){_("success",{result:e});}).fail(function(e){_("error",{message:e});});}else{_("error",{message:"Unknown service name: '"+Q.service+"'"});}}catch(f1){_("error",{message:f1.message});}}function D(O,P){var Q=O.getUi5ComponentName&&O.getUi5ComponentName(),R=P.data;if(typeof R==="string"){try{R=JSON.parse(P.data);}catch(e){jQuery.sap.log.debug("Message received from origin '"+P.origin+"' cannot be parsed: "+e,R,"sap.ushell.components.container.ApplicationContainer");return;}}if(typeof Q==="string"){jQuery.sap.log.debug("Skipping handling of postMessage 'message' event with data '"+JSON.stringify(R)+"' on container of UI5 application '"+Q+"'","Only non UI5 application containers can handle 'message' postMessage event","sap.ushell.components.container.ApplicationContainer");return;}if(!O.getActive()){jQuery.sap.log.debug("Skipping handling of postMessage 'message' event with data '"+JSON.stringify(R)+"' on inactive container '"+O.getId()+"'","Only active containers can handle 'message' postMessage event","sap.ushell.components.container.ApplicationContainer");return;}if(R.action==="pro54_setGlobalDirty"&&localStorage.getItem(O.globalDirtyStorageKey)===sap.ushell.Container.DirtyState.PENDING){if(!N.prototype._isTrustedPostMessageSource(O,P)){jQuery.sap.log.warning("Received message from untrusted origin: "+P.origin,R,"sap.ushell.components.container.ApplicationContainer");return;}jQuery.sap.log.debug("getGlobalDirty() pro54_setGlobalDirty SetItem key:"+O.globalDirtyStorageKey+" value: "+R.parameters.globalDirty,null,"sap.ushell.components.container.ApplicationContainer");u.localStorageSetItem(O.globalDirtyStorageKey,R.parameters.globalDirty,true);}else{N.prototype._handleServiceMessageEvent(O,P,R);}}function F(e,O){var P=e._getIFrame(),Q=e.getApplicationType();if(u.isApplicationTypeEmbeddedInIframe(e.getApplicationType(Q))&&P){P.contentWindow.postMessage(JSON.stringify({action:"pro54_disableDirtyHandler"}),"*");O.preventDefault();}}function G(R,e,O){R.write("<div").writeControlData(e).writeAccessibilityState(e).addClass("sapUShellApplicationContainer").writeClasses(e).addStyle("height",e.getHeight()).addStyle("width",e.getWidth()).writeStyles().write(">").renderControl(O);R.write("</div>");}function H(O,P){var Q=P==="TR"?"":"-NWBC";var V,R=function(){var V,T;try{V=sap.ui.getVersionInfo().version;}catch(e){jQuery.sap.log.error("sap ui version could not be determined, using sap.ui.version (core version) as fallback "+e);V=window.sap&&sap.ui&&sap.ui.version;}T=/\d+\.\d+\.\d+/.exec(V);if(T&&T[0]){V=T[0];}else{V=undefined;}return V;};V=R();if(V){O+=O.indexOf("?")>=0?"&":"?";O+="sap-shell="+encodeURIComponent("FLP"+V+Q);}return O;}function I(e,O,T,R){var P,Q=function(){var W=u.getParameterValueBoolean("sap-accessibility");if(W!==undefined){return W;}return sap.ushell.Container.getUser().getAccessibilityMode();},V=function(){var W=false,X=jQuery.sap.getUriParameters(e)||{mParams:{}};W=sap.ui.getCore().getConfiguration().getStatistics()&&!X.mParams.hasOwnProperty("sap-statistics");return W;};e+=e.indexOf("?")>=0?"&":"?";e+="sap-ie=edge";P=sap.ushell.Container.getUser().getTheme(sap.ushell.User.prototype.constants.themeFormat.NWBC);if(P){e+=e.indexOf("?")>=0?"&":"?";e+="sap-theme="+encodeURIComponent(P);}if(T){e+=e.indexOf("?")>=0?"&":"?";e+="sap-target-navmode="+encodeURIComponent(T);}if(Q()){e+=e.indexOf("?")>=0?"&":"?";e+="sap-accessibility=X";}if(V()){e+=e.indexOf("?")>=0?"&":"?";e+="sap-statistics=true";}if(R){e+=e.indexOf("?")>=0?"&":"?";e+="sap-keepclientsession=1";}return H(e,O);}function J(R,e,O,P){var Q=e.getAggregation("child");if(!Q||e._bRecreateChild){Q=N.prototype._createUi5Component(e,O,P);e._bRecreateChild=false;}N.prototype._renderControlInDiv(R,e,Q);}function K(e,O,V){var P=e.getProperty(O);if(jQuery.sap.equal(P,V)){return;}e.setProperty(O,V);e._bRecreateChild=true;}function L(R,e,O,P,Q){var T;localStorage.removeItem(e.globalDirtyStorageKey);if(Q&&Q.indexOf("SAPUI5.Component=")===0&&O===sap.ushell.components.container.ApplicationType.URL){J(R,e,P,Q.replace(/^SAPUI5\.Component=/,""));return;}if(Q&&Q.indexOf("SAPUI5=")===0&&O===sap.ushell.components.container.ApplicationType.URL){N.prototype._renderControlInDiv(R,e,N.prototype._createUi5View(e,P,Q));return;}jQuery.sap.log.debug("Not resolved as \"SAPUI5.Component=\" or \"SAPUI5=\" , "+"will attempt to load into iframe "+Q);if(!e.getActive()){jQuery.sap.log.debug("Skipping rendering container iframe","Container '"+e.getId()+"' is inactive");return;}try{P=e.getFrameSource(O,P,Q);}catch(V){jQuery.sap.log.error(V.message||V,null,s);e.fireEvent("applicationConfiguration");R.renderControl(N.prototype._createErrorControl());return;}if(sap.ushell.Container){T=N.prototype._getLogoutHandler(e);if(!T){if(u.isApplicationTypeEmbeddedInIframe(O)){T=N.prototype._logout.bind(null,e);l.put(e.getId(),T);sap.ushell.Container.attachLogoutEvent(T);sap.ushell.Container.addRemoteSystem(N.prototype._createSystemForUrl(P));}}else if(!u.isApplicationTypeEmbeddedInIframe(O)){sap.ushell.Container.detachLogoutEvent(T);l.remove(e.getId());}}if(u.isApplicationTypeEmbeddedInIframe(O)){var W=e.getTargetNavigationMode();P=N.prototype._adjustNwbcUrl(P,O,W,e.getIsStateful());u.localStorageSetItem(e.globalDirtyStorageKey,sap.ushell.Container.DirtyState.INITIAL);}e.fireEvent("applicationConfiguration");R.write("<iframe").writeControlData(e).writeAccessibilityState(e).writeAttributeEscaped("src",P).addClass("sapUShellApplicationContainer").writeClasses(e).addStyle("height",e.getHeight()).addStyle("width",e.getWidth()).writeStyles().write("></iframe>");}var N=c.extend(s,{metadata:{properties:{additionalInformation:{defaultValue:"",type:"string"},application:{type:"object"},applicationConfiguration:{type:"object"},applicationType:{defaultValue:"URL",type:p+"ApplicationType"},height:{defaultValue:"100%",type:"sap.ui.core.CSSSize"},navigationMode:{defaultValue:"",type:"string"},targetNavigationMode:{defaultValue:"",type:"string"},text:{defaultValue:"",type:"string"},url:{defaultValue:"",type:"string"},visible:{defaultValue:true,type:"boolean"},active:{defaultValue:true,type:"boolean"},"sap-system":{defaultValue:undefined,type:"string"},applicationDependencies:{type:"object"},componentHandle:{type:"object"},ui5ComponentName:{type:"string"},width:{defaultValue:"100%",type:"sap.ui.core.CSSSize"},shellUIService:{type:"object"},appIsolationService:{type:"object"},reservedParameters:{type:"object"},coreResourcesFullyLoaded:{type:"boolean"},isStateful:{defaultValue:false,type:"boolean"},iframeHandlers:{defaultValue:"",type:"string"}},events:{"applicationConfiguration":{}},aggregations:{child:{multiple:false,type:"sap.ui.core.Control",visibility:"hidden"}},library:"sap.ushell",designtime:"sap/ushell/designtime/ApplicationContainer.designtime"},exit:function(){var e,O=this;if(sap.ushell.Container){e=N.prototype._getLogoutHandler(O);if(e){sap.ushell.Container.detachLogoutEvent(e);l.remove(O.getId());}}localStorage.removeItem(O.globalDirtyStorageKey);if(O._unloadEventListener){removeEventListener("unload",O._unloadEventListener);}if(O._disableRouterEventHandler){sap.ui.getCore().getEventBus().unsubscribe("sap.ushell.components.container.ApplicationContainer","_prior.newUI5ComponentInstantion",O._disableRouterEventHandler);}if(O._storageEventListener){removeEventListener("storage",O._storageEventListener);}if(O._messageEventListener){removeEventListener("message",O._messageEventListener);}N.prototype._destroyChild(O);if(c.exit){c.exit.apply(O);}},init:function(){var e=this;e.globalDirtyStorageKey=d+jQuery.sap.uid();e._unloadEventListener=e.exit.bind(e);addEventListener("unload",e._unloadEventListener);e._storageEventListener=function(O){var P=e.getApplicationType();if(O.key===e.globalDirtyStorageKey&&O.newValue===sap.ushell.Container.DirtyState.PENDING&&u.isApplicationTypeEmbeddedInIframe(P)){var Q=e._getIFrame();if(Q){jQuery.sap.log.debug("getGlobalDirty() send pro54_getGlobalDirty ",null,"sap.ushell.components.container.ApplicationContainer");Q.contentWindow.postMessage(JSON.stringify({action:"pro54_getGlobalDirty"}),'*');}}};addEventListener('storage',e._storageEventListener);e._messageEventListener=N.prototype._handleMessageEvent.bind(null,e);addEventListener('message',e._messageEventListener);},onAfterRendering:function(e){if(this.getIsStateful()){this.rerender=function(){};}},renderer:function(R,e){var O=e.getApplication(),P=e.launchpadData,Q;if(!e.getVisible()){N.prototype._renderControlInDiv(R,e);return;}if(e.error){delete e.error;N.prototype._renderControlInDiv(R,e,N.prototype._createErrorControl());}else if(!O){N.prototype._render(R,e,e.getApplicationType(),e.getUrl(),e.getAdditionalInformation());}else if(!O.isResolvable()){N.prototype._render(R,e,O.getType(),O.getUrl(),"");}else if(P){N.prototype._render(R,e,P.applicationType,P.Absolute.url.replace(/\?$/,""),P.applicationData);}else{jQuery.sap.log.debug("Resolving "+O.getUrl(),null,s);O.resolve(function(T){jQuery.sap.log.debug("Resolved "+O.getUrl(),JSON.stringify(T),s);e.launchpadData=T;N.prototype._destroyChild(e);},function(T){var V=O.getMenu().getDefaultErrorHandler();if(V){V(T);}N.prototype._destroyChild(e);e.error=T;});Q=new sap.m.Text({text:N.prototype._getTranslatedText("loading",[O.getText()])});N.prototype._destroyChild(e);e.setAggregation("child",Q);N.prototype._renderControlInDiv(R,e,Q);}}});N.prototype.getFrameSource=function(e,O,P){if(!Object.prototype.hasOwnProperty.call(sap.ushell.components.container.ApplicationType,e)){throw new Error("Illegal application type: "+e);}return O;};N.prototype.setUrl=function(V){K(this,"url",V);};N.prototype.setAdditionalInformation=function(V){K(this,"additionalInformation",V);};N.prototype.setApplicationType=function(V){K(this,"applicationType",V);};N.prototype.createPostMessageRequest=function(e,O){var R=Date.now().toString();return{"type":"request","request_id":R,"service":e,"body":O};};N.prototype.registerShellCommunicationHandler=function(e){var O=this;if(Array.isArray(e)){e.forEach(function(P){O._addShellCommunicationHandler(P);});}else{this._addShellCommunicationHandler(e);}};N.prototype.setNewTRApplicationContext=function(e){var O=this._getIFrame();if(!O){return Promise.reject({message:"Expected an exisiting TR application application frame but found none."});}e=H(e);var R=this.createPostMessageRequest("sap.its.startService",{"url":e});return this.postMessageToIframe(R,O,true).catch(function(P){return Promise.reject({eventData:P,message:"Failed to change application context."});});};N.prototype.postMessageToIframe=function(O,P,W){var Q=this;var R=O.request_id;return new Promise(function(T,V){function X(Z){var $;try{$=JSON.parse(Z.data);if(R!==$.request_id){return;}if("success"===$.status){T($);}else{V($);}window.removeEventListener("message",X);}catch(e){T();jQuery.sap.log.warning("Obtained bad response from framework in response to message "+O.request_id);jQuery.sap.log.debug("Underlying framework returned invalid response data: '"+Z.data+"'");}}var Y=JSON.stringify(O);jQuery.sap.log.debug("Sending postMessage "+Y+" to application container '"+Q.getId()+"'");if(W){window.addEventListener("message",X,false);P.contentWindow.postMessage(Y,"*");}else{P.contentWindow.postMessage(Y,"*");T();}});};N.prototype.setNewApplicationContext=function(e,O){var P=this;var Q=this["setNew"+e+"ApplicationContext"];if(!Q){return Promise.reject({message:"Unsupported application type"});}var R=this._getIFrame();if(!R){return Promise.reject({message:"Expected an exisiting TR application application frame but found none."});}var T=this.createPostMessageRequest("sap.gui.triggerCloseSessionImmediately",{});return this.postMessageToIframe(T,R,true).then(function(){return Q.call(P,O);},function(V){return Promise.reject({eventData:V,message:"Failed to change application context."});});};N.prototype.onApplicationOpened=function(e){var O=this.getIsStateful();if(!O){return Promise.resolve();}var P=this.getApplicationType();if(P==="TR"&&e!=="TR"){var Q=this._getIFrame();if(!Q){return Promise.reject({message:"Expected an exisiting TR application application frame but found none."});}var R=this.createPostMessageRequest("sap.gui.triggerCloseSession",{});return this.postMessageToIframe(R,Q,false).catch(function(T){return Promise.reject({eventData:T,message:"Failed to change application context."});});}return Promise.resolve();};N.prototype.postMessageRequest=function(e){var O=this._getIFrame();if(!O){return Promise.reject({message:"Expected an exisiting TR application application frame but found none."});}var R=this.createPostMessageRequest(e,{});return this.postMessageToIframe(R,O,false).catch(function(P){return Promise.reject({eventData:P,message:"Failed to post message."});});};N.prototype._addShellCommunicationHandler=h;N.prototype._getCommunicationHandlers=j;N.prototype._adaptIsUrlSupportedResultForMessagePopover=f;N.prototype._getLogoutHandler=g;N.prototype._getParameterMap=k;N.prototype._getTranslatedText=m;N.prototype._createErrorControl=n;N.prototype._destroyChild=o;N.prototype._createUi5View=q;N.prototype._publishExternalEvent=t;N.prototype._createUi5Component=v;N.prototype._disableRouter=w;N.prototype._createSystemForUrl=x;N.prototype._isTrustedPostMessageSource=y;N.prototype._handleServiceMessageEvent=B;N.prototype._handleMessageEvent=D;N.prototype._logout=F;N.prototype._renderControlInDiv=G;N.prototype._adjustNwbcUrl=I;N.prototype._render=L;N.prototype._backButtonPressedCallback=z;N.prototype._getIFrame=A;return N;},true);
