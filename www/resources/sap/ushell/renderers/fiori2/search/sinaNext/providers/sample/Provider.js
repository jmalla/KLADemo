sinaDefine(['../../core/core','../../core/util','./template','./template2','../../sina/NavigationTarget'],function(c,u,t,a,N){"use strict";return c.defineClass({id:'sample',instanceCounterStr:"0",_initAsync:function(p){var b=this;b.sina=p.sina;b.NavigationTarget=N;this.sina.util.sampleProviderInstanceCounter++;b.instanceCounterStr=""+this.sina.util.sampleProviderInstanceCounter;var d;if(parseInt(b.instanceCounterStr,10)%2===1){b.templateProvider=t;}else{b.templateProvider=a;}d=b.templateProvider(b);d._init(d);var r=c.Promise.resolve({capabilities:this.sina._createCapabilities({fuzzy:false})});return r;},getSuggestionList:function(b){var l=this._stringify(b);var r=new RegExp("\"valueFormatted\"\:\"([^\"/]+?)\",","g");var m=[];l.replace(r,function(){m.push(arguments[1]);});var s=m.toString().split(' ');s=s.toString().split(',');m=m.concat(s);m=m.filter(function(i,p){if(i!==''){return m.indexOf(i)==p;}});return m;},_stringify:function(o){var b=[];var s=JSON.stringify(o,function(k,v){if(typeof v==='object'&&v!==null){if(b.indexOf(v)!==-1){return undefined;}b.push(v);}return v;});b=null;return s;},adjustImageViewing:function(){var b,d,l;try{$(".sapUshellSearchResultListItem-Image").on('mouseenter',function(){b=$(this).clone();$('body').append(b);d=($(window).height()-$(b).outerHeight())*0.33;l=($(window).width()-$(b).outerWidth())*0.33;b.css({position:"absolute",top:d+"px",left:l+"px"}).show();});$(".sapUshellSearchResultListItem-Image").on('mouseleave',function(){b.remove();});}catch(e){}},applyFilters:function(b,s){var d=[];if(!s.filter.rootCondition.conditions.length>0||!s.filter.rootCondition.conditions[0].conditions.length>0){return b;}var e=[];var f=[];for(var g=0;g<s.filter.rootCondition.conditions.length;g++){var l=s.filter.rootCondition.conditions[g].conditions;for(var h=0;h<l.length;h++){e.push([l[h].attribute,l[h].value]);f.push(l[h].attribute);}}var o=false;for(var i=0;i<b.length;i++){var q=b[i];var r=[];for(var j=0;j<e.length;j++){o=false;for(var k=0;k<q.detailAttributes.length;k++){var v=q.detailAttributes[k];if(v.id===e[j][0]&&v.value===e[j][1]){o=true;}}for(var m=0;m<q.titleAttributes.length;m++){var w=q.titleAttributes[m];if(w.id===e[j][0]&&w.value===e[j][1]){o=true;}}e[j][2]=o;r.push(o);}if(r.toString().match(/false/)===null){d.push(q);}else{var x=[];var y=f.filter(function(q,A){return f.indexOf(q)==A;});for(var n=0;n<y.length;n++){o=false;var z=y[n];for(var p=0;p<e.length;p++){if(e[p][0]===z&&e[p][2]===true){o=true;break;}}x.push(o);}if(x.toString().match(/false/)===null){d.push(q);}}}return d;},adjustHighlights:function(b,s){var n=[];var d="";for(var i=0;i<b.length;i++){var e=b[i];var f=true;d="";e.titleHighlighted=this.addHighlight(e.title,s);if(e.titleHighlighted!==e.title){f=false;}for(var j=0;j<e.detailAttributes.length;j++){var g=e.detailAttributes[j];d=g.metadata.type;if(d==="String"||d==="Longtext"||d==="Integer"){g.valueHighlighted=this.addHighlight(g.valueFormatted,s);if(g.valueHighlighted!==g.valueFormatted){f=false;}}}for(var k=0;k<e.titleAttributes.length;k++){var h=e.titleAttributes[k];d=h.metadata.type;if(d==="String"||d==="Longtext"||d==="Integer"){h.valueHighlighted=this.addHighlight(h.valueFormatted,s);if(h.valueHighlighted!==h.valueFormatted){f=false;}}}if(f===false||s==="*"){n.push(e);}}return n;},addHighlight:function(h,s){if(typeof h!='string'||typeof s!='string'){return h;}var p=h.toLowerCase().indexOf(s.toLowerCase());if(p>-1){var b=p+s.length;var n=h.substring(0,p)+'<b>'+h.substring(p,b)+'</b>'+h.substring(b);return n;}else{return h;}},augmentDetailAttributes:function(r){for(var i=0;i<r.length;i++){var b=r[i].detailAttributes;for(var j=0;j<b.length;j++){var d=b[j];d=u.addPotentialNavTargetsToAttribute(this.sina,d);}}return r;},executeSearchQuery:function(s){var b=this;b.searchQuery=s;return new c.Promise(function(r,d){var e,f,g;var i=b.templateProvider(b);var h=i.searchResultSetItemArray;h=b.augmentDetailAttributes(h);var j=i.searchResultSetItemArray2;j=b.augmentDetailAttributes(j);var k=h.concat(j);b.searchQuery=s;f=s.filter.searchTerm;g=s.filter.dataSource.id;var l=b.generateFacets(s);var m;if(g==="Scientists"||g==="Folklorists"){m=b.adjustHighlights(h,f);m=b.applyFilters(m,s);e=b.sina._createSearchResultSet({items:m,facets:l,type:"",query:s,title:"",totalCount:m.length});}else if(g==="Mysterious_Sightings"||g==="Urban_Legends"){m=b.adjustHighlights(j,f);m=b.applyFilters(m,s);e=b.sina._createSearchResultSet({items:m,facets:l,type:"",query:s,title:"",totalCount:m.length});}else if(g==="All"){m=b.adjustHighlights(h,f);m=b.applyFilters(m,s);var n=m.length;m=b.adjustHighlights(j,f);m=b.applyFilters(m,s);var o=m.length;l[0].items[0].measureValue=n;l[0].items[0].measureValueFormatted=''+n;l[0].items[1].measureValue=o;l[0].items[1].measureValueFormatted=''+o;m=b.adjustHighlights(k,f);m=b.applyFilters(m,s);e=b.sina._createSearchResultSet({items:m,facets:l,type:"",query:s,title:"",totalCount:m.length});}r(e);});},executeSuggestionQuery:function(q){var b=this;var d=q.filter.searchTerm;var e=this.templateProvider(this);var f=e.searchResultSetItemArray.concat(e.searchResultSetItemArray2);var g=this.getSuggestionList(f);var h=g.filter(function(s){var k=new RegExp("^"+d,"gi");return s.match(k);});if(h.length===0){h=g;}var j=[];var S=function(k){var l=b.sina.SuggestionCalculationMode.Data;var m=q.filter.clone();m.setSearchTerm(k);return b.sina._createSearchTermSuggestion({searchTerm:k,calculationMode:l,filter:m,label:k});};for(var i=0;i<h.length;i++){j.push(new S(h[i]));}var r=this.sina._createSuggestionResultSet({title:'Suggestions',query:q,items:j});return new c.Promise(function(k,l){k(r);});},executeChartQuery:function(q){var b=this.generateFacets(q);var w=1;if(q.dimension==="LOCATION"){w=0;}return new c.Promise(function(r,d){r(b[w]);});},generateFacets:function(s){var b=this;if(s.filter.dataSource.id==="All"){var d=s.filter.sina.allDataSource;var e=[b.sina._createDataSourceResultSetItem({dataSource:s.filter.sina.dataSources[1],dimensionValueFormatted:d.labelPlural,measureValue:4,measureValueFormatted:'4'}),b.sina._createDataSourceResultSetItem({dataSource:s.filter.sina.dataSources[2],dimensionValueFormatted:d.labelPlural,measureValue:5,measureValueFormatted:'5'})];var f=[b.sina._createDataSourceResultSet({title:s.filter.dataSource.label,titleHighlighted:s.filter.dataSource.label,items:e,query:s})];return f;}else{var g=[];var h=this.templateProvider(this);var l=b.sina.createFilter({searchTerm:b.searchQuery.filter.searchTerm,dataSource:b.searchQuery.filter.dataSource,rootCondition:b.searchQuery.filter.rootCondition.clone()});var m=[];var n,o,i,j,k,p;var r=h.searchResultSetItemArray;if(s.filter.dataSource.id==="Mysterious_Sightings"||s.filter.dataSource.id==="Urban_Legends"){r=h.searchResultSetItemArray2;}var q;var v=[];for(i=0;i<r.length;i++){p=r[i].detailAttributes;for(j=0;j<p.length;j++){if(p[j].id==="LOCATION"){q=p[j].value;if(v.indexOf(q)===-1){v.push(q);n=b.sina._createChartResultSetItem({filterCondition:b.sina.createSimpleCondition({attribute:"LOCATION",operator:b.sina.ComparisonOperator.Equals,value:q}),dimensionValueFormatted:q,measureValue:1,measureValueFormatted:'1',dataSource:b.searchQuery.filter.dataSource});m.push(n);}else{for(k=0;k<m.length;k++){if(m[k].filterCondition.value===q){m[k].measureValue=m[k].measureValue+1;m[k].measureValueFormatted=''+m[k].measureValue;}}}}}}o=b.sina._createChartResultSet({items:m,query:b.sina.createChartQuery({filter:l,dimension:"LOCATION"}),title:"Locations",type:''});g.push(o);var w;var x=[];var y="";m=[];for(i=0;i<r.length;i++){p=r[i].titleAttributes;if(s.filter.dataSource.id==="Mysterious_Sightings"||s.filter.dataSource.id==="Urban_Legends"){p=r[i].detailAttributes;}for(j=0;j<p.length;j++){if(p[j].id==="SCIENTIST"||p[j].id==="FOLKLORIST"){w=p[j].value;y=p[j].id;if(x.indexOf(w)===-1){x.push(w);n=b.sina._createChartResultSetItem({filterCondition:b.sina.createSimpleCondition({attribute:p[j].id,operator:b.sina.ComparisonOperator.Equals,value:w}),dimensionValueFormatted:w,measureValue:1,measureValueFormatted:'1',dataSource:b.searchQuery.filter.dataSource});m.push(n);}else{for(k=0;k<m.length;k++){if(m[k].filterCondition.value===w){m[k].measureValue=m[k].measureValue+1;m[k].measureValueFormatted=''+m[k].measureValue;}}}}}}o=b.sina._createChartResultSet({items:m,query:b.sina.createChartQuery({filter:l,dimension:y}),title:y.charAt(0).toUpperCase()+y.slice(1).toLowerCase()+"s",type:''});g.push(o);return g;}}});});
