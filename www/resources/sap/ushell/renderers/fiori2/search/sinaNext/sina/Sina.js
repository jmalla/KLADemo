sinaDefine(['../core/core','../core/util','./SearchQuery','./ChartQuery','./DataSourceQuery','./SuggestionQuery','./Filter','./DataSource','./ComplexCondition','./SimpleCondition','./AttributeMetadata','./AttributeGroupMetadata','./SearchResultSetItemAttribute','./SearchResultSetItemAttributeGroup','./SearchResultSetItem','./SearchResultSet','./AttributeType','./AttributeFormatType','./AttributeDescriptionTextArrangement','./DataSourceType','./SuggestionType','./SuggestionCalculationMode','./FacetType','./MatchingStrategy','./LogicalOperator','./ComparisonOperator','./AttributeUsageType','./FacetResultSet','./FacetResultSetItem','./SearchTermSuggestion','./SearchTermAndDataSourceSuggestion','./DataSourceSuggestion','./ObjectSuggestion','./SuggestionResultSet','./ChartResultSet','./DataSourceResultSet','./ChartResultSetItem','./DataSourceResultSetItem','./EqualsMode','./SortOrder','./Capabilities','./ConditionType','./Configuration','../providers/inav2/typeConverter','./NavigationTarget','../providers/tools/fiori/FioriIntentsResolver','../providers/tools/fiori/NavigationTargetForIntent','../providers/tools/cds/CDSAnnotationsParser','../providers/tools/fiori/SuvNavTargetResolver','./formatters/ConfigSearchResultSetFormatter','./formatters/ConfigMetadataFormatter','./formatters/Formatter','./formatters/NavtargetsInResultSetFormatter','./formatters/RemovePureAdvancedSearchFacetsFormatter'],function(c,u,S,C,D,a,F,b,d,e,A,f,g,h,k,l,m,n,o,p,q,r,s,M,L,t,v,w,x,y,z,B,O,E,G,H,I,J,K,N,P,Q,R,T,U,V,W,X,Y,Z,$,_,a1,b1){"use strict";return c.defineClass({AttributeType:m,AttributeFormatType:n,AttributeDescriptionTextArrangement:o,DataSourceType:p,AttributeUsageType:v,MatchingStrategy:M,LogicalOperator:L,ComparisonOperator:t,FacetType:s,SuggestionCalculationMode:r,SuggestionType:q,EqualsMode:K,SortOrder:N,ConditionType:Q,SearchResultSet:l,SearchResultSetItem:k,SearchResultSetItemAttribute:g,ObjectSuggestion:O,_init:function(i){this.core=c;this.util=u;this.inav2TypeConverter=T;this.provider=i;this.createSearchQuery=this.generateFactoryMethod(S);this.createChartQuery=this.generateFactoryMethod(C);this.createSuggestionQuery=this.generateFactoryMethod(a);this.createDataSourceQuery=this.generateFactoryMethod(D);this.createFilter=this.generateFactoryMethod(F);this.createComplexCondition=this.generateFactoryMethod(d);this.createSimpleCondition=this.generateFactoryMethod(e);this._createAttributeMetadata=this.generateFactoryMethod(A);this._createAttributeGroupMetadata=this.generateFactoryMethod(f);this._createSearchResultSetItemAttribute=this.generateFactoryMethod(g);this._createSearchResultSetItemAttributeGroup=this.generateFactoryMethod(h);this._createSearchResultSetItem=this.generateFactoryMethod(k);this._createSearchResultSet=this.generateFactoryMethod(l);this._createSearchTermSuggestion=this.generateFactoryMethod(y);this._createSearchTermAndDataSourceSuggestion=this.generateFactoryMethod(z);this._createDataSourceSuggestion=this.generateFactoryMethod(B);this._createObjectSuggestion=this.generateFactoryMethod(O);this._createSuggestionResultSet=this.generateFactoryMethod(E);this._createChartResultSet=this.generateFactoryMethod(G);this._createDataSourceResultSet=this.generateFactoryMethod(H);this._createChartResultSetItem=this.generateFactoryMethod(I);this._createDataSourceResultSetItem=this.generateFactoryMethod(J);this._createCapabilities=this.generateFactoryMethod(P);this._createConfiguration=this.generateFactoryMethod(R);this._createNavigationTarget=this.generateFactoryMethod(U);this._createFioriIntentsResolver=this.generateFactoryMethod(V);this._createNavigationTargetForIntent=this.generateFactoryMethod(W);this._createCDSAnnotationsParser=this.generateFactoryMethod(X);this._createSuvNavTargetResolver=this.generateFactoryMethod(Y);this.searchResultSetFormatters=[];this.metadataFormatters=[];this.dataSources=[];this.dataSourceMap={};this.allDataSource=this._createDataSource({id:'All',label:'All',type:this.DataSourceType.Category});this.searchResultSetFormatters.push(new a1());this.searchResultSetFormatters.push(new b1());},_initAsync:function(i){i=i||{};this.isDummyProvider=i.provider.indexOf("dummy")>-1;this.provider.label=i.label;return c.Promise.resolve().then(function(){return this._evaluateConfigurationAsync(i);}.bind(this)).then(function(){i.sina=this;return this.provider._initAsync.apply(this.provider,[i]);}.bind(this)).then(function(j){j=j||{};this.capabilities=j.capabilities||this._createCapabilities();return this._formatMetadataAsync();}.bind(this)).then(function(){if(this.getBusinessObjectDataSources().length===0&&!this.isDummyProvider){return Promise.reject(new c.Exception('Not active - no datasources'));}}.bind(this));},_formatMetadataAsync:function(){return c.executeSequentialAsync(this.metadataFormatters,function(i){return i.formatAsync({dataSources:this.dataSources});}.bind(this));},_evaluateConfigurationAsync:function(c1){var d1=[];if(c1.searchResultSetFormatters){for(var i=0;i<c1.searchResultSetFormatters.length;++i){var e1=c1.searchResultSetFormatters[i];if(!(e1 instanceof _)){e1=new Z(e1);}this.searchResultSetFormatters.push(e1);d1.push(e1.initAsync());}}if(c1.metadataFormatters){for(var j=0;j<c1.metadataFormatters.length;++j){var f1=c1.metadataFormatters[j];if(!(f1 instanceof _)){f1=new $(f1);}this.metadataFormatters.push(f1);d1.push(f1.initAsync());}}return c.Promise.all(d1);},loadMetadata:function(i){if(this.provider.loadMetadata){return this.provider.loadMetadata(i);}return c.Promise.resolve();},createDataSourceMap:function(j){var c1={};for(var i=0;i<j.length;++i){var d1=j[i];c1[d1.id]=d1;}return c1;},generateFactoryMethod:function(i){return function(j){j=j||{};j.sina=this;return new i(j);};},_createDataSource:function(i){i=i||{};i.sina=this;var j=new b(i);if(this.dataSourceMap[j.id]===j){throw new c.Exception('cannot create an already existing datasource: "'+j.id+'"');}this.dataSources.push(j);this.dataSourceMap[j.id]=j;return j;},getAllDataSource:function(){return this.allDataSource;},getBusinessObjectDataSources:function(){var j=[];for(var i=0;i<this.dataSources.length;++i){var c1=this.dataSources[i];if(!c1.hidden&&c1.type===this.DataSourceType.BusinessObject){j.push(c1);}}return j;},getDataSource:function(i){return this.dataSourceMap[i];},getConfigurationAsync:function(i){if(!this.provider.getConfigurationAsync){return c.Promise.resolve(this._createConfiguration({personalizedSearch:false,isPersonalizedSearchEditable:false}));}i=i||{};if(this.configurationPromise&&!i.forceReload){return this.configurationPromise;}this.configurationPromise=this.provider.getConfigurationAsync();return this.configurationPromise;},logUserEvent:function(i){if(!this.provider.logUserEvent){return;}this.provider.logUserEvent(i);},getDebugInfo:function(){var i=['Sina Provider:'+this.provider.id];if(this.provider.getDebugInfo){var j=this.provider.getDebugInfo();if(j){i.push(j);}}return i.join('\n');},parseDataSourceFromJson:function(j){var i=this.getDataSource(j.id);if(i){return i;}if(j.type!==this.DataSourceType.Category){throw new c.Exception('Datasource in URL does not exist '+j.id);}i=this._createDataSource(j);return i;},parseSimpleConditionFromJson:function(j){var i;if(c.isObject(j.value)){i=u.dateFromJson(j.value);}else{i=j.value;}return this.createSimpleCondition({operator:j.operator,attribute:j.attribute,value:i,attributeLabel:j.attributeLabel,valueLabel:j.valueLabel,userDefined:j.userDefined?true:false});},parseComplexConditionFromJson:function(j){var c1=[];for(var i=0;i<j.conditions.length;++i){var d1=j.conditions[i];c1.push(this.parseConditionFromJson(d1));}return this.createComplexCondition({operator:j.operator,conditions:c1,attributeLabel:j.attributeLabel,valueLabel:j.valueLabel,userDefined:j.userDefined?true:false});},parseConditionFromJson:function(j){switch(j.type){case'Simple':return this.parseSimpleConditionFromJson(j);case'Complex':return this.parseComplexConditionFromJson(j);default:throw new c.Exception('unknown condition type "'+j.type+'"');}},parseFilterFromJson:function(j){return this.createFilter({searchTerm:j.searchTerm,rootCondition:this.parseConditionFromJson(j.rootCondition),dataSource:this.parseDataSourceFromJson(j.dataSource)});}});});
