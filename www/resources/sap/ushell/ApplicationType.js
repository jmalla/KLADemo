// Copyright (c) 2009-2017 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/thirdparty/URI","sap/ushell/utils","sap/ushell/_ApplicationType/utils","sap/ushell/_ApplicationType/systemAlias","sap/ushell/_ApplicationType/wdaResolution","sap/ushell/_ApplicationType/guiResolution","sap/ushell/services/_ClientSideTargetResolution/ParameterMapping"],function(U,u,a,s,w,g,c,p){"use strict";function b(M,B,E){var I=M.inbound;var r=I&&I.resolutionResult;if(!(!I||!r||!(r["sap.wda"]))){return w.constructFullWDAResolutionResult(M,B,E);}if(!(!I||!r)){return w.constructWDAResolutionResult(M,B,E);}}function d(M,B,E){var o=new U(B),I=M.inbound,j=I&&I.resolutionResult,k=jQuery.extend(true,{},M.mappedIntentParamsPlusSimpleDefaults),S,l;if(k["sap-system"]){S=k["sap-system"][0];delete k["sap-system"];}if(k["sap-system-src"]){l=k["sap-system-src"][0];delete k["sap-system-src"];}return new Promise(function(r,R){s.spliceSapSystemIntoURI(o,j.systemAlias,S,l,"WCF",j.systemAliasSemantics||s.SYSTEM_ALIAS_SEMANTICS.apply,E).done(function(n){var P=a.getURLParsing().paramsToString(k),F=a.appendParametersToUrl(P,n.toString());var q={url:F,text:j.text||"",additionalInformation:j.additionalInformation||"",applicationType:"WCF",fullWidth:true};r(q);}).fail(function(n){R(n);});});}function e(M,B,E){var I=M.inbound,j,S,k,o,r={};["applicationType","additionalInformation","applicationDependencies"].forEach(function(P){if(I.resolutionResult.hasOwnProperty(P)){r[P]=I.resolutionResult[P];}});r.url=B;if(r.applicationDependencies&&typeof r.url==="undefined"){r.url="";}if(typeof r.url==="undefined"){return Promise.reject("Cannot resolve intent: url was not specified in matched inbound");}o=jQuery.extend(true,{},M.mappedIntentParamsPlusSimpleDefaults);r.reservedParameters={};var R={"sap-ui-fl-max-layer":true,"sap-ui-fl-control-variant-id":true};Object.keys(R).forEach(function(n){var v=o[n];if(v){delete o[n];r.reservedParameters[n]=v;}});M.mappedDefaultedParamNames=M.mappedDefaultedParamNames.filter(function(D){return!R[D];});if(M.mappedDefaultedParamNames.length>0){o["sap-ushell-defaultedParameterNames"]=[JSON.stringify(M.mappedDefaultedParamNames)];}S=o["sap-system"]&&o["sap-system"][0];k=o["sap-system-src"]&&o["sap-system-src"][0];r["sap-system"]=S;if(typeof k==="string"){r["sap-system-src"]=k;}M.effectiveParameters=o;j=a.getURLParsing().paramsToString(o);if(j){r.url=r.url+((r.url.indexOf("?")<0)?"?":"&")+j;}if(typeof I.resolutionResult.ui5ComponentName!=="undefined"){r.ui5ComponentName=I.resolutionResult.ui5ComponentName;}r.text=I.title;return Promise.resolve(r);}function f(M,B,E){var I=M.inbound,o=I&&I.resolutionResult,r={};var j=new U(B);var k=jQuery.extend(true,{},M.mappedIntentParamsPlusSimpleDefaults);if(M.inbound&&M.inbound.action==="launchURL"&&M.inbound.semanticObject==="Shell"){delete k["sap-external-url"];}var S=k["sap-system"]&&k["sap-system"][0];var l=k["sap-system-src"]&&k["sap-system-src"][0];r["sap-system"]=S;delete k["sap-system"];if(typeof l==="string"){r["sap-system-src"]=l;delete k["sap-system-src"];}return(new Promise(function(R,n){if(a.absoluteUrlDefinedByUser(j,o.systemAlias,o.systemAliasSemantics)){R(B);}else{s.spliceSapSystemIntoURI(j,o.systemAlias,S,l,"URL",o.systemAliasSemantics||s.SYSTEM_ALIAS_SEMANTICS.applied,E).fail(n).done(function(q){var t=q.toString();R(t);});}})).then(function(n){var P=a.getURLParsing().paramsToString(k);return a.appendParametersToUrl(P,n);},Promise.reject.bind(Promise)).then(function(n){["additionalInformation","applicationDependencies"].forEach(function(P){if(I.resolutionResult.hasOwnProperty(P)){r[P]=I.resolutionResult[P];}});r.url=n;r.text=I.title;r.applicationType="URL";return Promise.resolve(r);},Promise.reject.bind(Promise));}var A={URL:{type:"URL",generateResolutionResult:f,easyAccessMenu:{intent:"Shell-startURL",resolver:null,showSystemSelectionInUserMenu:true,showSystemSelectionInSapMenu:false,systemSelectionPriority:1}},WDA:{type:"WDA",generateResolutionResult:b,easyAccessMenu:{intent:"Shell-startWDA",resolver:w.resolveEasyAccessMenuIntentWDA,showSystemSelectionInUserMenu:true,showSystemSelectionInSapMenu:true,systemSelectionPriority:2}},TR:{type:"TR",generateResolutionResult:g.generateTRResolutionResult,easyAccessMenu:{intent:"Shell-startGUI",resolver:g.resolveEasyAccessMenuIntentWebgui,showSystemSelectionInUserMenu:true,showSystemSelectionInSapMenu:true,systemSelectionPriority:3}},NWBC:{type:"NWBC"},WCF:{type:"WCF",generateResolutionResult:d},SAPUI5:{type:"SAPUI5",generateResolutionResult:e}};function h(){return Object.keys(A).map(function(j){return A[j];}).filter(function(o){return typeof o.easyAccessMenu==="object";});}function i(){var E={};h().forEach(function(o){E[o.easyAccessMenu.intent]=o.easyAccessMenu.resolver;});return function(M){return E[M];};}var m={getEasyAccessMenuResolver:i(),getEasyAccessMenuDefinitions:h};Object.keys(m).forEach(function(M){Object.defineProperty(A,M,{value:m[M]});});return A;},false);
