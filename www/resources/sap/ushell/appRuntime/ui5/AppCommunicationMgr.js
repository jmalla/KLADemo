// Copyright (c) 2009-2017 SAP SE, All Rights Reserved
sap.ui.define([],function(){"use strict";var i;function A(){this.postResultPromises=[];this.cnt=0;addEventListener('message',this.handleMessageEvent.bind(null,this));A.prototype._handleMessageEvent=this.handleMessageEvent;}A.prototype.handleMessageEvent=function(c,m){var M=m.data;if(m===undefined)return;if(typeof M==="string"){try{M=JSON.parse(m.data);}catch(e){jQuery.sap.log.debug("Message received from origin '"+m.origin+"' cannot be parsed: "+e,M,"sap.ui5Isolation.AppCommunicationMgr");return;}}if(typeof M.type===undefined)return;if(M.type==="response"){if(M.request_id&&c.postResultPromises[M.request_id]){var r=c.postResultPromises[M.request_id];if(M.status==="success"){r.resolve(M.body.result);}else{r.reject();}}}else{}};A.prototype.postMessage=function(m){var a,t=window.parent;if(m){try{if("request"===m.type&&!m["request_id"]){m["request_id"]=this.getId();}a=JSON.stringify(m);t.postMessage(a,"*");}catch(e){jQuery.sap.log.error("Message '"+m+"' cannot be posted: "+e,"sap.ui5Isolation.AppCommunicationMgr");}}};A.prototype.sendMessageToOuterShell=function(m,p){var d=new jQuery.Deferred(),M={"type":"request","service":m,"body":(p?p:{})};this.postMessage(M);this.postResultPromises[M["request_id"]]=d;return d.promise();};A.prototype.postHashChange=function(n){var m={"type":"request","service":"sap.ushell.CrossApplicationNavigation.hashChange","body":{"newHash":n}};this.postMessage(m);};A.prototype.getId=function(){return"SAPUI5_ISOLATION_MSGID_"+(++this.cnt);};return{getInstance:function(){if(!i){i=new A();}return i;}};},false);
